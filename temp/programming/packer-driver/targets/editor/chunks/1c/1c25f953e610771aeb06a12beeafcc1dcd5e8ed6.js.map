{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/BatteryManager.ts"],"names":["BatteryManager","Node","UITransform","Vec3","Widget","Battery","getFileName","toNodeSpaceAR","batteryPositionConfig","textureConfig","commonConfig","batteryConfig","batterySkinConfig","batteryScoreConfig","fntScoreConfig","objectListSet","objectList","Map","batteryParent","uiCreaterList","controlCallback","sourceManage","fishManager","bulletManager","backgroundSceneManager","musicEffectPlayer","scaleRatio","rootNode","bulletServerID","resumeBulletID","getBulletID","init","parent","posConfig","tConfig","cConfig","bConfig","bsConfig","scoreConfig","fntConfig","clear","k","v","prefab","push","getFile","source","registerTouch","getRootNode","getBackgroundSceneManager","uninit","createAllBatteryByPosition","sendFuncs","sceneParam","i","ui","node","name","uit","addComponent","obj","addChild","create","pos","x","y","multiplyScalar","setPosition","widget","isAlignBottom","bottom","setAnchorPoint","isAlignTop","top","console","log","setPos","setBatteryInfo","info","has","user_info","player_id","batteryObj","set_id","pinfo","linfo","config_id","batt_cfg_id","side","local_pos","set","rotationOtherUserInfo","rotationInformation","resetRotation","removeBatteryByPlayerId","playerID","get","resumeBatteryState","delete","getBatteryByPlayerId","update","dt","getMyselfBatteryObj","myBattery","forEach","isMyBattery","clearAllLockState","unLockFish","setControlCall","call","callControl","getParentObj","seteAllUserUIHidden","setUserUIHidden","setStartGame","removeAllBattery","destroy","on","EventType","TOUCH_START","e","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded"],"mappings":"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","sourcesContent":["import { EventTouch, Node, UITransform, Vec3, Widget } from \"cc\"\r\nimport SourceManage from \"../../base/SourceManage\"\r\nimport { Battery } from \"./Battery\"\r\nimport { FishManager } from \"./FishManager\"\r\nimport { BulletManager } from \"./BulletManager\"\r\nimport { getFileName, toNodeSpaceAR } from \"./FishTool\"\r\nimport { BackgroundSceneManager } from \"./BackgroundSceneManager\"\r\nimport { MusicEffectPlayer } from \"./MusicEffectPlayer\"\r\n\r\n////////////////////////////////////////////////////////////////////////////////\r\n\r\nexport class BatteryManager {\r\n  // config\r\n  public batteryPositionConfig = []\r\n  public textureConfig = null\r\n  public commonConfig = null\r\n  public batteryConfig = null\r\n  public batterySkinConfig = null\r\n  public batteryScoreConfig = null\r\n  public fntScoreConfig = null\r\n\r\n  // member\r\n  public objectListSet = {}\r\n  public objectList: Map<String, Battery> = new Map();\r\n  public batteryParent: Node\r\n  public uiCreaterList = []\r\n  public controlCallback\r\n  public sourceManage: SourceManage\r\n  public fishManager: FishManager\r\n  private bulletManager: BulletManager;\r\n  private backgroundSceneManager: BackgroundSceneManager;\r\n  private musicEffectPlayer: MusicEffectPlayer;\r\n  /**缩放比例 */\r\n  private scaleRatio: number = 1;\r\n\r\n  private rootNode: Node;\r\n\r\n  private bulletServerID = 0;\r\n  public getBulletID() {\r\n    return ++this.bulletServerID;\r\n  }\r\n\r\n  public resumeBulletID = () => {\r\n    this.bulletServerID = 0\r\n  }\r\n\r\n\r\n  public init(parent: Node, rootNode: Node, posConfig, tConfig, cConfig, bConfig, bsConfig, scoreConfig, fntConfig, sourceManage: SourceManage,\r\n    bulletManager: BulletManager, fishManager: FishManager, backgroundSceneManager: BackgroundSceneManager, musicEffectPlayer: MusicEffectPlayer,\r\n    scaleRatio: number) {\r\n    this.batteryPositionConfig = posConfig\r\n    this.textureConfig = tConfig\r\n    this.commonConfig = cConfig\r\n    this.batteryConfig = bConfig\r\n    this.batterySkinConfig = bsConfig\r\n    this.batteryScoreConfig = scoreConfig\r\n    this.fntScoreConfig = fntConfig\r\n\r\n    this.objectListSet = {}\r\n    this.objectList.clear();\r\n    this.uiCreaterList = []\r\n    this.batteryParent = parent\r\n    this.rootNode = rootNode\r\n    this.sourceManage = sourceManage\r\n    this.bulletManager = bulletManager\r\n    this.fishManager = fishManager\r\n    this.backgroundSceneManager = backgroundSceneManager\r\n    this.musicEffectPlayer = musicEffectPlayer\r\n    this.scaleRatio = scaleRatio\r\n\r\n    for (const k in this.batteryPositionConfig) {\r\n      const v = this.batteryPositionConfig[k].prefab;\r\n      this.uiCreaterList.push(this.sourceManage.getFile(getFileName(v)).source);\r\n    }\r\n    this.resumeBulletID();\r\n    this.registerTouch();\r\n  }\r\n\r\n  public getRootNode() {\r\n    return this.rootNode\r\n  }\r\n\r\n  public getBackgroundSceneManager() {\r\n    return this.backgroundSceneManager\r\n  }\r\n\r\n  public uninit() {\r\n    this.batteryPositionConfig = null\r\n    this.textureConfig = null\r\n    this.commonConfig = null\r\n    this.batteryConfig = null\r\n    this.batterySkinConfig = null\r\n    this.batteryScoreConfig = null\r\n    this.fntScoreConfig = null\r\n\r\n    this.objectListSet = null\r\n    this.objectList = null\r\n    this.batteryParent = null\r\n    this.uiCreaterList = null\r\n    this.controlCallback = null\r\n    this.sourceManage = null\r\n    this.fishManager = null\r\n    this.bulletManager = null\r\n\r\n    this.resumeBulletID();\r\n  }\r\n\r\n  /**\r\n  * @param sendFuncs 发送消息函数\r\n  * @param sceneParam 场景参数\r\n  */\r\n  public createAllBatteryByPosition(sendFuncs, sceneParam) {\r\n    let i = 1;\r\n    for (const k in this.batteryPositionConfig) {\r\n      const v = this.batteryPositionConfig[k];\r\n      let ui = this.uiCreaterList[i - 1]\r\n      if (ui !== null) {\r\n        let node = new Node();\r\n        node.name = \"barrery\" + i;\r\n        const uit = node.addComponent(UITransform)\r\n        let obj = node.addComponent(Battery);\r\n        this.batteryParent.addChild(node)\r\n        obj.create(ui, this.textureConfig, this.commonConfig, this.batteryConfig, this.batterySkinConfig, this.batteryScoreConfig,\r\n          this.fntScoreConfig, sendFuncs, sceneParam, this.sourceManage, this.fishManager, this.bulletManager, this,\r\n          this.backgroundSceneManager, this.musicEffectPlayer)\r\n        const pos = new Vec3(v.pos.x, v.pos.y).multiplyScalar(this.scaleRatio);\r\n        obj.node.setPosition(toNodeSpaceAR(this.batteryParent, pos))\r\n        const widget = node.addComponent(Widget)\r\n        if (i === 1 || i === 2) {\r\n          widget.isAlignBottom = true;\r\n          widget.bottom = v.pos.y;\r\n          uit.setAnchorPoint(0.5, 0)\r\n        } else {\r\n          widget.isAlignTop = true;\r\n          widget.top = v.pos.y;\r\n          uit.setAnchorPoint(0.5, 1)\r\n        }\r\n\r\n        this.objectListSet[i] = obj\r\n      }\r\n      i++;\r\n    }\r\n    console.log(\"create all battery object information  +  +  +  +  +  +  +  +  +  +  +  +  +  +  +  +  + \")\r\n  }\r\n\r\n  public setPos() {\r\n    // let i = 1;\r\n    // for (const k in this.batteryPositionConfig) {\r\n    //   const v = this.batteryPositionConfig[k];\r\n    //   const battery = this.objectListSet[i] as Battery;\r\n    //   const node = battery.node;\r\n    //   const uit = node.getComponent(UITransform)\r\n    //   const widget = node.getComponent(Widget)\r\n    //   if (i === 1 || i === 2) {\r\n    //     widget.isAlignBottom = true;\r\n    //     widget.bottom = v.pos.y;\r\n    //     uit.setAnchorPoint(0.5, 0)\r\n    //   } else {\r\n    //     widget.isAlignTop = true;\r\n    //     widget.top = v.pos.y;\r\n    //     uit.setAnchorPoint(0.5, 0)\r\n    //   }\r\n    //   i++;\r\n    // }\r\n  }\r\n\r\n  /**\r\n  info = {\r\n    user_info = {\r\n      player_id \t  = 0,//玩家id\r\n      set_id \t\t  = -1,//坐位id\r\n      is_let \t  = false,//是否为本地，区别自己与别人的炮台\r\n      gold \t\t  = 0,//金币\r\n      head_id \t  = 0,//头像\r\n      level \t\t  = 0,//等级\r\n      vip_level \t  = 0,//vip等级\r\n      nick_name \t  = \"1234\",//昵称\r\n      battery_id \t  = 0 //炮id\r\n        battery_score  = 0.01\r\n        isPowerBattery = false\r\n        room_id\r\n         + + \r\n      },\r\n    }\r\n   */\r\n  public setBatteryInfo(info) {\r\n    if (!this.objectList.has(info.user_info.player_id)) {\r\n      let batteryObj = this.objectListSet[info.user_info.set_id] as Battery\r\n      if (batteryObj) {\r\n        let pinfo = this.batteryPositionConfig[info.user_info.set_id]\r\n        const pos = new Vec3(pinfo.pos.x, pinfo.pos.y).multiplyScalar(this.scaleRatio);\r\n        let linfo = {\r\n          config_id: pinfo.batt_cfg_id,\r\n          user_info: info.user_info,\r\n          side: pinfo.side,\r\n          local_pos: pos,\r\n        }\r\n        this.objectList.set(info.user_info.player_id, batteryObj);\r\n        batteryObj.setBatteryInfo(linfo, this.batteryParent);\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public rotationOtherUserInfo() {\r\n    for (const i in this.objectListSet) {\r\n      const v = this.objectListSet[i] as Battery;\r\n      v.rotationInformation(i)\r\n    }\r\n  }\r\n\r\n  public resetRotation() {\r\n    for (const i in this.objectListSet) {\r\n      const v = this.objectListSet[i] as Battery;\r\n      v.resetRotation()\r\n    }\r\n  }\r\n\r\n  public removeBatteryByPlayerId(playerID) {\r\n    let batteryObj = this.objectList.get(playerID) as Battery;\r\n    if (batteryObj) {\r\n      batteryObj.resumeBatteryState()\r\n    }\r\n    this.objectList.delete(playerID);\r\n  }\r\n\r\n  public getBatteryByPlayerId(playerID) {\r\n    return this.objectList.get(playerID) as Battery\r\n  }\r\n\r\n  public update(dt) {\r\n    // for (const k in this.objectList) {\r\n    //   const v = this.objectList[k];\r\n    //   if (!v) continue;\r\n    //   v.update(dt)\r\n    // }\r\n  }\r\n\r\n  /**获得自己位置的炮台 */\r\n  public getMyselfBatteryObj(): Battery {\r\n    let myBattery = null;\r\n    this.objectList.forEach((v, k) => {\r\n      if (v.isMyBattery()) {\r\n        myBattery = v;\r\n      }\r\n    })\r\n    return myBattery\r\n  }\r\n\r\n  public clearAllLockState() {\r\n    this.objectList.forEach((v, k) => {\r\n      v.unLockFish();\r\n    })\r\n  }\r\n\r\n  public setControlCall(call) {\r\n    this.controlCallback = call\r\n  }\r\n\r\n  public callControl() {\r\n    if (this.controlCallback) {\r\n      this.controlCallback()\r\n    }\r\n  }\r\n\r\n  public getParentObj() {\r\n    return this.batteryParent\r\n  }\r\n\r\n  public seteAllUserUIHidden() {\r\n    this.objectList.forEach((v, k) => {\r\n      v.setUserUIHidden();\r\n    })\r\n  }\r\n\r\n  public setStartGame() {\r\n    for (const i in this.objectListSet) {\r\n      const v = this.objectListSet[i] as Battery;\r\n      if (!v) continue;\r\n      v.setStartGame()\r\n    }\r\n  }\r\n\r\n  public removeAllBattery() {\r\n    for (const i in this.objectListSet) {\r\n      const v = this.objectListSet[i] as Battery;\r\n      v.node.destroy();\r\n    }\r\n\r\n    this.objectListSet = {};\r\n    this.objectList.clear();\r\n  }\r\n\r\n  private registerTouch() {\r\n    this.batteryParent.on(Node.EventType.TOUCH_START, (e: EventTouch) => {\r\n      const myBattery = this.getMyselfBatteryObj();\r\n      myBattery && myBattery.onTouchBegan(e);\r\n    });\r\n    this.batteryParent.on(Node.EventType.TOUCH_MOVE, (e: EventTouch) => {\r\n      const myBattery = this.getMyselfBatteryObj();\r\n      myBattery && myBattery.onTouchMoved(e);\r\n    });\r\n    this.batteryParent.on(Node.EventType.TOUCH_END, (e: EventTouch) => {\r\n      const myBattery = this.getMyselfBatteryObj();\r\n      myBattery && myBattery.onTouchEnded(e);\r\n    });\r\n  }\r\n}\r\n\r\n\r\n"]}