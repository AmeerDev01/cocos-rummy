{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfcV2/viewModel/GxfcV2MainViewModel.ts"],"names":["ViewModel","StoreInject","ModalBox","global","lang","addToastAction","UseSetOption","config","cacheData","clearCacheData","GxfcV2_Audio","sourceManageSeletor","SKT_MAG_TYPE","sktInstance","sktMsgListener","bundlePkgName","PrefabPathDefine","getStore","changeGame","setAutoLauncherInfo","updateGold","updateJackpotAmount","updateJackpotDatas","updatePositionId","updateWinloss","updateRollerStatus","AutoLauncherType","GameType","RollerStatus","calBetAmount","isAuto","isSubGameToSubGame","verifyBetResultData","GxfcV2DialogWinViewModel","GxfcV2FoolerViewModel","GxfcV2HeaderViewModel","GxfcV2RollerPanelViewModel","GxfcV2RulePanelViewModel","EffectType","SoundPathDefine","GxfcV2MainViewModel","constructor","initCallback","headerViewModel","footerViewModel","rollerPanelViewModel","isBetResult","goodLuckPos","betCallbackFun","begin","mountViewNode","comp","getHeader","connect","setEvent","quitGame","onQuitGame","getFooter","getRoller","onSendBet","sendBet","onOpenRule","openRule","add","AUTH","data","error","closeSubGame","confirmContent","write","k","InitGameModule","FetcherFaild","gameType","SUBGAME2","fixedChessboardIcon","authData","dispatch","bl","lastGameType","viewGameType","currGameType","leftCount","freeGameCount","freeGameAmount","playBgMusic","SUBGAME1","initSlot","scheduleOnce","viewNode","isValid","props","autoLauncherInfo","gameTypeInfo","sendSktMessage","token","localStorage","getItem","gameId","LAUNCH","unschedule","undefined","result","playOneShot","ding","content","Instance","show","type","rollerLaunchResult","si","dl","rollerId","i","length","console","log","localLeftCount","freeCount","nextLeftCount","isDelay","NONE","REFRESHCOINS","JACKPOT","JACKPOT_TOTAL","option","gameSet","gxfcv2","betTarget","betAmount","positionId","MAIN","gold","hallDispatch","palyingModule","RechangeGlod","placeStr","autoLauncherType","totalCount","sendBetTime","Date","now","RUNNING","betListenerTimeHandle","bind","schedule","tableId","WebSocketModule","WebSocketError","unMountCallBack","removeById","unMount","getRollerPanelViewModel","showDialogWin","dialogInfo","done","gxfcv2DialogWinViewModel","mountView","getFile","DIALOG_WIN","source","appendTo","setProps","onWindowCloseHandler","getGoodLuckPos","setGoodLuckPos","pos","rulePanelViewMode","RULEPANEL","effectType","EFFECT1","stop","play","Main_bg","Free_bg","inject","state","betDropDownlist","game","subGameAnimationPlayInfo","jackpotDatas","jackpotTotalAmount"],"mappings":"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","sourcesContent":["import { Vec3 } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport ModalBox from \"../../../common/ModalBox\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\nimport UseSetOption from \"../../../utils/UseSetOption\"\r\nimport { GxfcV2_Main, IEvent, IProps } from \"../components/GxfcV2_Main\"\r\nimport config from \"../config\"\r\nimport { cacheData, clearCacheData } from \"../dataTransfer\"\r\nimport { GxfcV2_Audio, sourceManageSeletor } from \"../index\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { bundlePkgName } from \"../sourceDefine\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { getStore } from \"../store\"\r\nimport { changeGame, initGameStore, setAutoLauncherInfo, updateGold, updateJackpotAmount, updateJackpotDatas, updatePositionId, updateWinloss } from \"../store/actions/game\"\r\nimport { updateRollerStatus } from \"../store/actions/roller\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { AuthDataVo, AutoLauncherType, DialogInfo, GameType, JackpotData, RollerLaunchResult, RollerStatus, calBetAmount, isAuto, isSubGameToSubGame, verifyBetResultData } from \"../type\"\r\nimport GxfcV2DialogWinViewModel from \"./GxfcV2DialogWinViewModel\"\r\nimport GxfcV2FoolerViewModel from \"./GxfcV2FoolerViewModel\"\r\nimport GxfcV2HeaderViewModel from \"./GxfcV2HeaderViewModel\"\r\nimport GxfcV2RollerPanelViewModel from \"./GxfcV2RollerPanelViewModel\"\r\nimport GxfcV2RulePanelViewModel from \"./GxfcV2RulePanelViewModel\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\n\r\n@StoreInject(getStore())\r\nclass GxfcV2MainViewModel extends ViewModel<GxfcV2_Main, IProps, IEvent> {\r\n  private initCallback;\r\n  constructor(initCallback) {\r\n    super('GxfcV2_Main')\r\n    this.initCallback = initCallback;\r\n  }\r\n\r\n  private headerViewModel: GxfcV2HeaderViewModel;\r\n  private footerViewModel: GxfcV2FoolerViewModel;\r\n  public rollerPanelViewModel: GxfcV2RollerPanelViewModel;\r\n\r\n  private isBetResult = true;\r\n\r\n  /**奖励的坐标 */\r\n  private goodLuckPos: Vec3;\r\n\r\n  private betCallbackFun;\r\n  protected begin() {\r\n    this.headerViewModel = new GxfcV2HeaderViewModel().mountViewNode(this.comp.getHeader()).connect();\r\n    this.headerViewModel.setEvent({\r\n      quitGame: () => {\r\n        this.onQuitGame();\r\n      }\r\n    })\r\n    this.footerViewModel = new GxfcV2FoolerViewModel().mountViewNode(this.comp.getFooter()).connect();\r\n    this.rollerPanelViewModel = new GxfcV2RollerPanelViewModel().mountViewNode(this.comp.getRoller()).connect();\r\n\r\n    this.footerViewModel.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      },\r\n      onOpenRule: () => {\r\n        this.openRule();\r\n      }\r\n    })\r\n    this.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      }\r\n    })\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.AUTH, bundlePkgName, (data: AuthDataVo, error) => {\r\n      if (error) {\r\n        return;\r\n      }\r\n\r\n      if (!data) {\r\n        global.closeSubGame({\r\n          confirmContent: lang.write(k => k.InitGameModule.FetcherFaild) + '-' + SKT_MAG_TYPE.AUTH\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (data.gameType === GameType.SUBGAME2) {\r\n        // 锁定的图标\r\n        cacheData.fixedChessboardIcon = data.fixedChessboardIcon;\r\n      }\r\n\r\n      cacheData.authData = data;\r\n      this.dispatch(updateGold(data.bl));\r\n\r\n      this.dispatch(changeGame({\r\n        lastGameType: data.gameType,\r\n        viewGameType: data.gameType,\r\n        currGameType: data.gameType,\r\n        leftCount: data.freeGameCount,\r\n        freeGameAmount: data.freeGameAmount,\r\n      }))\r\n\r\n      this.playBgMusic();\r\n\r\n      if (data.freeGameAmount > 0 && data.gameType === GameType.SUBGAME1) {\r\n        this.dispatch(updateWinloss(data.freeGameAmount));\r\n      }\r\n\r\n      // 这里初始化插槽\r\n      this.rollerPanelViewModel.comp.initSlot();\r\n      // 延时一点时间才卸载laoding界面\r\n      this.comp.scheduleOnce(() => {\r\n        this.viewNode.isValid && this.initCallback && this.initCallback();\r\n\r\n        // 进入游戏之后如果是自动游戏，就发送下注\r\n        if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n          this.comp.scheduleOnce(() => {\r\n            this.sendBet();\r\n          },1)\r\n        }\r\n\r\n      }, 0.1)\r\n    })\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.AUTH, {\r\n      token: localStorage.getItem(\"token\"),\r\n      gameId: config.gameId\r\n    });\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, bundlePkgName, (data: RollerLaunchResult, error) => {\r\n      this.comp.unschedule(this.betCallbackFun);\r\n      this.betCallbackFun = undefined;\r\n      this.isBetResult = true;\r\n      const result = verifyBetResultData(data)\r\n      if (!error && result > 0) {\r\n        GxfcV2_Audio.playOneShot(SoundPathDefine.ding)\r\n        const content = lang.write(k => k.InitGameModule.FetcherFaild) + '-ERROR(' + result + ')';\r\n        ModalBox.Instance().show({\r\n          content: content, type: 'Prompt'\r\n        }, () => {\r\n          return true\r\n        })\r\n        return;\r\n      }\r\n      cacheData.rollerLaunchResult = data;\r\n\r\n      const si = cacheData.rollerLaunchResult.dl.si[0];\r\n      if (si.gameType === GameType.SUBGAME2 || this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n        //每局的锁定图标\r\n        cacheData.fixedChessboardIcon = si.fixedChessboardIcon;\r\n      }\r\n\r\n      // 服务器的索引是从1开始的\r\n      const rollerId = si.rollerId\r\n      for (let i = 0; i < rollerId.length; i++) {\r\n        rollerId[i]--;\r\n      }\r\n      console.log(\"rollerId \", si.rollerId)\r\n\r\n      const localLeftCount = this.comp.props.gameTypeInfo.leftCount;\r\n      let leftCount = si.freeCount;\r\n      let nextLeftCount = undefined;\r\n      let isDelay = false;\r\n      // 小游戏切到小游戏时，暂不改变切换状态\r\n      // 为了让玩家延时看到剩余的次数，特殊处理\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.gameType)) {\r\n\r\n      }\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.gameType)\r\n        || (si.freeCount >= localLeftCount && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) // 如果服务器给的次数比本地的次数大了，说明次数发生变化，延迟显示\r\n        || (localLeftCount - si.freeCount > 1 && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2)) { //如果服务器给的次数小于本地的次数超过了1次，说明次数发生变化，延迟显示\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n\r\n      if (isDelay) {\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n\r\n      this.dispatch(changeGame({\r\n        lastGameType: GameType.NONE,\r\n        viewGameType: this.comp.props.gameTypeInfo.viewGameType,\r\n        currGameType: si.gameType,\r\n        leftCount: leftCount,\r\n        freeGameAmount: si.freeGameAmount,\r\n        nextLeftCount: nextLeftCount\r\n      }))\r\n    })\r\n\r\n    // 更新金额\r\n    sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateGold(data));\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT, bundlePkgName, (data: JackpotData[], error) => {\r\n      this.dispatch(updateJackpotDatas(data))\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT_TOTAL, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateJackpotAmount(data))\r\n    })\r\n\r\n    if (UseSetOption.Instance().option.gameSet.gxfcv2 && UseSetOption.Instance().option.gameSet.gxfcv2.betTarget) {\r\n      this.dispatch(updatePositionId(UseSetOption.Instance().option.gameSet.gxfcv2.betTarget))\r\n    } else {\r\n      this.dispatch(updatePositionId(1))\r\n    }\r\n  }\r\n\r\n  private sendBet() {\r\n    if (!this.isBetResult) {\r\n      console.log(\"已经发送过了下注，不能重复发送，等待服务器返回\")\r\n      return;\r\n    }\r\n\r\n    const betAmount = calBetAmount(this.comp.props.positionId)\r\n    // 在主游戏中才提示余额不足\r\n    if (this.comp.props.gameTypeInfo.viewGameType === GameType.MAIN && this.comp.props.gold < betAmount) {\r\n      global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.RechangeGlod, {}, { placeStr: \"对不起，您的金币不足，请充值！\" }) }))\r\n\r\n      // 如果余额不足，并且是自动状态，就取消自动\r\n      if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n        this.dispatch(setAutoLauncherInfo({\r\n          autoLauncherType: AutoLauncherType.NONE,\r\n          totalCount: 0,\r\n          leftCount: 0\r\n        }))\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (this.comp.props.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n      this.dispatch(updateGold(this.comp.props.gold - betAmount));\r\n    }\r\n\r\n    cacheData.sendBetTime = Date.now();\r\n    console.log(\"sendBet time \" + cacheData.sendBetTime)\r\n\r\n    cacheData.rollerLaunchResult = null;\r\n    cacheData.fixedChessboardIcon = null;\r\n    this.dispatch(updateRollerStatus(RollerStatus.RUNNING));\r\n    this.isBetResult = false;\r\n    this.betCallbackFun = this.betListenerTimeHandle.bind(this);\r\n    this.comp.schedule(this.betCallbackFun, 10);\r\n\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n      \"positionId\": this.comp.props.positionId,\r\n      \"tableId\": cacheData.authData.tableId,\r\n    });\r\n  }\r\n\r\n  private betListenerTimeHandle() {\r\n    if (!this.isBetResult) {\r\n      this.isBetResult = true;\r\n      const content = lang.write(k => k.WebSocketModule.WebSocketError) + '-' + SKT_MAG_TYPE.LAUNCH;\r\n      GxfcV2_Audio.playOneShot(SoundPathDefine.ding)\r\n      ModalBox.Instance().show({\r\n        content: content, type: 'Prompt'\r\n      }, () => {\r\n        this.onQuitGame();\r\n        return true\r\n      })\r\n    }\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    sktMsgListener.removeById(bundlePkgName)\r\n    this.footerViewModel.unMount();\r\n    this.headerViewModel.unMount();\r\n    this.rollerPanelViewModel.unMount();\r\n    clearCacheData();\r\n  }\r\n\r\n  public getRollerPanelViewModel() {\r\n    return this.rollerPanelViewModel;\r\n  }\r\n\r\n  private onQuitGame() {\r\n    global.closeSubGame();\r\n  }\r\n\r\n  /**显示大奖 */\r\n  public showDialogWin(dialogInfo: DialogInfo, done) {\r\n    let gxfcv2DialogWinViewModel = new GxfcV2DialogWinViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.DIALOG_WIN).source)\r\n      .appendTo(this.viewNode);\r\n      gxfcv2DialogWinViewModel.setProps({\r\n      dialogInfo: dialogInfo,\r\n      gameTypeInfo: this.comp.props.gameTypeInfo,\r\n      autoLauncherInfo: this.comp.props.autoLauncherInfo,\r\n    })\r\n    gxfcv2DialogWinViewModel.setEvent({\r\n      onWindowCloseHandler: () => {\r\n        done && done();\r\n      }\r\n    })\r\n  }\r\n\r\n  public getGoodLuckPos() {\r\n    return this.goodLuckPos;\r\n  }\r\n\r\n  public setGoodLuckPos(pos: Vec3) {\r\n    this.goodLuckPos = pos;\r\n  }\r\n\r\n  public openRule() {\r\n    const rulePanelViewMode = new GxfcV2RulePanelViewModel()\r\n      .mountView(sourceManageSeletor().getFile(PrefabPathDefine.RULEPANEL).source)\r\n      .appendTo(this.viewNode, { effectType: EffectType.EFFECT1 });\r\n  }\r\n\r\n  public playBgMusic() {\r\n    GxfcV2_Audio.stop();\r\n    if (this.comp.props.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n      GxfcV2_Audio.play(SoundPathDefine.Main_bg, true)\r\n    } else if (this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME1) {\r\n\t\t\tGxfcV2_Audio.play(SoundPathDefine.Free_bg, true)\r\n    }\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      return {\r\n        betDropDownlist: state.game.betDropDownlist,\r\n        positionId: state.game.positionId,\r\n        gold: state.game.gold,\r\n        gameTypeInfo: state.game.gameTypeInfo,\r\n        subGameAnimationPlayInfo: state.game.subGameAnimationPlayInfo,\r\n        jackpotDatas: state.game.jackpotDatas,\r\n        jackpotTotalAmount: state.game.jackpotTotalAmount,\r\n        autoLauncherInfo: state.game.autoLauncherInfo,\r\n      }\r\n    })\r\n    return this\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default GxfcV2MainViewModel"]}