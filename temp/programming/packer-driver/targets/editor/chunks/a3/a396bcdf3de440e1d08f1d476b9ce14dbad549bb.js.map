{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fruit777/components/Fruit777_BigPrize.ts"],"names":["_decorator","Label","Node","sp","Vec3","BaseComponent","sourceManageSeletor","TaskScheduler","Task","StepNumber","ccclass","property","Fruit777_BigPrize","taskScheduler","winnerConfig","propertyNode","props_sb_lbjs_BIGWIN","props_slots_common_game_bw_gold","props_slots_goldNum","props","winning","glodAmount","keepTime","events","killSelfHandler","start","initState","bindEvent","useProps","key","value","cur","titleSkeleton","getComponent","Skeleton","skeletonData","getFile","fileName","source","name","animation","x","y","z","position","setPosition","timeScale","loop","active","glodSkeleton","node","scheduleOnce","joinqQueue","done","pre","num","string","toFixed","formatAmountWithCommas","destroyCallBack","destoryQueue","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, Node, Skeleton, sp, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { sourceManageSeletor } from '../index';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\twinning?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t},\r\n\tglodAmount?: number,\r\n\tkeepTime?: number\r\n}\r\nexport interface IEvent {\r\n\t/**自灭弹窗 */\r\n\tkillSelfHandler: () => void\r\n}\r\n\r\n@ccclass('Fruit777_BigPrize')\r\nexport class Fruit777_BigPrize extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate taskScheduler: TaskScheduler = new TaskScheduler()\r\n\tprivate winnerConfig: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t}[] = []\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_sb_lbjs_BIGWIN: new Node(),\r\n\t\tprops_slots_common_game_bw_gold: new Node(),\r\n\t\tprops_slots_goldNum: new Label()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\twinning: null,\r\n\t\tglodAmount: 0,\r\n\t\tkeepTime: 3000\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tkillSelfHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"winning\") {\r\n\t\t\tthis.winnerConfig = value.cur\r\n\t\t\tif (value.cur) {\r\n\t\t\t\tconst titleSkeleton = this.propertyNode.props_sb_lbjs_BIGWIN.getComponent(sp.Skeleton)\r\n\t\t\t\ttitleSkeleton.skeletonData = sourceManageSeletor().getFile(this.props.winning.fileName[0]).source\r\n\t\t\t\tif (value.cur.name === \"watermelon\") {\r\n\t\t\t\t\ttitleSkeleton.animation = \"animation\"\r\n\t\t\t\t\tconst { x, y, z } = this.propertyNode.props_sb_lbjs_BIGWIN.position\r\n\t\t\t\t\tthis.propertyNode.props_sb_lbjs_BIGWIN.setPosition(new Vec3(x, y - 100, z))\r\n\t\t\t\t\ttitleSkeleton.timeScale = 0.4\r\n\t\t\t\t\ttitleSkeleton.loop = false\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttitleSkeleton.animation = \"a2\"\r\n\t\t\t\t\ttitleSkeleton.timeScale = 1\r\n\t\t\t\t\t// const { x, y, z } = this.propertyNode.props_sb_lbjs_BIGWIN.position\r\n\t\t\t\t\t// this.propertyNode.props_sb_lbjs_BIGWIN.setPosition(new Vec3(x, y + 80, z))\r\n\t\t\t\t}\r\n\t\t\t\tif (this.props.winning.fileName[1]) {\r\n\t\t\t\t\tthis.propertyNode.props_slots_common_game_bw_gold.active = true\r\n\t\t\t\t\tconst glodSkeleton = this.propertyNode.props_slots_common_game_bw_gold.getComponent(sp.Skeleton)\r\n\t\t\t\t\tglodSkeleton.skeletonData = sourceManageSeletor().getFile(this.props.winning.fileName[1]).source\r\n\t\t\t\t\tglodSkeleton.animation = \"loop\"\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.propertyNode.props_slots_common_game_bw_gold.active = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"glodAmount\") {\r\n\t\t\tif (this.props.winning.name === \"watermelon\") {\r\n\t\t\t\tthis.propertyNode.props_slots_goldNum.node.active = false\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.propertyNode.props_slots_goldNum.node.active = true\r\n\t\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\t\tthis.propertyNode && this.propertyNode.props_slots_goldNum && (this.propertyNode.props_slots_goldNum.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\tthis.events && this.events.killSelfHandler()\r\n\t\t\t\t\t\t\t\t//数字展示完了之后，再停留1秒钟\r\n\t\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\t}, 2)\r\n\t\t\t\t\t\t})).start()\r\n\t\t\t\t\t}))\r\n\t\t\t\t}, 1)\r\n\t\t\t} else {\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\tthis.propertyNode && this.propertyNode.props_slots_goldNum && (this.propertyNode.props_slots_goldNum.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tthis.events && this.events.killSelfHandler()\r\n\t\t\t\t\t\t\t//数字展示完了之后，再停留1秒钟\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t}, 1)\r\n\t\t\t\t\t})).start()\r\n\t\t\t\t}), true)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected destroyCallBack(): void {\r\n\t\tthis.taskScheduler.destoryQueue()\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n"]}