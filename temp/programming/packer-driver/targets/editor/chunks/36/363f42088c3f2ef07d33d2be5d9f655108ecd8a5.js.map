{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/FishTool.ts"],"names":["Animation","AnimationClip","AudioClip","Font","Node","ParticleSystem2D","Prefab","Sprite","SpriteAtlas","SpriteFrame","UITransform","Vec3","sp","getFileType","file","strArr","split","fileSuffie","SkeletonData","getFileName","isPng","createSpriteNode","sourceManage","parentNode","fileSrc","source","getFile","fishNode","addChild","addComponent","spriteFrame","createSpriteAtlasNode","src_cfg","spriteName","spriteAtlas","getSpriteFrame","getSpriteAtlasBySpriteFrame","setSpriteFrameBySpriteAtlas","node","sprite","getComponent","setSpriteFrame","setSpriteAtlasNode","createAnimationNode","isPlay","isLoop","done","undefined","animationNode","sizeMode","SizeMode","RAW","trim","String","pattern","format","createAnimation","fishSpriteFrames","getSpriteFrames","filter","v","name","startsWith","key","sort","v1","v2","c1","parseInt","c2","sample","ft","clip","createWithSpriteFrames","wrapMode","WrapMode","Loop","Normal","anima","addClip","defaultClip","play","on","EventType","FINISHED","addAnimation","getAnimation","createParticleSystemNode","p","autoRemoveOnFinish","createSkeleton","sk","Skeleton","skeletonData","premultipliedAlpha","loop","createFont","llcompare","a","b","llminus","llplus","g_ByRandomSelectID","lst","val","Math","random","sum","i","length","gi","id","toNodeSpaceAR","parent","pos","convertToNodeSpaceAR","x","y","toWorldSpaceAR","convertToWorldSpaceAR"],"mappings":"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","sourcesContent":["import { Animation, AnimationClip, AudioClip, Font, Node, ParticleSystem2D, Prefab, Sprite, SpriteAtlas, SpriteFrame, UITransform, Vec3, sp } from \"cc\";\r\nimport SourceManage, { ISourceFile } from \"../../base/SourceManage\";\r\n\r\nexport const getFileType = (file: string) => {\r\n  const strArr = file.split('.');\r\n  const fileSuffie = strArr[1];\r\n  if (fileSuffie === 'plist') {\r\n    return SpriteAtlas;\r\n  } else if (fileSuffie === 'json') {\r\n    return sp.SkeletonData;\r\n  } else if (fileSuffie === 'prefab') {\r\n    return Prefab;\r\n  } else if (fileSuffie === 'fnt') {\r\n    return Font;\r\n  } else if (fileSuffie === 'mp3') {\r\n    return AudioClip;\r\n  }\r\n  return SpriteFrame;\r\n}\r\n\r\nexport const getFileName = (file: string) => {\r\n  const strArr = file.split('.');\r\n  const fileSuffie = strArr[1];\r\n  const isPng = fileSuffie === 'png' || fileSuffie === 'jpg';\r\n\r\n  if (isPng) {\r\n    return strArr[0] + '/spriteFrame'\r\n  }\r\n  return strArr[0]\r\n}\r\n\r\n/**\r\n * 创建图片节点\r\n * @param sourceManage 预加载资源管理对象\r\n * @param parentNode 父节点\r\n * @param fileSrc 文件路径\r\n * @returns \r\n */\r\nexport const createSpriteNode = (sourceManage: SourceManage, parentNode: Node, fileSrc) => {\r\n  const source = sourceManage.getFile(getFileName(fileSrc)).source;\r\n  let fishNode = new Node();\r\n  parentNode.addChild(fishNode);\r\n  fishNode.addComponent(Sprite).spriteFrame = source;\r\n  return fishNode;\r\n}\r\n\r\n/**\r\n * 从图集中创建图片\r\n * @param sourceManage 预加载资源管理对象\r\n * @param parentNode 父节点\r\n * @param src_cfg 文件路径\r\n * @param spriteName 图片名称\r\n * @returns \r\n */\r\nexport const createSpriteAtlasNode = (sourceManage: SourceManage, parentNode: Node, src_cfg, spriteName: string) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source as SpriteAtlas;\r\n  let fishNode = new Node();\r\n  parentNode.addChild(fishNode);\r\n  const sp = fishNode.addComponent(Sprite)\r\n  sp.spriteAtlas = source;\r\n  sp.spriteFrame = source.getSpriteFrame(spriteName);\r\n  return fishNode;\r\n}\r\n\r\n/**\r\n * 获得图片资源\r\n * @param sourceManage \r\n * @param src_cfg \r\n * @param spriteName \r\n * @returns \r\n */\r\nexport const getSpriteAtlasBySpriteFrame = (sourceManage: SourceManage, src_cfg, spriteName: string) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source as SpriteAtlas;\r\n  return source.getSpriteFrame(spriteName);\r\n}\r\n\r\n\r\n/**\r\n * 获得图片资源\r\n * @param sourceManage \r\n * @param spriteName \r\n * @returns \r\n */\r\nexport const getSpriteFrame = (sourceManage: SourceManage, fileSrc: string) => {\r\n  return sourceManage.getFile(fileSrc).source as SpriteFrame;\r\n}\r\n/**\r\n * 设置精灵\r\n * @param sourceManage \r\n * @param node \r\n * @param spriteName \r\n */\r\nexport const setSpriteFrameBySpriteAtlas = (sourceManage: SourceManage, node: Node, src_cfg, spriteName: string) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source as SpriteAtlas;\r\n  let sprite = node.getComponent(Sprite);\r\n  if (!sprite) {\r\n    sprite = node.addComponent(Sprite);\r\n  }\r\n  sprite.spriteFrame = source.getSpriteFrame(spriteName);\r\n}\r\n\r\n/**\r\n * 设置精灵\r\n * @param sourceManage \r\n * @param node \r\n * @param spriteName \r\n */\r\nexport const setSpriteFrame = (sourceManage: SourceManage, node: Node, fileSrc: string) => {\r\n  let sprite = node.getComponent(Sprite);\r\n  if (!sprite) {\r\n    sprite = node.addComponent(Sprite);\r\n  }\r\n  sprite.spriteFrame = sourceManage.getFile(fileSrc).source;\r\n}\r\n\r\n\r\n/**\r\n * 从图集中设置图片\r\n * @param sourceManage 预加载资源管理对象\r\n * @param node 要设置图片的节点\r\n * @param src_cfg 文件路径\r\n * @param spriteName 图片名称\r\n * @returns \r\n */\r\nexport const setSpriteAtlasNode = (sourceManage: SourceManage, node: Node, src_cfg, spriteName: string) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source as SpriteAtlas;\r\n  let sp = node.getComponent(Sprite)\r\n  if (!sp) {\r\n    sp = node.addComponent(Sprite)\r\n  }\r\n  sp.spriteAtlas = source;\r\n  sp.spriteFrame = source.getSpriteFrame(spriteName);\r\n  return node;\r\n}\r\n\r\n/**\r\n * 创建序列帧动画节点\r\n * @param sourceManage 预加载资源管理\r\n * @param parentNode 父节点\r\n * @param src_cfg 资源配置对象\r\n * @param isPlay 是否创建之后立马播放\r\n * @param isLoop 是否循环\r\n * @returns \r\n */\r\nexport const createAnimationNode = (sourceManage: SourceManage, parentNode: Node, src_cfg, isPlay: boolean, isLoop: boolean, done = undefined) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source;\r\n  let animationNode = new Node();\r\n  parentNode.addChild(animationNode);\r\n  const sp = animationNode.addComponent(Sprite)\r\n  sp.sizeMode = Sprite.SizeMode.RAW;\r\n  sp.trim = false;\r\n  sp.spriteAtlas = source;\r\n  sp.spriteFrame = source.getSpriteFrame(String(src_cfg.pattern).format(1));\r\n  createAnimation(animationNode, source, src_cfg, isPlay, isLoop, done);\r\n  return animationNode;\r\n}\r\n\r\n/**\r\n * 创建序列帧\r\n * @param animationNode 动画节点\r\n * @param spriteAtlas 图集\r\n * @param src_cfg 资源配置对象\r\n * @param done 完成之后的回调\r\n */\r\nexport const createAnimation = (animationNode: Node, spriteAtlas: SpriteAtlas, src_cfg, isPlay: boolean, isLoop: boolean, done = undefined) => {\r\n  const fishSpriteFrames = spriteAtlas.getSpriteFrames().filter(v => v.name.startsWith(src_cfg.key + '_')).sort((v1, v2) => {\r\n    const c1 = parseInt(v1.name.split('_')[1])\r\n    const c2 = parseInt(v2.name.split('_')[1])\r\n    return c1 - c2;\r\n  });\r\n\r\n  const sample = 1 / src_cfg.ft;\r\n  const clip = AnimationClip.createWithSpriteFrames(fishSpriteFrames, sample)\r\n  clip.wrapMode = isLoop ? AnimationClip.WrapMode.Loop : AnimationClip.WrapMode.Normal;\r\n\r\n  const anima = animationNode.addComponent(Animation)\r\n  anima.addClip(clip);\r\n  anima.defaultClip = clip;\r\n  isPlay && anima.play();\r\n\r\n  anima.on(Animation.EventType.FINISHED, () => {\r\n    done && done();\r\n  })\r\n}\r\n\r\nexport const addAnimation = (sourceManage: SourceManage, animationNode: Node, src_cfg, isPlay: boolean, isLoop: boolean, done = undefined) => {\r\n  const spriteAtlas = sourceManage.getFile(getFileName(src_cfg.file)).source as SpriteAtlas;\r\n  createAnimation(animationNode, spriteAtlas, src_cfg, isPlay, isLoop, done)\r\n}\r\n\r\nexport const getAnimation = (node: Node): Animation => {\r\n  return node.getComponent(Animation);\r\n}\r\n\r\n/**\r\n * 创建粒子动画节点\r\n * @param sourceManage 预加载资源管理\r\n * @param parentNode 父节点\r\n * @param src_cfg 资源配置对象\r\n * @returns \r\n */\r\nexport const createParticleSystemNode = (sourceManage: SourceManage, parentNode: Node, src_cfg) => {\r\n  const source = sourceManage.getFile(getFileName(src_cfg.file)).source;\r\n  let node = new Node();\r\n  parentNode.addChild(node);\r\n  const p = node.addComponent(ParticleSystem2D);\r\n  p.file = source;\r\n  p.autoRemoveOnFinish = true;\r\n  return node;\r\n}\r\n\r\n/**\r\n * 创建骨骼动画\r\n * @param sourceManage 预加载资源管理对象\r\n * @param parentNode 父节点\r\n * @param fileSrc 文件路径\r\n * @returns \r\n */\r\nexport const createSkeleton = (sourceManage: SourceManage, parentNode: Node, fileSrc) => {\r\n  const source = sourceManage.getFile(getFileName(fileSrc)).source;\r\n  let node = new Node();\r\n  parentNode.addChild(node);\r\n  const sk = node.addComponent(sp.Skeleton);\r\n  sk.skeletonData = source;\r\n  sk.premultipliedAlpha = false;\r\n  sk.loop = true;\r\n  return node;\r\n}\r\n/**\r\n * 创建字体资源\r\n * @param sourceManage \r\n * @param fileSrc \r\n * @returns \r\n */\r\nexport const createFont = (sourceManage: SourceManage, fileSrc) => {\r\n  const source = sourceManage.getFile(getFileName(fileSrc)).source;\r\n  return source;\r\n}\r\n\r\nexport const llcompare = (a, b) => {\r\n  return a < b ? -1 : a > b ? 1 : 0;\r\n}\r\n\r\nexport const llminus = (a, b) => {\r\n  return a - b;\r\n}\r\nexport const llplus = (a, b) => {\r\n  return a + b;\r\n}\r\n\r\nexport const g_ByRandomSelectID = (lst: any[]) => {\r\n  let val = Math.random()\r\n  let sum = 0\r\n  for (let i = 0; i < lst.length; i++) {\r\n    sum = sum + lst[i].gi\r\n    if (sum > val) {\r\n      return lst[i].id\r\n    }\r\n  }\r\n\r\n  return -1\r\n}\r\n\r\nexport const toNodeSpaceAR = (parent: Node, pos) => {\r\n  return parent.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(pos.x, pos.y));\r\n}\r\nexport const toWorldSpaceAR = (parent: Node, pos) => {\r\n  return parent.getComponent(UITransform).convertToWorldSpaceAR(new Vec3(pos.x, pos.y));\r\n}"]}