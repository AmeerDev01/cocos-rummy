{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealth/Slot/Component/GodWealth_Roller.ts"],"names":["_decorator","Node","UITransform","Size","Prefab","instantiate","Vec3","tween","Mask","GodWealth_BaseComponent","AudioManager","SoundList","ccclass","property","GodWealth_Roller","rollerDataRep","isRoll","rollerData","rollerIndex","endFlag","initStartIndex","lastJoinIconIndex","stopHandler","isSpeed","start","bindUI","getRollProxy","getRepository","rootUi","root","getComponent","anchorY","rollerUi","RollerLayOut","data","length","setContentSize","intervalWidth","rollerWidth","intervalHeight","rollerheight","portraitNum","setPosition","position","x","i","icon","y","addChild","index","setFace","initRollerLayOut2","RollerLayOut2","bindEvent","bindRollerData","startRoll","stopIndex","joinIcon","setStopIndex","children","forEach","setEffect","node","enabled","stopRoll","cbFn","addLastJoinIconIndex","showResult","setSiblingIndex","stopCallBack","getInstance","playSound","theRollerStops","destroy","setIconEffect","mode","target","allState","comp","some","iconId","iconIndex","addDockIcon","targetArr","item","icon2","hiddenAmounts","e","console","error","removeAllDockIcon","removeAllChildren","togglesThePopUpLayerState","state","active","rollWithCell","to","rollSpeed","window","setTimeout","deviation","Math","abs","_lastJoinIconIndex","count","easing","call","lastChild","value","newValue","update","deltaTime","lateUpdate"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label, UITransform, Size, Prefab, instantiate, Vec3, Layout, tween, log, Mask } from 'cc';\r\nimport GodWealth_BaseComponent from './GodWealth_BaseComponent';\r\nimport { SlotRepository, RollerType } from '../Repositories/SlotRepository';\r\nimport { GodWealth_Icon } from './GodWealth_Icon';\r\nimport { SlotProxy } from '../Proxy/SlotProxy';\r\nimport { AudioManager, SoundList } from '../Managr/AudioManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 动画停止回调\r\n */\r\ntype StopHandlerType = (rollerIndex: number, rollerData: RollerType) => void\r\n\r\n@ccclass('GodWealth_Roller')\r\nexport class GodWealth_Roller extends GodWealth_BaseComponent {\r\n\t@property(Node)\r\n\tRollerLayOut: Node = null\r\n\r\n\t@property(Node)\r\n\tRollerLayOut2: Node = null\r\n\r\n\t// @property(Node)\r\n\t// bubble: Node = null\r\n\r\n\t@property(Prefab)\r\n\ticon: Prefab = null\r\n\r\n\t@property(Prefab)\r\n\ticon2: Prefab = null\r\n\r\n\tprivate rollerDataRep: SlotRepository\r\n\tprivate isRoll = false\r\n\tprivate rollerData: RollerType\r\n\t/**第几条滑槽，序号 */\r\n\tprivate rollerIndex: number\r\n\t/**此值存在，即要检测停止了 */\r\n\tprivate endFlag: boolean = true\r\n\t/**初始化时，图标开始的排列序号 */\r\n\tprivate initStartIndex = 0\r\n\t/**下一个要加入的图标 */\r\n\tprivate lastJoinIconIndex = 0\r\n\t// private target: number = -1\r\n\t/**动态效果停止后的动态回调函数 */\r\n\tprivate stopHandler: StopHandlerType\r\n\r\n\tprivate isSpeed = false;\r\n\tstart() { }\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerDataRep = this.getRollProxy().getRepository();\r\n\t\t// const layout = this.RollerLayOut.getComponent(Layout)\r\n\t\t// layout.spacingY = this.rollerData.roller.intervalHeight\r\n\t\t// 配置滑槽宽高度(也就是蒙板宽高)\r\n\t\tconst rootUi = this.root.getComponent(UITransform) as UITransform\r\n\t\trootUi.anchorY = 1\r\n\t\tconst rollerUi = this.RollerLayOut.getComponent(UITransform) as UITransform\r\n\t\t// rootUi.anchorX = 0\r\n\t\trollerUi.anchorY = 1\r\n\t\t// rollerUi.anchorX = 0\r\n\t\tthis.lastJoinIconIndex = this.initStartIndex - 1\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// 设置蒙版组件高度\r\n\t\trootUi.setContentSize(new Size(this.rollerData.intervalWidth + this.rollerData.rollerWidth,\r\n\t\t\t((this.rollerData.intervalHeight + this.rollerData.rollerheight) * this.rollerData.portraitNum) + this.rollerData.intervalHeight))\r\n\t\t//设置滑道高度，多一个高度\r\n\t\trollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n\t\t\t(this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum + 1)))\r\n\t\t// 滑道网上顶一个单位（但是上沿有遮挡，再降30）\r\n\t\tthis.RollerLayOut.setPosition(this.RollerLayOut.position.x, (this.rollerData.intervalHeight + this.rollerData.rollerheight) - this.rollerData.intervalHeight)\r\n\t\t// 初始化即将开始的图标\r\n\t\tfor (let i = 0; i < this.rollerData.portraitNum; i++) {\r\n\t\t\tconst icon = instantiate(this.icon)\r\n\t\t\ticon.setPosition(new Vec3(0, icon.position.y - (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (i + 1)))\r\n\t\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t\tconst index = this.initStartIndex + i;\r\n            (<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\")).setFace(this.rollerData.data[index])\r\n\r\n\t\t}\r\n\t\t// this.bubble.active = this.rollerData.isBigIcon\r\n\t\tthis.initRollerLayOut2()\r\n\t}\r\n\r\n\tprivate initRollerLayOut2() {\r\n\t\tconst rollerUi = this.RollerLayOut2.getComponent(UITransform) as UITransform\r\n\t\trollerUi.anchorY = 1\r\n\t\trollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n\t\t\t(this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum)))\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\t/**指定滑槽数据 */\r\n\tpublic bindRollerData(rollerIndex: number, data: RollerType) {\r\n\t\tthis.rollerData = data\r\n\t\tthis.rollerIndex = rollerIndex\r\n\t}\r\n\t/**\r\n\t * 开始滚动\r\n\t * @param stopIndex 设定要停止的序号（从1开始的）\r\n\t */\r\n\tpublic startRoll(stopIndex: number, isSpeed: boolean = false) {\r\n\t\tthis.isSpeed = isSpeed;\r\n\t\t// 往上移动一个网格，以便放上下一个要显示的icon\r\n\t\tthis.joinIcon();\r\n\t\t// console.log(this.rollerIndex, stopIndex);\r\n\t\t(this.getRollProxy() as SlotProxy).setStopIndex(this.rollerIndex, stopIndex)\r\n\t\tthis.isRoll = true\r\n\t\tthis.endFlag = false\r\n\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t(<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\")).setEffect()\r\n\t\t})\r\n\t\tthis.node.getComponent(Mask).enabled = true\r\n\t\t// this.rollWithCell('down')\r\n\t\t// console.log(this.getRollProxy().getRepository())\r\n\t}\r\n\t// 停止滚动\r\n\tpublic stopRoll(cbFn: StopHandlerType) {\r\n\t\tthis.endFlag = true\r\n\t\tthis.stopHandler = cbFn\r\n\t\tthis.addLastJoinIconIndex(this.rollerData.showResult.stopIndex, 3);\r\n\t\t// (this.getRollProxy() as FruitsSlotProxy).setStopIndex(this.rollerIndex)\r\n\t}\r\n\tprivate joinIcon() {\r\n\t\t// this.lastJoinIconIndex === this.rollerData.data.length && (this.lastJoinIconIndex = 0)\r\n\t\t// console.log(this.lastJoinIconIndex)\r\n\t\tconst icon = instantiate(this.icon)\r\n\t\ticon.setPosition(icon.position.x, 0)\r\n\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t(<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\")).setFace(this.rollerData.data[this.lastJoinIconIndex])\r\n\t\ticon.setSiblingIndex(0)\r\n\t\tthis.lastJoinIconIndex--\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// this.RollerLayOut.removeChild(this.RollerLayOut.children[this.RollerLayOut.children.length - 1])\r\n\t\t// this.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n\tprivate stopCallBack() {\r\n\t\tthis.node.getComponent(Mask).enabled = false\r\n\t\tthis.stopHandler && this.stopHandler(this.rollerIndex, this.rollerData)\r\n\t\t// this.RollerLayOut.children.forEach(icon => {\r\n\t\t// \tconst comp = (<Icon>icon.getComponent(\"dragon_Icon\"))\r\n\t\t// \tif (comp.iconId === this.target) {\r\n\t\t// \t\tcomp.setEffect('animation')\r\n\t\t// \t}\r\n\t\t// })\r\n\t\tAudioManager.getInstance().playSound(SoundList.theRollerStops)\r\n\t\tthis.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n\r\n\t/**\r\n\t * 设置当前滑槽的闪动图标()\r\n\t * @param mode 传入的是光标id，还是左边序列号\r\n\t * @param target 光标位置或者y轴坐标序列\r\n\t */\r\n\tpublic setIconEffect(mode: 'index' | 'coord', target: number[],allState:boolean=false) {\r\n\t\tif (mode === 'index') {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\tconst comp = (<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\"))\r\n\t\t\t\tif (target.some(i => i === comp.iconId)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcomp.setEffect()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tlet iconIndex = this.rollerData.portraitNum\r\n\t\t\tthis.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t\ticonIndex--\r\n\t\t\t\tconst comp = (<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\"))\r\n\t\t\t\tif (target.some(i => i === iconIndex)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t}else {\r\n                    if(allState){\r\n                        comp.setEffect()\r\n                    }\r\n                }\r\n\t\t\t})\r\n\t\t\t//向上数第几个光标闪动\r\n\t\t\t// for (let i = 2; i >= 0; i--) {\r\n\t\t\t// \tconst comp = (<Icon>this.RollerLayOut.children[i].getComponent(\"dragon_Icon\"))\r\n\t\t\t// \tif (!comp) continue\r\n\t\t\t// \tif (i === target) {\r\n\t\t\t// \t\tcomp.setEffect(1)\r\n\t\t\t// \t} else {\r\n\t\t\t// \t\tcomp.setEffect()\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t\t// this.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t// \tconst comp = (<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\"))\r\n\t\t\t// })\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 添加停靠图标\r\n\t * @param index 停靠的序号，从下到上\r\n\t */\r\n\tpublic addDockIcon(targetArr: number[]) {\r\n\t\t   // this.removeAllDockIcon()\r\n            targetArr.forEach((item, index) => {\r\n                try {\r\n                    const icon = instantiate(this.icon2);\r\n                    if(item[0]===0){\r\n                        item[0]=2\r\n                    }else if(item[0]===2){\r\n                        item[0]=0\r\n                    }\r\n                    (<GodWealth_Icon>icon.getComponent(\"GodWealth_Icon\")).hiddenAmounts(item[1])\r\n                    icon.setPosition(new Vec3(0, -item[0] * this.rollerData.rollerheight))\r\n                    this.RollerLayOut2.addChild(icon);\r\n                }catch (e) {\r\n                    console.error('dodododo')\r\n                }\r\n            })\r\n\t}\r\n\r\n\tpublic removeAllDockIcon() {\r\n\t\tthis.RollerLayOut2.removeAllChildren()\r\n\t}\r\n    //隐藏显示弹出层2\r\n    public togglesThePopUpLayerState(state:boolean=false){\r\n        this.RollerLayOut2.active=state\r\n    }\r\n\t/**滚动一个格子 */\r\n\tprivate rollWithCell(position: 'up' | 'down') {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t// icon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t\ttween(icon).to(this.rollerData.rollSpeed / 1000, { position: new Vec3(icon.position.x, icon.position.y - ((this.rollerData.intervalHeight + this.rollerData.rollerheight))) }).start()\r\n\t\t\t})\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\t\t// if (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation = Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t\t\t\ttween().target(icon).to(this.rollerData.rollSpeed / 1000 + 0.3, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.rollWithCell(position)\r\n\t\t\t\t}\r\n\t\t\t}, this.rollerData.rollSpeed)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\t\tlet newValue = stopIndex + value;\r\n\t\t\tif (newValue >= this.rollerData.data.length) {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue - this.rollerData.data.length;\r\n\t\t\t} else {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue;\r\n\t\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\ticon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t})\r\n\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\tif (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation =0 //Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach((icon,index)=> {\r\n\t\t\t\t\t\t\ttween().target(icon).to(0.5, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight) + index * 25)\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlateUpdate() {\r\n\t\t// if (this.RollerLayOut.children.length) {\r\n\t\t// \tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t// \tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t// \t\tlastChild.destroy()\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n}\r\n\r\n"]}