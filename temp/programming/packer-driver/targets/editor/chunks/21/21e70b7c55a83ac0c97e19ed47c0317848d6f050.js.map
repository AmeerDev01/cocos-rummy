{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/ObjectPool.ts"],"names":["ObjectPool","ObjectClassType","type_fish","type_bullet","type_fish_net","type_fish_gold","type_fish_fnt","defaultNewObjectNum","objectClassList","objectParent","bulletConfig","batteryConfig","commonConfig","fishConfig","textureConfig","fishHitLabelConfig","fishLabelFntConfig","fishFntResConfig","fishNetConfig","fishGoldConfig","activeConfig","batteryManager","sourceManage","fishNetManager","fishLabelFntManager","scaleRatio","rootNode","initConfig","setFishNetManager","setFishLabelFntManager","init","parent","k","v","object_id","creater","object_lst","uninit","registerObjectCreater","cType","item","newSomeObject","dataID","number","cItem","i","info","obj_id","id","newObj","create","bullet","initEnv","bonding_size","addChild","uiRoot","setPosition","fishNet","fishGold","fishLabelFnt","getObject","obj","buse","getUseState","dID","getDataId"],"mappings":"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","sourcesContent":["/**\r\n  对象池\r\n */\r\n\r\nimport { Node } from \"cc\";\r\nimport { Bullet } from \"./Bullet\";\r\nimport { BatteryManager } from \"./BatteryManager\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport { FishNet } from \"./FishNet\";\r\nimport { FishNetManager } from \"./FishNetManager\";\r\nimport { FishGold } from \"./FishGold\";\r\nimport { FishLabelFntManager } from \"./FishLabelFntManager\";\r\nimport { FishLabelFnt } from \"./FishLabelFnt\";\r\n\r\n//对象类型\r\nexport const ObjectClassType = {\r\n  type_fish: 1,//鱼\r\n  type_bullet: 2,//子弹\r\n  type_fish_net: 3,//鱼网\r\n  type_fish_gold: 4,//金币\r\n  type_fish_fnt: 5,//鱼字体\r\n}\r\n\r\nexport interface ICreateObj {\r\n  create(info);\r\n}\r\n\r\ntype ObjectClass = {\r\n  object_id: number,\r\n  creater: ICreateObj,\r\n  object_lst: any\r\n}\r\n\r\n//////////////////////////////////////-\r\nexport class ObjectPool {\r\n  private defaultNewObjectNum = 5\r\n  private objectClassList: ObjectClass[] = []\r\n  private objectParent: Node = null\r\n\r\n  private bulletConfig;\r\n  private batteryConfig;\r\n  private commonConfig;\r\n  private fishConfig;\r\n  private textureConfig;\r\n  private fishHitLabelConfig;\r\n  private fishLabelFntConfig;\r\n  private fishFntResConfig;\r\n  private fishNetConfig;\r\n  private fishGoldConfig;\r\n  private activeConfig;\r\n  private batteryManager: BatteryManager;\r\n  private sourceManage: SourceManage;\r\n  private fishNetManager: FishNetManager;\r\n  private fishLabelFntManager: FishLabelFntManager;\r\n  /**缩放比例 */\r\n  private scaleRatio: number = 1;\r\n  private rootNode: Node;\r\n\r\n  public initConfig(bulletConfig, batteryConfig, commonConfig, fishConfig, textureConfig,\r\n    fishHitLabelConfig, fishLabelFntConfig, fishNetConfig, fishGoldConfig, activeConfig, fishFntResConfig,\r\n    batteryManager: BatteryManager, sourceManage: SourceManage, scaleRatio: number = 1, rootNode: Node) {\r\n    this.bulletConfig = bulletConfig;\r\n    this.batteryConfig = batteryConfig;\r\n    this.commonConfig = commonConfig;\r\n    this.fishConfig = fishConfig;\r\n    this.textureConfig = textureConfig;\r\n    this.fishHitLabelConfig = fishHitLabelConfig;\r\n    this.fishLabelFntConfig = fishLabelFntConfig;\r\n    this.fishFntResConfig = fishFntResConfig;\r\n    this.fishNetConfig = fishNetConfig;\r\n    this.fishGoldConfig = fishGoldConfig;\r\n    this.activeConfig = activeConfig;\r\n    this.fishNetConfig = fishNetConfig;\r\n    this.batteryManager = batteryManager;\r\n    this.sourceManage = sourceManage;\r\n    this.scaleRatio = scaleRatio;\r\n    this.rootNode = rootNode;\r\n  }\r\n\r\n  public setFishNetManager(fishNetManager: FishNetManager) {\r\n    this.fishNetManager = fishNetManager;\r\n  }\r\n\r\n  public setFishLabelFntManager(fishLabelFntManager: FishLabelFntManager) {\r\n    this.fishLabelFntManager = fishLabelFntManager\r\n  }\r\n\r\n  public init(parent: Node) {\r\n    this.objectClassList = []\r\n    this.objectParent = parent\r\n    for (const k in ObjectClassType) {\r\n      const v = ObjectClassType[k];\r\n      if (!v) continue;\r\n      this.objectClassList[v] = {\r\n        object_id: 0,\r\n        creater: null,\r\n        object_lst: {},\r\n      }\r\n    }\r\n  }\r\n\r\n  public uninit() {\r\n    this.objectClassList = null\r\n    this.objectParent = null\r\n    this.bulletConfig = null\r\n    this.batteryConfig = null\r\n    this.commonConfig = null\r\n    this.fishConfig = null\r\n    this.textureConfig = null\r\n    this.fishHitLabelConfig = null\r\n    this.fishLabelFntConfig = null\r\n    this.fishNetConfig = null\r\n    this.batteryManager = null\r\n    this.sourceManage = null\r\n    this.fishNetManager = null\r\n  }\r\n\r\n  public registerObjectCreater(cType, creater) {\r\n    let item = this.objectClassList[cType]\r\n    if (item) {\r\n      item.creater = creater\r\n    }\r\n  }\r\n\r\n  public newSomeObject(cType, dataID, number: number) {\r\n    let cItem = this.objectClassList[cType]\r\n    if (cItem && cItem.creater) {\r\n      for (let i = 1; i <= number; i++) {\r\n        cItem.object_id = cItem.object_id + 1\r\n        let info = { obj_id: cItem.object_id, id: dataID, }\r\n\r\n        let creater = cItem.creater\r\n        let newObj = creater.create(info)\r\n        if (cType === ObjectClassType.type_bullet) {\r\n          let bullet: Bullet = newObj as Bullet;\r\n          bullet.initEnv(this.bulletConfig, this.commonConfig.bonding_size, this.batteryManager, this.sourceManage, this.fishNetManager, this.scaleRatio)\r\n          bullet.init(info);\r\n          this.objectParent.addChild(bullet.uiRoot)\r\n          bullet.uiRoot.setPosition(0, 0)\r\n        } else {\r\n          if (ObjectClassType.type_fish_net === cType) {\r\n            let fishNet: FishNet = newObj as FishNet;\r\n            fishNet.init(info, this.fishNetConfig, this.sourceManage, this.rootNode);\r\n          } else if (ObjectClassType.type_fish_gold === cType) {\r\n            let fishGold: FishGold = newObj as FishGold;\r\n            fishGold.init(info, this.sourceManage, this.fishGoldConfig, this.textureConfig, this.activeConfig, this.commonConfig, this.rootNode);\r\n          } else if (ObjectClassType.type_fish_fnt === cType) {\r\n            let fishLabelFnt: FishLabelFnt = newObj as FishLabelFnt;\r\n            fishLabelFnt.init(info, this.sourceManage, this.fishLabelFntManager, this.fishLabelFntConfig, this.fishFntResConfig, this.activeConfig, \r\n              this.commonConfig, this.rootNode);\r\n          }\r\n          this.objectParent.addChild(newObj.uiRoot)\r\n          // this.objectParent.setPosition(0, 0)\r\n        }\r\n\r\n        cItem.object_lst[cItem.object_id] = newObj\r\n      }\r\n    }\r\n  }\r\n\r\n  public getObject(cType, dataID) {\r\n    let obj = null\r\n    let cItem = this.objectClassList[cType]\r\n    if (cItem) {\r\n      for (const k in cItem.object_lst) {\r\n        const v = cItem.object_lst[k];\r\n        if (!v) continue;\r\n        let buse = v.getUseState()\r\n        let dID = v.getDataId()\r\n\r\n        if (buse === false && dID === dataID) {\r\n          obj = v\r\n          break\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!obj) {\r\n      this.newSomeObject(cType, dataID, this.defaultNewObjectNum)\r\n      cItem = this.objectClassList[cType]\r\n      obj = cItem.object_lst[cItem.object_id]\r\n    }\r\n\r\n    return obj\r\n  }\r\n}\r\n\r\n\r\n\r\n"]}