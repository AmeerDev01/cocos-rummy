{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/Crash/net/Crash_NetMsgDispatcher.ts"],"names":["MessageCallBack","Crash_NetMsgDispatcher","code","callBacks","doCallBack","bl","data","args","i","length","info","obj","callBack","call","removeCallBackByObj","splice","msgCallBacks","getInstance","instance","regCallBack","msg","getMsgCallBackByCode","push","removeCallBack","removeAllProtocolByObj","find","item","doMsgCallBack","callBackInfo"],"mappings":";;;iBAEMA,e,EAuBeC,sB;;;;;;;;;;;;;AAvBfD,MAAAA,e,GAAN,MAAMA,eAAN,CAAsB;AAAA;AAAA,eAClBE,IADkB,GACH,IADG;AAAA,eAElBC,SAFkB,GAEyE,EAFzE;AAAA;;AAIlBC,QAAAA,UAAU,CAACC,EAAD,EAAcC,IAAd,EAAyBC,IAAzB,EAA+B;AACrC,eAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKL,SAAL,CAAeM,MAAlC,EAA0C,EAAED,CAA5C,EAAgD;AAC5C,gBAAIE,IAAI,GAAG,KAAKP,SAAL,CAAeK,CAAf,CAAX;;AACA,gBAAGE,IAAI,CAACC,GAAR,EAAa;AACTD,cAAAA,IAAI,CAACE,QAAL,CAAcC,IAAd,CAAmBH,IAAI,CAACC,GAAxB,EAA6BN,EAA7B,EAAiCC,IAAjC,EAAuCC,IAAvC;AACH;AACJ;AACJ;;AAEDO,QAAAA,mBAAmB,CAAEH,GAAF,EAAgB;AAC/B,eAAI,IAAIH,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKL,SAAL,CAAeM,MAAlC,EAA0C,EAAED,CAA5C,EAAgD;AAC5C,gBAAG,KAAKL,SAAL,CAAeK,CAAf,EAAkBG,GAAlB,KAA0BA,GAA7B,EAAkC;AAC9B,mBAAKR,SAAL,CAAeY,MAAf,CAAsBP,CAAtB,EAAyB,CAAzB;AACA;AACH;AACJ;AACJ;;AApBiB,O;;yBAuBDP,sB,GAAN,MAAMA,sBAAN,CAA6B;AAAA;AAAA,eAShCe,YATgC,GASO,EATP;AAAA;;AAEf,eAAXC,WAAW,GAAG;AACxB,cAAG,KAAKC,QAAL,IAAiB,IAApB,EAA0B;AACtB,iBAAKA,QAAL,GAAgB,IAAIjB,sBAAJ,EAAhB;AACH;;AACD,iBAAO,KAAKiB,QAAZ;AACH;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGOC,QAAAA,WAAW,CAAEjB,IAAF,EAAgBS,GAAhB,EAA6BC,QAA7B,EAAsF;AACpG,cAAIQ,GAAoB,GAAG,KAAKC,oBAAL,CAA0BnB,IAA1B,CAA3B;;AACA,cAAG,CAACkB,GAAJ,EAAS;AACLA,YAAAA,GAAG,GAAG,IAAIpB,eAAJ,EAAN;AACAoB,YAAAA,GAAG,CAAClB,IAAJ,GAAWA,IAAX;AACA,iBAAKc,YAAL,CAAkBM,IAAlB,CAAuBF,GAAvB;AACH;;AACDA,UAAAA,GAAG,CAACjB,SAAJ,CAAcmB,IAAd,CAAmB;AACfX,YAAAA,GAAG,EAAEA,GADU;AAEfC,YAAAA,QAAQ,EAAEA;AAFK,WAAnB;AAIH;;AAEMW,QAAAA,cAAc,CAAErB,IAAF,EAAgBS,GAAhB,EAA8B;AAC/C,cAAIS,GAAoB,GAAG,KAAKC,oBAAL,CAA0BnB,IAA1B,CAA3B;;AACA,cAAG,CAACkB,GAAJ,EAAS;AACL;AACH;;AAEDA,UAAAA,GAAG,CAACN,mBAAJ,CAAwBH,GAAxB;AACH;;AAEMa,QAAAA,sBAAsB,CAAEb,GAAF,EAAgB;AACzC,eAAI,IAAIH,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKQ,YAAL,CAAkBP,MAArC,EAA6C,EAAED,CAA/C,EAAkD;AAC9C,iBAAKQ,YAAL,CAAkBR,CAAlB,EAAqBM,mBAArB,CAAyCH,GAAzC,EAD8C,CAE9C;AACH;AACJ;;AAGOU,QAAAA,oBAAoB,CAAEnB,IAAF,EAAkC;AAC1D,iBAAO,KAAKc,YAAL,CAAkBS,IAAlB,CAAwBC,IAAD,IAAQ;AAClC,mBAAOA,IAAI,CAACxB,IAAL,KAAcA,IAArB;AACH,WAFM,CAAP;AAGH;;AAEMyB,QAAAA,aAAa,CAACtB,EAAD,EAAcH,IAAd,EAA4BI,IAA5B,EAAuCC,IAAvC,EAAkD;AAClE,cAAIqB,YAAY,GAAG,KAAKP,oBAAL,CAA0BnB,IAA1B,CAAnB;;AACA,cAAG0B,YAAH,EAAiB;AACbA,YAAAA,YAAY,CAACxB,UAAb,CAAwBC,EAAxB,EAA4BC,IAA5B,EAAkCC,IAAlC;AACH;AACJ;;AAlEuC,O;;AAAvBN,MAAAA,sB,CACFiB,Q,GAAmC,I","sourcesContent":["import Crash_Singleton from \"./Crash_Singleton\";\r\n\r\nclass MessageCallBack {\r\n    code: string = null;\r\n    callBacks: Array<{obj: Object, callBack: (bl: boolean, data: any, ...args: any)=> void}> = [];\r\n\r\n    doCallBack(bl: boolean, data: any, args) {\r\n        for(let i = 0; i < this.callBacks.length; ++i ) {\r\n            let info = this.callBacks[i];\r\n            if(info.obj) {\r\n                info.callBack.call(info.obj, bl, data, args);\r\n            }\r\n        }\r\n    }\r\n\r\n    removeCallBackByObj( obj: Object ) {\r\n        for(let i = 0; i < this.callBacks.length; ++i ) {\r\n            if(this.callBacks[i].obj === obj) {\r\n                this.callBacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default class Crash_NetMsgDispatcher {\r\n    private static instance: Crash_NetMsgDispatcher = null;\r\n    public static getInstance() {\r\n        if(this.instance == null) {\r\n            this.instance = new Crash_NetMsgDispatcher();\r\n        }\r\n        return this.instance;\r\n    }\r\n\r\n    private msgCallBacks: Array<MessageCallBack> = [];\r\n    // // private static instance: NetMsgDispatcher = null;\r\n    // private instance:NetMsgDispatcher\r\n    // static getInstance() {\r\n    //     if(!this.instance) {\r\n    //         this.instance = new NetMsgDispatcher();\r\n    //     }\r\n    //     return this.instance;\r\n    // }\r\n    // static  msgCallBacks: Array<MessageCallBack> = [];\r\n    // constructor() {\r\n    //     super()\r\n    //     NetMsgDispatcher.msgCallBacks=[]\r\n    // }\r\n\r\n\r\n    public regCallBack( code: string, obj: Object, callBack: (bl: boolean, data: any, ...args: any)=> void) {\r\n        let msg: MessageCallBack = this.getMsgCallBackByCode(code);\r\n        if(!msg) {\r\n            msg = new MessageCallBack();\r\n            msg.code = code;\r\n            this.msgCallBacks.push(msg);\r\n        }\r\n        msg.callBacks.push({\r\n            obj: obj,\r\n            callBack: callBack\r\n        });\r\n    }\r\n\r\n    public removeCallBack( code: string, obj: Object ) {\r\n        let msg: MessageCallBack = this.getMsgCallBackByCode(code);\r\n        if(!msg) {\r\n            return;\r\n        }\r\n\r\n        msg.removeCallBackByObj(obj);\r\n    }\r\n\r\n    public removeAllProtocolByObj( obj: Object ) {\r\n        for(let i = 0; i < this.msgCallBacks.length; ++i) {\r\n            this.msgCallBacks[i].removeCallBackByObj(obj);\r\n            // Mark: remove MessageCallBack\r\n        }\r\n    }\r\n\r\n\r\n    private getMsgCallBackByCode( code: string ): MessageCallBack {\r\n        return this.msgCallBacks.find((item)=>{\r\n            return item.code === code;\r\n        });\r\n    }\r\n\r\n    public doMsgCallBack(bl: boolean, code: string, data: any, args: any) {\r\n        let callBackInfo = this.getMsgCallBackByCode(code);\r\n        if(callBackInfo) {\r\n            callBackInfo.doCallBack(bl, data, args);\r\n        }\r\n    }\r\n\r\n}\r\n"]}