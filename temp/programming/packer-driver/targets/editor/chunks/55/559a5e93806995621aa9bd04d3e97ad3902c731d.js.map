{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egyptV2/components/EgyptV2_Roller.ts"],"names":["_decorator","instantiate","Node","tween","UITransform","Vec3","BaseComponent","config","calBetAmount","GameType","getColumnLockIconArr","IconId","egyptv2_Audio","sourceManageSeletor","PrefabPathDefine","getNodeByNameDeep","EgyptV2SingleIconRollerViewModel","SoundPathDefine","cacheData","ccclass","property","EgyptV2_Roller","lastIndex","showIconCount","normalRollOption","stopIconIndex","columnIndex","iconPool","iconRollerQueue","isRoll","iconArr","rollOverCallback","isSpeedBorder","props_column_effect_node","iconAnimationNode","props_lock_icon_list","speddBorderNode","isMergeIcon","lockIcons","singleIconRollerViewModels","rollerCount","bigNode","rollerLaunchResult","sendBetTime","propertyNode","props_icon_list","props_big_icon","props","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","positionId","events","onCheckNextLeftCount","start","initState","setColumnEffectNode","getChildByName","initSlot","Math","floor","random","length","initColumn","isSubGame2","replaceSingleRollerIcon","iconCount","i","joinIcon","SUBGAME2","isSubGame1","SUBGAME1","addIconIndex","index","value","newValue","isSubGame2SpecialIcon","id","BEETLE","SUN_GOD","getIntervalHeight","gameType","undefined","subGameRollOption","intervalHeight1","intervalHeight2","intervalHeight","iconId","iconConfig","icon","find","v","getIcon","showAmount","position","getRollerPaddingBottom","getHeight","y","getIconContainerAnchorPos","lastNode","getPosition","getNode","setPosition","push","setBeetleAmount","getId","randomBeetleAmount","diff","calIndexDiff","lockIconDatas","getFixedChessboardIcon","lockIconData","setAmount","amount","betAmount","si","dl","fixedChessboardIcon","index1","index2","bindEvent","useProps","key","node","isValid","changeRollerHeight","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","unscheduleAllCallbacks","hideScatterAnimation","comp","stopRoll","console","log","setSpeedBorderStatus","stopSingleRollerIcon","addLastJoinIconIndex","stopIndex","getStopIconIndex","totalCount","bindUI","getRollSpeed","expectRollerSpeed","rollerSpeed","mergeIcon","parentNode","getAlikeIconCount","pos","getMergeIconPos","buildSkeleton","bool","isWinIcon","worldPosition","clone","add","wp","values","iconIndexs","isWinWild","WILD","show","active","setWorldPosition","x","playOneShot","fast_roller","scaleX","expectBorderScaleX","scaleY","expectBorderScaleY","setScale","fileName","TWO_ICON","THREE_ICON","getFile","source","addChild","getBigNodeScaleY","twoIconScaleY","threeIconScaleY","count","filter","SCATTER","hideWin","pauseWinIcon","pauseWin","playWinIcon","scheduleOnce","playWin","playBeetleAnimation","done","beetleArr","playOneScatterAnimation","element","rollOverHandle","addLockIcon","shell_end","time","isPlayAnimation","playCount","lockValues","egyptV2Icon","iconv","getIconIndex","isBeetleIcon","isSunGod","sunGod","replaceIcon","restore","removeSingleRollerIcon","getSlotIndex","unMount","splice","removeLockIcon","destory","getIconPosByIndex","height","singleRollerHeight","halfHeight","paddingBottom","interval","iconListUI","getComponent","anchorY","rollerHeight","rollerHeight2","rollerHeight1","getWorldPosition","resetIconPos","lock","buildSingleRollerIcon","replaceMultiRollerIcon","firstIcon","getFirstIcon","removeFromParent","hideAmount","viewModel","mountView","SINGLE_ICON_ROLLER","appendTo","viewNode","width","singleIconMaskWidth","singleIconMaskHeight","rollerPaddingBottom","multiIconRoller","frist","iconHideY","shift","endIcon","duration","to","isMultiRoll","getBeetleNode","isIncludeSunGod","nodes","getAmount","getSunGodIconNode","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Game, instantiate, Node, sp, tween, UITransform, Vec2, Vec3, view } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { EgyptV2Icon } from './EgyptV2_Icon';\r\nimport { calBetAmount, GameType, GameTypeInfo, getColumnLockIconArr, IconId, LockIcon, RollerInfo, RollerLaunchResult, RollerStatus } from '../type';\r\nimport { egyptv2_Audio, sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { EgyptV2_SingleIconRoller } from './EgyptV2_SingleIconRoller';\r\nimport EgyptV2SingleIconRollerViewModel from '../viewModel/EgyptV2SingleIconRollerViewModel';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport game from '../store/reducer/game';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/** 选择的线id */\r\n\tpositionId: number,\r\n}\r\nexport interface IEvent {\r\n\tonCheckNextLeftCount: () => void\r\n}\r\n\r\n@ccclass('EgyptV2_Roller')\r\nexport class EgyptV2_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = config.normalRollOption.showIconCount;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**是否正在滚动 */\r\n\tprivate isRoll = false;\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: EgyptV2Icon[] = [];\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**是否快速边框（期待scatter中奖边框） */\r\n\tprivate isSpeedBorder;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\t/**锁定图标节点 */\r\n\tprivate props_lock_icon_list: Node;\r\n\t/**快速滚动层节点 */\r\n\tprivate speddBorderNode: Node;\r\n\t/**是否合并图标了 */\r\n\tprivate isMergeIcon = false;\r\n\r\n\t/**锁定图标列表 */\r\n\tprivate lockIcons: EgyptV2Icon[] = [];\r\n\t/**单个图标的滚动 */\r\n\tprivate singleIconRollerViewModels: EgyptV2SingleIconRollerViewModel[] = [];\r\n\r\n\t/**滚动次数 */\r\n\tprivate rollerCount = -1;\r\n\r\n\t/**大图标 */\r\n\tprivate bigNode: Node;\r\n\tprivate rollerLaunchResult: RollerLaunchResult;\r\n\tprivate sendBetTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t\tprops_big_icon: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\tpositionId: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonCheckNextLeftCount: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t\tthis.speddBorderNode = this.props_column_effect_node.getChildByName(\"props_speed_border\")\r\n\t\tthis.props_lock_icon_list = getNodeByNameDeep(\"props_lock_icon_list\", this.props_column_effect_node);\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, iconPool: IconPool) {\r\n\t\tthis.iconPool = iconPool;\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.lastIndex = Math.floor(Math.random() * this.iconRollerQueue.length);\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\t/**是否小游戏2的特殊图标 */\r\n\tprivate isSubGame2SpecialIcon(id: number) {\r\n\t\treturn id === IconId.BEETLE || id === IconId.SUN_GOD;\r\n\t}\r\n\r\n\tprivate getIntervalHeight(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight1\r\n\t\t} else if (gameType === GameType.SUBGAME2) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight2;\r\n\t\t}\r\n\t\treturn config.normalRollOption.intervalHeight;\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\t// 在子游戏2中，初始化不显示甲壳虫和太阳神\r\n\t\tif (this.isSubGame2() && this.isSubGame2SpecialIcon(iconConfig.id)) {\r\n\t\t\tthis.joinIcon();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\ticon.showAmount();\r\n\t\tconst position = new Vec3(0, this.getRollerPaddingBottom() + icon.getHeight() / 2);\r\n\t\tposition.y -= this.getIconContainerAnchorPos();\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.getIntervalHeight();\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置甲壳虫上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: EgyptV2Icon) {\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff >= 3) {\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// console.log(`setBeetleAmount--- diff:${diff},stopIconIndex:${this.stopIconIndex},lastIndex:${this.lastIndex},columnIndex:${this.columnIndex}`);\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\t// 没有锁定图标就随机一个金额\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst index = diff === 2 ? 0 : diff === 0 ? 2 : 1;\r\n\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === index)\r\n\t\tif (lockIconData) {\r\n\t\t\ticon.setAmount(lockIconData.amount)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate randomBeetleAmount(icon: EgyptV2Icon) {\r\n\t\t// 没有锁定图标就随机一个金额\r\n\t\tconst betAmount = calBetAmount(this.props.positionId)\r\n\t\tlet amount = Math.floor(Math.random() * betAmount)\r\n\t\tamount = amount <= 0 ? amount + 1 : amount\r\n\t\ticon.setAmount(amount)\r\n\t}\r\n\r\n\tprivate getFixedChessboardIcon() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tconst si = this.rollerLaunchResult.dl.si[0]\r\n\t\t\tif (si.gameType === GameType.SUBGAME2 || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t\treturn si.fixedChessboardIcon;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\treturn cacheData.fixedChessboardIcon;\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'gameTypeInfo') {\r\n\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.singleIconRollerViewModels.length === 0) {\r\n\t\t\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t\t\t}\r\n\t\t\t\tthis.changeRollerHeight(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.bigNode && this.bigNode.destroy();\r\n\t\tthis.bigNode = null;\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.hideIconWin();\r\n\t\tthis.hideScatterAnimation();\r\n\t\tthis.rollerCount = -1;\r\n\t\tthis.isMergeIcon = false;\r\n\t\tthis.isSpeedBorder = false;\r\n\t\tthis.isRoll = true;\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.startRoll());\r\n\t\t}\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, isSpeedBorder: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.isSpeedBorder = isSpeedBorder;\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\tthis.rollerLaunchResult = rollerLaunchResult;\r\n\t\tthis.sendBetTime = cacheData.sendBetTime;\r\n\t\tconsole.log(\"roller stop time \" + this.sendBetTime);\r\n\t\t// let value = isSpeedBorder ? 15 : this.columnIndex + 1\r\n\r\n\t\tthis.rollerCount = 0;\r\n\r\n\t\tif (!this.isSubGame2()) {\r\n\t\t\tisSpeedBorder && this.setSpeedBorderStatus(true);\r\n\t\t\t// let value = isSpeedBorder ? 30 : 3;\r\n\t\t\t// this.addLastJoinIconIndex(this.stopIconIndex, 30);\r\n\t\t} else {\r\n\t\t\tthis.stopSingleRollerIcon(rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tif (stopIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet newValue = stopIndex + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\tthis.lastIndex = newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex}`);\r\n\t\tlet totalCount = 1 * (this.columnIndex + 1);\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\ttotalCount = 20;\r\n\t\t}\r\n\t\tif (this.rollerCount <= totalCount) {\r\n\t\t\tif (this.rollerCount === totalCount) {\r\n\t\t\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex},\tstopIconIndex:${this.stopIconIndex}`);\r\n\t\t\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3)\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\treturn config.normalRollOption.expectRollerSpeed;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tprivate mergeIcon(parentNode: Node, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet iconCount = this.getAlikeIconCount(rollerLaunchResult);\r\n\t\tlet pos: Vec3 = this.getMergeIconPos(rollerLaunchResult);\r\n\r\n\t\tif (pos) {\r\n\t\t\tthis.buildSkeleton(parentNode, pos, iconCount);\r\n\t\t\tthis.isMergeIcon = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得合并图标的位置 */\r\n\tprivate getMergeIconPos(rollerLaunchResult: RollerLaunchResult, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tlet iconCount = this.getAlikeIconCount(rollerLaunchResult);\r\n\t\tlet pos: Vec3;\r\n\t\tif (iconCount === this.showIconCount) {\r\n\t\t\tlet bool = true;\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (!this.isWinIcon(i, rollerLaunchResult)) {\r\n\t\t\t\t\tbool = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (bool) {\r\n\t\t\t\t// 3个图标取中间的图标的坐标\r\n\t\t\t\tpos = this.iconArr[1].getNode().worldPosition;\r\n\t\t\t}\r\n\t\t} else if (iconCount == this.showIconCount - 1) {\r\n\t\t\t// 找出两个相邻的图标\r\n\t\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\t\tif (this.iconArr[i].getId() === this.iconArr[i + 1].getId() && this.isWinIcon(i, rollerLaunchResult) && this.isWinIcon(i + 1, rollerLaunchResult)) {\r\n\t\t\t\t\t// 用开始的图标的坐标 + 图标的一半 + 间隔的一半\r\n\t\t\t\t\tpos = this.iconArr[i].getNode().worldPosition.clone().add(new Vec3(0, this.iconArr[i].getHeight() / 2 + this.getIntervalHeight(gameType) / 2));\r\n\t\t\t\t\t// console.log(`getMergeIconPos begin`, pos.x, pos.y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tprivate isWinIcon(index: number, rollerLaunchResult: RollerLaunchResult, iconId: IconId = undefined) {\r\n\t\tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\tif (iconId) {\r\n\t\t\t\t\treturn this.iconArr[index].getId() === iconId;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否有中奖图标wild */\r\n\tpublic isWinWild() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (this.isWinIcon(i, this.rollerLaunchResult, IconId.WILD)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate setSpeedBorderStatus(show: boolean) {\r\n\t\tthis.speddBorderNode.active = show;\r\n\t\tif (show) {\r\n\t\t\tthis.speddBorderNode.setWorldPosition(new Vec3(this.node.worldPosition.x + 11, this.node.worldPosition.y + 13));\r\n\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.fast_roller)\r\n\r\n\t\t\tlet scaleX = config.normalRollOption.expectBorderScaleX;\r\n\t\t\tlet scaleY = config.normalRollOption.expectBorderScaleY;\r\n\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1) {\r\n\t\t\t\tscaleX = config.subGameRollOption.expectBorderScaleX;\r\n\t\t\t\tscaleY = config.subGameRollOption.expectBorderScaleY;\r\n\t\t\t}\r\n\t\t\tthis.speddBorderNode.setScale(new Vec3(scaleX, scaleY, 1));\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildSkeleton(parentNode: Node, pos: Vec3, iconCount: number) {\r\n\t\tconst fileName = iconCount === 2 ? PrefabPathDefine.TWO_ICON : PrefabPathDefine.THREE_ICON;\r\n\t\tthis.bigNode = instantiate(sourceManageSeletor().getFile(fileName).source);\r\n\t\tthis.bigNode.name = \"bigNode-\" + iconCount;\r\n\t\tparentNode.addChild(this.bigNode);\r\n\t\tthis.bigNode.setWorldPosition(pos);\r\n\r\n\t\tthis.bigNode.setScale(new Vec3(1, this.getBigNodeScaleY(iconCount)))\r\n\t}\r\n\r\n\tprivate getBigNodeScaleY(iconCount: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\r\n\t\tif (gameType !== GameType.SUBGAME1) {\r\n\t\t\treturn iconCount ? config.normalRollOption.twoIconScaleY : config.normalRollOption.threeIconScaleY;\r\n\t\t} else {\r\n\t\t\treturn iconCount ? config.subGameRollOption.twoIconScaleY : config.subGameRollOption.threeIconScaleY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得相同图标个数 */\r\n\tprivate getAlikeIconCount(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 1;\r\n\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\tif (this.iconArr[i].getId() === IconId.WILD &&\r\n\t\t\t\tthis.iconArr[i].getId() === this.iconArr[i + 1].getId() &&\r\n\t\t\t\tthis.isWinIcon(i, rollerLaunchResult) && this.isWinIcon(i + 1, rollerLaunchResult)) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**暂停赢的图标 */\r\n\tpublic pauseWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.pauseWin());\r\n\t}\r\n\r\n\tprivate hideScatterAnimation() {\r\n\t\tthis.iconArr.filter(v => v.getId() === IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tif (this.isRoll) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.isMergeIcon) {\r\n\t\t\tthis.mergeIcon(this.propertyNode.props_big_icon, this.rollerLaunchResult);\r\n\t\t}\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tconst icon = this.iconArr[index];\r\n\t\t\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\t\t\tif (icon.getId() !== IconId.WILD || !this.isMergeIcon) {\r\n\t\t\t\t\ticon.playWin(this.propertyNode.props_big_icon)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 0.2)\r\n\t}\r\n\t/**播放甲壳虫动画 */\r\n\tpublic playBeetleAnimation(done) {\r\n\t\tlet count = 0;\r\n\t\tconst beetleArr = this.iconArr.filter((v, index) => v.getId() === IconId.BEETLE && index < this.showIconCount)\r\n\t\tif (beetleArr.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbeetleArr.forEach(v => {\r\n\t\t\tv.playBeetleAnimation(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= beetleArr.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**播放一次scatter动画 */\r\n\tprivate playOneScatterAnimation() {\r\n\t\t// 小游戏2不播放\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\telement.playWin(this.propertyNode.props_big_icon, false, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconsole.log(\"roller over handle stop time \" + this.sendBetTime);\r\n\t\tthis.isRoll = false;\r\n\t\tthis.stopIconIndex = -1;\r\n\r\n\t\tthis.isSpeedBorder && this.setSpeedBorderStatus(false);\r\n\t\t// this.mergeIcon(this.propertyNode.props_big_icon, rollerLaunchResult);\r\n\t\tthis.playOneScatterAnimation();\r\n\t\t// 滚动结束时，只有在小游戏2才立马添加锁定图标\r\n\t\tthis.isSubGame2() && this.addLockIcon();\r\n\r\n\t\tegyptv2_Audio.playOneShot(SoundPathDefine.shell_end)\r\n\r\n\t\t// 滚动停止之后需要延迟的时间\r\n\t\tconst time = this.isSubGame2() ? 1.5 : 0.05;\r\n\t\tthis.events.onCheckNextLeftCount();\r\n\t\t// const time = 0.05;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, time)\r\n\r\n\t}\r\n\r\n\t/**添加锁定图标 */\r\n\tpublic addLockIcon(isPlayAnimation: boolean = true) {\r\n\t\tif (!this.iconPool) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet playCount = 0;\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tlockValues.forEach(v => {\r\n\t\t\tlet egyptV2Icon = this.lockIcons.find(iconv => iconv.getIconIndex() === v.index)\r\n\t\t\tif (!egyptV2Icon) {\r\n\t\t\t\tconst iconConfig = config.icon.find(icon => icon.id === v.iconId)\r\n\t\t\t\tegyptV2Icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, v.index);\r\n\t\t\t\tif (!isPlayAnimation || egyptV2Icon.isBeetleIcon()) {\r\n\t\t\t\t\tegyptV2Icon.setAmount(v.amount);\r\n\t\t\t\t} else if (egyptV2Icon.isSunGod()) {\r\n\t\t\t\t\t// 播放太阳神出现的音效\r\n\t\t\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.sunGod)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst replaceIcon = this.iconArr[v.index];\r\n\t\t\t\tegyptV2Icon.setPosition(replaceIcon.getPosition())\r\n\t\t\t\treplaceIcon.restore();\r\n\r\n\t\t\t\tthis.iconArr[v.index] = egyptV2Icon;\r\n\t\t\t\tthis.lockIcons.push(egyptV2Icon)\r\n\r\n\t\t\t\tthis.removeSingleRollerIcon(v.index);\r\n\r\n\t\t\t\tisPlayAnimation && egyptV2Icon.playBeetleAnimation(() => {\r\n\t\t\t\t\tegyptV2Icon.hideWin();\r\n\t\t\t\t})\r\n\t\t\t\tplayCount++;\r\n\t\t\t\t// console.log(`addlockicon columnIndex ${this.columnIndex} index ${v.index} amount ${v.amount}, this.lockIcons.length ${this.lockIcons.length}`);\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn playCount;\r\n\t}\r\n\r\n\tprivate removeSingleRollerIcon(index: number) {\r\n\t\tfor (let i = 0; i < this.singleIconRollerViewModels.length; i++) {\r\n\t\t\tconst element = this.singleIconRollerViewModels[i];\r\n\t\t\tif (element.comp.getSlotIndex() === index) {\r\n\t\t\t\telement.unMount();\r\n\t\t\t\tthis.singleIconRollerViewModels.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**删除锁定图标 */\r\n\tpublic removeLockIcon() {\r\n\t\tthis.lockIcons.forEach(v => v.destory());\r\n\t\tthis.lockIcons = [];\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst halfHeight = height / 2;\r\n\t\tconst paddingBottom = this.getRollerPaddingBottom(gameType)\r\n\t\tlet y = 0;\r\n\t\tif (index === 0) {\r\n\t\t\t// 第一个图标的坐标位置 = 下边距 + icon高度的一半\r\n\t\t\ty = paddingBottom + halfHeight;\r\n\t\t} else {\r\n\t\t\t// 从第二开始的坐标 = 下边距 + icon高度的一半 + 图标间隔个数 + icon高度个数\r\n\t\t\tconst interval = this.getIntervalHeight(gameType) * index\r\n\t\t\ty = paddingBottom + halfHeight + interval + height * index;\r\n\t\t}\r\n\t\ty -= this.getIconContainerAnchorPos();\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得图标容器锚点的起始位置 */\r\n\tprivate getIconContainerAnchorPos() {\r\n\t\tconst iconListUI = this.propertyNode.props_icon_list.getComponent(UITransform)\r\n\t\treturn iconListUI.height * iconListUI.anchorY\r\n\t}\r\n\r\n\tpublic changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tif (gameType === GameType.SUBGAME2) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight2;\r\n\t\t} else if (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight1;\r\n\t\t}\r\n\t\tthis.propertyNode.props_icon_list.getComponent(UITransform).height = rollerHeight;\r\n\r\n\r\n\t\tif (this.isMergeIcon) {\r\n\t\t\tconsole.log(`bigNode11 setWorldPosition begin`, this.bigNode.getWorldPosition().x, this.bigNode.getWorldPosition().y);\r\n\t\t\tconst pos = this.getMergeIconPos(this.rollerLaunchResult, gameType);\r\n\t\t\t// 重新设置合并图标位置\r\n\t\t\t// this.bigNode.setWorldPosition(pos);\r\n\t\t\tconsole.log(`bigNode11 setWorldPosition end`, pos.x, pos.y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**重置图标位置 */\r\n\tpublic resetIconPos(gameType: GameType) {\r\n\t\tthis.changeRollerHeight(gameType);\r\n\t\tif (gameType !== GameType.SUBGAME2) {\r\n\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\tconst pos = this.getIconPosByIndex(i, gameType);\r\n\t\t\t\ticon.setPosition(pos);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isMergeIcon) {\r\n\t\t\t// console.log(`bigNode setWorldPosition begin`, this.bigNode.getWorldPosition().x, this.bigNode.getWorldPosition().y);\r\n\t\t\tconst pos = this.getMergeIconPos(this.rollerLaunchResult, gameType);\r\n\t\t\t// 重新设置合并图标位置\r\n\t\t\tthis.bigNode.setWorldPosition(pos);\r\n\t\t\t// console.log(`bigNode setWorldPosition end`, pos.x, pos.y);\r\n\t\t\tlet iconCount = this.getAlikeIconCount(this.rollerLaunchResult);\r\n\t\t\tthis.bigNode.setScale(new Vec3(1, this.getBigNodeScaleY(iconCount, gameType)));\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换单个滚动图标 */\r\n\tpublic replaceSingleRollerIcon() {\r\n\t\tthis.addLockIcon(false);\r\n\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\tconst v = this.iconArr[i];\r\n\t\t\t// 替换不是甲壳虫和太阳神图标\r\n\t\t\t// if (!this.isSubGame2SpecialIcon(v.getId())) {\r\n\t\t\tif (!lockValues.find(lock => lock.index === i)) {\r\n\t\t\t\tthis.buildSingleRollerIcon(i, v.getPosition(), v);\r\n\t\t\t\tv.getNode().active = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换多个滚动图标 */\r\n\tpublic replaceMultiRollerIcon() {\r\n\t\tthis.singleIconRollerViewModels.forEach(v => {\r\n\t\t\tconst firstIcon = v.comp.getFirstIcon();\r\n\t\t\tfirstIcon.getNode().removeFromParent();\r\n\r\n\t\t\tconst index = v.comp.getSlotIndex();\r\n\t\t\tthis.propertyNode.props_icon_list.addChild(firstIcon.getNode());\r\n\t\t\tfirstIcon.setPosition(this.getIconPosByIndex(index))\r\n\t\t\tthis.iconArr[index] = firstIcon;\r\n\r\n\t\t\tv.unMount();\r\n\t\t})\r\n\r\n\t\t// 只有从小游戏2退出去的才隐藏甲壳虫上面的数字\r\n\t\tif (this.props.gameTypeInfo.lastGameType === GameType.SUBGAME2 ||\r\n\t\t\tthis.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t// 在切到游戏之后，把甲壳虫上面的数字隐藏了\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (i >= this.iconArr.length) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tconst v = this.iconArr[i];\r\n\t\t\t\tif (v.isBeetleIcon() || v.getId() === IconId.SUN_GOD) {\r\n\t\t\t\t\tv.hideAmount();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.lockIcons = [];\r\n\t\tthis.singleIconRollerViewModels = [];\r\n\t}\r\n\r\n\t/**构建单个图标滚动 */\r\n\tprivate buildSingleRollerIcon(index: number, pos: Vec3, icon: EgyptV2Icon) {\r\n\t\tconst viewModel = new EgyptV2SingleIconRollerViewModel()\r\n\t\t\t.mountView(sourceManageSeletor().getFile(PrefabPathDefine.SINGLE_ICON_ROLLER).source)\r\n\t\t\t.appendTo(this.propertyNode.props_icon_list);\r\n\t\tviewModel.viewNode.getComponent(UITransform).width = config.subGameRollOption.singleIconMaskWidth;\r\n\t\tviewModel.viewNode.getComponent(UITransform).height = config.subGameRollOption.singleIconMaskHeight;\r\n\t\tthis.singleIconRollerViewModels.push(viewModel);\r\n\t\tviewModel.viewNode.setPosition(pos);\r\n\r\n\t\tviewModel.comp.initSlot(this.columnIndex, index, icon.getIconIndex(), this.iconPool);\r\n\t}\r\n\r\n\tprivate getRollerPaddingBottom(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.rollerPaddingBottom;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerPaddingBottom;\r\n\t}\r\n\r\n\t/**多图标滚动 */\r\n\tprivate multiIconRoller() {\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - this.getRollSpeed()));\r\n\t\t})\r\n\r\n\t\tconst frist = this.iconArr[0];\r\n\t\t// 图标隐藏的Y坐标 = 图标一半高度 + 滚轴下内边距 + 容器锚点的高度\r\n\t\tlet iconHideY = -(frist.getHeight() / 2 + this.getRollerPaddingBottom())\r\n\t\ticonHideY -= this.getIconContainerAnchorPos()\r\n\t\tif (frist.getPosition().y <= iconHideY) {\r\n\t\t\t// console.log(`columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex}, rollerCount:${this.rollerCount}`);\r\n\t\t\tif (this.rollerCount >= 0) {\r\n\t\t\t\tthis.rollerCount++;\r\n\t\t\t}\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[2]\r\n\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\t// console.log(`xxxxxxxxxxx-----columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex},endIcon.getIconIndex():${endIcon.getIconIndex()},this.getStopIconIndex():${this.getStopIconIndex()}`);\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\r\n\t\t\t\tconst duration = 0.1;\r\n\t\t\t\t// 结束之后计算每个图标的最终位置，\r\n\t\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\t\ttween(icon.getNode()).to(duration, { position: this.getIconPosByIndex(i) }).start();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t}, duration)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isMultiRoll() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**停止单个图标的滚动 */\r\n\tprivate stopSingleRollerIcon(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 0;\r\n\t\tif (this.singleIconRollerViewModels.length === 0) {\r\n\t\t\tthis.isRoll = false;\r\n\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t} else {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.stopRoll(this.stopIconIndex, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.singleIconRollerViewModels.length) {\r\n\t\t\t\t\tthis.isRoll = false;\r\n\t\t\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t}, rollerLaunchResult));\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得甲壳虫上面的数字节点 */\r\n\tpublic getBeetleNode(isIncludeSunGod: boolean = false) {\r\n\t\tconst nodes: EgyptV2Icon[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\t// 获得太阳神图标，数字必须要大于0的\r\n\t\t\tconst isSunGod = isIncludeSunGod && element.getId() === IconId.SUN_GOD && element.getAmount() > 0;\r\n\t\t\tif (element.getId() === IconId.BEETLE || isSunGod) {\r\n\t\t\t\tnodes.push(element);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\t/**获得太阳神图标 */\r\n\tpublic getSunGodIconNode() {\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\t// 并且要是锁定的图标\r\n\t\t\tif (element.getId() === IconId.SUN_GOD && element.getAmount() === 0 && lockValues.find(v => v.index === i)) {\r\n\t\t\t\treturn element;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tthis.isRoll = false;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll && this.iconArr.length > 0) {\r\n\t\t\tif (this.isMultiRoll()) {\r\n\t\t\t\tthis.multiIconRoller();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}