{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/FishLabelFnt.ts"],"names":["FishLabelFnt","Label","Node","Vec3","ActionEffectPlayer","createFont","toNodeSpaceAR","fishLabelFntZorder","FishLabelFntCreate","create","info","constructor","fishLabelConfig","fishLabelResConfig","actionConfig","commonConfig","object_id","item_config","is_alive","end_call","uiRoot","label","total_gold","add_step","cur_add_time","buse_add_score","fishLabelFntManager","sourceManage","rootNode","addComponent","init","obj_id","id","scr_config","src_id","string","font","src","active","setPosition","setSiblingIndex","play","spos","number","mul","getUseSkew","setScale","max_rate_show","show_add_score_time","pushShowAddScore","act_id","getDataId","getObjectId","setUseState","buse","getUseState","setEndCallback","call","resumeOrgin","getAddScoreState","update","dt","Math","floor","pow"],"mappings":"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","sourcesContent":["import { Label, Node, Vec3 } from \"cc\"\r\nimport { ActionEffectPlayer } from \"./ActionEffectPlayer\"\r\nimport { ICreateObj } from \"./ObjectPool\";\r\nimport { FishLabelFntManager } from \"./FishLabelFntManager\";\r\nimport { createFont, toNodeSpaceAR } from \"./FishTool\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\n\r\n/**\r\n  金钱显示字体\r\n */\r\nconst fishLabelFntZorder = 800000\r\n\r\n/**\r\n  info = {\r\n    obj_id,\r\n    id,\r\n  }\r\n */\r\nexport const FishLabelFntCreate: ICreateObj = {\r\n  create: (info) => {\r\n    return new FishLabelFnt();\r\n  }\r\n}\r\n\r\nexport class FishLabelFnt {\r\n  private fishLabelConfig = null\r\n  private fishLabelResConfig = null\r\n  private actionConfig = null\r\n  private commonConfig = null\r\n  private object_id = null\r\n  private item_config = null\r\n  private is_alive: boolean\r\n  private end_call = null\r\n\r\n  public uiRoot: Node;\r\n  private label: Label;\r\n  private total_gold: number;\r\n  private add_step: number;\r\n  private cur_add_time: number;\r\n  private buse_add_score: boolean;\r\n  private fishLabelFntManager: FishLabelFntManager\r\n  private sourceManage: SourceManage;\r\n  private rootNode: Node;\r\n\r\n  constructor() {\r\n    this.uiRoot = new Node();\r\n    this.label = this.uiRoot.addComponent(Label)\r\n  }\r\n\r\n  public init(info, sourceManage: SourceManage, fishLabelFntManager: FishLabelFntManager, fishLabelConfig, fishLabelResConfig, actionConfig,\r\n    commonConfig, rootNode: Node) {\r\n    this.sourceManage = sourceManage;\r\n    this.fishLabelConfig = fishLabelConfig;\r\n    this.fishLabelResConfig = fishLabelResConfig;\r\n    this.fishLabelFntManager = fishLabelFntManager;\r\n    this.actionConfig = actionConfig;\r\n    this.commonConfig = commonConfig;\r\n    this.rootNode = rootNode;\r\n    this.object_id = info.obj_id\r\n    this.item_config = this.fishLabelConfig[info.id]\r\n    this.is_alive = false\r\n    this.end_call = null\r\n\r\n    let scr_config = this.fishLabelResConfig[this.item_config.src_id]\r\n    this.label.string = \"0\"\r\n    this.label.font = createFont(this.sourceManage, scr_config.src);\r\n    this.uiRoot.active = (false)\r\n    // this.uiRoot.setWorldPosition(new Vec3(0, 0))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(0, 0)))\r\n\r\n    this.uiRoot.setSiblingIndex(fishLabelFntZorder);\r\n\r\n    this.total_gold = 0\r\n    this.add_step = 0\r\n    this.cur_add_time = 0\r\n\r\n    this.buse_add_score = false\r\n  }\r\n\r\n  public play(spos, number: number, mul) {\r\n    if (this.fishLabelFntManager.getUseSkew() == true) {\r\n      this.uiRoot.setScale(-1, -1)\r\n    } else {\r\n      this.uiRoot.setScale(1, 1)\r\n    }\r\n\r\n    if (mul > this.commonConfig.max_rate_show || number > 9.90) {\r\n      this.label.string = \"0\"\r\n      this.buse_add_score = true\r\n      //s = 1/2*a*pow(t,2)\r\n      this.add_step = 2 * number / (this.commonConfig.show_add_score_time * this.commonConfig.show_add_score_time)\r\n      this.total_gold = number\r\n      this.fishLabelFntManager.pushShowAddScore(this)\r\n    } else {\r\n      this.label.string = `+${number}`\r\n      this.buse_add_score = false\r\n    }\r\n\r\n    // this.uiRoot.setWorldPosition(new Vec3(spos.x, spos.y))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, spos))\r\n    this.uiRoot.active = (true)\r\n\r\n    ActionEffectPlayer.play(this.uiRoot, () => {\r\n      if (this.end_call) {\r\n        this.end_call(this)\r\n      }\r\n    }, this.actionConfig[this.item_config.act_id])\r\n  }\r\n\r\n  public getDataId() {\r\n    return this.item_config.id\r\n  }\r\n\r\n  public getObjectId() {\r\n    return this.object_id\r\n  }\r\n\r\n  public setUseState(buse) {\r\n    this.is_alive = buse\r\n  }\r\n\r\n  public getUseState() {\r\n    return this.is_alive\r\n  }\r\n\r\n  public setEndCallback(call) {\r\n    this.end_call = call\r\n  }\r\n\r\n  public resumeOrgin() {\r\n    this.uiRoot.active = (false)\r\n    // this.uiRoot.setWorldPosition(new Vec3(0, 0))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(0, 0)))\r\n    this.end_call = null\r\n    this.label.string = \"0\"\r\n    this.total_gold = 0\r\n    this.add_step = 0\r\n    this.cur_add_time = 0\r\n    this.buse_add_score = false\r\n  }\r\n\r\n  public getAddScoreState() {\r\n    return this.buse_add_score\r\n  }\r\n\r\n  public update(dt) {\r\n    if (this.buse_add_score == true) {\r\n      if (this.cur_add_time > this.commonConfig.show_add_score_time) {\r\n        this.buse_add_score = false\r\n        this.label.string = `+${this.total_gold}`\r\n      } else {\r\n        this.cur_add_time = this.cur_add_time + dt\r\n        this.label.string = '+' + Math.floor(this.add_step * Math.pow(this.cur_add_time, 2) / 2);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n"]}