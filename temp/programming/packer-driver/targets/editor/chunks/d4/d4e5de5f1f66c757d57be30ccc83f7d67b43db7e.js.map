{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/starlight/viewModel/RollerPanelViewModel.ts"],"names":["ViewModel","StoreInject","getStore","AutoLauncherType","GameModeType","GameType","IconEffectType","config","setStopRollAction","initRollAction","setIconEffect","setRollRoundEnd","setRollSpeed","setSmallBox","SKT_MAG_TYPE","sktMsgListener","dataTransfer","refreshData","DataKeyType","TaskScheduler","Task","PrefabPathDefine","footerViewModel","starlight_Audio","gameBoardViewModel","sourceManageSeletor","EffectType","changeGameFreeGametotalMultiplier","changeMinigameCount","changeMultipleTotal","changeProfit","changeRoleAttack","changeViewGame","changeapostille","setWaiting","updateBalance","updateGameModeType","updateSubGameTimes","BaseViewModel","SoundPathDefine","addToastAction","SgBoxViewModel","sendNativeVibrate","RollerPanelViewModel","constructor","lastGameType","currGameType","viewGameType","rollerMap","taskScheduler","autoLaunchType","winnerDialog","apostille","isHasten","balance","gameFreeGametotalMultiplier","begin","initRollerMap","comp","setProps","SUBGAME1","dispatch","scheduleOnce","manualBetHandler","setEvent","setRoleAttacks","bl","allRollStop","playOneShot","ROLLER_END","flicherArr","ICON_EFFECT_DATA","forEach","item","Object","keys","length","i","winningPosition","task","done","gameWinningVos","v","NORMAIL","joinqQueue","theNumberOfAdditions","GAME_TYPE","INDEXADDFREECOUNT","setokkk","miniGameFlying","multiplier","multiplesOfFlight","RATES","samllMultiplier","addFrequency","ITEMTOTALMULTIPLIER","SUBGAME_TIMES","GAMEFREEGAMETOTALMULTIPLIER","addGold","MAIN","PROFIT_AMOUNT","FREE_GAME_AMOUNT","showAwardTask","checkAward","changeGameTypeTask","isExecute","SCATTER_BONUS","UI_FREESPIN","caculateDialog1","mountView","getFile","CACULATE","source","appendTo","parentNode","parent","effectType","EFFECT1","isModal","type","total","killSelfHandler","unMount","BALANCE","stop","play","BG_MUSIC_1","NEXTGAME_TYPE","buyToWin","normal","caculateDialog2","BG_MUSIC_MAIN","probabilityDoublingSwitch","e","BUY_RATE_BTN_CLICK","isAccelerate","buyMiniGames","str","BUY_FREE_BTN","SGBOX","miniGameAmount","connect","LAMIT_FAST","add","LAUNCHER_BET","data","error","content","rollerItem","index","COINSAFTERBETTING","stopQueue","NONE","stopIndex","ROLLER_STOP_INDEX_ID","indexAddFreeCount","autoLauncherPanel","setLaunchEvent","state","asp","queue","queueIndex","isLargeRollGame","SUBGAME2","gameOption","largeRollOption","normalRollOption","push","iconQueue","map","iconId","uiData","find","id","iconEffect","height","singleRollerHeight","width","singleRollerWidth","intervalHeight","singleIntervalHeight","multiple","LargeIcon","LargeRoller","rolling","speed","rollerSpeed","speedBackUp","rollerWidth","intervalWidth","rollerIntervalWidth","stopIconIndex","direction","profitMultiple","PROFIT_MULTIPLE","winning","minRate","maxRate","BIG_PRIZE","glodAmount","unMountCallBack","destoryQueue","rollerViewModelMap","mv","removeById","inject","game","autoLauncherType","roller","iconEffectData","betAmount","bettingInformation","gameMode","remainSubGameTimes","isRollEnd","roundAllEnd","minigameCount"],"mappings":"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","sourcesContent":["import { Node, log } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { Starlight_RollerPanel, IProps, IEvent } from \"../components/Starlight_RollerPanel\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { getStore } from \"../store\"\r\nimport { AutoLauncherType, DialogType, DirectionType, GameModeType, GameType, IconEffectType, RollerType } from \"../type\"\r\nimport config from \"../config\"\r\nimport { beginRollAction, setStopRollAction, initRollAction, endRollingAction, setIconEffect, setRollRoundEnd, setRollSpeed, setSmallBox } from \"../store/actions/roller\"\r\nimport { SKT_MAG_TYPE, sktMsgListener } from \"../socketConnect\"\r\nimport dataTransfer, { refreshData, DataKeyType, setData } from \"../dataTransfer\"\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from \"../../../utils/TaskScheduler\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { footerViewModel, starlight_Audio, gameBoardViewModel, sourceManageSeletor } from \"../index\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport { changeGame, changeGameFreeGametotalMultiplier, changeMinigameCount, changeMultipleTotal, changeProfit, changeRoleAttack, changeViewGame, changeapostille, setSubGameTimes, setWaiting, updateBalance, updateGameModeType, updateJackpotAmount, updateSubGameTimes } from \"../store/actions/game\"\r\nimport BaseViewModel from \"../../../common/viewModel/BaseViewModel\"\r\nimport { Starlight_BigPrize, IState as BPIState, IProps as BPIProps, IEvent as BPIEvent } from \"../components/Starlight_BigPrize\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\nimport SgBoxViewModel from \"./SgBoxViewModel\"\r\nimport { Starlight_SmallGame_caculate, IState as CPIState, IProps as CPIProps, IEvent as CPIEvent } from \"../components/Starlight_SmallGame_caculate\"\r\nimport { sendNativeVibrate } from \"../../../common/bridge\"\r\n\r\n@StoreInject(getStore())\r\nclass RollerPanelViewModel extends ViewModel<Starlight_RollerPanel, IProps, IEvent> {\r\n  constructor() {\r\n    super('Starlight_RollerPanel')\r\n  }\r\n  private lastGameType: GameType\r\n  private currGameType: GameType\r\n  private viewGameType: GameType\r\n  public rollerMap: RollerType[] = []\r\n  public taskScheduler: TaskScheduler = new TaskScheduler()\r\n  private autoLaunchType: AutoLauncherType\r\n  private winnerDialog: BaseViewModel<Starlight_BigPrize, BPIState, BPIProps, BPIEvent>\r\n  private apostille: boolean\r\n  private isHasten: boolean\r\n  private balance: number\r\n  private gameFreeGametotalMultiplier: number\r\n  protected begin() {\r\n    // const rollerMap: RollerType[] = []\r\n    // this.dispatch(setRollRoundEnd(true))\r\n    this.initRollerMap()\r\n    // 手动切换场景 \r\n    this.comp.setProps({ currGameType: this.currGameType })\r\n    if (this.currGameType !== GameType.SUBGAME1) { // 按钮置灰\r\n      this.dispatch(setRollRoundEnd(true))\r\n    } else {\r\n      this.dispatch(setRollRoundEnd(false))\r\n      this.comp.scheduleOnce(()=>{\r\n        footerViewModel.manualBetHandler()\r\n      },2)\r\n    }\r\n    this.setEvent({\r\n      setRoleAttacks: (bl) => {\r\n        this.dispatch(changeRoleAttack(bl))\r\n      },\r\n      allRollStop: () => {\r\n        starlight_Audio.playOneShot(SoundPathDefine.ROLLER_END)\r\n        this.dispatch(changeMultipleTotal(0))\r\n        this.dispatch(changeMinigameCount(0))\r\n        this.dispatch(setSmallBox({}))\r\n        const flicherArr = dataTransfer(DataKeyType.ICON_EFFECT_DATA)\r\n        flicherArr.forEach(item => {\r\n          if (Object.keys(flicherArr).length > 0) {\r\n            for (let i in item.winningPosition) {\r\n              const task = new Task((done) => {\r\n                for (let i = 0; i < item.gameWinningVos.length; i++) {\r\n                  const v = item.gameWinningVos[i];\r\n                  this.dispatch(setSmallBox(v))\r\n                }\r\n                //console.log('消除列表',item.winningPosition[i]);\r\n                this.dispatch(setIconEffect(IconEffectType.NORMAIL, item.winningPosition[i]))\r\n                //闪烁2秒钟就结束\r\n                this.comp.scheduleOnce(()=>{\r\n                  done()\r\n                },2)\r\n              })\r\n              this.taskScheduler.joinqQueue(task, false)\r\n            }\r\n          }\r\n        })\r\n        const theNumberOfAdditions = new Task((done) => { // 添加增加特效图标\r\n          if (dataTransfer(DataKeyType.GAME_TYPE) == GameType.SUBGAME1 && dataTransfer(DataKeyType.INDEXADDFREECOUNT) > 2) {\r\n            this.comp.setokkk(done)\r\n          } else {\r\n            done()\r\n          }\r\n        })\r\n        this.taskScheduler.joinqQueue(theNumberOfAdditions, false)\r\n        const miniGameFlying = new Task((done) => { // 倍数飞行特效 \r\n          if(flicherArr.length>1 ){\r\n            this.comp.multiplier(done)\r\n          }else{\r\n            done()\r\n          }\r\n        })\r\n        this.taskScheduler.joinqQueue(miniGameFlying, false)\r\n        const multiplesOfFlight = new Task((done) => { //小游戏飞行特效\r\n          if(flicherArr.length>1 && dataTransfer(DataKeyType.RATES).length > 0&& dataTransfer(DataKeyType.GAME_TYPE) == GameType.SUBGAME1){\r\n            this.comp.samllMultiplier(done)\r\n          }else{\r\n            done()\r\n          }\r\n        })\r\n        this.taskScheduler.joinqQueue(multiplesOfFlight, false)\r\n        const addFrequency = new Task((done) => {\r\n          // 倍数特效\r\n          this.dispatch(changeMultipleTotal(dataTransfer(DataKeyType.ITEMTOTALMULTIPLIER)))\r\n          //检查添加INDEXADDFREECOUNT\r\n          if (dataTransfer(DataKeyType.GAME_TYPE) == GameType.SUBGAME1) {\r\n            this.dispatch(changeMinigameCount(dataTransfer(DataKeyType.INDEXADDFREECOUNT)))\r\n            // 更新次数\r\n            this.dispatch(updateSubGameTimes(dataTransfer(DataKeyType.SUBGAME_TIMES)))\r\n            this.dispatch(changeGameFreeGametotalMultiplier(dataTransfer(DataKeyType.GAMEFREEGAMETOTALMULTIPLIER)))\r\n            this.comp.scheduleOnce(()=>{\r\n              done()\r\n            },1)\r\n          } else {\r\n            done()\r\n          }\r\n        })\r\n        this.taskScheduler.joinqQueue(addFrequency, false)\r\n        const addGold = new Task((done) => {\r\n          //图标效果执行完之后要执行的任务，检查是否有爆奖\r\n          if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.MAIN) {\r\n            this.dispatch(changeProfit(dataTransfer(DataKeyType.PROFIT_AMOUNT)))\r\n          } else {\r\n            this.dispatch(changeProfit(dataTransfer(DataKeyType.FREE_GAME_AMOUNT)))\r\n          }\r\n          this.comp.scheduleOnce(()=>{\r\n            done()\r\n          },0.5)\r\n        })\r\n        this.taskScheduler.joinqQueue(addGold, false)\r\n        const showAwardTask = new Task((done) => {\r\n          //图标效果执行完之后要执行的任务，检查是否有爆奖\r\n          this.checkAward(done)\r\n        })\r\n        this.taskScheduler.joinqQueue(showAwardTask, false)\r\n        if (gameBoardViewModel.changeGameTypeTask && !gameBoardViewModel.changeGameTypeTask.isExecute) {\r\n          if (this.currGameType === GameType.SUBGAME1 && dataTransfer(DataKeyType.SUBGAME_TIMES) !== 0) {\r\n            //isSCATTER显示\r\n            this.taskScheduler.joinqQueue(new Task((done) => {\r\n              starlight_Audio.playOneShot(SoundPathDefine.SCATTER_BONUS)\r\n              this.comp.setokkk(done)\r\n            }))\r\n            //马上执行的游戏类型是小游戏1\r\n            this.taskScheduler.joinqQueue(new Task((done) => {\r\n              if (this.apostille) {\r\n                this.initRollerMap(2)\r\n              }\r\n              starlight_Audio.playOneShot(SoundPathDefine.UI_FREESPIN)\r\n              const caculateDialog1 = new BaseViewModel<Starlight_SmallGame_caculate, CPIState, CPIProps, CPIEvent>('Starlight_SmallGame_caculate').mountView(sourceManageSeletor()\r\n                .getFile(PrefabPathDefine.CACULATE).source).appendTo(this.parentNode.parent, { effectType: EffectType.EFFECT1, isModal: true})\r\n                .setProps({ type: 1, total: dataTransfer(DataKeyType.SUBGAME_TIMES),autoLaunchType: this.autoLaunchType  })\r\n                .setEvent({\r\n                  killSelfHandler: () => {\r\n                    caculateDialog1.unMount(EffectType.EFFECT1)\r\n                    // 手动切换小游戏\r\n                    this.dispatch(updateBalance(dataTransfer(DataKeyType.BALANCE)))\r\n                    this.comp.setProps({ currGameType: 1 })\r\n                    this.dispatch(updateSubGameTimes(dataTransfer(DataKeyType.SUBGAME_TIMES)))\r\n                    starlight_Audio.stop()\r\n                    starlight_Audio.play(SoundPathDefine.BG_MUSIC_1, true)\r\n                    done()\r\n                  }\r\n                })\r\n            }))\r\n          }\r\n          if (dataTransfer(DataKeyType.NEXTGAME_TYPE) === GameType.MAIN) {\r\n            this.taskScheduler.joinqQueue(new Task((done) => {\r\n              if (this.apostille) {\r\n                this.initRollerMap(1)\r\n                this.dispatch(updateGameModeType(GameModeType.buyToWin))\r\n              } else {\r\n                this.dispatch(updateGameModeType(GameModeType.normal))\r\n              }\r\n              if (dataTransfer(DataKeyType.FREE_GAME_AMOUNT) !== 0) {\r\n                starlight_Audio.playOneShot(SoundPathDefine.UI_FREESPIN)\r\n                const caculateDialog2 = new BaseViewModel<Starlight_SmallGame_caculate, CPIState, CPIProps, CPIEvent>('Starlight_SmallGame_caculate').mountView(sourceManageSeletor()\r\n                  .getFile(PrefabPathDefine.CACULATE).source).appendTo(this.parentNode.parent, { effectType: EffectType.EFFECT1, isModal: true})\r\n                  .setProps({ type: 2, total: dataTransfer(DataKeyType.FREE_GAME_AMOUNT),autoLaunchType: this.autoLaunchType})\r\n                  .setEvent({\r\n                    killSelfHandler: () => {\r\n                      this.dispatch(setRollRoundEnd(true))\r\n                      this.dispatch(updateBalance(dataTransfer(DataKeyType.BALANCE)))\r\n                      this.comp.setProps({ currGameType: 0 })\r\n                      caculateDialog2.unMount(EffectType.EFFECT1)\r\n                      this.dispatch(changeViewGame(0))\r\n                      starlight_Audio.stop()\r\n                      starlight_Audio.play(SoundPathDefine.BG_MUSIC_MAIN, true)\r\n                      this.comp.scheduleOnce(()=>{\r\n                        done()\r\n                      },2)\r\n                    }\r\n                  })\r\n              } else {\r\n                this.comp.setProps({ currGameType: 0 })\r\n                done()\r\n              }\r\n            }))\r\n          }\r\n          //禁用掉主下注按钮\r\n          this.taskScheduler.joinqQueue(gameBoardViewModel.changeGameTypeTask)\r\n          this.taskScheduler.joinqQueue(new Task((done) => {\r\n            this.dispatch(setRollRoundEnd(true))\r\n            if (dataTransfer(DataKeyType.NEXTGAME_TYPE) == GameType.SUBGAME1) {\r\n              footerViewModel.manualBetHandler()\r\n            } else {\r\n              this.dispatch(setWaiting(true))\r\n            }\r\n            done()\r\n          }), false)\r\n        } else {\r\n          //不切换游戏\r\n          this.taskScheduler.joinqQueue(new Task((done) => {\r\n            this.dispatch(setRollRoundEnd(true))\r\n            this.dispatch(setWaiting(true))\r\n            if (dataTransfer(DataKeyType.NEXTGAME_TYPE) == GameType.SUBGAME1) {\r\n              footerViewModel.manualBetHandler()\r\n            } \r\n            if (dataTransfer(DataKeyType.GAME_TYPE) == GameType.MAIN) {\r\n              this.dispatch(updateBalance(dataTransfer(DataKeyType.BALANCE)))\r\n            }\r\n            done()\r\n          }), false)\r\n        }\r\n      },\r\n      // 道具状态\r\n      probabilityDoublingSwitch: (e) => {\r\n        this.dispatch(changeapostille(e))\r\n        this.initRollerMap()\r\n        starlight_Audio.playOneShot(SoundPathDefine.BUY_RATE_BTN_CLICK)\r\n        if (e) {\r\n          this.dispatch(updateGameModeType(GameModeType.buyToWin))\r\n        } else {\r\n          this.dispatch(updateGameModeType(GameModeType.normal))\r\n        }\r\n      },\r\n      // 是否加速\r\n      isAccelerate: (e) => {\r\n        if (!e) {\r\n          this.dispatch(setRollSpeed(2))\r\n        } else {\r\n          this.dispatch(setRollSpeed(1))\r\n        }\r\n      },\r\n      buyMiniGames: (str) => {\r\n        starlight_Audio.playOneShot(SoundPathDefine.BUY_FREE_BTN)\r\n        new SgBoxViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.SGBOX).source).appendTo(this.parentNode.parent, {\r\n          effectType: EffectType.EFFECT1, isModal: true,\r\n        }).setProps({ miniGameAmount: str, balance: this.balance }).setEvent({\r\n        }).connect()\r\n      }\r\n    })\r\n    this.dispatch(initRollAction(this.rollerMap))\r\n    if (this.autoLaunchType === AutoLauncherType.LAMIT_FAST) {\r\n      this.dispatch(setRollSpeed(2))\r\n    }\r\n    sktMsgListener.add(SKT_MAG_TYPE.LAUNCHER_BET, \"roller\", (data, error) => {\r\n      if (error) {\r\n        this.dispatch(addToastAction({ content: error }))\r\n        this.rollerMap.forEach((rollerItem, index) => {\r\n          this.dispatch(setStopRollAction(index, 1))\r\n        })\r\n      } else {\r\n        refreshData(data)\r\n        if(dataTransfer(DataKeyType.GAME_TYPE) == GameType.MAIN){\r\n          this.dispatch(updateBalance(dataTransfer(DataKeyType.COINSAFTERBETTING)))\r\n        }\r\n        this.taskScheduler.stopQueue(false)\r\n        this.dispatch(setIconEffect(IconEffectType.NONE, []))\r\n        this.dispatch(changeViewGame(dataTransfer(DataKeyType.GAME_TYPE)))\r\n        const stopIndex: number[] = dataTransfer(DataKeyType.ROLLER_STOP_INDEX_ID)\r\n        this.rollerMap.forEach((rollerItem, index) => {\r\n          this.dispatch(setStopRollAction(index, stopIndex ? stopIndex[index] : 0))\r\n        })\r\n        let indexAddFreeCount = dataTransfer(DataKeyType.INDEXADDFREECOUNT)\r\n        if (indexAddFreeCount > 2) { // 加次数的时候 先减再加\r\n          this.dispatch(updateSubGameTimes(dataTransfer(DataKeyType.SUBGAME_TIMES) - indexAddFreeCount))\r\n        } else {\r\n          this.dispatch(updateSubGameTimes(dataTransfer(DataKeyType.SUBGAME_TIMES)))\r\n        }\r\n      }\r\n    }, 0)\r\n    this.dispatch(changeProfit(dataTransfer(this.viewGameType === GameType.MAIN ? DataKeyType.PROFIT_AMOUNT : DataKeyType.FREE_GAME_AMOUNT)))\r\n    this.comp.scheduleOnce(()=>{\r\n      this.dispatch(setWaiting(true))\r\n    },1.5)\r\n    footerViewModel.autoLauncherPanel.setLaunchEvent(() => {\r\n      footerViewModel.manualBetHandler()\r\n    })\r\n  }\r\n  public initRollerMap(state?) {\r\n    this.rollerMap = []\r\n    let asp = state\r\n    if (state) {\r\n      asp = state == 1 ? true : false\r\n    } else {\r\n      asp = this.apostille\r\n    }\r\n    config[!asp ? 'iconRollerQueue' : 'rateIconRollerQueue'].forEach((queue, queueIndex) => {\r\n      const isLargeRollGame: boolean = (this.currGameType === GameType.SUBGAME2 && queueIndex === 1)\r\n      const gameOption = isLargeRollGame ? config.largeRollOption : config.normalRollOption\r\n      this.rollerMap.push({\r\n        index: queueIndex,\r\n        iconQueue: queue.map((iconId, index) => {\r\n          const uiData = config[isLargeRollGame ? 'largeIcon' : 'rollerIcon'].find(i => i.id === iconId)\r\n          return {\r\n            iconId,\r\n            queueIndex: index + 1,\r\n            iconEffect: IconEffectType.NONE,\r\n            height: gameOption.singleRollerHeight,\r\n            width: gameOption.singleRollerWidth,\r\n            intervalHeight: gameOption.singleIntervalHeight,\r\n            multiple: [],\r\n            LargeIcon: (this.currGameType === GameType.SUBGAME2 && queueIndex == 1),\r\n            uiData\r\n          }\r\n        }),\r\n        LargeRoller: isLargeRollGame,\r\n        rolling: false,\r\n        speed: gameOption.rollerSpeed,\r\n        speedBackUp: gameOption.rollerSpeed,\r\n        width: gameOption.rollerWidth,\r\n        intervalWidth: gameOption.rollerIntervalWidth,\r\n        stopIconIndex: -1,\r\n        direction: gameOption.direction,\r\n      })\r\n    })\r\n    this.dispatch(initRollAction(this.rollerMap))\r\n  }\r\n  /**检查是否要爆奖，爆什么奖 */\r\n  private checkAward(done: Function) {\r\n    const profitMultiple = dataTransfer(DataKeyType.PROFIT_MULTIPLE)\r\n    const winning = config.winning.find(item => item.minRate <= profitMultiple && profitMultiple < item.maxRate)\r\n    if (winning) {\r\n      sendNativeVibrate(200)\r\n      const winnerDialog = new BaseViewModel<Starlight_BigPrize, BPIState, BPIProps, BPIEvent>('Starlight_BigPrize').mountView(sourceManageSeletor()\r\n        .getFile(PrefabPathDefine.BIG_PRIZE).source).appendTo(this.parentNode.parent, { effectType: EffectType.EFFECT1, isModal: true })\r\n        .setProps({ winning, glodAmount: dataTransfer(DataKeyType.PROFIT_AMOUNT) })\r\n        .setEvent({\r\n          killSelfHandler: () => {\r\n            winnerDialog.unMount(EffectType.EFFECT1)\r\n            this.comp.scheduleOnce(()=>{\r\n              done()\r\n            },1)\r\n          }\r\n        })\r\n      //.playOneShot(SoundPathDefine.OPEN_PRIZE)\r\n    } else {\r\n      done()\r\n    }\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    this.taskScheduler.destoryQueue()\r\n    this.comp.rollerViewModelMap.forEach(mv => mv.unMount())\r\n    // this.comp.rollerViewModelMap = []\r\n    this.dispatch(initRollAction([]))\r\n    sktMsgListener.removeById(\"roller\")\r\n    // this.winnerDialog && this.winnerDialog.unMount()\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      this.lastGameType = state.game.currGameType\r\n      this.currGameType = state.game.currGameType\r\n      this.viewGameType = state.game.viewGameType\r\n      this.autoLaunchType = state.game.autoLauncherType\r\n      this.apostille = state.game.apostille\r\n      this.isHasten = state.game.isHasten\r\n      this.balance = state.game.balance\r\n      this.gameFreeGametotalMultiplier = state.game.gameFreeGametotalMultiplier\r\n      return {\r\n        rollerMap: state.roller.rollerMap,\r\n        iconEffectData: state.roller.iconEffectData,\r\n        // jackpotAmount: state.game.jackpotAmount,\r\n        betAmount: state.game.bettingInformation,\r\n        gameMode: state.game.gameMode,\r\n        remainSubGameTimes: state.game.remainSubGameTimes,\r\n        isHasten: state.game.isHasten,\r\n        isRollEnd: state.roller.roundAllEnd,\r\n        minigameCount: state.game.minigameCount,\r\n        gameFreeGametotalMultiplier: state.game.gameFreeGametotalMultiplier\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default RollerPanelViewModel\r\n"]}