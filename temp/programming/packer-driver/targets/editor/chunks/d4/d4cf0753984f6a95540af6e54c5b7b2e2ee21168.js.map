{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/qiuqiu/components/Qiuqiu_MainBoard.ts"],"names":["Label","Node","Toggle","UITransform","Vec3","_decorator","instantiate","tween","BaseComponent","config","DeskStatus","StepNumber","ChipViewModel","playBtnClick","playCoin","playXiazhuJinbi","sourceManageSeletor","PrefabPathDefine","splitChip","getNodeByNameDeep","global","ccclass","property","Qiuqiu_MainBoard","propertyNode","props_btn_title_menu","props_clip_area","props_player_wrap","props_label_pot_num","props_btn_title_shop","props_btn_title_chat","props_dealer","props_paid_area","props_pilechip","props_label_cutdown_num","props","deskStatus","WAITING","playerMap","Array","seatNumber","fill","lastActiveSeatIndex","currActiveSeatIndex","gold","totalBetAmount","newBetInfo","beginGameCountdown","balanceInfos","events","openSetPanel","toggle","openShopPanel","onQuitRoom","dealerBeginOut","getSeatFlyClipStartPos","step","flyChipSpeed","start","getPlayerWrapNode","initState","bindEvent","on","EventType","TOUCH_END","getComponent","isChecked","openShop","useProps","key","value","updateTotalBetAmount","flyClip","cur","COUNTDOWNING","clearData","CLSOE","recycleChip","updateBeginGameCountdown","bindUI","active","node","parent","string","formatNumber","stop","pre","num","Math","floor","isValid","set","pot","i","toString","length","substring","betInfo","pos","seatIndex","startPos","convertToNodeSpaceAR","chips","amount","forEach","v","endPos","randomEndPos","createChip","startPosIsWorlds","parentNode","speed","done","chip","mountView","getFile","prefabs_quiqui_chip","source","appendTo","setProps","connect","viewNode","setWorldPosition","setPosition","to","position","call","removeAllChildren","getWorldPosition","count","children","worldPosition","removeSelf","pileChip","wins","flyToPlayer","arrIndex","pildChipNode","startNode","getPileChipNode","getChildByName","setScale","chipFlyToPlayer","paid","paidChip","winloss","dealerPos","winSeatIndex","winAmount","addChild","formatAmountWithLetter","scheduleOnce","y","flyToSeatIndex","tf","x","random","width","height","getHealerPosition","countdown","update","deltaTime"],"mappings":"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","sourcesContent":["import { Label, Node, Toggle, UITransform, Vec3, _decorator, instantiate, tween } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport config from '../config';\r\nimport { BalanceInfo, BetInfo, Countdown, DeskStatus, Player } from '../type';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport ChipViewModel from '../viewModel/ChipViewModel';\r\nimport { playBtnClick, playCoin, playXiazhuJinbi, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport { splitChip } from '../qiuqiu_tool';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { global } from '../../../hall';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tdeskStatus: DeskStatus\r\n\t/**玩家 */\r\n\tplayerMap: Player[],\r\n\t/**上一个做动作的玩家 */\r\n\tlastActiveSeatIndex: number,\r\n\t/**当前要做动作的用户 */\r\n\tcurrActiveSeatIndex: number,\r\n\tgold: number,\r\n\ttotalBetAmount: number,\r\n\t/**最新下注 */\r\n\tnewBetInfo: BetInfo,\r\n\t/**开始游戏倒计时 */\r\n\tbeginGameCountdown: Countdown,\r\n\t/**本局的结算用户的结算信息 */\r\n\tbalanceInfos: BalanceInfo[],\r\n}\r\nexport interface IEvent {\r\n\topenSetPanel: (toggle: boolean) => void,\r\n\topenShopPanel: () => void,\r\n\tonQuitRoom: () => void,\r\n\t/**庄家开始出牌 */\r\n\tdealerBeginOut: () => void,\r\n\t/**获得座位飞筹码开始位置 */\r\n\tgetSeatFlyClipStartPos: (seatIndex: number) => Vec3,\r\n}\r\n\r\n@ccclass('Qiuqiu_MainBoard')\r\nexport class Qiuqiu_MainBoard extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_title_menu: new Node(),\r\n\t\tprops_clip_area: new Node(),\r\n\t\tprops_player_wrap: new Node(),\r\n\t\tprops_label_pot_num: new Label(),\r\n\t\tprops_btn_title_shop: new Node(),\r\n\t\tprops_btn_title_chat: new Node(),\r\n\t\t/**荷官节点 */\r\n\t\tprops_dealer: new Node(),\r\n\t\t/**赔付筹码的放置区域 */\r\n\t\tprops_paid_area: new Node(),\r\n\t\t/**单个人赔付筹码的放置区域 */\r\n\t\tprops_pilechip: new Node(),\r\n\t\t/**开始游戏倒计时 */\r\n\t\tprops_label_cutdown_num: new Label(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tdeskStatus: DeskStatus.WAITING,\r\n\t\tplayerMap: new Array(config.seatNumber).fill(null),\r\n\t\tlastActiveSeatIndex: -1,\r\n\t\tcurrActiveSeatIndex: -1,\r\n\t\tgold: 0,\r\n\t\ttotalBetAmount: -1,\r\n\t\tnewBetInfo: null,\r\n\t\tbeginGameCountdown: null,\r\n\t\tbalanceInfos: []\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\topenSetPanel: (toggle: boolean) => { },\r\n\t\topenShopPanel: () => { },\r\n\t\tonQuitRoom: () => { },\r\n\t\tdealerBeginOut: () => { },\r\n\t\tgetSeatFlyClipStartPos: () => { return null },\r\n\t}\r\n\r\n\tpublic getPlayerWrapNode() {\r\n\t\treturn this.propertyNode.props_player_wrap;\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_title_menu.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tplayBtnClick();\r\n\t\t\tthis.events.openSetPanel(this.propertyNode.props_btn_title_menu.getComponent(Toggle).isChecked);\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_title_shop.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tplayBtnClick();\r\n\t\t\tglobal.openShop();\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === 'totalBetAmount') {\r\n\t\t\tthis.updateTotalBetAmount(value);\r\n\t\t} else if (key === 'newBetInfo') {\r\n\t\t\tthis.flyClip();\r\n\t\t} else if (key === 'deskStatus') {\r\n\t\t\tif (DeskStatus.WAITING === value.cur || DeskStatus.COUNTDOWNING === value.cur) {\r\n\t\t\t\tthis.clearData();\r\n\t\t\t} else if (DeskStatus.CLSOE === value.cur) {\r\n\t\t\t\tthis.recycleChip();\r\n\t\t\t}\r\n\t\t} else if (key === 'beginGameCountdown') {\r\n\t\t\tthis.updateBeginGameCountdown();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_pilechip.active = false;\r\n\t\tthis.propertyNode.props_label_cutdown_num.node.parent.active = false;\r\n\t}\r\n\r\n\tprivate step: StepNumber;\r\n\t/**更新累计下注 */\r\n\tprivate updateTotalBetAmount(value: { pre: any, cur: any }) {\r\n\t\tif (value.cur === 0) {\r\n\t\t\tthis.propertyNode.props_label_pot_num.string = this.formatNumber(0);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.step && this.step.stop();\r\n\t\tthis.step = new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\tnum = Math.floor(num);\r\n\t\t\tthis.node.isValid && (this.propertyNode.props_label_pot_num.string = this.formatNumber(num));\r\n\t\t});\r\n\t\tthis.step.set(100)\r\n\t\tthis.step.start();\r\n\t}\r\n\r\n\tprivate formatNumber(value: number) {\r\n\t\tlet pot = value + '';\r\n\t\tfor (let i = 0; i < 12 - value.toString().length; i++) {\r\n\t\t\tpot = '0' + pot;\r\n\t\t}\r\n\t\treturn pot.substring(0, 3) + ' ' + pot.substring(3, 6) + ' ' + pot.substring(6, 9) + ' ' + pot.substring(9, 12)\r\n\t}\r\n\r\n\t/**飞筹码 */\r\n\tprivate flyClip() {\r\n\t\tconst betInfo = this.props.newBetInfo;\r\n\t\tif (!betInfo) return;\r\n\t\tplayXiazhuJinbi();\r\n\t\tconst pos = this.events.getSeatFlyClipStartPos(betInfo.seatIndex);\r\n\t\tconst startPos = this.propertyNode.props_clip_area.getComponent(UITransform).convertToNodeSpaceAR(pos);\r\n\r\n\t\tconst chips = splitChip(betInfo.amount);\r\n\t\tchips.forEach(v => {\r\n\t\t\tconst endPos = this.randomEndPos();\r\n\t\t\tthis.createChip(false, startPos, endPos, v, this.propertyNode.props_clip_area, 0.3);\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * 创建筹码，同时飞筹码\r\n\t * @param startPosIsWorlds 开始坐标是否世界坐标\r\n\t * @param startPos 开始坐标\r\n\t * @param endPos 结束坐标\r\n\t * @param value 筹码值\r\n\t * @param parentNode 上级节点\r\n\t * @param speed 筹码飞翔速度\r\n\t * @param done 筹码飞完之后回调函数\r\n\t */\r\n\tprivate createChip(startPosIsWorlds: boolean, startPos: Vec3, endPos: Vec3, value: number, parentNode: Node, speed: number, done = null) {\r\n\t\tlet chip = new ChipViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.prefabs_quiqui_chip).source).appendTo(parentNode)\r\n\t\t\t.setProps({\r\n\t\t\t\tvalue: value\r\n\t\t\t}).connect();\r\n\r\n\r\n\t\tstartPosIsWorlds ? chip.viewNode.setWorldPosition(startPos) : chip.viewNode.setPosition(startPos);\r\n\t\ttween(chip.viewNode).to(speed, { position: endPos }).call(() => {\r\n\t\t\tthis.node.isValid && done && done();\r\n\t\t}).start();\r\n\t}\r\n\r\n\tprivate flyChipSpeed = 0.2\r\n\t/**回收筹码 */\r\n\tpublic recycleChip() {\r\n\t\tthis.propertyNode.props_paid_area.removeAllChildren();\r\n\t\tconst endPos = this.propertyNode.props_dealer.getWorldPosition();\r\n\t\tlet count = 0;\r\n\r\n\t\tconst children = this.propertyNode.props_clip_area.children;\r\n\t\tconst length = children.length;\r\n\t\tchildren.forEach(v => {\r\n\t\t\ttween(v).to(this.flyChipSpeed, { worldPosition: endPos }).removeSelf().call(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= length) {\r\n\t\t\t\t\tthis.node.isValid && this.pileChip(endPos);\r\n\t\t\t\t}\r\n\t\t\t}).start();\r\n\t\t})\r\n\t}\r\n\r\n\t/**堆筹码 */\r\n\tprivate pileChip(startPos: Vec3) {\r\n\t\tconst wins = this.props.balanceInfos;\r\n\r\n\t\t// 通过递归，第一堆往用户头像飞完之后，接到飞第二堆\r\n\t\tconst flyToPlayer = (arrIndex: number) => {\r\n\t\t\tconst pildChipNode = this.propertyNode.props_paid_area.children[arrIndex]\r\n\t\t\tif (!pildChipNode) return;\r\n\r\n\t\t\tconst startNode = this.getPileChipNode(pildChipNode);\r\n\t\t\tpildChipNode.getChildByName(\"spr_chip_bg\").setScale(new Vec3(0, 0))\r\n\t\t\tthis.node.isValid && this.chipFlyToPlayer(startNode, wins[arrIndex].seatIndex, () => {\r\n\t\t\t\tarrIndex++;\r\n\t\t\t\tif (!this.node.isValid) return;\r\n\t\t\t\t// pildChipNode.setScale(new Vec3(0, 0))\r\n\t\t\t\tif (arrIndex < wins.length) {\r\n\t\t\t\t\tflyToPlayer(arrIndex);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.propertyNode.props_paid_area.removeAllChildren();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// 通过递归，从荷官开始飞向桌面，开始堆第一堆，第一堆完了之后开始堆第二堆，所有都堆完了之后，开始飞向用户筹码\r\n\t\tconst paid = (arrIndex: number) => {\r\n\t\t\t// 筹码回收完了之后的下一步操作\r\n\t\t\tthis.node.isValid && this.paidChip(startPos, wins[arrIndex].seatIndex, wins[arrIndex].winloss, () => {\r\n\t\t\t\tarrIndex++;\r\n\t\t\t\tif (arrIndex < wins.length) {\r\n\t\t\t\t\tpaid(arrIndex);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tflyToPlayer(0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tpaid(0);\r\n\t}\r\n\r\n\t/**\r\n\t * 赔付筹码\r\n\t * @param dealerPos 荷官位置 \r\n\t * @param winSeatIndex 赢的位置\r\n\t * @param winAmount 赢的金额\r\n\t * @param done 完成的回调函数\r\n\t */\r\n\tprivate paidChip(dealerPos: Vec3, winSeatIndex: number, winAmount: number, done) {\r\n\t\tconst pildChipNode = instantiate(this.propertyNode.props_pilechip);\r\n\t\tpildChipNode.active = true;\r\n\t\tthis.propertyNode.props_paid_area.addChild(pildChipNode);\r\n\r\n\t\t// 显示赔付\r\n\t\tgetNodeByNameDeep('props_label_chip', pildChipNode).getComponent(Label).string = winAmount.formatAmountWithLetter();\r\n\t\tconst startNode = this.getPileChipNode(pildChipNode);\r\n\t\tconst endPos = startNode.getComponent(UITransform).convertToNodeSpaceAR(startNode.getWorldPosition());\r\n\r\n\t\tconst chips = splitChip(winAmount);\r\n\t\tconst length = chips.length;\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.node.isValid && this.createChip(true, dealerPos, endPos, chips[i], startNode, this.flyChipSpeed, () => {\r\n\t\t\t\t\tif (i === length - 1) {\r\n\t\t\t\t\t\t// 停顿一下再放用户头像飞\r\n\t\t\t\t\t\t// this.scheduleOnce(() => {\r\n\t\t\t\t\t\tthis.node.isValid && done && done();\r\n\t\t\t\t\t\t// }, 0.5)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tendPos.y += 5;\r\n\t\t\t}, 0.05 * (i + 1))\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getPileChipNode(node: Node) {\r\n\t\treturn node && node.getChildByName(\"props_chips\");\r\n\t}\r\n\r\n\t/**\r\n\t * 筹码飞向用户\r\n\t * @param pildChipNode \r\n\t * @param flyToSeatIndex \r\n\t * @param done \r\n\t */\r\n\tprivate chipFlyToPlayer(pildChipNode: Node, flyToSeatIndex: number, done) {\r\n\t\tconst endPos = this.events.getSeatFlyClipStartPos(flyToSeatIndex);\r\n\t\t// 飞向自己时播放收金币的音效\r\n\t\tflyToSeatIndex === 0 && playCoin();\r\n\t\tconst children = pildChipNode.children;\r\n\t\tconst length = children.length;\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tconst v = children[i];\r\n\t\t\ttween(v).to(this.flyChipSpeed * (i + 1), { worldPosition: endPos }).removeSelf().call(() => {\r\n\t\t\t\tif (i === length - 1) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t}).start();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**随机筹码结束位置 */\r\n\tprivate randomEndPos() {\r\n\t\tconst tf = this.propertyNode.props_clip_area.getComponent(UITransform);\r\n\t\tconst x = Math.random() * tf.width;\r\n\t\tconst y = Math.random() * tf.height;\r\n\t\treturn new Vec3(x, y);\r\n\t}\r\n\r\n\t/**获得荷官位置 */\r\n\tpublic getHealerPosition() {\r\n\t\treturn this.propertyNode.props_dealer.getWorldPosition();\r\n\t}\r\n\r\n\tpublic clearData() {\r\n\t\tthis.updateTotalBetAmount({ pre: 0, cur: 0 })\r\n\t\tthis.propertyNode.props_paid_area.removeAllChildren();\r\n\t\tthis.propertyNode.props_clip_area.removeAllChildren();\r\n\t}\r\n\r\n\tprivate updateBeginGameCountdown() {\r\n\t\tconst countdown = this.props.beginGameCountdown;\r\n\t\tif (countdown && countdown.countdown > 0) {\r\n\t\t\tthis.propertyNode.props_label_cutdown_num.node.parent.active = true;\r\n\t\t\tthis.propertyNode.props_label_cutdown_num.string = countdown.countdown < 10 ? '0' + countdown.countdown : countdown.countdown + '';\r\n\t\t} else {\r\n\t\t\tthis.propertyNode.props_label_cutdown_num.node.parent.active = false;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}