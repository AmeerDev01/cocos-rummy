{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/ObjectEffectWorld.ts"],"names":["ObjectEffectWorld","constructor","bulletManager","batteryManager","fishManager","shotCallback","init","uninit","registerCallback","func","update","shotLst","bullets","getBulletBondingInfoLst","k","v","battery","getBatteryByPlayerId","player_id","bullet","lockFishID","getLockFishId","lockFish","getFishObjById","getCurLockFishId","isShotFish","bbx","bulletObj","fishObj","showFishEff","fish","shotFish"],"mappings":";;;8BAiBaA,iB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AALb;AACA;AACA;AAEA;mCACaA,iB,GAAN,MAAMA,iBAAN,CAAwB;AAM7BC,QAAAA,WAAW,CAACC,aAAD,EAA+BC,cAA/B,EAA+DC,WAA/D,EAAyF;AAAA,eAJ5FF,aAI4F;AAAA,eAH5FC,cAG4F;AAAA,eAF5FC,WAE4F;AAAA,eAD5FC,YAC4F,GAD7E,IAC6E;AAClG,eAAKH,aAAL,GAAqBA,aAArB;AACA,eAAKC,cAAL,GAAsBA,cAAtB;AACA,eAAKC,WAAL,GAAmBA,WAAnB;AACD;;AAEME,QAAAA,IAAI,GAAG;AACZ,eAAKD,YAAL,GAAoB,IAApB;AACD;;AAEME,QAAAA,MAAM,GAAG;AACd,eAAKF,YAAL,GAAoB,IAApB;AACD;;AAEMG,QAAAA,gBAAgB,CAACC,IAAD,EAAO;AAC5B,eAAKJ,YAAL,GAAoBI,IAApB;AACD;;AAEMC,QAAAA,MAAM,GAAG;AACd,cAAIC,OAAO,GAAG,EAAd;AACA,cAAIC,OAAO,GAAG,KAAKV,aAAL,CAAmBW,uBAAnB,EAAd;;AACA,eAAK,MAAMC,CAAX,IAAgBF,OAAhB,EAAyB;AACvB,kBAAMG,CAAC,GAAGH,OAAO,CAACE,CAAD,CAAjB;AACA,gBAAIC,CAAC,KAAK,IAAV,EAAgB;AAChB,gBAAIC,OAAO,GAAG,KAAKb,cAAL,CAAoBc,oBAApB,CAAyCF,CAAC,CAACG,SAA3C,CAAd;;AACA,gBAAIF,OAAJ,EAAa;AACX,oBAAMG,MAAM,GAAGJ,CAAC,CAACI,MAAjB;AACA,oBAAMC,UAAU,GAAGJ,OAAO,CAACK,aAAR,EAAnB;AACA,oBAAMC,QAAQ,GAAG,KAAKlB,WAAL,CAAiBmB,cAAjB,CAAgCH,UAAhC,CAAjB,CAHW,CAKX;;AACA,kBAAIE,QAAQ,IAAIH,MAAM,CAACK,gBAAP,OAA8BJ,UAA9C,EAA0D;AAAE;AAC1D,oBAAIE,QAAQ,CAACG,UAAT,CAAoBV,CAAC,CAACW,GAAtB,MAA+B,IAAnC,EAAyC;AACvCf,kBAAAA,OAAO,CAACG,CAAD,CAAP,GAAa;AAAEa,oBAAAA,SAAS,EAAER,MAAb;AAAqBS,oBAAAA,OAAO,EAAEN;AAA9B,mBAAb;AACAA,kBAAAA,QAAQ,CAACO,WAAT;AACD;AACF,eALD,MAKO;AAAE;AACP,sBAAMC,IAAI,GAAG,KAAK1B,WAAL,CAAiB2B,QAAjB,CAA0BhB,CAAC,CAACW,GAA5B,CAAb;;AACA,oBAAII,IAAJ,EAAU;AACRnB,kBAAAA,OAAO,CAACG,CAAD,CAAP,GAAa;AAAEa,oBAAAA,SAAS,EAAER,MAAb;AAAqBS,oBAAAA,OAAO,EAAEE;AAA9B,mBAAb;AACAA,kBAAAA,IAAI,CAACD,WAAL;AACD;AACF;AACF;AACF;;AACD,eAAKxB,YAAL,CAAkBM,OAAlB;AACD;;AApD4B,O","sourcesContent":["import { Battery } from \"./Battery\"\r\nimport { BatteryManager } from \"./BatteryManager\"\r\nimport { Bullet } from \"./Bullet\"\r\nimport { BulletManager } from \"./BulletManager\"\r\nimport { Fish } from \"./Fish\"\r\nimport { FishManager } from \"./FishManager\"\r\n\r\nexport type ShotInfo = {\r\n  bulletObj: Bullet,\r\n  fishObj: Fish\r\n}\r\n\r\n/**\r\n  对象作用世界，碰撞\r\n */\r\n\r\n//////////////////////////////////////////\r\nexport class ObjectEffectWorld {\r\n\r\n  private bulletManager: BulletManager\r\n  private batteryManager: BatteryManager\r\n  private fishManager: FishManager\r\n  private shotCallback = null\r\n  constructor(bulletManager: BulletManager, batteryManager: BatteryManager, fishManager: FishManager) {\r\n    this.bulletManager = bulletManager\r\n    this.batteryManager = batteryManager\r\n    this.fishManager = fishManager\r\n  }\r\n\r\n  public init() {\r\n    this.shotCallback = null\r\n  }\r\n\r\n  public uninit() {\r\n    this.shotCallback = null\r\n  }\r\n\r\n  public registerCallback(func) {\r\n    this.shotCallback = func\r\n  }\r\n\r\n  public update() {\r\n    let shotLst = {}\r\n    let bullets = this.bulletManager.getBulletBondingInfoLst()\r\n    for (const k in bullets) {\r\n      const v = bullets[k];\r\n      if (v === null) continue;\r\n      let battery = this.batteryManager.getBatteryByPlayerId(v.player_id) as Battery;\r\n      if (battery) {\r\n        const bullet = v.bullet as Bullet;\r\n        const lockFishID = battery.getLockFishId()\r\n        const lockFish = this.fishManager.getFishObjById(lockFishID) as Fish\r\n\r\n        // console.log(`lockFishID = ${lockFishID}, bulletLockFishID = ${bullet.getCurLockFishId()}`);\r\n        if (lockFish && bullet.getCurLockFishId() === lockFishID) { //锁定\r\n          if (lockFish.isShotFish(v.bbx) === true) {\r\n            shotLst[k] = { bulletObj: bullet, fishObj: lockFish }\r\n            lockFish.showFishEff()\r\n          }\r\n        } else { //没有锁定\r\n          const fish = this.fishManager.shotFish(v.bbx) as Fish\r\n          if (fish) {\r\n            shotLst[k] = { bulletObj: bullet, fishObj: fish }\r\n            fish.showFishEff()\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.shotCallback(shotLst)\r\n  }\r\n}\r\n\r\n\r\n"]}