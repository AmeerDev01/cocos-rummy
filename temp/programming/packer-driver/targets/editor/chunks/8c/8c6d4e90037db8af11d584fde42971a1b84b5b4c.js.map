{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenix/Slot/Component/phoenix_AwardBox.ts"],"names":["_decorator","Label","Node","sp","tween","UIOpacity","Vec3","phoenix_BaseComponent","config","bindClickEvent","ccclass","property","BoxState","Phoenix_AwardBox","SkeletonData","boxId","status","CLOSE","start","update","deltaTime","showScore","amount","score","node","getChildByName","getComponent","string","formatAmountWithCommas","ui","active","setScale","opacity","target","to","scale","setEffect","effectId","cb","skeletonRoot","Skeleton","animation","awardBoxItem","find","item","id","window","setTimeout","subIcon","skeleton","skeletonData","name","animafild","OPEN","destroy","setBoxId","bindEvent","bindUI"],"mappings":"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","sourcesContent":["import {_decorator, Label, Node, sp, tween, UIOpacity, Vec3} from 'cc';\r\nimport phoenix_BaseComponent from './phoenix_BaseComponent';\r\nimport config from '../phoenix_config';\r\nimport {bindClickEvent} from '../phoenix_utils';\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\n\r\nexport enum BoxState {\r\n    OPEN,\r\n    CLOSE,\r\n    OPRNING\r\n}\r\n\r\n\r\n@ccclass('Phoenix_AwardBox')\r\nexport class Phoenix_AwardBox extends phoenix_BaseComponent {\r\n    /**宝箱ID */\r\n    public boxId: string = ''\r\n    /**宝箱状态 */\r\n    public status: BoxState = BoxState.CLOSE\r\n\r\n    @property(Node)\r\n    subIcon: Node = null\r\n\r\n    @property(sp.SkeletonData)\r\n    BxApple: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    BxStrawberry: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    BxGrape: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    BxWatermelon: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    BxBanana: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    up: sp.SkeletonData = null\r\n\r\n    @property(sp.SkeletonData)\r\n    addtimes: sp.SkeletonData = null\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n\r\n    private showScore(amount: number) {\r\n        const score = this.node.getChildByName(\"score\")\r\n        score.getComponent(Label).string = amount.formatAmountWithCommas() + ''\r\n        const ui = score.getComponent(UIOpacity)\r\n        score.active = true\r\n        score.setScale(0.7, 0.7)\r\n        ui.opacity = 0\r\n        tween().target(ui).to(0.2, {opacity: 255}).start()\r\n        tween().target(score).to(0.2, {scale: new Vec3(1, 1)}).start()\r\n    }\r\n\r\n    /**执行响应的效果 */\r\n    public setEffect(effectId: string, amount: number, cb: () => void) {\r\n        // console.log(this.boxId, '开始效果')\r\n        const skeletonRoot = this.node.getComponent(sp.Skeleton)\r\n        skeletonRoot.animation = 'diankaibaoxiang';\r\n        // skeletonRoot.loop = false //这个居然没有作用，MMP\r\n        const awardBoxItem = config.awardBoxItem.find(item => item.id === effectId)\r\n        window.setTimeout(() => {\r\n            // 打开贝壳等一秒钟\r\n            this.subIcon.active = true\r\n            const skeleton = this.subIcon.getComponent(sp.Skeleton)\r\n            skeleton.skeletonData = this[awardBoxItem.name]\r\n            skeleton.animation = awardBoxItem.animafild\r\n            window.setTimeout(() => {\r\n                // 展示结果耗时\r\n                this.status = BoxState.OPEN\r\n                amount && this.showScore(amount)\r\n                cb && cb()\r\n            }, 1500)\r\n        }, 1000)\r\n        window.setTimeout(() => skeletonRoot.destroy(), 1500)\r\n    }\r\n\r\n    /**执行响应的效果 */\r\n    public setBoxId(boxId: string) {\r\n        this.boxId = boxId\r\n        this.node.getChildByName(\"boxId\").getComponent(Label).string = boxId\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n        // this.node.on(Node.EventType.TOUCH_END, () => { })\r\n    }\r\n\r\n    protected bindUI(): void {\r\n        bindClickEvent(this.node)\r\n        this.node.setScale(0.9, 0.9)\r\n    }\r\n}\r\n\r\n"]}