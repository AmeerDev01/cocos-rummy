{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egyptV2/components/EgyptV2_SingleIconRoller.ts"],"names":["_decorator","Node","Vec3","BaseComponent","config","GameType","getColumnLockIconArr","IconId","cacheData","ccclass","property","EgyptV2_SingleIconRoller","lastIndex","showIconCount","stopIconIndex","columnIndex","slotIndex","iconPool","iconRollerQueue","iconArr","intervalHeight","subGameRollOption","intervalHeight2","rollOverCallback","props_column_effect_node","iconAnimationNode","isRoll","rollCount","rollerSpeed","rollerLaunchResult","rollMaxCount","propertyNode","props_icon_list","props","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","events","start","initState","setColumnEffectNode","getChildByName","initSlot","addIconIndex","initColumn","getSlotIndex","iconCount","i","joinIcon","length","iconId","iconConfig","icon","find","v","id","getIcon","position","lastNode","y","getPosition","getHeight","getNode","setPosition","push","setBeetleAmount","getId","BEETLE","SUBGAME2","diff","calIndexDiff","lockIconDatas","fixedChessboardIcon","lockIconData","index","setAmount","amount","index1","index2","bindEvent","useProps","key","value","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","stopRoll","addLastJoinIconIndex","stopIndex","newValue","getStopIconIndex","bindUI","getRollSpeed","hideWin","playWinIcon","WILD","playWin","rollOverHandle","endIcon","scheduleOnce","node","isValid","getIconPosByIndex","height","normalRollOption","singleRollerHeight","interval","getFirstIcon","shift","rollerIcon","speed","x","frist","hideY","restore","getIconIndex","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Mask, Node, sp, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { EgyptV2Icon } from './EgyptV2_Icon';\r\nimport { GameType, GameTypeInfo, getColumnLockIconArr, IconId, LockIcon, RollerInfo, RollerLaunchResult, RollerStatus } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('EgyptV2_SingleIconRoller')\r\nexport class EgyptV2_SingleIconRoller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = 1;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**插槽索引 */\r\n\tprivate slotIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: EgyptV2Icon[] = [];\r\n\t/**图标间隔 */\r\n\tprivate intervalHeight = config.subGameRollOption.intervalHeight2;\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\r\n\tprivate isRoll = false;\r\n\tprivate rollCount = 0;\r\n\tprivate rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\r\n\tprivate rollerLaunchResult: RollerLaunchResult;\r\n\r\n\tprivate rollMaxCount = 10;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, slotIndex: number, lastIndex: number, iconPool: IconPool) {\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.slotIndex = slotIndex;\r\n\t\tthis.lastIndex = this.addIconIndex(lastIndex, 1);\r\n\t\tthis.iconPool = iconPool;\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\t}\r\n\r\n\tpublic getSlotIndex() {\r\n\t\treturn this.slotIndex;\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tconst position = new Vec3(0, 0);\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.intervalHeight;\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置甲壳虫上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: EgyptV2Icon) {\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff > 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === this.slotIndex)\r\n\t\tif (lockIconData) {\r\n\t\t\ticon.setAmount(lockIconData.amount)\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.rollCount = 0;\r\n\t\tthis.rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\t\tthis.isRoll = true;\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\tthis.rollerLaunchResult = rollerLaunchResult;\r\n\r\n\t\tconst diff = this.slotIndex === 2 ? 0 : this.slotIndex === 0 ? 2 : 1;\r\n\t\tthis.stopIconIndex = this.addIconIndex(this.stopIconIndex, diff);\r\n\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 15);\r\n\r\n\t\t// console.log(`stopRoll--- columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},stopIconIndex:${this.stopIconIndex}, lastIndex:${this.lastIndex}`)\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tthis.lastIndex = this.addIconIndex(stopIndex, value);\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\treturn this.rollCount < this.rollMaxCount ? -1 : this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.stopIconIndex === -1) {\r\n\t\t\treturn this.rollerSpeed;\r\n\t\t}\r\n\t\tthis.rollCount++;\r\n\t\tif (this.rollCount <= this.rollMaxCount) {\r\n\t\t\tthis.rollCount === this.rollMaxCount && this.addLastJoinIconIndex(this.stopIconIndex, 4);\r\n\t\t\t// console.log(`=====columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},rollCount:${this.rollCount},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex}`);\r\n\t\t\treturn this.rollerSpeed;\r\n\t\t}\r\n\t\tlet rollerSpeed = this.rollerSpeed;\r\n\t\tif (this.rollCount % 5 === 0) {\r\n\t\t\trollerSpeed -= 5;\r\n\t\t\trollerSpeed = rollerSpeed <= 0 ? 1 : rollerSpeed;\r\n\t\t\tthis.rollerSpeed = rollerSpeed;\r\n\t\t}\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},rollCount:${this.rollCount},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},rollerSpeed:${rollerSpeed}`);\r\n\r\n\t\treturn rollerSpeed;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tconst icon = this.iconArr[index];\r\n\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\tif (icon.getId() !== IconId.WILD) {\r\n\t\t\ticon.playWin(this.iconAnimationNode)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(endIcon: EgyptV2Icon) {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, 0.05)\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number) {\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst interval = this.intervalHeight * (index + 1)\r\n\t\tconst y = interval + height / 2 + height * index;\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得第一个图标 */\r\n\tpublic getFirstIcon() {\r\n\t\treturn this.iconArr.shift();\r\n\t}\r\n\r\n\tpublic rollerIcon() {\r\n\t\tconst speed = this.getRollSpeed();\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - speed));\r\n\t\t})\r\n\t\tconst frist = this.iconArr[0];\r\n\t\tconst hideY = -(frist.getHeight() + this.intervalHeight)\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},y:${frist.getPosition().y},hideY:${hideY}`);\r\n\t\tif (frist.getPosition().y <= hideY) {\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[0]\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.rollCount = 0;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\t\t\t\tthis.rollOverHandle(endIcon);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprotected onDestroy(): void {\r\n\t\tthis.iconArr.forEach(v => v.restore());\r\n\t\tthis.iconArr = [];\r\n\t\tthis.iconRollerQueue = null;\r\n\t\tthis.props_column_effect_node = null;\r\n\t\tthis.iconAnimationNode = null;\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.rollerIcon();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}