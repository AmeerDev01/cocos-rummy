{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/bandarQiuQiu/components/BandarQiuQiu_gameBoard.ts"],"names":["_decorator","Game","game","instantiate","Node","Sprite","BaseComponent","gameCacheData","SpriteFramePathDefine","mainGameViewModel","playBtnClick","playMyLose","playMyWin","sourceManageSelector","TaskScheduler","Task","betAreaViewModel","historyViewModel","loseViewModel","winViewModel","setMyWinLose","SKT_MAG_TYPE","sktInstance","ccclass","property","BandarQiuQiu_gameBoard","taskScheduler","isShowGame","propertyNode","props_btn_history","props_mim_history","props_history_icon","props_history_icon_new","props","countDown","usersInfo","gameStatus","myInfo","myWinLose","minHistory","events","openHistoryPanel","openWinPanel","openLosePanel","sendGameShowEvent","start","initState","bindEvent","on","EVENT_HIDE","EVENT_SHOW","isUnMount","node","EventType","TOUCH_END","sendSktMessage","HISTORY","roomId","useProps","key","value","cur","joinqQueue","done","window","setTimeout","comp","updateWinsAndLosses","closePopup","dispatch","createMinHistory","removeAllChildren","forEach","m","i","minHItem","getComponent","spriteFrame","getSpriteFrame","addChild","length","newX","setPosition","position","y","clearTheCacheData","time","undefined","unMount","clearAllBetAreaGold","initUsers","item","index","destroyCallBack","destoryQueue","result","fileName","BANDARQIUQIU_MIN_HISTORY_BLUE_WIN","BANDARQIUQIU_MIN_HISTORY_RED_WIN","BANDARQIUQIU_MIN_HISTORY_LV_WIN","getFile","source","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Game, game, instantiate, Node, Sprite, SpriteFrame, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { gameCacheData, GameStatus, HeadType, History, MemberInfoVo } from '../type';\r\nimport { SpriteFramePathDefine } from '../sourceDefine/spriteDefine';\r\nimport { mainGameViewModel, playBtnClick, playMyLose, playMyWin, sourceManageSelector } from '../index';\r\nimport TaskScheduler, { Task } from '../../../utils/TaskScheduler';\r\nimport { betAreaViewModel, historyViewModel, loseViewModel, winViewModel } from '../viewModel/BandarQiuQiuGameBoardViewModel';\r\nimport { setMyWinLose } from '../store/actions/game';\r\nimport { SKT_MAG_TYPE, sktInstance } from '../socketConnect';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tcountDown:number,\r\n\tusersInfo:MemberInfoVo[],\r\n\tmyInfo:HeadType,\r\n\tmyWinLose:number,\r\n\tgameStatus: GameStatus,\r\n\t// initGameType: GameStatus,\r\n\tminHistory:number[],\r\n}\r\nexport interface IEvent {\r\n\topenHistoryPanel: () => void,\r\n\topenWinPanel:() => void,\r\n\topenLosePanel: () => void,\r\n\tsendGameShowEvent: () => void,\r\n}\r\n\r\n@ccclass('BandarQiuQiu_gameBoard')\r\nexport class BandarQiuQiu_gameBoard extends BaseComponent<IState, IProps, IEvent> {\r\n\tprivate taskScheduler=new TaskScheduler()\r\n\tpublic isShowGame:boolean=true;\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_history: new Node(),\r\n\t\tprops_mim_history: new Node(),\r\n\t\tprops_history_icon:new Node(),\r\n\t\tprops_history_icon_new:new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tcountDown: 0,\r\n\t\tusersInfo: null,\r\n\t\t// initGameType: null,\r\n\t\tgameStatus:null,\r\n\t\tmyInfo: null,\r\n\t\tmyWinLose: null,\r\n\t\tminHistory: null,\r\n\t\t\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\topenHistoryPanel: () => { },\r\n\t\topenWinPanel: () => { },\r\n\t\topenLosePanel: () => { },\r\n\t\tsendGameShowEvent: () => { },\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t\tgame.on(Game.EVENT_HIDE,()=>{//游戏切入后台\r\n\t\t\tthis.isShowGame=false\r\n\t\t})\r\n\t\tgame.on(Game.EVENT_SHOW,()=>{//游戏进入\r\n\t\t\t  this.isShowGame = true;\r\n\t\t\t  if (!mainGameViewModel.isUnMount) {\r\n\t\t\t\t  if (this.node) {\r\n\t\t\t\t\t  this.events.sendGameShowEvent();\r\n\t\t\t\t  }\r\n\t\t\t  }\r\n\t\t\t  \r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_history.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tplayBtnClick();\r\n\t\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.HISTORY,gameCacheData.roomId)\r\n\t\t    this.events.openHistoryPanel()\r\n\t    })\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"myWinLose\") {\r\n\t\t\tif (value.cur === 0) { return }\r\n\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\twindow.setTimeout(()=>{\r\n\t\t\t\t\tif (value.cur === 1) {\r\n\t\t\t\t\t\tplayMyWin();\r\n\t\t\t\t\t\tthis.events.openWinPanel();\r\n\t\t\t\t\t\tlet myInfo = this.props.myInfo;\r\n\t\t\t\t\t\twinViewModel.comp.updateWinsAndLosses(myInfo);\r\n\t\t\t\t\t\t// console.log(\"this.props.myInfo\",this.props.myInfo);\r\n\t\t\t\t\t\tthis.closePopup()\r\n\t\t\t\t\t} else if (value.cur === 2) {\r\n\t\t\t\t\t\tplayMyLose();\r\n\t\t\t\t\t\tthis.events.openLosePanel();\r\n\t\t\t\t\t\tlet myInfo = this.props.myInfo;\r\n\t\t\t\t\t\tloseViewModel.comp.updateWinsAndLosses(myInfo);\r\n\t\t\t\t\t\t// console.log(\"this.props.myInfo\",this.props.myInfo);\r\n\t\t\t\t\t\tthis.closePopup()\r\n\t\t\t\t\t}\r\n\t\t\t\t},4000)\r\n\t\t\t\twindow.setTimeout(() => done(), 1000);\r\n\t\t\t}), false).joinqQueue(new Task((done) => {\r\n\t\t\t\tthis.dispatch(setMyWinLose(0));\r\n\t\t\t\twindow.setTimeout(() => done(), 1000);\r\n\t\t\t}),false)\r\n\t\t\t\t\r\n\t\t}\r\n\t\tif (key === \"minHistory\") {\r\n\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif (historyViewModel && !historyViewModel.isUnMount) {\r\n\t\t\t\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.HISTORY,gameCacheData.roomId)\r\n\t\t\t\t}\r\n\t\t\t\tthis.createMinHistory(value.cur)\r\n\t\t\t}, 4000);\r\n\r\n\t\t}\r\n       \r\n\t}\r\n\r\n\t/**更新小面板历史记录 */\r\n\tpublic createMinHistory(minHistory) {\r\n\t\tif (mainGameViewModel.isUnMount ) { return };\r\n        if(!this.propertyNode){ return }\r\n\t\tthis.propertyNode.props_mim_history.removeAllChildren();\r\n\r\n\t\tminHistory.forEach((m, i) => {\r\n\t\t\tlet minHItem = instantiate(this.propertyNode.props_history_icon);\r\n\t\t\tminHItem.getComponent(Sprite).spriteFrame = this.getSpriteFrame(m);\r\n\t\t\t\r\n\t\t\tthis.propertyNode.props_mim_history.addChild(minHItem);\r\n\t\t\tif (i === minHistory.length - 1) {\r\n\t\t\t\tlet newX = -237.5 + (minHistory.length * 24.5);\r\n\t\t\t\tthis.propertyNode.props_history_icon_new.setPosition(newX, this.propertyNode.props_history_icon_new.position.y)\r\n\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/**清除缓存数据 */\r\n\tprivate clearTheCacheData() {\r\n\t\t\r\n\t}\r\n\r\n\t /**自动关闭输赢结算弹窗*/\r\n\t protected closePopup(){\r\n\t\t if (!mainGameViewModel.isUnMount) {\r\n\t\t  //五秒后自动关闭结算弹框\r\n\t\t  // let time:number=this.initSeconds*1000\r\n\t\t\tlet time: number = 3 * 1000;\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t// this.init()\r\n\t\t\t\tif (winViewModel != undefined) {\r\n\t\t\t\t\tif (!winViewModel.isUnMount) {\r\n\t\t\t\t\t\twinViewModel.unMount();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (loseViewModel != undefined) {\r\n\t\t\t\t\tif (!loseViewModel.isUnMount) {\r\n\t\t\t\t\t\tloseViewModel.unMount();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, time);\r\n\t\t\tbetAreaViewModel.comp.clearAllBetAreaGold();\r\n\t\t}                \r\n\t}  \r\n\t\r\n\t/**\r\n\t * 初始化上榜用户的数据\r\n\t */\r\n\tpublic initUsers(usersInfo:MemberInfoVo[]){\r\n\t\tusersInfo.forEach((item,i)=>{\r\n\t\t\titem.index=i\r\n\t\t})\r\n\t\r\n\t}\r\n\r\n\tprotected destroyCallBack(): void {\r\n\t\tthis.taskScheduler.destoryQueue();\r\n\t}\r\n\r\n\tprivate getSpriteFrame(result:number): SpriteFrame {\r\n\t\tlet fileName = '';\r\n\t\tif (result === 1) {\r\n\t\t\tfileName = SpriteFramePathDefine.BANDARQIUQIU_MIN_HISTORY_BLUE_WIN;\r\n\t\t} else if (result === 2) {\r\n\t\t\tfileName = SpriteFramePathDefine.BANDARQIUQIU_MIN_HISTORY_RED_WIN;\r\n\t\t} else if (result === 3) {\r\n\t\t\tfileName = SpriteFramePathDefine.BANDARQIUQIU_MIN_HISTORY_LV_WIN;\r\n\t\t} \r\n\t\treturn sourceManageSelector().getFile(fileName).source;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}