{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/domino/components/Domino_Mine.ts"],"names":["_decorator","Label","Node","Sprite","tween","UITransform","Vec3","BaseComponent","playChooseCard","playGuoPai","playTimeout","sourceManageSeletor","PrefabPathDefine","DeskStatus","PlayerSatus","CardViewModel","setDeskCardOutline","global","ccclass","property","Domino_Mine","handCardViewModelList","dealIndex","notOutCarTime","propertyNode","props_btn_head","props_label_mine_name","props_label_mine_gold","props_spr_banker","props_btn_head_circle","props_spr_cek","props_label_countDown_time","props_Layout_cards_handCards","props_spr_ready","props_Layout_cards_misNum","props_win_label","props_loss_label","props","deskStatus","outCardItem","leftOutCardItem","rightOutCardItem","newCardItem","currActiveSeatIndex","outCountdown","uid","head","nickName","glodAmount","state","WAITING","isMaster","remainCardCount","cardIList","noWayCardNumber","isActive","winloss","events","onReady","onOutCard","value","azimuth","start","initState","bindEvent","on","EventType","TOUCH_END","useProps","key","string","formatAmountWithLetter","active","loadHeadSprite","cur","seatIndex","isReconnect","filter","v","comp","getValue","updateCardState","console","log","window","clearTimeout","countdown","clearData","updateWinloss","updateMissNumber","node","isValid","time","bindUI","removeAllChildren","forEach","unMount","getSiblingIndex","cardItem","i","length","element","downFace","viewNode","j","elementJ","upFace","reconnectDeal","deal","done","isAnime","genCardView","siblingIndex","cardViewModel","setSiblingIndex","setComplateCallback","position","getComponent","convertToWorldSpaceAR","getPosition","y","getOriginalHeight","convertToNodeSpaceAR","mountView","getFile","CARD","source","setInitHide","appendTo","setProps","index","isHand","isShow","connect","push","sort","s1","s2","r","clearLangPressStatus","isBright","isDisable","dispatch","undefined","isChecked","setCheckedAnime","isCanOutCard","dragEnd","out","outLength","setBright","isCanOut","find","setTimeout","values","children","name","labelNode","initPos","x","to","call","setPosition","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Label, Node, Sprite, tween, UITransform, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { playChooseCard, playGuoPai, playTimeout, roomChooseViewModel, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { CardItem, CardPosition, Countdown, DeskStatus, genCardItem, Player, PlayerSatus } from \"../type\";\r\nimport CardViewModel from '../viewModel/CardViewModel';\r\nimport { setDeskCardOutline } from '../store/action/game';\r\nimport { global } from '../../../hall';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n}\r\n\r\nexport interface IProps {\r\n\tdeskStatus: DeskStatus,\r\n\t/**所有出牌数据 */\r\n\toutCardItem: CardItem[],\r\n\t/**左边出牌 */\r\n\tleftOutCardItem: CardItem[],\r\n\t/**右边出牌 */\r\n\trightOutCardItem: CardItem[],\r\n\t/**最新出牌 */\r\n\tnewCardItem: CardItem,\r\n\t/**当前正激活等待的用户 */\r\n\tcurrActiveSeatIndex: number,\r\n\t/**出牌倒计时 */\r\n\toutCountdown: Countdown,\r\n\tuid: string,\r\n\t/**头像序号 */\r\n\thead: number,\r\n\tnickName: string,\r\n\tglodAmount: number,\r\n\t/**状态 */\r\n\tstate: PlayerSatus,\r\n\t/**是否是庄家 */\r\n\tisMaster: boolean,\r\n\t/**剩余牌数量 */\r\n\tremainCardCount: number,\r\n\t/**手牌组，正常情况下，只有玩家自身才有 */\r\n\tcardIList: CardItem[],\r\n\t/**跟不上的牌点数 */\r\n\tnoWayCardNumber: number[],\r\n\t/**是否激活 */\r\n\tisActive: boolean,\r\n\twinloss: number,\r\n}\r\nexport interface IEvent {\r\n\tonReady: () => void,\r\n\t/**\r\n\t * 出牌方法\r\n\t * @param value 出牌值，对应服务器的value\r\n\t * @param azimuth 0：左， 1：右\r\n\t * @returns \r\n\t */\r\n\tonOutCard: (value: number, azimuth: 0 | 1) => void,\r\n}\r\n\r\n@ccclass('Domino_Mine')\r\nexport class Domino_Mine extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\tprivate handCardViewModelList: CardViewModel[] = []\r\n\tprivate dealIndex = 0;\r\n\tprivate notOutCarTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\t/**头像图片 */\r\n\t\tprops_btn_head: new Sprite(),\r\n\t\t/**玩家昵称 */\r\n\t\tprops_label_mine_name: new Label(),\r\n\t\t/**玩家金币 */\r\n\t\tprops_label_mine_gold: new Label(),\r\n\t\t/**庄家标识 */\r\n\t\tprops_spr_banker: new Node(),\r\n\t\t/**头像外圈 */\r\n\t\tprops_btn_head_circle: new Node(),\r\n\t\t/**pass标识 */\r\n\t\tprops_spr_cek: new Node(),\r\n\t\t/**倒计时 */\r\n\t\tprops_label_countDown_time: new Label(),\r\n\t\t/**手牌节点 */\r\n\t\tprops_Layout_cards_handCards: new Node(),\r\n\t\t/**准备 */\r\n\t\tprops_spr_ready: new Node(),\r\n\t\tprops_Layout_cards_misNum: new Node(),\r\n\t\tprops_win_label: new Label(),\r\n\t\tprops_loss_label: new Label(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tdeskStatus: null,\r\n\t\toutCardItem: [],\r\n\t\tleftOutCardItem: [],\r\n\t\trightOutCardItem: [],\r\n\t\tnewCardItem: null,\r\n\t\tcurrActiveSeatIndex: -1,\r\n\t\toutCountdown: null,\r\n\t\tuid: '',\r\n\t\thead: -1,\r\n\t\tnickName: '',\r\n\t\tglodAmount: -1,\r\n\t\tstate: PlayerSatus.WAITING,\r\n\t\tisMaster: false,\r\n\t\tremainCardCount: -1,\r\n\r\n\t\tcardIList: [],\r\n\t\tnoWayCardNumber: [],\r\n\t\tisActive: false,\r\n\t\twinloss: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonReady: () => { },\r\n\t\tonOutCard: (value: number, azimuth: 0 | 1) => { },\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_spr_ready.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onReady();\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tkey === \"nickName\" && (this.propertyNode.props_label_mine_name.string = this.props.nickName)\r\n\t\tkey === \"glodAmount\" && (this.propertyNode.props_label_mine_gold.string = this.props.glodAmount.formatAmountWithLetter())\r\n\t\tkey === \"isMaster\" && (this.propertyNode.props_spr_banker.active = this.props.isMaster)\r\n\t\tkey === \"head\" && (global.loadHeadSprite(this.props.head, this.propertyNode.props_btn_head))\r\n\t\tif (key === \"state\") {\r\n\t\t\tthis.propertyNode.props_spr_ready.active = this.props.state === PlayerSatus.WAITING\r\n\t\t\t// if (this.props.state === PlayerSatus.WAITING) {\r\n\t\t\t// \tthis.clearData();\r\n\t\t\t// } else if (this.props.state === PlayerSatus.READY) {\r\n\t\t\t// \tthis.clearData();\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tif (key === 'newCardItem' && value.cur && value.cur.seatIndex === 0 && !value.cur.isReconnect) {\r\n\t\t\tthis.handCardViewModelList && (this.handCardViewModelList = this.handCardViewModelList.filter(v => v.comp && v.getValue() !== value.cur.value));\r\n\t\t\tthis.updateCardState(false);\r\n\t\t} else if (key === 'currActiveSeatIndex') {\r\n\t\t\tconsole.log('当前操作的用户 ====================', value.cur)\r\n\t\t\tthis.notOutCarTime && window.clearTimeout(this.notOutCarTime);\r\n\t\t\tthis.updateCardState(value.cur === 0);\r\n\t\t} else if (key === 'outCountdown' && value.cur && value.cur.seatIndex === 0) {\r\n\t\t\tthis.countdown(value.cur);\r\n\t\t} else if (key === 'deskStatus') {\r\n\t\t\tif (this.props.deskStatus === DeskStatus.WAITING) {\r\n\t\t\t\tthis.clearData();\r\n\t\t\t}\r\n\t\t} else if (key === 'winloss') {\r\n\t\t\tthis.updateWinloss(value.cur);\r\n\t\t} else if (key === 'noWayCardNumber') {\r\n\t\t\tthis.updateMissNumber(value.cur);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate countdown(outCountdown: Countdown) {\r\n\t\tif (!this.node || !this.node.isValid) return;\r\n\t\toutCountdown.time === 3 && playTimeout();\r\n\t\tthis.propertyNode.props_label_countDown_time.node.active = outCountdown.time > 0;\r\n\t\tthis.propertyNode.props_label_countDown_time.string = outCountdown.time + \"\";\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_label_countDown_time.node.active = false;\r\n\t\tthis.propertyNode.props_spr_banker.active = false;\r\n\t\tthis.propertyNode.props_win_label.node.active = false;\r\n\t\tthis.propertyNode.props_loss_label.node.active = false;\r\n\t\tthis.updateMissNumber();\r\n\t}\r\n\r\n\tpublic clearData() {\r\n\t\tthis.dealIndex = 0;\r\n\t\tthis.propertyNode.props_Layout_cards_handCards.removeAllChildren();\r\n\t\tthis.handCardViewModelList.forEach(v => v.unMount());\r\n\t\tthis.handCardViewModelList = [];\r\n\t}\r\n\r\n\tprivate getSiblingIndex(cardItem: CardItem) {\r\n\t\tfor (let i = this.handCardViewModelList.length - 1; i >= 0; i--) {\r\n\t\t\tconst element = this.handCardViewModelList[i];\r\n\t\t\tif (cardItem.downFace > element.comp.props.downFace) {\r\n\t\t\t\treturn element.viewNode.getSiblingIndex() + 1;\r\n\t\t\t} else if (cardItem.downFace === element.comp.props.downFace) {\r\n\t\t\t\tfor (let j = i; j >= 0; j--) {\r\n\t\t\t\t\tconst elementJ = this.handCardViewModelList[j];\r\n\t\t\t\t\tif (cardItem.upFace > element.comp.props.upFace) {\r\n\t\t\t\t\t\treturn elementJ.viewNode.getSiblingIndex() + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn element.viewNode.getSiblingIndex();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tpublic reconnectDeal() {\r\n\t\tthis.props.cardIList.forEach(v => {\r\n\t\t\tthis.deal(() => { }, false);\r\n\t\t})\r\n\t\tthis.dealIndex = 0;\r\n\t}\r\n\r\n\t/**发牌 */\r\n\tpublic deal(done: (position: Vec3) => void, isAnime: boolean = true) {\r\n\t\tthis.dealIndex === 0 && this.clearData();\r\n\t\tconst cardItem = this.props.cardIList[this.dealIndex++];\r\n\t\tthis.dealIndex >= 7 && (this.dealIndex = 0);\r\n\t\tthis.genCardView(cardItem, done, isAnime);\r\n\t}\r\n\r\n\t/**构建牌 */\r\n\tprivate genCardView(cardItem: CardItem, done: (position: Vec3) => void, isAnime: boolean = true) {\r\n\t\tif (!cardItem) return;\r\n\t\tconst siblingIndex = this.getSiblingIndex(cardItem);\r\n\t\tconst cardViewModel = new CardViewModel().setSiblingIndex(siblingIndex)\r\n\t\t// 添加牌成功之后回调方法，目的是拿到最新的坐标\r\n\t\tcardViewModel.setComplateCallback(() => {\r\n\t\t\tconst position = this.propertyNode.props_Layout_cards_handCards.getComponent(UITransform).convertToWorldSpaceAR(cardViewModel.comp.node.getPosition());\r\n\t\t\tposition.y += cardViewModel.getOriginalHeight();\r\n\t\t\tdone(this.node.getComponent(UITransform).convertToNodeSpaceAR(position));\r\n\t\t});\r\n\r\n\t\tcardViewModel.mountView(sourceManageSeletor().getFile(PrefabPathDefine.CARD).source)\r\n\t\t\t.setInitHide(isAnime)\r\n\t\t\t.appendTo(this.propertyNode.props_Layout_cards_handCards)\r\n\t\t\t.setProps({\r\n\t\t\t\tindex: siblingIndex,\r\n\t\t\t\tupFace: cardItem.upFace,\r\n\t\t\t\tdownFace: cardItem.downFace,\r\n\t\t\t\tposition: cardItem.position,\r\n\t\t\t\tisAnime: isAnime,\r\n\t\t\t\tisHand: true,\r\n\t\t\t\tisShow: true,\r\n\t\t\t\tvalue: cardItem.value\r\n\t\t\t}).connect();\r\n\t\tthis.handCardViewModelList.push(cardViewModel);\r\n\t\tthis.handCardViewModelList.sort((s1, s2) => {\r\n\t\t\tconst r = s1.comp.props.downFace - s2.comp.props.downFace;\r\n\t\t\treturn r === 0 ? s1.comp.props.upFace - s2.comp.props.upFace : r;\r\n\t\t})\r\n\r\n\t\tcardViewModel.comp.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tcardViewModel.comp.clearLangPressStatus();\r\n\t\t\t// 没有高亮不能选择\r\n\t\t\tif (!cardViewModel.isBright() || cardViewModel.comp.props.isDisable) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.dispatch(setDeskCardOutline(undefined));\r\n\t\t\tthis.handCardViewModelList.filter(v => v !== cardViewModel).forEach(v => v.setProps({ isChecked: false }));\r\n\r\n\t\t\tcardViewModel.comp.setCheckedAnime(true);\r\n\t\t\t// 出牌了\r\n\t\t\tif (cardViewModel.isChecked()) {\r\n\t\t\t\t// 拖动之后可以出牌了，这里就调用出牌方法了\r\n\t\t\t\tif (!cardViewModel.comp.isCanOutCard()) {\r\n\t\t\t\t\tthis.events.onOutCard(cardViewModel.getValue(), 1);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tplayChooseCard();\r\n\t\t\t\tcardViewModel.setProps({ isChecked: !cardViewModel.isChecked() })\r\n\t\t\t}\r\n\t\t\tcardViewModel.comp.dragEnd();\r\n\t\t})\r\n\t}\r\n\r\n\t/**更新可操作的牌 */\r\n\tprivate updateCardState(out: boolean) {\r\n\t\tconst outLength = this.props.outCardItem.length;\r\n\t\tif (out && outLength === 0) {\r\n\t\t\tthis.handCardViewModelList.forEach(v => v.comp.setProps({ isBright: true }));\r\n\t\t} else {\r\n\t\t\tlet newCardItem;\r\n\t\t\tif (out) {\r\n\t\t\t\tnewCardItem = this.props.leftOutCardItem.length === 0 ? this.props.outCardItem[0]\r\n\t\t\t\t\t: this.props.leftOutCardItem[this.props.leftOutCardItem.length - 1];\r\n\t\t\t\tthis.handCardViewModelList.forEach(v => v.setBright(newCardItem, 0));\r\n\r\n\t\t\t\tnewCardItem = this.props.rightOutCardItem.length === 0 ? this.props.outCardItem[0]\r\n\t\t\t\t\t: this.props.rightOutCardItem[this.props.rightOutCardItem.length - 1];\r\n\t\t\t\tthis.handCardViewModelList.forEach(v => v.setBright(newCardItem, 1));\r\n\r\n\t\t\t\tconst isCanOut = this.handCardViewModelList.find(v => v.isBright());\r\n\t\t\t\tif (!isCanOut) {\r\n\t\t\t\t\tplayGuoPai();\r\n\t\t\t\t\t// 不能出牌时，延迟2秒发送出牌消息\r\n\t\t\t\t\t// console.log(\"不能出牌时，延迟2秒发送出牌消息\");\r\n\t\t\t\t\tthis.notOutCarTime = window.setTimeout(() => {\r\n\t\t\t\t\t\tthis.events.onOutCard(-1, undefined);\r\n\t\t\t\t\t}, 2000)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.handCardViewModelList.forEach(v => v.setBright(undefined, 0));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**更新缺点 */\r\n\tprivate updateMissNumber(values: number[] = []) {\r\n\t\tthis.propertyNode.props_Layout_cards_misNum.active = false;\r\n\t\tthis.propertyNode.props_Layout_cards_misNum.children.forEach(node => {\r\n\t\t\tconst value = values.find(value => node.name === 'props_spr_cards_misNum-00' + value);\r\n\t\t\tif (value >= 0) {\r\n\t\t\t\tnode.active = true;\r\n\t\t\t\tthis.propertyNode.props_Layout_cards_misNum.active = true;\r\n\t\t\t} else {\r\n\t\t\t\tnode.active = false;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprivate updateWinloss(value: number) {\r\n\t\tif (value === 0) return;\r\n\t\tthis.propertyNode.props_win_label.node.active = value > 0;\r\n\t\tthis.propertyNode.props_loss_label.node.active = !this.propertyNode.props_win_label.node.active;\r\n\t\tlet labelNode: Node;\r\n\t\tif (value > 0) {\r\n\t\t\tthis.propertyNode.props_win_label.string = '+' + value.formatAmountWithLetter();\r\n\t\t\tlabelNode = this.propertyNode.props_win_label.node;\r\n\t\t} else {\r\n\t\t\tthis.propertyNode.props_loss_label.string = value.formatAmountWithLetter();\r\n\t\t\tlabelNode = this.propertyNode.props_loss_label.node;\r\n\t\t}\r\n\t\tconst initPos = new Vec3(labelNode.position.x, labelNode.position.y);\r\n\t\ttween(labelNode).to(1, { position: new Vec3(initPos.x, initPos.y + 50) }).call(() => {\r\n\t\t\tif (labelNode.isValid) {\r\n\t\t\t\tlabelNode.setPosition(initPos);\r\n\t\t\t\tlabelNode.active = false;\r\n\t\t\t}\r\n\t\t}).start();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}