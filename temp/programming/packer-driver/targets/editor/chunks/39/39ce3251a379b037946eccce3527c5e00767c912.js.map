{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/login_v2/Hall_LoginDialogV2.ts"],"names":["_decorator","Button","EditBox","Node","Prefab","sys","BaseComponent","InputValidator","global","hallAudio","lang","sourceManageSeletor","SoundPathDefine","config","RegV2ViewModel","PrefabPathDefine","CaptchaGenerator","addToastAction","EffectType","ccclass","property","LoginType","Hall_LoginDialogV2","captchaGenerator","propertyNode","props_closeBtu","props_input_akun","props_input_sandi","props_btn_login_forget","props_input_kode","props_spr_kode","props_btn_daftarAkun","props_btn_login","events","closeHandler","loginHandler","loginName","password","done","loginDoneHandler","sendSmsHandler","phoneNumber","errorHandler","errorInfo","props","start","initState","bindEvent","on","EventType","TOUCH_END","node","reg","login","openURL","customerOutUrl","generate","useProps","key","value","bindUI","localStorage","getItem","string","begin","isIDAPhoneNumber","isEmtry","write","k","HallModule","passwordEmptyError","placeStr","isChartLength","valodateCode","trim","length","hallDispatch","content","captchaEmptyError","toLocaleLowerCase","captcha","captchaError","success","mountView","getFileAsync","_LOGIN_DIALOG_REG_V2","source","appendTo","parent","effectType","EFFECT2","setEvent","regDoneHandler","callback","event","customEventData","playOneShot","BTU_CLICK","target","setState","showLoginType","PHONE","PASSWORD","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Color, Component, EditBox, EventHandler, instantiate, Label, Node, Prefab, ScrollView, sys, Toggle, ToggleContainer } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport InputValidator from '../../../utils/InputValidator';\r\nimport { fetcher, global, hallAudio, lang, sourceManageSeletor } from '../../index';\r\nimport { SoundPathDefine } from '../../sourceDefine/soundDefine';\r\nimport { config } from '../../config';\r\nimport RegV2ViewModel from '../../viewModel/login_v2/RegV2ViewModel';\r\nimport { PrefabPathDefine } from '../../sourceDefine/prefabDefine';\r\nimport CaptchaGenerator from '../../../utils/CaptchaGenerator';\r\nimport { addToastAction } from '../../store/actions/baseBoard';\r\nimport { EffectType } from '../../../utils/NodeIOEffect';\r\nimport ModalBox from '../../../common/ModalBox';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum LoginType {\r\n\tPHONE = 1,\r\n\tPASSWORD = 4\r\n}\r\n\r\nexport interface IState {\r\n}\r\n\r\nexport interface IProps {\r\n\r\n}\r\n\r\nexport interface IEvent {\r\n\t/**关闭窗口回调 */\r\n\tcloseHandler?: () => void\r\n\t/**登录 */\r\n\tloginHandler?: (loginName: string, password: string, done: (success: boolean) => void) => void,\r\n\t/**登录成功的回调 */\r\n\tloginDoneHandler: () => void,\r\n\t/**发送验证码 */\r\n\tsendSmsHandler?: (phoneNumber: string) => void\r\n\t/**错误输入回调 */\r\n\terrorHandler: (errorInfo: string) => void\r\n}\r\n\r\n@ccclass('Hall_LoginDialogV2')\r\nexport class Hall_LoginDialogV2 extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate captchaGenerator: CaptchaGenerator\r\n\tprotected propertyNode = {\r\n\t\t/**关闭节点 */\r\n\t\tprops_closeBtu: new Node(),\r\n\t\t/**登录账户 */\r\n\t\tprops_input_akun: new EditBox(),\r\n\t\t/**登录密码 */\r\n\t\tprops_input_sandi: new EditBox(),\r\n\t\t/**忘记密码按钮 */\r\n\t\tprops_btn_login_forget: new Button(),\r\n\t\t/**验证码 */\r\n\t\tprops_input_kode: new EditBox(),\r\n\t\t/**验证码获取按钮 */\r\n\t\tprops_spr_kode: new Node(),\r\n\t\t/**注册 */\r\n\t\tprops_btn_daftarAkun: new Button(),\r\n\t\t/**登录 */\r\n\t\tprops_btn_login: new Button()\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tcloseHandler: () => { },\r\n\t\tloginHandler: (loginName: string, password: string, done: (success: boolean) => void) => { },\r\n\t\tloginDoneHandler: () => { },\r\n\t\tsendSmsHandler: (phoneNumber: string) => { },\r\n\t\terrorHandler: (errorInfo: string) => { }\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\r\n\t}\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_closeBtu.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.closeHandler()\r\n\t\t})\r\n\t\t/**注册 */\r\n\t\tthis.propertyNode.props_btn_daftarAkun.node.on(Node.EventType.TOUCH_END, () => this.reg())\r\n\t\t/**登录 */\r\n\t\tthis.propertyNode.props_btn_login.node.on(Node.EventType.TOUCH_END, () => this.login())\r\n\t\t/**忘记密码 */\r\n\t\tthis.propertyNode.props_btn_login_forget.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tsys.openURL(config.customerOutUrl)\r\n\t\t\t// ModalBox.Instance().show({ url: config.customerOutUrl })\r\n\t\t})\r\n\t\t/**切换验证码 */\r\n\t\tthis.propertyNode.props_spr_kode.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.captchaGenerator.generate()\r\n\t\t})\r\n\t}\r\n\r\n\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: Partial<IState>, cur: Partial<IState> }) {\r\n\t\t/**传入的props变更触发的函数 */\r\n\t\t// console.log(key, \"change\", value.cur)\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.captchaGenerator = new CaptchaGenerator(this.propertyNode.props_spr_kode, 4)\r\n\t\tif (sys.localStorage.getItem('loginName')) {\r\n\t\t\tthis.propertyNode.props_input_akun.string = sys.localStorage.getItem('loginName')\r\n\t\t}\r\n\t}\r\n\t/**确认登录 */\r\n\tprivate login() {\r\n\t\tconst loginName = this.propertyNode.props_input_akun.string\r\n\t\tconst password = this.propertyNode.props_input_sandi.string;\r\n\t\t(new InputValidator()).begin().isIDAPhoneNumber(loginName)\r\n\t\t\t.isEmtry(password, lang.write(k => k.HallModule.passwordEmptyError, {}, { placeStr: \"请输入密码\" }))\r\n\t\t\t.isChartLength([6, 30], password).done(() => {\r\n\t\t\t\t/**验证码 */\r\n\t\t\t\tconst valodateCode = this.propertyNode.props_input_kode.string\r\n\t\t\t\tif (valodateCode.trim().length === 0) {\r\n\t\t\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.captchaEmptyError, {}, { placeStr: \"请输入验证码\" }) }))\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (valodateCode.toLocaleLowerCase() !== this.captchaGenerator.captcha.toLocaleLowerCase()) {\r\n\t\t\t\t\tthis.captchaGenerator.generate()\r\n\t\t\t\t\tthis.propertyNode.props_input_kode.string = '';\r\n\t\t\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.captchaError, {}, { placeStr: \"验证码错误\" }) }))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.events.loginHandler(loginName, password, (success: boolean) => {\r\n\t\t\t\t\t\t!success && this.captchaGenerator.generate();\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t}\r\n\r\n\tprivate async reg() {\r\n\t\tnew RegV2ViewModel().mountView((await sourceManageSeletor().getFileAsync(PrefabPathDefine._LOGIN_DIALOG_REG_V2, Prefab)).source).appendTo(this.node.parent, {\r\n\t\t\teffectType: EffectType.EFFECT2\r\n\t\t}).setEvent({\r\n\t\t\tregDoneHandler: () => {\r\n\t\t\t\tthis.events.loginDoneHandler()\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tcallback(event: Event, customEventData: string) {\r\n\t\thallAudio.playOneShot(SoundPathDefine.BTU_CLICK)\r\n\t\tswitch (event.target[\"name\"]) {\r\n\t\t\tcase \"Toggle_phone\":\r\n\t\t\t\t//显示手机登录\r\n\t\t\t\tthis.setState({ showLoginType: LoginType.PHONE })\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"Toggle_password\":\r\n\t\t\t\t//显示密码登录\r\n\t\t\t\tthis.setState({ showLoginType: LoginType.PASSWORD })\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}