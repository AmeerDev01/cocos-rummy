{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/BatteryHitScore.ts"],"names":["BatteryHitScore","Label","Node","UIOpacity","Vec3","tween","createFont","llcompare","toNodeSpaceAR","constructor","sourceManage","parentNode","config","id","rootNode","uiRoot","label","opacity","bused_state","addChild","addComponent","init","string","font","src","active","setPosition","show","pos","rot","score","call","setWorldPosition","x","y","angle","strScore","delay","isValid","by","worldPosition","to","start","getUseState","getId","destory","destroy"],"mappings":"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","sourcesContent":["import { Label, Node, UIOpacity, Vec3, tween } from \"cc\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport { createFont, llcompare, toNodeSpaceAR } from \"./FishTool\";\r\n\r\n/**\r\n  提示分数字体显示\r\n */\r\nexport class BatteryHitScore {\r\n  private sourceManage: SourceManage;\r\n  public uiRoot: Node;\r\n  private label: Label;\r\n  private opacity: UIOpacity;\r\n  private bused_state: boolean;\r\n  private id: number;\r\n  private rootNode: Node;\r\n\r\n  constructor(sourceManage: SourceManage, parentNode: Node, config, id, rootNode: Node) {\r\n    this.sourceManage = sourceManage;\r\n    this.rootNode = rootNode;\r\n    this.uiRoot = new Node();\r\n    parentNode.addChild(this.uiRoot)\r\n    this.opacity = this.uiRoot.addComponent(UIOpacity)\r\n    this.label = this.uiRoot.addComponent(Label);\r\n\r\n    this.init(config, id);\r\n  }\r\n\r\n  public init(config, id) {\r\n    this.label.string = \"0\"\r\n    this.label.font = createFont(this.sourceManage, config.src);\r\n    this.uiRoot.active = (false)\r\n    // this.uiRoot.setWorldPosition(new Vec3(0, 0))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(0, 0)))\r\n    this.bused_state = false\r\n    this.id = id\r\n  }\r\n\r\n  public show(pos: Vec3, rot: number, score: number, call) {\r\n    this.bused_state = true\r\n    this.uiRoot.setWorldPosition(new Vec3(pos.x, pos.y))\r\n    // this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, pos))\r\n    this.uiRoot.angle = rot\r\n    let strScore = `${score}`\r\n    if (llcompare(score, 0) >= 0) {\r\n      strScore = `+${score}`\r\n    }\r\n    this.label.string = (strScore)\r\n\r\n    const y = pos.y > 200 ? -80 : 80;\r\n\r\n    tween(this.uiRoot)\r\n      .delay(2.5)\r\n      .call(() => {\r\n        if (this.uiRoot.isValid) {\r\n          this.uiRoot.active = true\r\n          call && call();\r\n        }\r\n      })\r\n      .by(0.3, { worldPosition: new Vec3(0, y) })\r\n      .delay(0.8).call(() => {\r\n        tween(this.opacity)\r\n          .to(0.3, { opacity: 0 }).call(() => {\r\n            if (this.uiRoot.isValid) {\r\n              this.uiRoot.active = false\r\n              this.uiRoot.setWorldPosition(new Vec3(0, 0))\r\n              // this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(0, 0)))\r\n              this.bused_state = false\r\n              this.opacity.opacity = 255\r\n            }\r\n          }).start();\r\n      })\r\n      .start()\r\n    // this.runAction(cc.sequence({\r\n    //   cc.delayTime(2.5), cc.callFunc(() => {\r\n    //     this.active = (true)\r\n    //     if (call) {\r\n    //       call()\r\n    //     }\r\n    //   }), cc.MoveBy.create(0.3, cc.v2(0, 80)), cc.delayTime(0.8), cc.fadeOut(0.3), cc.callFunc(() => {\r\n    //     this.active = (false)\r\n    //     this.active = (false)\r\n    //     this.setPosition(0, 0)\r\n    //     this.bused_state = false\r\n    //     this.opacity = (255)\r\n    //   })\r\n    // }))\r\n  }\r\n\r\n  public getUseState() {\r\n    return this.bused_state\r\n  }\r\n\r\n  public getId() {\r\n    return this.id\r\n  }\r\n\r\n  public destory() {\r\n    this.uiRoot.destroy();\r\n    this.sourceManage = null;\r\n    this.label = null;\r\n    this.opacity = null;\r\n  }\r\n}\r\n// public create(config, id) {\r\n// \tlet obj = BatteryHitScore.new()\r\n// \tif( obj ){\r\n// \t\tobj.init(config, id)\r\n// \t}\r\n// \treturn obj\r\n// }\r\n\r\n"]}