{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_SubGameGate.ts"],"names":["_decorator","instantiate","Label","Node","ProgressBar","sp","Sprite","SpriteFrame","sys","BaseComponent","subGameList","SubGameRunState","baseBoardView","global","hallAudio","sourceManageSeletor","BundleSplit","addToastAction","SoundPathDefine","lang","DEV","getPackageName","ccclass","property","Hall_SubGameGate","gameGateItemNodeList","loadingStart","propertyNode","props_gameItem_template","props","useVip","gamesIds","activeSubGameInfo","events","onTouchInto","start","initState","bindEvent","useProps","key","value","forEach","gameId","hallGameGate","find","i","gameGateItemNode","node","addChild","active","on","EventType","TOUCH_END","openGateGame","hotMark","getChildByName","downLoadState","getComponent","Skeleton","skeletonData","getFileAsync","length","fileNameLarge","fileNameSmall","SkeletonData","source","animation","spriteFrame","nameSprite","push","vipMark","string","isChoose","target","item","progressBarWrap","setLoadingState","runState","RUN","isH5","window","hallDispatch","content","write","k","PersonCenterModule","PersonCenterSumbit","placeStr","playOneShot","GAME_CLICK","CLOSE","INIT","loadGame","getRemoteBundle","curr","total","then","bundle","undefined","comp","beginInitSubGame","catch","e","dispatch","ERROR","bundleName","progress","isShow","progressRatio","progressBar","set","localStorage","getItem","setItem","loadList","JSON","parse","result","some","md5","stringify","bindUI","useState","pre","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, assert, Button, Component, instantiate, Label, Layout, Node, Prefab, ProgressBar, sp, Sprite, SpriteFrame, sys, UITransform } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { HallGameGateType, subGameList, SubGameRunState } from '../config'\r\nimport { baseBoardView, bundleCommon, global, hallAudio, sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport BundleSplit from '../../utils/BundleSplit';\r\nimport { addToastAction, setLoadingAction, setSubGameInfoAction, setSubGameRunState } from '../store/actions/baseBoard';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { lang } from '../index';\r\nimport { DEV } from 'cc/env';\r\nimport { getPackageName } from '../../common/bridge';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\tisdownLoaded?: boolean\r\n}\r\n\r\nexport interface IProps {\r\n\tuseVip: number,\r\n\tgamesIds?: Array<number>,\r\n\tactiveSubGameInfo?: HallGameGateType\r\n}\r\nexport interface IEvent {\r\n\t/**此图标被点击 */\r\n\tonTouchInto?: (gameInfo: HallGameGateType) => void\r\n}\r\n\r\n@ccclass('Hall_SubGameGate')\r\nexport class Hall_SubGameGate extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate gameGateItemNodeList: { key: number, node: Node }[] = []\r\n\t/**进度条的初始值（用于支持多阶段加载的情况） */\r\n\tprivate loadingStart: number = 0.02\r\n\tprotected propertyNode = {\r\n\t\tprops_gameItem_template: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tuseVip: 0,\r\n\t\tgamesIds: [],\r\n\t\tactiveSubGameInfo: null\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonTouchInto: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: Partial<IState>, cur: Partial<IState> }) {\r\n\t\tif (key === \"gamesIds\") {\r\n\t\t\t// 实例化界面\r\n\t\t\tthis.props.gamesIds.forEach(async gameId => {\r\n\t\t\t\tif (gameId) {\r\n\t\t\t\t\tconst hallGameGate: HallGameGateType = subGameList.find(i => i.gameId === gameId)\r\n\t\t\t\t\tif (!hallGameGate) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 根据\r\n\t\t\t\t\tconst gameGateItemNode: Node = instantiate(this.propertyNode.props_gameItem_template)\r\n\t\t\t\t\tthis.node.addChild(gameGateItemNode)\r\n\t\t\t\t\tgameGateItemNode.active = true\r\n\t\t\t\t\tgameGateItemNode.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t\t\t\tthis.openGateGame(gameId)\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\thallGameGate.hotMark && (gameGateItemNode.getChildByName(\"hot_jiaobiao\").active = true)\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"gameSkeleton\").active = true\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"spr_word\").active = true\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"download_icon\").active = !this.downLoadState(gameId)\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"gameSkeleton\").getComponent(sp.Skeleton).skeletonData = (await sourceManageSeletor()\r\n\t\t\t\t\t\t.getFileAsync(this.props.gamesIds.length === 1 ? hallGameGate.fileNameLarge : hallGameGate.fileNameSmall, sp.SkeletonData)).source\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"gameSkeleton\").getComponent(sp.Skeleton).animation = \"animation\"\r\n\t\t\t\t\tgameGateItemNode.getChildByName(\"spr_word\").getComponent(Sprite).spriteFrame = (await sourceManageSeletor()\r\n\t\t\t\t\t\t.getFileAsync(hallGameGate.nameSprite[this.props.gamesIds.length - 1], SpriteFrame)).source\r\n\t\t\t\t\tthis.gameGateItemNodeList.push({ key: gameId, node: gameGateItemNode })\r\n\t\t\t\t\tif (hallGameGate.vipMark > this.props.useVip) {\r\n\t\t\t\t\t\tgameGateItemNode.getChildByName(\"vipWrap\").active = true\r\n\t\t\t\t\t\tconst node = gameGateItemNode.getChildByName(\"vipWrap\").getChildByName(\"vip_jiaobiao\").getChildByName(\"label_vipLevel\")\r\n\t\t\t\t\t\tnode && (node.getComponent(Label).string = `VIP${hallGameGate.vipMark}`)\r\n\t\t\t\t\t\tgameGateItemNode.getChildByName(\"download_icon\").active = false\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//做个占位\r\n\t\t\t\t\tconst gameGateItemNode: Node = instantiate(this.propertyNode.props_gameItem_template)\r\n\t\t\t\t\tgameGateItemNode.active = true\r\n\t\t\t\t\tthis.node.addChild(gameGateItemNode)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (key === \"activeSubGameInfo\") {\r\n\t\t\t// console.log('activeSubGameInfo', this.props.activeSubGameInfo.runState)\r\n\t\t\tlet isChoose: boolean = false\r\n\t\t\tthis.props.gamesIds.forEach(gameId => {\r\n\t\t\t\tif (gameId && !isChoose) {\r\n\t\t\t\t\t//this.progressBar必须有值，才正确选中了对象，因为gameId是有重复的\r\n\t\t\t\t\tconst target = this.gameGateItemNodeList.find(item => item.key === gameId)\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\tconst progressBarWrap = target.node.getChildByName(\"loadWrap\")\r\n\t\t\t\t\t\tif (this.props.activeSubGameInfo && this.props.activeSubGameInfo.gameId === gameId && progressBarWrap) {\r\n\t\t\t\t\t\t\tisChoose = true\r\n\t\t\t\t\t\t\tthis.setLoadingState(gameId, 0, false)\r\n\t\t\t\t\t\t\tif (this.props.activeSubGameInfo.runState === SubGameRunState.RUN) {\r\n\t\t\t\t\t\t\t\tthis.downLoadState(gameId, true)\r\n\t\t\t\t\t\t\t\ttarget.node.getChildByName(\"download_icon\").active = false\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tpublic openGateGame(gameId: number) {\r\n\t\tconst isH5 = !DEV && getPackageName() === 'web' && window['installBundle']\r\n\t\tif (window['onLoadingBundleName']) {\r\n\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.PersonCenterModule.PersonCenterSumbit, {}, { placeStr: \"请稍后\" }) }))\r\n\t\t\treturn\r\n\t\t}\r\n\t\twindow['onLoadingBundleName'] = gameId\r\n\t\tconst hallGameGate: HallGameGateType = subGameList.find(i => i.gameId === gameId)\r\n\t\thallAudio.playOneShot(SoundPathDefine.GAME_CLICK)\r\n\t\tif (hallGameGate.runState === SubGameRunState.CLOSE) {\r\n\t\t\thallGameGate.runState = SubGameRunState.INIT\r\n\t\t} else {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.setLoadingState(gameId, 0)\r\n\t\tconst loadGame = () => {\r\n\t\t\tBundleSplit.getRemoteBundle(hallGameGate, (curr, total) => {\r\n\t\t\t\t// this.setLoadingState(gameId, 0.2 * curr / total)\r\n\t\t\t}).then((bundle) => {\r\n\t\t\t\twindow['onLoadingBundleName'] = undefined\r\n\t\t\t\tthis.setLoadingState(gameId, this.loadingStart, true, isH5 ? 0.5 : 1)\r\n\t\t\t\tbaseBoardView.comp.beginInitSubGame(hallGameGate)\r\n\t\t\t}).catch(e => {\r\n\t\t\t\twindow['onLoadingBundleName'] = undefined\r\n\t\t\t\tthis.dispatch(addToastAction({ content: e }))\r\n\t\t\t\thallAudio.playOneShot(SoundPathDefine.ERROR)\r\n\t\t\t\tthis.setLoadingState(gameId, 0, false, isH5 ? 0.5 : 1)\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (isH5) {\r\n\t\t\twindow['installBundle'](hallGameGate.bundleName)\r\n\t\t\twindow['onBundleInstallProgress'] = (bundleName: string, progress: number) => {\r\n\t\t\t\tif (progress === 1) {\r\n\t\t\t\t\tloadGame()\r\n\t\t\t\t\tthis.setLoadingState(gameId, 1, true, 0.5)\r\n\t\t\t\t\tthis.loadingStart = 0.5\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setLoadingState(gameId, progress, true, 0.5)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tloadGame()\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 设置加载的进度状态，也可同时控制进度框的显示隐藏\r\n\t * @param gameId 子游戏id\r\n\t * @param progress 进度\r\n\t * @param isShow 是否显示进度框\r\n\t * @param progressRatio 传入进度值的打折量\r\n\t * @returns \r\n\t */\r\n\tpublic setLoadingState(gameId: number, progress: number, isShow: boolean = true, progressRatio: number = 1) {\r\n\t\t// console.log(gameId, progress)\r\n\t\tconst gameGateItemNode = this.gameGateItemNodeList.find(item => item.key === gameId).node\r\n\t\tconst progressBarWrap = gameGateItemNode.getChildByName(\"loadWrap\")\r\n\t\tconst progressBar = progressBarWrap.getChildByName(\"DownloadPb\").getChildByName(\"progressBar\").getComponent(ProgressBar)\r\n\t\tprogressBarWrap.active = isShow\r\n\t\tprogressBar.progress = this.loadingStart + progress * progressRatio\r\n\t\t!isShow && (subGameList.find(i => i.gameId === gameId).runState = SubGameRunState.CLOSE)\r\n\t\treturn progressBarWrap\r\n\t}\r\n\r\n\t/**\r\n\t * 获取是否已经下载\r\n\t * @param gameId 子游戏ID\r\n\t * @param set 获取到没有下载结果时是否要重设\r\n\t * @returns \r\n\t */\r\n\tprivate downLoadState(gameId: number, set: boolean = false) {\r\n\t\t!sys.localStorage.getItem('download') && sys.localStorage.setItem('download', '[]')\r\n\t\tconst loadList: Array<{ gameId: number, md5: string }> = JSON.parse(sys.localStorage.getItem('download'))\r\n\t\tconst hallGameGate: HallGameGateType = subGameList.find(i => i.gameId === gameId)\r\n\t\tconst result = loadList.some(item => item.gameId === gameId && item.md5 === hallGameGate.md5)\r\n\t\tif (!result && set) {\r\n\t\t\tconst target = loadList.find(item => item.gameId === gameId)\r\n\t\t\ttarget ? (target.md5 = hallGameGate.md5) : loadList.push({ gameId, md5: hallGameGate.md5 })\r\n\t\t\tsys.localStorage.setItem('download', JSON.stringify(loadList))\r\n\t\t}\r\n\t\treturn result\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_gameItem_template.active = false\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tif (value.pre === true) {\r\n\r\n\t\t\t}\r\n\t\t}, [\"isdownLoaded\"])\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}