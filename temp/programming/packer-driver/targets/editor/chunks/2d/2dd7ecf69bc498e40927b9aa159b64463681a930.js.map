{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealthV2/viewModel/GodWealthV2MainViewModel.ts"],"names":["godWealthV2_Audio","sourceManageSeletor","ViewModel","StoreInject","ModalBox","global","lang","addToastAction","config","cacheData","clearCacheData","SKT_MAG_TYPE","sktInstance","sktMsgListener","bundlePkgName","PrefabPathDefine","getStore","changeGame","resetStore","setAutoLauncherInfo","updateGold","updateJackpotAmount","updateJackpotDatas","updatePositionId","updateWinloss","initRoller","updateRollerStatus","AutoLauncherType","GameType","RollerStatus","calBetAmount","isAuto","isSubGameToSubGame","verifyBetResultData","GodWealthV2DialogWinViewModel","GodWealthV2FooterViewModel","GodWealthV2HeaderViewModel","GodWealthV2RollerPanelViewModel","BaseViewModel","EffectType","UseSetOption","SoundPathDefine","GodWealthV2MainViewModel","constructor","initCallback","gameTypeInfo","headerViewModel","footerViewModel","rollerPanelViewModel","helpPanelPanel","isAuthDone","isBetResult","goodLuckPos","startBtnV","betCallbackFun","begin","mountViewNode","comp","getHeader","connect","setEvent","quitGame","onQuitGame","getFooter","getRoller","onSendBet","sendBet","openHelpPanel","openRule","Instance","option","gameSet","godWealthV2","betTarget","dispatch","add","AUTH","data","error","closeSubGame","confirmContent","write","k","InitGameModule","FetcherFaild","gameType","SUBGAME2","fixedChessboardIcon","authData","bl","lastGameType","viewGameType","currGameType","leftCount","freeGameCount","freeGameAmount","playBgMusic","SUBGAME1","initSlot","scheduleOnce","viewNode","isValid","props","autoLauncherInfo","sendSktMessage","token","localStorage","getItem","gameId","LAUNCH","unschedule","undefined","result","playOneShot","DING","content","show","type","rollerLaunchResult","si","dl","rollerId","i","length","console","log","localLeftCount","freeCount","nextLeftCount","isDelay","NONE","REFRESHCOINS","JACKPOT","JACKPOT_TOTAL","mountView","getFile","RULE","source","appendTo","effectType","EFFECT1","isModal","closeHandler","unMount","betAmount","positionId","MAIN","gold","hallDispatch","palyingModule","RechangeGlod","placeStr","autoLauncherType","totalCount","RUNNING","betListenerTimeHandle","bind","schedule","tableId","WebSocketModule","WebSocketError","unMountCallBack","removeById","showDialogWin","dialogInfo","done","godWealthV2DialogWinViewModel","DIALOG_WIN","setProps","onWindowCloseHandler","getGoodLuckPos","getStartBtnPos","setGoodLuckPos","pos","setStartBtnPos","stop","play","MAIN_BG","GAME2_BG","GAME1_BG","inject","state","game","betDropDownlist","subGameAnimationPlayInfo","jackpotDatas","jackpotTotalAmount"],"mappings":"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","sourcesContent":["import { godWealthV2_Audio, mainViewModel, sourceManageSeletor } from \"../index\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport ModalBox from \"../../../common/ModalBox\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\nimport { GodWealthV2_Main, IEvent, IProps } from \"../components/GodWealthV2_Main\"\r\nimport config from \"../config\"\r\nimport { cacheData, clearCacheData } from \"../dataTransfer\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { bundlePkgName } from \"../sourceDefine\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { getStore } from \"../store\"\r\nimport { changeGame, resetStore, setAutoLauncherInfo, updateGold, updateJackpotAmount, updateJackpotDatas, updatePositionId, updateWinloss } from \"../store/actions/game\"\r\nimport { initRoller, updateRollerStatus } from \"../store/actions/roller\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { AuthDataVo, AutoLauncherType, DialogInfo, GameType, JackpotData, RollerLaunchResult, RollerStatus, calBetAmount, isAuto, isSubGameToSubGame, verifyBetResultData } from \"../type\"\r\nimport GodWealthV2DialogWinViewModel from \"./GodWealthV2DialogWinViewModel\"\r\nimport GodWealthV2FooterViewModel from \"./GodWealthV2FooterViewModel\"\r\nimport GodWealthV2HeaderViewModel from \"./GodWealthV2HeaderViewModel\"\r\nimport GodWealthV2RollerPanelViewModel from \"./GodWealthV2RollerPanelViewModel\"\r\nimport GodWealthV2RollerViewModel from \"./GodWealthV2RollerViewModel\"\r\nimport { GodWealthV2_helpPanel, IState as FIState, IProps as FIProps, IEvent as FIEvent } from \"../components/GodWealthV2_helpPanel\"\r\nimport { Vec3 } from \"cc\"\r\nimport BaseViewModel from \"../../../hall/viewModel/BaseViewModel\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport StepNumber from \"../../../utils/StepNumber\"\r\nimport UseSetOption from \"../../../utils/UseSetOption\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\n\r\n@StoreInject(getStore())\r\nclass GodWealthV2MainViewModel extends ViewModel<GodWealthV2_Main, IProps, IEvent> {\r\n\r\n  private initCallback;\r\n  private gameTypeInfo;\r\n  constructor(initCallback) {\r\n    super('GodWealthV2_Main')\r\n    this.initCallback = initCallback;\r\n  }\r\n\r\n  public headerViewModel: GodWealthV2HeaderViewModel;\r\n  public footerViewModel: GodWealthV2FooterViewModel;\r\n  public rollerPanelViewModel: GodWealthV2RollerPanelViewModel;\r\n  public helpPanelPanel: BaseViewModel<GodWealthV2_helpPanel, FIState, FIProps, FIEvent>\r\n  public isAuthDone: boolean = false\r\n\r\n  private isBetResult = true;\r\n  /**奖励的坐标 */\r\n  private goodLuckPos: Vec3;\r\n  /**开始按钮坐标 */\r\n  private startBtnV: Vec3;\r\n  private betCallbackFun;\r\n  protected begin() {\r\n    this.headerViewModel = new GodWealthV2HeaderViewModel().mountViewNode(this.comp.getHeader()).connect();\r\n    this.headerViewModel.setEvent({\r\n      quitGame: () => {\r\n        this.onQuitGame();\r\n      }\r\n    })\r\n    this.footerViewModel = new GodWealthV2FooterViewModel().mountViewNode(this.comp.getFooter()).connect();\r\n    this.rollerPanelViewModel = new GodWealthV2RollerPanelViewModel().mountViewNode(this.comp.getRoller()).connect();\r\n\r\n    this.footerViewModel.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      },\r\n      openHelpPanel: () => {\r\n        this.openRule()\r\n      },\r\n    })\r\n    this.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      }\r\n    })\r\n    if (UseSetOption.Instance().option.gameSet.godWealthV2 && UseSetOption.Instance().option.gameSet.godWealthV2.betTarget) {\r\n      this.dispatch(updatePositionId(UseSetOption.Instance().option.gameSet.godWealthV2.betTarget))\r\n    } else {\r\n      this.dispatch(updatePositionId(1))\r\n    }\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.AUTH, bundlePkgName, (data: AuthDataVo, error) => {\r\n      if (error) {\r\n        return;\r\n      }\r\n\r\n      if (!data) {\r\n        global.closeSubGame({\r\n          confirmContent: lang.write(k => k.InitGameModule.FetcherFaild) + '-' + SKT_MAG_TYPE.AUTH\r\n        });\r\n        return;\r\n      }\r\n      this.isAuthDone = true\r\n      if (data.gameType === GameType.SUBGAME2) {\r\n        // 锁定的图标\r\n        cacheData.fixedChessboardIcon = data.fixedChessboardIcon;\r\n      }\r\n\r\n      cacheData.authData = data;\r\n      this.dispatch(updateGold(data.bl));\r\n\r\n      this.dispatch(changeGame({\r\n        lastGameType: data.gameType,\r\n        viewGameType: data.gameType,\r\n        currGameType: data.gameType,\r\n        leftCount: data.freeGameCount,\r\n        freeGameAmount: data.freeGameAmount,\r\n      }))\r\n\r\n      this.playBgMusic();\r\n\r\n      if (data.gameType === GameType.SUBGAME1 && data.freeGameAmount > 0) {\r\n        this.dispatch(updateWinloss(data.freeGameAmount));\r\n      }\r\n\r\n      // 这里初始化插槽\r\n      this.rollerPanelViewModel.comp.initSlot();\r\n\r\n      // 延时一点时间才卸载laoding界面\r\n      this.comp.scheduleOnce(() => {\r\n        this.viewNode && this.viewNode.isValid && this.initCallback && this.initCallback();\r\n\r\n        // 进入游戏之后如果是自动游戏，就发送下注\r\n        if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n          this.sendBet();\r\n        }\r\n      }, 0.1)\r\n\r\n\r\n    })\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.AUTH, {\r\n      token: localStorage.getItem(\"token\"),\r\n      gameId: config.gameId\r\n    });\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, bundlePkgName, (data: RollerLaunchResult, error) => {\r\n      this.comp.unschedule(this.betCallbackFun);\r\n      this.betCallbackFun = undefined;\r\n      this.isBetResult = true;\r\n      const result = verifyBetResultData(data)\r\n      if (!error && result > 0) {\r\n        godWealthV2_Audio.playOneShot(SoundPathDefine.DING)\r\n        const content = lang.write(k => k.InitGameModule.FetcherFaild) + '-ERROR(' + result + ')';\r\n        ModalBox.Instance().show({\r\n          content: content, type: 'Prompt'\r\n        }, () => {\r\n          return true\r\n        })\r\n        return;\r\n      }\r\n      cacheData.rollerLaunchResult = data;\r\n      const si = data.dl.si[0];\r\n      if (si.gameType === GameType.SUBGAME2 || this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n        //每局的锁定图标\r\n        cacheData.fixedChessboardIcon = si.fixedChessboardIcon;\r\n      }\r\n\r\n      // 服务器的索引是从1开始的\r\n      const rollerId = si.rollerId\r\n      for (let i = 0; i < rollerId.length; i++) {\r\n        rollerId[i]--;\r\n      }\r\n      console.log(\"rollerId \", si.rollerId)\r\n      const localLeftCount = this.comp.props.gameTypeInfo.leftCount;\r\n      let leftCount = si.freeCount;\r\n      let nextLeftCount = undefined;\r\n      let isDelay = false;\r\n      // 小游戏切到小游戏时，暂不改变切换状态\r\n      // 为了让玩家延时看到剩余的次数，特殊处理\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.gameType)) {\r\n\r\n      }\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.gameType)\r\n        || (si.freeCount >= localLeftCount && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) // 如果服务器给的次数比本地的次数大了，说明次数发生变化，延迟显示\r\n        || (localLeftCount - si.freeCount > 1 && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2)) { //如果服务器给的次数小于本地的次数超过了1次，说明次数发生变化，延迟显示\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n\r\n      if (isDelay) {\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n\r\n      this.dispatch(changeGame({\r\n        lastGameType: GameType.NONE,\r\n        viewGameType: this.comp.props.gameTypeInfo.viewGameType,\r\n        currGameType: si.gameType,\r\n        leftCount: leftCount,\r\n        freeGameAmount: si.freeGameAmount,\r\n        nextLeftCount: nextLeftCount\r\n      }))\r\n    })\r\n\r\n    // 更新金额\r\n    sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateGold(data));\r\n    })\r\n\r\n    //jackpot用户\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT, bundlePkgName, (data: JackpotData[], error) => {\r\n      this.dispatch(updateJackpotDatas(data))\r\n    })\r\n\r\n    //jackpot TotalAmount\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT_TOTAL, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateJackpotAmount(data))\r\n    })\r\n\r\n\r\n  }\r\n  public openRule() {\r\n    this.helpPanelPanel = new BaseViewModel<GodWealthV2_helpPanel, FIState, FIProps, FIEvent>(\"GodWealthV2_helpPanel\").mountView(sourceManageSeletor().getFile(PrefabPathDefine.RULE).source)\r\n      .appendTo(this.viewNode, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n        closeHandler: () => {\r\n          this.helpPanelPanel.unMount(EffectType.EFFECT1)\r\n        }\r\n      })\r\n  }\r\n  private sendBet() {\r\n    if (!this.isAuthDone) return\r\n    if (!this.isBetResult) {\r\n      console.log(\"已经发送过了下注，不能重复发送，等待服务器返回\")\r\n      return;\r\n    }\r\n\r\n    const betAmount = calBetAmount(this.comp.props.positionId)\r\n    if (this.gameTypeInfo.viewGameType === GameType.MAIN && this.comp.props.gold < betAmount) {\r\n      global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.RechangeGlod, {}, { placeStr: \"对不起，您的金币不足，请充值！\" }) }))\r\n      // global.openShop()\r\n      // 如果余额不足，并且是自动状态，就取消自动\r\n      if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n        this.dispatch(setAutoLauncherInfo({\r\n          autoLauncherType: AutoLauncherType.NONE,\r\n          totalCount: 0,\r\n          leftCount: 0\r\n        }))\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n      this.dispatch(updateGold(this.comp.props.gold - betAmount));\r\n      // let moneyLabel = mainViewModel.headerViewModel.comp.getMoenyLabelNode();\r\n      // const stepNumber = new StepNumber(Number(moneyLabel.string.replace(/,/g, \"\")), this.comp.props.gold - betAmount, (num) => {\r\n      //   if (this.viewNode && this.viewNode.isValid) {\r\n      //     moneyLabel.string = (+num.toFixed(0)).formatAmountWithCommas();\r\n      //   }\r\n      //   })\r\n      // stepNumber.setFlyNode(moneyLabel.node.parent, moneyLabel.node, 22)\r\n      // stepNumber.start()\r\n    }\r\n\r\n    cacheData.rollerLaunchResult = null;\r\n    cacheData.fixedChessboardIcon = null;\r\n    this.dispatch(updateRollerStatus(RollerStatus.RUNNING));\r\n    this.isBetResult = false;\r\n    this.betCallbackFun = this.betListenerTimeHandle.bind(this);\r\n    this.comp.schedule(this.betCallbackFun, 10);\r\n\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n      \"positionId\": this.comp.props.positionId,\r\n      \"tableId\": cacheData.authData.tableId,\r\n    });\r\n  }\r\n\r\n  private betListenerTimeHandle() {\r\n    if (!this.isBetResult) {\r\n      this.isBetResult = true;\r\n      const content = lang.write(k => k.WebSocketModule.WebSocketError) + '-' + SKT_MAG_TYPE.LAUNCH;\r\n      godWealthV2_Audio.playOneShot(SoundPathDefine.DING)\r\n\r\n      ModalBox.Instance().show({\r\n        content: content, type: 'Prompt'\r\n      }, () => {\r\n        this.onQuitGame();\r\n        return true\r\n      })\r\n    }\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    sktMsgListener.removeById(bundlePkgName)\r\n    this.footerViewModel.unMount();\r\n    this.headerViewModel.unMount();\r\n    this.rollerPanelViewModel.unMount();\r\n    clearCacheData();\r\n    this.dispatch(resetStore(''))\r\n    this.dispatch(initRoller(0))\r\n  }\r\n\r\n  private onQuitGame() {\r\n    global.closeSubGame();\r\n  }\r\n\r\n  /**显示大奖 */\r\n  public showDialogWin(dialogInfo: DialogInfo, done) {\r\n    let godWealthV2DialogWinViewModel = new GodWealthV2DialogWinViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.DIALOG_WIN).source)\r\n      .appendTo(this.viewNode).connect();\r\n    // console.log(\"this.comp.props.autoLauncherInfo\",this.comp.props.autoLauncherInfo);\r\n\r\n    godWealthV2DialogWinViewModel.setProps({\r\n      autoLauncherInfo: this.comp.props.autoLauncherInfo,\r\n      dialogInfo: dialogInfo,\r\n      gameTypeInfo: this.comp.props.gameTypeInfo,\r\n    })\r\n    godWealthV2DialogWinViewModel.setEvent({\r\n      onWindowCloseHandler: () => {\r\n        done && done();\r\n      }\r\n    })\r\n  }\r\n  public getGoodLuckPos() {\r\n    return this.goodLuckPos;\r\n  }\r\n\r\n  public getStartBtnPos() {\r\n    return this.startBtnV\r\n  }\r\n\r\n  public setGoodLuckPos(pos: Vec3) {\r\n    this.goodLuckPos = pos;\r\n  }\r\n\r\n  public setStartBtnPos(pos: Vec3) {\r\n    this.startBtnV = pos;\r\n  }\r\n\r\n  public playBgMusic() {\r\n    godWealthV2_Audio.stop();\r\n    if (this.comp.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n      godWealthV2_Audio.play(SoundPathDefine.MAIN_BG, true)\r\n    } else if (this.comp.props.gameTypeInfo.currGameType === GameType.SUBGAME2) {\r\n      godWealthV2_Audio.play(SoundPathDefine.GAME2_BG, true)\r\n    } else {\r\n      godWealthV2_Audio.play(SoundPathDefine.GAME1_BG, true)\r\n    }\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      this.gameTypeInfo = state.game.gameTypeInfo;\r\n\r\n      return {\r\n        betDropDownlist: state.game.betDropDownlist,\r\n        positionId: state.game.positionId,\r\n        gold: state.game.gold,\r\n        gameTypeInfo: state.game.gameTypeInfo,\r\n        subGameAnimationPlayInfo: state.game.subGameAnimationPlayInfo,\r\n        jackpotDatas: state.game.jackpotDatas,\r\n        jackpotTotalAmount: state.game.jackpotTotalAmount,\r\n        autoLauncherInfo: state.game.autoLauncherInfo,\r\n      }\r\n    })\r\n    return this\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default GodWealthV2MainViewModel"]}