{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_GiftBag.ts"],"names":["_decorator","Button","instantiate","Label","Node","PageView","sys","BaseComponent","SKT_MAG_TYPE","sktInstance","sktMsgListener","setLoadingAction","global","hallAudio","lang","sourceManageSeletor","BaseViewModel","PrefabPathDefine","EffectType","ModalBox","SoundPathDefine","ccclass","property","Hall_GiftBag","propertyNode","props_btn_close","props_PageView_gift_bag","props_page_template_item","props_btn_left","props_btn_right","props","isAutoShowPopItem","giftList","events","onClosePanel","start","initState","bindEvent","node","on","EventType","TOUCH_END","getAudioInstance","playing","play","MAIN_BGM","index","getCurrentPageIndex","scrollToPage","setArrowDisplay","count","content","children","filter","i","active","length","useProps","key","value","sendSktMessage","GIFT_LIST","isLoading","setState","bindUI","add","data","hallDispatch","isShow","RECHARGE_ORDER","openURL","useState","state","separatePage","Instance","show","write","k","MainPaneModule","NoGiftData","placeStr","type","removeAllPages","forEach","item","getChildByName","getComponent","string","giftName","normalGoldCoin","formatAmountWithCommas","updateRenderData","discountCoins","amount","discountRate","chooseBankVM","mountView","getFile","HELL_CHOOSE_BANK","source","appendTo","effectType","EFFECT1","isModal","setEvent","unMount","EFFECT2","onOrder","rechargeChannelId","money","orderRechargeType","giftBagMallId","id","setProps","onlyDisplayArr","rechargeChannelIds","startCountdown","addPage","e","console","log","scheduleOnce","onDestroy","removeById","timeLabel","targetDate","Date","setDate","getDate","setHours","setMinutes","setSeconds","setMilliseconds","updateCountdownLabel","schedule","currentDate","times","getTime","h","parseInt","remainHours","m","remainMinutes","s","remainSeconds","remainTimeStr","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAmBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,G,OAAAA,G;;AACnEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,Y,iBAAAA,Y;AAAcC,MAAAA,W,iBAAAA,W;AAAaC,MAAAA,c,iBAAAA,c;;AAC3BC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,S,iBAAAA,S;AAAWC,MAAAA,I,iBAAAA,I;AAAMC,MAAAA,mB,iBAAAA,mB;;AAC3BC,MAAAA,a;;AAEEC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,U,iBAAAA,U;;AACFC,MAAAA,Q;;AAEEC,MAAAA,e,kBAAAA,e;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBtB,U;;8BAyCjBuB,Y,WADZF,OAAO,CAAC,cAAD,C,gBAAR,MACaE,YADb;AAAA;AAAA,0CACwE;AAAA;AAAA;AAAA,eAG7DC,YAH6D,GAG9C;AACxBC,YAAAA,eAAe,EAAE,IAAIxB,MAAJ,EADO;AAExByB,YAAAA,uBAAuB,EAAE,IAAIrB,QAAJ,EAFD;AAGxBsB,YAAAA,wBAAwB,EAAE,IAAIvB,IAAJ,EAHF;AAIxBwB,YAAAA,cAAc,EAAE,IAAIxB,IAAJ,EAJQ;AAKxByB,YAAAA,eAAe,EAAE,IAAIzB,IAAJ;AALO,WAH8C;AAAA,eAWhE0B,KAXgE,GAWhD;AACtBC,YAAAA,iBAAiB,EAAE,KADG;AAEtBC,YAAAA,QAAQ,EAAE;AAFY,WAXgD;AAAA,eAgBhEC,MAhBgE,GAgB/C;AACvBC,YAAAA,YAAY,EAAE,MAAM,CAAG;AADA,WAhB+C;AAAA;;AACvEC,QAAAA,KAAK,GAAG,CAAG;;AAmBDC,QAAAA,SAAS,GAAG;AACrB,iBAAO;AACNJ,YAAAA,QAAQ,EAAE;AADJ,WAAP;AAGA;;AAESK,QAAAA,SAAS,GAAS;AAC3B,eAAKb,YAAL,CAAkBC,eAAlB,CAAkCa,IAAlC,CAAuCC,EAAvC,CAA0CnC,IAAI,CAACoC,SAAL,CAAeC,SAAzD,EAAoE,MAAM;AACzE,aAAC;AAAA;AAAA,wCAAUC,gBAAV,GAA6BC,OAA9B,IAAyC;AAAA;AAAA,wCAAUC,IAAV,CAAe;AAAA;AAAA,oDAAgBC,QAA/B,EAAyC,IAAzC,CAAzC;AACA,iBAAKZ,MAAL,CAAYC,YAAZ;AACA,WAHD;AAKA,eAAKV,YAAL,CAAkBI,cAAlB,CAAiCW,EAAjC,CAAoCnC,IAAI,CAACoC,SAAL,CAAeC,SAAnD,EAA8D,MAAM;AACnE,kBAAMK,KAAK,GAAG,KAAKtB,YAAL,CAAkBE,uBAAlB,CAA0CqB,mBAA1C,EAAd;AACA,iBAAKvB,YAAL,CAAkBE,uBAAlB,CAA0CsB,YAA1C,CAAuDF,KAAK,GAAG,CAAR,GAAYA,KAAK,GAAG,CAApB,GAAwB,CAA/E;AACA,iBAAKG,eAAL;AACA,WAJD;AAKA,eAAKzB,YAAL,CAAkBK,eAAlB,CAAkCU,EAAlC,CAAqCnC,IAAI,CAACoC,SAAL,CAAeC,SAApD,EAA+D,MAAM;AACpE;AACA,kBAAMS,KAAK,GAAG,KAAK1B,YAAL,CAAkBE,uBAAlB,CAA0CyB,OAA1C,CAAkDC,QAAlD,CAA2DC,MAA3D,CAAkEC,CAAC,IAAIA,CAAC,CAACC,MAAzE,EAAiFC,MAA/F;AACA,kBAAMV,KAAK,GAAG,KAAKtB,YAAL,CAAkBE,uBAAlB,CAA0CqB,mBAA1C,EAAd;AACA,iBAAKvB,YAAL,CAAkBE,uBAAlB,CAA0CsB,YAA1C,CAAuDF,KAAK,GAAGI,KAAK,GAAG,CAAhB,GAAoBJ,KAAK,GAAG,CAA5B,GAAgCI,KAAK,GAAG,CAA/F;AACA,iBAAKD,eAAL;AACA,WAND;AAOA,eAAKzB,YAAL,CAAkBE,uBAAlB,CAA0CY,IAA1C,CAA+CC,EAA/C,CAAkD,cAAlD,EAAkE,MAAM;AACvE,iBAAKU,eAAL;AACA,WAFD,EAEG,IAFH;AAGA,eAAKA,eAAL;AACA;;AAEOA,QAAAA,eAAe,GAAG;AACzB;AACA,gBAAMC,KAAK,GAAG,KAAK1B,YAAL,CAAkBE,uBAAlB,CAA0CyB,OAA1C,CAAkDC,QAAlD,CAA2DC,MAA3D,CAAkEC,CAAC,IAAIA,CAAC,CAACC,MAAzE,EAAiFC,MAA/F;AACA,gBAAMV,KAAK,GAAG,KAAKtB,YAAL,CAAkBE,uBAAlB,CAA0CqB,mBAA1C,EAAd;AACA,eAAKvB,YAAL,CAAkBI,cAAlB,CAAiC2B,MAAjC,GAA0CL,KAAK,GAAG,CAAR,GAAY,IAAZ,GAAmB,KAA7D;AACA,eAAK1B,YAAL,CAAkBK,eAAlB,CAAkC0B,MAAlC,GAA2CL,KAAK,GAAG,CAAR,GAAY,IAAZ,GAAmB,KAA9D;;AACA,cAAIJ,KAAK,KAAK,CAAd,EAAiB;AAChB,iBAAKtB,YAAL,CAAkBI,cAAlB,CAAiC2B,MAAjC,GAA0C,KAA1C;AACA,WAFD,MAEO,IAAIT,KAAK,GAAG,CAAR,KAAcI,KAAlB,EAAyB;AAC/B,iBAAK1B,YAAL,CAAkBK,eAAlB,CAAkC0B,MAAlC,GAA2C,KAA3C;AACA;AAED;;AAESE,QAAAA,QAAQ,CAACC,GAAD,EAAoBC,KAApB,EAAmD;AACpE,cAAID,GAAG,KAAK,UAAZ,EAAwB;AACvB,gBAAI,CAAC,KAAK5B,KAAL,CAAWE,QAAX,CAAoBwB,MAAzB,EAAiC;AAEhC;AAAA;AAAA,8CAAYI,cAAZ,CAA2B;AAAA;AAAA,gDAAaC,SAAxC,EAAmD,EAAnD,EAAuD;AAAEC,gBAAAA,SAAS,EAAE;AAAb,eAAvD;AACA,aAHD,MAGO;AACN,mBAAKC,QAAL,CAAc;AAAE/B,gBAAAA,QAAQ,EAAE,KAAKF,KAAL,CAAWE;AAAvB,eAAd;AACA;AACD;AACD;;AAESgC,QAAAA,MAAM,GAAS;AACxB,eAAKxC,YAAL,CAAkBG,wBAAlB,CAA2C4B,MAA3C,GAAoD,KAApD;AACA;AAAA;AAAA,gDAAeU,GAAf,CAAmB;AAAA;AAAA,4CAAaJ,SAAhC,EAA2C,MAA3C,EAAoDK,IAAD,IAAU;AAC5D;AAAA;AAAA,kCAAOC,YAAP,CAAoB;AAAA;AAAA,sDAAiB;AAAEC,cAAAA,MAAM,EAAE;AAAV,aAAjB,CAApB;AACA,iBAAKL,QAAL,CAAc;AAAE/B,cAAAA,QAAQ,EAAEkC;AAAZ,aAAd;AACA,WAHD;AAIA;AAAA;AAAA,gDAAeD,GAAf,CAAmB;AAAA;AAAA,4CAAaI,cAAhC,EAAgD,MAAhD,EAAyDH,IAAD,IAAU;AACjE;AAAA;AAAA,kCAAOC,YAAP,CAAoB;AAAA;AAAA,sDAAiB;AAAEC,cAAAA,MAAM,EAAE;AAAV,aAAjB,CAApB;AACA9D,YAAAA,GAAG,CAACgE,OAAJ,CAAYJ,IAAZ,EAFiE,CAGjE;AACA,WAJD;AAKA,eAAKK,QAAL,CAAc,CAACb,GAAD,EAAMC,KAAN,KAAgB;AAC7B,gBAAI,CAAC,KAAKa,KAAL,CAAWxC,QAAX,CAAoBqB,MAApB,CAA2BC,CAAC,IAAIA,CAAC,CAACmB,YAAF,KAAmB,CAAnD,EAAsDjB,MAA3D,EAAmE;AAClE;AAAA;AAAA,wCAASkB,QAAT,GAAoBC,IAApB,CAAyB;AAAExB,gBAAAA,OAAO,EAAE;AAAA;AAAA,kCAAKyB,KAAL,CAAWC,CAAC,IAAIA,CAAC,CAACC,cAAF,CAAiBC,UAAjC,EAA6C,EAA7C,EAAiD;AAAEC,kBAAAA,QAAQ,EAAE;AAAZ,iBAAjD,CAAX;AAAqFC,gBAAAA,IAAI,EAAE;AAA3F,eAAzB,EAAgI,MAAM;AACrI,qBAAKhD,MAAL,CAAYC,YAAZ;AACA,uBAAO,IAAP;AACA,eAHD;AAIA;;AACD,iBAAKV,YAAL,CAAkBE,uBAAlB,CAA0CwD,cAA1C,GAP6B,CAO6B;;AAC1D,iBAAKV,KAAL,CAAWxC,QAAX,CAAoBqB,MAApB,CAA2BC,CAAC,IAAIA,CAAC,CAACmB,YAAF,KAAmB,CAAnD,EAAsDU,OAAtD,CAA8D,CAACC,IAAD,EAAOtC,KAAP,KAAiB;AAC9E,oBAAMR,IAAI,GAAGpC,WAAW,CAAC,KAAKsB,YAAL,CAAkBG,wBAAnB,CAAxB;AACAW,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,YAApB,EAAkCC,YAAlC,CAA+CnF,KAA/C,EAAsDoF,MAAtD,GAA+DH,IAAI,CAACI,QAApE;AACAlD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,gBAApB,EAAsCC,YAAtC,CAAmDnF,KAAnD,EAA0DoF,MAA1D,GAAmEH,IAAI,CAACK,cAAL,CAAoBC,sBAApB,EAAnE;AACApD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,gBAApB,EAAsCC,YAAtC,CAAmDnF,KAAnD,EAA0DwF,gBAA1D,CAA2E,IAA3E;AACArD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,YAApB,EAAkCC,YAAlC,CAA+CnF,KAA/C,EAAsDoF,MAAtD,GAA+DH,IAAI,CAACQ,aAAL,CAAmBF,sBAAnB,EAA/D;AACApD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,iBAApB,EAAuCC,YAAvC,CAAoDnF,KAApD,EAA2DoF,MAA3D,GAAoEH,IAAI,CAACS,MAAL,CAAYH,sBAAZ,EAApE;AACApD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,YAApB,EAAkCC,YAAlC,CAA+CnF,KAA/C,EAAsDoF,MAAtD,GAAgE,IAAGH,IAAI,CAACU,YAAa,GAArF;AACAxD,cAAAA,IAAI,CAAC+C,cAAL,CAAoB,SAApB,EAA+B9C,EAA/B,CAAkCnC,IAAI,CAACoC,SAAL,CAAeC,SAAjD,EAA4D,MAAM;AACjE;AACA,sBAAMsD,YAAY,GAAG;AAAA;AAAA,oDAA8D,iBAA9D,EAAiFC,SAAjF,CAA2F;AAAA;AAAA,kEAAsBC,OAAtB,CAA8B;AAAA;AAAA,0DAAiBC,gBAA/C,EAAiEC,MAA5J,EACnBC,QADmB,CACV,KAAK9D,IADK,EACC;AAAE+D,kBAAAA,UAAU,EAAE;AAAA;AAAA,gDAAWC,OAAzB;AAAkCC,kBAAAA,OAAO,EAAE;AAA3C,iBADD,EACoDC,QADpD,CAC6D;AAChFtE,kBAAAA,YAAY,EAAE,MAAM;AACnB6D,oBAAAA,YAAY,CAACU,OAAb,CAAqB;AAAA;AAAA,kDAAWC,OAAhC;AACA,mBAH+E;AAIhFC,kBAAAA,OAAO,EAAGC,iBAAD,IAAuB;AAC/B;AAAA;AAAA,oDAAYhD,cAAZ,CAA2B;AAAA;AAAA,sDAAaS,cAAxC,EAAwD;AACvDuC,sBAAAA,iBADuD;AAEvDC,sBAAAA,KAAK,EAAEzB,IAAI,CAACS,MAF2C;AAGvDiB,sBAAAA,iBAAiB,EAAE,CAHoC;AAIvDC,sBAAAA,aAAa,EAAE3B,IAAI,CAAC4B;AAJmC,qBAAxD,EAKG;AAAElD,sBAAAA,SAAS,EAAE;AAAb,qBALH,EAD+B,CAO/B;AACA;AAZ+E,iBAD7D,EAcjBmD,QAdiB,CAcR;AACXC,kBAAAA,cAAc,EAAE9B,IAAI,CAAC+B,kBAAL,IAA2B;AADhC,iBAdQ,CAArB;AAiBA,eAnBD;AAoBA7E,cAAAA,IAAI,CAACiB,MAAL,GAAc,IAAd;AACA,mBAAK6D,cAAL,CAAoB9E,IAAI,CAAC+C,cAAL,CAAoB,yBAApB,EAA+CC,YAA/C,CAA4DnF,KAA5D,CAApB,EA7B8E,CA8B9E;;AACA,kBAAI;AACH,qBAAKqB,YAAL,CAAkBE,uBAAlB,CAA0C2F,OAA1C,CAAkD/E,IAAlD;AACA,eAFD,CAEE,OAAOgF,CAAP,EAAU;AAAEC,gBAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AAAgB;AAC9B,aAlCD;AAoCA,iBAAKG,YAAL,CAAkB,MAAM;AACvB;AACA,kBAAI,KAAK3F,KAAL,IAAc,CAAC,KAAKA,KAAL,CAAWC,iBAA9B,EAAiD;AAChD,qBAAKyC,KAAL,CAAWxC,QAAX,CAAoBmD,OAApB,CAA4B,CAACC,IAAD,EAAOtC,KAAP,KAAiB;AAC5C,sBAAIsC,IAAI,CAACX,YAAL,KAAsB,CAA1B,EAA6B;AAC5B,yBAAKjD,YAAL,CAAkBE,uBAAlB,CAA0CsB,YAA1C,CAAuDF,KAAvD;AACA;AACD,iBAJD;AAKA;AACD,aATD,EASG,IATH;AAUA,iBAAKG,eAAL;AACA,WAvDD,EAuDG,CAAC,UAAD,CAvDH;AAwDA;;AACSyE,QAAAA,SAAS,GAAG;AACrB;AAAA;AAAA,gDAAeC,UAAf,CAA0B,MAA1B;AACA;;AAEOP,QAAAA,cAAc,CAACQ,SAAD,EAAmB;AACxC,gBAAMC,UAAU,GAAG,IAAIC,IAAJ,EAAnB;AACAD,UAAAA,UAAU,CAACE,OAAX,CAAmBF,UAAU,CAACG,OAAX,KAAuB,CAA1C;AACAH,UAAAA,UAAU,CAACI,QAAX,CAAoB,CAApB;AACAJ,UAAAA,UAAU,CAACK,UAAX,CAAsB,CAAtB;AACAL,UAAAA,UAAU,CAACM,UAAX,CAAsB,CAAtB;AACAN,UAAAA,UAAU,CAACO,eAAX,CAA2B,CAA3B;AAEA,eAAKC,oBAAL,CAA0BT,SAA1B,EAAqCC,UAArC;AACA,eAAKS,QAAL,CAAc,MAAM;AACnB,iBAAKD,oBAAL,CAA0BT,SAA1B,EAAqCC,UAArC;AACA,WAFD,EAEG,CAFH;AAGA;;AAEOQ,QAAAA,oBAAoB,CAACT,SAAD,EAAmBC,UAAnB,EAAqC;AAChE,gBAAMU,WAAW,GAAG,IAAIT,IAAJ,EAApB;AACA,cAAIU,KAAK,GAAG,CAACX,UAAU,CAACY,OAAX,KAAuBF,WAAW,CAACE,OAAZ,EAAxB,IAAiD,IAA7D,CAFgE,CAEG;;AACnE,cAAIC,CAAC,GAAGC,QAAQ,CAACH,KAAK,GAAG,EAAR,GAAa,EAAb,GAAkB,EAAnB,CAAhB,CAHgE,CAGxB;;AACxC,gBAAMI,WAAW,GAAGF,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmBA,CAAvC;AACA,cAAIG,CAAC,GAAGF,QAAQ,CAACH,KAAK,GAAG,EAAR,GAAa,EAAb,GAAkB,EAAnB,CAAhB,CALgE,CAKxB;;AACxC,gBAAMM,aAAa,GAAGD,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmBA,CAAzC;AACA,cAAIE,CAAC,GAAGJ,QAAQ,CAACH,KAAK,GAAG,EAAR,GAAa,EAAd,CAAhB,CAPgE,CAO7B;;AACnC,gBAAMQ,aAAa,GAAGD,CAAC,GAAG,EAAJ,GAAS,MAAMA,CAAf,GAAmBA,CAAzC;AAEA,gBAAME,aAAa,GAAI,GAAEL,WAAY,IAAGE,aAAc,IAAGE,aAAc,EAAvE;AACApB,UAAAA,SAAS,CAACrC,MAAV,GAAmB0D,aAAnB;AACA;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAjLsE,O","sourcesContent":["import { _decorator, Button, Component, instantiate, Label, Node, PageView, sys, UITransform } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from '../socketConnect';\r\nimport { setLoadingAction } from '../store/actions/baseBoard';\r\nimport { global, hallAudio, lang, sourceManageSeletor } from '../index';\r\nimport BaseViewModel from '../viewModel/BaseViewModel';\r\nimport { Hall_ChooseBank, IState as CBState, IProps as CBProps, IEvent as CBEvent } from './Hall_ChooseBank';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { EffectType } from '../../utils/NodeIOEffect';\r\nimport ModalBox from '../../common/ModalBox';\r\nimport { purchaseAppsflyerEvents } from '../../common/bridge';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport type GiftItemType = {\r\n\tid: number,\r\n\t/**支付金额 */\r\n\tamount: number,\r\n\tcreateTime: string,\r\n\t/**优惠金币 */\r\n\tdiscountCoins: number,\r\n\t/**优惠率 */\r\n\tdiscountRate: number,\r\n\t/**礼包名称 */\r\n\tgiftName: string,\r\n\t/**礼包类型 */\r\n\tgiftType: number,\r\n\tisDel: number,\r\n\t/**商城是否显示（0不显示  1显示） */\r\n\tmallPage: number,\r\n\t/**实际金币 */\r\n\tnormalGoldCoin: number,\r\n\t/**弹窗是否显示（0不显示  1显示） */\r\n\tseparatePage: number,\r\n\t/**支持的支付渠道 */\r\n\trechargeChannelIds: Array<string>\r\n}\r\n\r\nexport interface IState {\r\n\tgiftList: Array<GiftItemType>\r\n}\r\n\r\nexport interface IProps {\r\n\t/**是否展示有弹出标记的 */\r\n\tisAutoShowPopItem: boolean,\r\n\t/**外部也可以传 */\r\n\tgiftList: Array<GiftItemType>\r\n}\r\nexport interface IEvent {\r\n\tonClosePanel: () => void\r\n}\r\n\r\n@ccclass('Hall_GiftBag')\r\nexport class Hall_GiftBag extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_close: new Button(),\r\n\t\tprops_PageView_gift_bag: new PageView(),\r\n\t\tprops_page_template_item: new Node(),\r\n\t\tprops_btn_left: new Node(),\r\n\t\tprops_btn_right: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tisAutoShowPopItem: false,\r\n\t\tgiftList: null\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonClosePanel: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tgiftList: []\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_close.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t!hallAudio.getAudioInstance().playing && hallAudio.play(SoundPathDefine.MAIN_BGM, true)\r\n\t\t\tthis.events.onClosePanel()\r\n\t\t})\r\n\r\n\t\tthis.propertyNode.props_btn_left.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tconst index = this.propertyNode.props_PageView_gift_bag.getCurrentPageIndex()\r\n\t\t\tthis.propertyNode.props_PageView_gift_bag.scrollToPage(index > 0 ? index - 1 : 0)\r\n\t\t\tthis.setArrowDisplay()\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_right.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t// const count = this.propertyNode.props_PageView_gift_bag.getPages().length\r\n\t\t\tconst count = this.propertyNode.props_PageView_gift_bag.content.children.filter(i => i.active).length\r\n\t\t\tconst index = this.propertyNode.props_PageView_gift_bag.getCurrentPageIndex()\r\n\t\t\tthis.propertyNode.props_PageView_gift_bag.scrollToPage(index < count - 1 ? index + 1 : count - 1)\r\n\t\t\tthis.setArrowDisplay()\r\n\t\t})\r\n\t\tthis.propertyNode.props_PageView_gift_bag.node.on('page-turning', () => {\r\n\t\t\tthis.setArrowDisplay()\r\n\t\t}, this);\r\n\t\tthis.setArrowDisplay()\r\n\t}\r\n\r\n\tprivate setArrowDisplay() {\r\n\t\t// const count = this.propertyNode.props_PageView_gift_bag.getPages().length\r\n\t\tconst count = this.propertyNode.props_PageView_gift_bag.content.children.filter(i => i.active).length\r\n\t\tconst index = this.propertyNode.props_PageView_gift_bag.getCurrentPageIndex()\r\n\t\tthis.propertyNode.props_btn_left.active = count > 1 ? true : false\r\n\t\tthis.propertyNode.props_btn_right.active = count > 1 ? true : false\r\n\t\tif (index === 0) {\r\n\t\t\tthis.propertyNode.props_btn_left.active = false\r\n\t\t} else if (index + 1 === count) {\r\n\t\t\tthis.propertyNode.props_btn_right.active = false\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"giftList\") {\r\n\t\t\tif (!this.props.giftList.length) {\r\n\r\n\t\t\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.GIFT_LIST, {}, { isLoading: true })\r\n\t\t\t} else {\r\n\t\t\t\tthis.setState({ giftList: this.props.giftList })\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_page_template_item.active = false\r\n\t\tsktMsgListener.add(SKT_MAG_TYPE.GIFT_LIST, \"gift\", (data) => {\r\n\t\t\tglobal.hallDispatch(setLoadingAction({ isShow: false }))\r\n\t\t\tthis.setState({ giftList: data })\r\n\t\t})\r\n\t\tsktMsgListener.add(SKT_MAG_TYPE.RECHARGE_ORDER, 'gift', (data) => {\r\n\t\t\tglobal.hallDispatch(setLoadingAction({ isShow: false }))\r\n\t\t\tsys.openURL(data)\r\n\t\t\t// ModalBox.Instance().show({ url: data })\r\n\t\t})\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tif (!this.state.giftList.filter(i => i.separatePage === 1).length) {\r\n\t\t\t\tModalBox.Instance().show({ content: lang.write(k => k.MainPaneModule.NoGiftData, {}, { placeStr: \"暂无礼包数据\" }), type: \"Prompt\" }, () => {\r\n\t\t\t\t\tthis.events.onClosePanel()\r\n\t\t\t\t\treturn true\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tthis.propertyNode.props_PageView_gift_bag.removeAllPages()//.content.removeAllChildren()\r\n\t\t\tthis.state.giftList.filter(i => i.separatePage === 1).forEach((item, index) => {\r\n\t\t\t\tconst node = instantiate(this.propertyNode.props_page_template_item)\r\n\t\t\t\tnode.getChildByName(\"label_name\").getComponent(Label).string = item.giftName\r\n\t\t\t\tnode.getChildByName(\"label_gole_old\").getComponent(Label).string = item.normalGoldCoin.formatAmountWithCommas()\r\n\t\t\t\tnode.getChildByName(\"label_gole_old\").getComponent(Label).updateRenderData(true)\r\n\t\t\t\tnode.getChildByName(\"label_gole\").getComponent(Label).string = item.discountCoins.formatAmountWithCommas()\r\n\t\t\t\tnode.getChildByName(\"label_price_buy\").getComponent(Label).string = item.amount.formatAmountWithCommas()\r\n\t\t\t\tnode.getChildByName(\"label_free\").getComponent(Label).string = `+${item.discountRate}%`\r\n\t\t\t\tnode.getChildByName(\"btn_buy\").on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t\t\t//购买\r\n\t\t\t\t\tconst chooseBankVM = new BaseViewModel<Hall_ChooseBank, CBState, CBProps, CBEvent>('Hall_ChooseBank').mountView(sourceManageSeletor().getFile(PrefabPathDefine.HELL_CHOOSE_BANK).source)\r\n\t\t\t\t\t\t.appendTo(this.node, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n\t\t\t\t\t\t\tonClosePanel: () => {\r\n\t\t\t\t\t\t\t\tchooseBankVM.unMount(EffectType.EFFECT2)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonOrder: (rechargeChannelId) => {\r\n\t\t\t\t\t\t\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.RECHARGE_ORDER, {\r\n\t\t\t\t\t\t\t\t\trechargeChannelId,\r\n\t\t\t\t\t\t\t\t\tmoney: item.amount,\r\n\t\t\t\t\t\t\t\t\torderRechargeType: 2,\r\n\t\t\t\t\t\t\t\t\tgiftBagMallId: item.id\r\n\t\t\t\t\t\t\t\t}, { isLoading: true })\r\n\t\t\t\t\t\t\t\t// purchaseAppsflyerEvents(item.amount + '', 'IDR')\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).setProps({\r\n\t\t\t\t\t\t\tonlyDisplayArr: item.rechargeChannelIds || []\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\tnode.active = true\r\n\t\t\t\tthis.startCountdown(node.getChildByName(\"props_Label_cutdown_num\").getComponent(Label));\r\n\t\t\t\t// this.propertyNode.props_PageView_gift_bag.content.addChild(node)\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.propertyNode.props_PageView_gift_bag.addPage(node)\r\n\t\t\t\t} catch (e) { console.log(e) }\r\n\t\t\t})\r\n\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t//加个延时是为了确认isAutoShowPopItem已经获取了值\r\n\t\t\t\tif (this.props && !this.props.isAutoShowPopItem) {\r\n\t\t\t\t\tthis.state.giftList.forEach((item, index) => {\r\n\t\t\t\t\t\tif (item.separatePage === 1) {\r\n\t\t\t\t\t\t\tthis.propertyNode.props_PageView_gift_bag.scrollToPage(index)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}, 0.05)\r\n\t\t\tthis.setArrowDisplay()\r\n\t\t}, [\"giftList\"])\r\n\t}\r\n\tprotected onDestroy() {\r\n\t\tsktMsgListener.removeById(\"gift\")\r\n\t}\r\n\r\n\tprivate startCountdown(timeLabel: Label) {\r\n\t\tconst targetDate = new Date()\r\n\t\ttargetDate.setDate(targetDate.getDate() + 1);\r\n\t\ttargetDate.setHours(0);\r\n\t\ttargetDate.setMinutes(0);\r\n\t\ttargetDate.setSeconds(0);\r\n\t\ttargetDate.setMilliseconds(0);\r\n\r\n\t\tthis.updateCountdownLabel(timeLabel, targetDate);\r\n\t\tthis.schedule(() => {\r\n\t\t\tthis.updateCountdownLabel(timeLabel, targetDate);\r\n\t\t}, 1)\r\n\t}\r\n\r\n\tprivate updateCountdownLabel(timeLabel: Label, targetDate: Date) {\r\n\t\tconst currentDate = new Date()\r\n\t\tlet times = (targetDate.getTime() - currentDate.getTime()) / 1000; // times是剩余时间总的秒数\r\n\t\tlet h = parseInt(times / 60 / 60 + ''); //时\r\n\t\tconst remainHours = h < 10 ? '0' + h : h;\r\n\t\tlet m = parseInt(times / 60 % 60 + ''); //分\r\n\t\tconst remainMinutes = m < 10 ? '0' + m : m;\r\n\t\tlet s = parseInt(times % 60 + ''); // 秒\r\n\t\tconst remainSeconds = s < 10 ? '0' + s : s;\r\n\r\n\t\tconst remainTimeStr = `${remainHours}:${remainMinutes}:${remainSeconds}`;\r\n\t\ttimeLabel.string = remainTimeStr;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}