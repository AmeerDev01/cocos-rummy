{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thor/viewModel/AutoLauncherViewModel.ts"],"names":["ViewModel","StoreInject","getStore","AutoLauncherType","GameType","footerViewModel","changeAutoLauncherType","setAutoLaunchedTimes","setShowAuthLaunch","dataTransfer","DataKeyType","setRollSpeed","autoLauncherTypeWithTimes","NONE","TIME_10","TIME_20","TIME_50","TIME_100","TIME_500","LAMIT_FAST","LIMIT","AutoLauncherViewModel","constructor","isWaiting","isRollEnd","autoLaunchedTimes","autoLauncherType","lanuchEvent","begin","comp","schedule","GAME_TYPE","MAIN","dispatch","undefined","setLaunchEvent","connect","inject","state","game","roller","roundAllEnd","isShowAutoLaunch"],"mappings":"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","sourcesContent":["import { Node } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { Thor_AuthLauncher, IProps, IEvent } from \"../components/Thor_AuthLauncher\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { getStore } from \"../store\"\r\nimport { AutoLauncherType, GameType } from \"../type\"\r\nimport { footerViewModel } from \"../index\"\r\nimport { changeAutoLauncherType, setAutoLaunchedTimes, setShowAuthLaunch } from \"../store/actions/game\"\r\nimport dataTransfer, { DataKeyType } from \"../dataTransfer\"\r\nimport { setRollSpeed } from \"../store/actions/roller\"\r\n\r\nexport const autoLauncherTypeWithTimes = {\r\n  [AutoLauncherType.NONE]: 0,\r\n  [AutoLauncherType.TIME_10]: 10,\r\n  [AutoLauncherType.TIME_20]: 20,\r\n  [AutoLauncherType.TIME_50]: 50,\r\n  [AutoLauncherType.TIME_100]: 100,\r\n  [AutoLauncherType.TIME_500]: 500,\r\n  [AutoLauncherType.LAMIT_FAST]: 10000,\r\n  [AutoLauncherType.LIMIT]: 20000,\r\n}\r\n@StoreInject(getStore())\r\nclass AutoLauncherViewModel extends ViewModel<Thor_AuthLauncher, IProps, IEvent> {\r\n  constructor() {\r\n    super('Thor_AuthLauncher')\r\n  }\r\n  private isWaiting: boolean = true\r\n  private isRollEnd: boolean = true\r\n  private autoLaunchedTimes: number = 0\r\n  private autoLauncherType: AutoLauncherType = AutoLauncherType.NONE\r\n\r\n  private lanuchEvent: () => void\r\n  protected begin() {\r\n    footerViewModel.comp.schedule( ()=> {\r\n      if (this.isWaiting && this.autoLauncherType !== AutoLauncherType.NONE) {\r\n        if (this.autoLaunchedTimes < autoLauncherTypeWithTimes[this.autoLauncherType] && this.isRollEnd) {\r\n          // console.log('自动启动', this.autoLaunchedTimes, autoLauncherTypeWithTimes[this.autoLauncherType])\r\n          this.lanuchEvent && this.lanuchEvent()\r\n          if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.MAIN) {\r\n            this.dispatch(setAutoLaunchedTimes(undefined))\r\n          }\r\n        } else {\r\n          this.dispatch(setShowAuthLaunch(false))\r\n          this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n          this.dispatch(setAutoLaunchedTimes(0))\r\n          this.dispatch(setRollSpeed(1))\r\n        }\r\n      }\r\n    }, 1);\r\n  }\r\n\r\n  /**设置自动运行器要自动运行的函数 */\r\n  public setLaunchEvent(lanuchEvent: () => void) {\r\n    this.lanuchEvent = lanuchEvent\r\n  }\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      this.isWaiting = state.game.isWaiting\r\n      this.autoLauncherType = state.game.autoLauncherType\r\n      this.autoLaunchedTimes = state.game.autoLaunchedTimes\r\n      this.isRollEnd = state.roller.roundAllEnd\r\n      return {\r\n        isShowAutoLaunch: state.game.isShowAutoLaunch,\r\n        isWaiting: state.game.isWaiting,\r\n        autoLauncherType: state.game.autoLauncherType\r\n      }\r\n    })\r\n    return this\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default AutoLauncherViewModel\r\n"]}