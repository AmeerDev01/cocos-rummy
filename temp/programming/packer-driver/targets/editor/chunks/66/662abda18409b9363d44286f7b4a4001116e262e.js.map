{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/ShopViewModel.ts"],"names":["ShopViewModel","sys","ViewModel","SKT_MAG_TYPE","sktInstance","sktMsgListener","InputValidator","ToastType","addToastAction","setLoadingAction","getStore","lang","ModalBox","constructor","isDana","begin","add","GET_WITH_DRAW_CHANNEL","data","setProps","dataList","dispatch","isShow","RECHARGE_ORDER","Instance","show","url","openURL","content","write","k","WebSocketModule","WebSocketSendError","placeStr","type","ERROR","sendSktMessage","isLoading","setEvent","rechargeHandler","channelItem","amount","name","isDecimal","done","id","unMountCallBack","removeById","connect","inject","memberInfo","getState","state"],"mappings":"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","sourcesContent":["import { Node, sys } from \"cc\"\r\nimport ViewModel from \"../../base/ViewModel\"\r\nimport { Hall_ShopPanel, IProps, IEvent } from \"../components/Hall_ShopPanel\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport InputValidator from \"../../utils/InputValidator\"\r\nimport { ToastType, addToastAction, setLoadingAction } from \"../store/actions/baseBoard\"\r\nimport { getStore } from \"../store\"\r\nimport { baseBoardView, lang } from \"../index\"\r\nimport ModalBox from \"../../common/ModalBox\"\r\nimport { getPackageName, purchaseAppsflyerEvents } from \"../../common/bridge\"\r\n\r\nclass ShopViewModel extends ViewModel<Hall_ShopPanel, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_ShopPanel')\r\n  }\r\n  private isDana: boolean = false\r\n  protected begin() {\r\n    sktMsgListener.add(SKT_MAG_TYPE.GET_WITH_DRAW_CHANNEL, 'shop', (data) => {\r\n      this.setProps({\r\n        dataList: data\r\n      })\r\n      this.dispatch(setLoadingAction({ isShow: false }))\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.RECHARGE_ORDER, 'shop', (data) => {\r\n      this.dispatch(setLoadingAction({ isShow: false }))\r\n      if (data) {\r\n        if (!this.isDana) {\r\n          //DANA渠道不支持ifream\r\n          ModalBox.Instance().show({ url: data })\r\n        } else {\r\n          sys.openURL(data)\r\n        }\r\n      } else {\r\n        this.dispatch(addToastAction({ content: lang.write(k => k.WebSocketModule.WebSocketSendError, {}, { placeStr: \"network error\" }), type: ToastType.ERROR }))\r\n      }\r\n      // data && sys.openURL(data)\r\n      // data && ModalBox.Instance().show({ url: data })\r\n    })\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.GET_WITH_DRAW_CHANNEL, {}, { isLoading: true })\r\n    this.setEvent({\r\n      rechargeHandler: (channelItem, amount) => {\r\n        this.isDana = channelItem.name === \"DANA\" ? true : false\r\n        // 暂时不限制游客充值\r\n        // if (!baseBoardView.mainPanelViewModel.isTouristPass()) return\r\n        new InputValidator().begin().isDecimal(amount, false).done(() => {\r\n          sktInstance.sendSktMessage(SKT_MAG_TYPE.RECHARGE_ORDER, {\r\n            \"rechargeChannelId\": channelItem.id,\r\n            \"money\": amount\r\n          }, { isLoading: true })\r\n          // purchaseAppsflyerEvents(amount, 'IDR')\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack() {\r\n    sktMsgListener.removeById('shop')\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({ memberInfo: getStore().getState().memberInfo }, (state: StateType) => {\r\n      return {\r\n        memberInfo: state.memberInfo\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default ShopViewModel"]}