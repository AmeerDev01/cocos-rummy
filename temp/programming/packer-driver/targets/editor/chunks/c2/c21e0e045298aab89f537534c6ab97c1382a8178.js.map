{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fish/components/Fish_Getnewwwep.ts"],"names":["Label","Node","Sprite","Toggle","Vec3","_decorator","instantiate","sp","BaseComponent","createSkeleton","createSpriteAtlasNode","sourceManageSelector","ccclass","property","Fish_Getnewwwep","propertyNode","props_list","props_img_side","props","vipLevel","myBatteryId","textureConfig","batterySkinConfig","events","onClose","changeBattery","batteryId","start","initState","bindEvent","node","on","EventType","TOUCH_END","useProps","key","value","initBatteryList","bindUI","removeAllChildren","element","createBattery","skinConfig","itemNode","batteryNode","id","texture","src","spriteName","String","pattern","format","getComponent","Skeleton","setAnimation","ani1","setScale","angle","setSiblingIndex","isLock","vip","isChecked","enabled","getChildByName","string","name","active","grayscale","addChild","CLICK","e","update","deltaTime"],"mappings":"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","sourcesContent":["import { Label, Node, Sprite, Toggle, Vec3, _decorator, instantiate, sp } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { createSkeleton, createSpriteAtlasNode } from '../../../common/fish/FishTool';\r\nimport { sourceManageSelector } from '../index';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n}\r\n\r\nexport interface IProps {\r\n\tvipLevel?: number,\r\n\tmyBatteryId?: number,\r\n\ttextureConfig?: any,\r\n\tbatterySkinConfig?: any\r\n}\r\nexport interface IEvent {\r\n\tonClose: () => void,\r\n\tchangeBattery: (batteryId: number) => void\r\n}\r\n\r\n@ccclass('Fish_Getnewwwep')\r\nexport class Fish_Getnewwwep extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_list: new Node(),\r\n\t\tprops_img_side: new Node(),\r\n\t}\r\n\tpublic props: IProps = {\r\n\t\tvipLevel: 0,\r\n\t\tmyBatteryId: 0,\r\n\t\ttextureConfig: null,\r\n\t\tbatterySkinConfig: null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonClose: () => { },\r\n\t\tchangeBattery: (batteryId: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onClose();\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps | '_setDone', value: { pre: any, cur: any }) {\r\n\t\tif (key === '_setDone') {\r\n\t\t\tthis.initBatteryList();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\tprivate initBatteryList() {\r\n\t\tthis.propertyNode.props_list.removeAllChildren();\r\n\t\tfor (const key in this.props.batterySkinConfig) {\r\n\t\t\tconst element = this.props.batterySkinConfig[key];\r\n\t\t\tthis.createBattery(element);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createBattery(skinConfig) {\r\n\t\tconst itemNode = instantiate(this.propertyNode.props_img_side);\r\n\t\tlet batteryNode: Node;\r\n\t\tif (skinConfig.id === 0) {\r\n\t\t\tconst texture = this.props.textureConfig[skinConfig.src]\r\n\t\t\tconst spriteName = String(texture.pattern).format(1);\r\n\t\t\tbatteryNode = createSpriteAtlasNode(sourceManageSelector(), itemNode, texture, spriteName);\r\n\t\t} else {\r\n\t\t\tbatteryNode = createSkeleton(sourceManageSelector(), itemNode, skinConfig.src)\r\n\t\t\tbatteryNode.getComponent(sp.Skeleton).setAnimation(0, skinConfig.ani1, true);\r\n\t\t\tbatteryNode.setScale(new Vec3(0.8, 0.8))\r\n\t\t}\r\n\t\tbatteryNode.angle = 90;\r\n\t\tbatteryNode.setSiblingIndex(0);\r\n\r\n\t\tconst isLock = this.props.vipLevel < skinConfig.vip;\r\n\r\n\t\titemNode.getComponent(Toggle).isChecked = !isLock;\r\n\t\titemNode.getComponent(Toggle).enabled = !isLock\r\n\t\titemNode.getChildByName(\"txt_title\").getComponent(Label).string = skinConfig.name;\r\n\t\titemNode.getChildByName(\"txt_vip\").getComponent(Label).string = 'VIP ' + skinConfig.vip;\r\n\t\titemNode.getChildByName(\"img_unlock\").active = !isLock;\r\n\t\titemNode.getChildByName(\"img_using\").active = this.props.myBatteryId === skinConfig.id;\r\n\t\titemNode.getChildByName(\"img_lock\").active = isLock;\r\n\t\titemNode.getChildByName(\"img_lock_hedi\").active = isLock;\r\n\t\titemNode.getComponent(Sprite).grayscale = isLock\r\n\r\n\t\tthis.propertyNode.props_list.addChild(itemNode);\r\n\r\n\t\titemNode.on(Toggle.EventType.CLICK, (e: Toggle) => {\r\n\t\t\tif (e.isChecked) {\r\n\t\t\t\tif (skinConfig.id !== this.props.myBatteryId) {\r\n\t\t\t\t\tthis.events.changeBattery(skinConfig.id);\r\n\t\t\t\t}\r\n\t\t\t\tthis.events.onClose();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t}\r\n}\r\n\r\n"]}