{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dfdc/components/BlessedWealthy_roller.ts"],"names":["_decorator","Mask","Node","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","GameType","SMALLGAME","RollerIconViewModel","sourceManageSeletor","PrefabPathDefine","config","endRollingAction","setRollSpeed","ccclass","property","BlessedWealthy_roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","rollerHeight","rollConfig","normalRollOption","propertyNode","props_roller","props_dfdc_honghuodakuang","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","isSpeedUp","stopMode","isSortStop","iconYuanBaoEffectData","iconFreeGameEffectData","iconEffectItemData","viewGameType","freeGamePositionId","CHOSSE0","isJumpStop","events","rollStart","rollEnd","rollerIndex","start","initState","roundEnd","bindEvent","useProps","key","value","pre","direction","DOWN","cur","iconQueue","length","initRoller","rolling","comp","node","position","y","UP","getRollerHeight","creator","setState","stopIconIndex","bringForwardEnd","dispatch","filter","i","isUnMount","l","index","item","indexOf","setProps","iconYuanBaoEffect","iconFreeGameEffect","iconViewModel","joinIcon","insideCount","children","active","getPosition","iconData","itemHeight","getComponent","height","intervalHeight","setPosition","x","width","left","intervalWidth","right","stopSpeed","SUBGAME1","iconId","uiData","fileName","mountView","getFile","ICON","source","appendTo","connect","speed","push","cache","bindUI","useState","enabled","window","setInterval","iconMv","undefined","update","deltaTime","forEach","_node","z","queueIndex","unMount","then","singleRollerHeight","singleIntervalHeight","to","easing","call","state","getRoundEnd","onDestroy","clearInterval"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Mask, Node, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType, GameType, SMALLGAME } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { playFastRoller, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction, setRollSpeed } from '../store/actions/roller';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tisSpeedUp?: boolean,\r\n\tstopMode: 'index' | 'jump'\r\n\tisSortStop: boolean\r\n\ticonYuanBaoEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\ticonFreeGameEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\ticonEffectItemData?:{\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tviewGameType: GameType,\r\n\tfreeGamePositionId: SMALLGAME,\r\n\tisJumpStop: boolean,\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n}\r\n\r\n@ccclass('BlessedWealthy_roller')\r\nexport class BlessedWealthy_roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\t// private coordList: Array<number> = []\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\tprops_dfdc_honghuodakuang:new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tisSpeedUp: false,\r\n\t\tstopMode: 'jump',\r\n\t\tisSortStop: false,\r\n\t\ticonYuanBaoEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\ticonFreeGameEffectData:{\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\ticonEffectItemData:{\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tviewGameType: GameType.NONE,\r\n\t\tfreeGamePositionId: SMALLGAME.CHOSSE0,\r\n\t\tisJumpStop:false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\trollEnd: (rollerIndex: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\t//更新\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\t\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\t// console.log(\"this.props.isJumpStop isSortStop\",this.props.isSortStop);\r\n\t\t\t\t\t// // if (!this.props.isSortStop) {\r\n\t\t\t\t\t// \tplayFastRoller()\r\n\t\t\t\t\t// // }\r\n\t\t\t\t\tthis.events.rollStart()\r\n\t\t\t\t}\r\n\t\t\t\tif (value.pre.rolling === true && value.cur.rolling === false) {\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (value.pre.stopIconIndex !== value.cur.stopIconIndex) {\r\n\t\t\t\t\tif (this.props.stopMode === \"jump\") {\r\n\t\t\t\t\t\t// 放弃这种模式(控制跳跃的距离来实现步停)\r\n\t\t\t\t\t\tthis.bringForwardEnd(this.props.rollerType, 2)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dispatch(setRollSpeed(this.props.isSpeedUp ? 1.5 : 1))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectItemData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconEffectItemData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconYuanBaoEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconYuanBaoEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconYuanBaoEffect: this.props.iconYuanBaoEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconYuanBaoEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconFreeGameEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconFreeGameEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconFreeGameEffect: this.props.iconFreeGameEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconFreeGameEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**主要用于初始化的时候 */\r\n\tprivate creator() {\r\n\t\tconst iconViewModel = this.joinIcon()\r\n\t\tconst insideCount = this.propertyNode.props_roller.children.filter(i => i.active).length - 1\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -this.getRollerHeight() + (itemHeight / 2) + (insideCount * itemHeight), 1))\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -(insideCount * itemHeight) - (itemHeight / 2), 1))\r\n\t\t}\r\n\t\t// this.coordList.push(iconViewModel.comp.node.position.y)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**初始化 */\r\n\tprivate initRoller() {\r\n\t\t//取队列最后n个图标\t \r\n\t\tthis.rollConfig = config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\t\t// this.propertyNode.props_daqipao.active = this.props.rollerType.LargeRoller\r\n\r\n\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t}\r\n\t}\r\n\t/**提前结束,这个停止方式，应该只支持indexTrgger这种触发方案 */\r\n\tprivate bringForwardEnd(rollerType: RollerType, stopSpeed: number = 4) {\r\n\t\tif (rollerType.stopIconIndex + stopSpeed >= this.props.rollerType.iconQueue.length) {\r\n\t\t\tif (rollerType.stopIconIndex === this.props.rollerType.iconQueue.length) {\r\n\t\t\t\tthis.nextJoinIconIndex = 2;\r\n\t\t\t} else {\t\t\t\t\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.iconQueue.length - rollerType.stopIconIndex\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 添加图标\r\n\t * @returns \r\n\t */\r\n\tprivate joinIcon() {\r\n\t\t//下一个要加入的图标\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex];\t\r\n\t\t// 进入小游戏凤凰图标资源更改\r\n\t\tif (this.props && this.props.viewGameType === GameType.SUBGAME1 && iconData && iconData.iconId === 12) {\r\n\t\t\tif (this.props && this.props.freeGamePositionId > 0) {\r\n\t\t\t\ticonData.uiData.fileName = `img/rollerIcon/wild/tubiao_xyx_niao${this.props.freeGamePositionId}`\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst iconViewModel = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source).appendTo(this.propertyNode.props_roller).setProps({ iconData }).connect()\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\t//icon的高度加上上下纵向高度\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY + itemHeight - this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex--\r\n\t\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t\tthis.compensation = iconViewModel.comp.node.position.y\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY - itemHeight + this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex++\r\n\t\t\tthis.nextJoinIconIndex === this.props.rollerType.iconQueue.length  && (this.nextJoinIconIndex = 0)\r\n\t\t}\r\n\t\tthis.displayIconList.push(iconViewModel)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns \r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\t\t}, [\"roundEnd\"])\r\n\t\t!this.timer_clear && (this.timer_clear = window.setInterval(() => {\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(iconMv => {\r\n\t\t\t\tif (iconMv.isUnMount) {\r\n\t\t\t\t\ticonMv = undefined\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t}, 200))\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.props.rollerType.rolling) {\r\n\t\t\tthis.displayIconList.filter(item => item.comp.node && item.comp.node.active).forEach((iconMv, i) => {\r\n\t\t\t\tconst _node = iconMv.comp.node\r\n\t\t\t\tconst { x, y, z } = _node.getPosition()\r\n\t\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t// console.log(this.props.rollerType.index, 'delete icon')\r\n\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -this.getRollerHeight(true) + (i - 0.5) * itemHeight, z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\t\t\t// 超出的要删除\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t\tif (!this.state.roundEnd && this.displayIconList.length - 1 === i) {\r\n\t\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t\t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y + this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t//恢复到默认位置并对齐，第一个元素是最上面那个\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -itemHeight * (i - 0.5), z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t\t// this.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n\r\n"]}