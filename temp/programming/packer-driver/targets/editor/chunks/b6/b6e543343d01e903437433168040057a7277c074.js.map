{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_SignIn.ts"],"names":["Animation","Button","Label","Node","Sprite","_decorator","log","BaseComponent","Throttler","ApiUrl","global","sourceManageSeletor","ccclass","property","Hall_SignIn","propertyNode","props_btn_close","props_btn_menerima","props_btn_unMenerima","props_spr_signIn_vipbg","props_vip_num","props_vip_level","props","memberInfo","signInDatas","signSuccess","events","requestGetSignInList","requestSign","weekType","close","onChangeGold","value","start","initState","bindEvent","node","on","EventType","TOUCH_END","openVipMain","getSignInWeekType","isDebouncerAsync","SIGN_IN","then","isPass","setState","state","updateSignStatus","active","updatePositionStatus","signInDataType","getWeekType","day","type","status","gold","signNode","getSignInNode","goldNode","getChildByName","unclaimedNode","alreadyNode","getComponent","string","formatAmountWithLetter","grayscale","nodename","playSignInAnimaton","play","setSiblingIndex","signInData","find","v","getDay","vipLevel","vip","vipGold","WeekType","SUNDAY","FINISHED","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","ULTIMATE","isSignSunday","init","datas","signDay","tap","forEach","updateChangeVip","scheduleOnce","lastSignDay","reverse","useProps","key","newData","cur","length","signType","spriteFrame","getFile","source","bindUI","children","filter","name","startsWith","update","deltaTime"],"mappings":"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","sourcesContent":["import { Animation, Button, Label, Node, Sprite, _decorator, log } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport Throttler from '../../utils/Throttler';\r\nimport { ApiUrl } from '../apiUrl';\r\nimport { global, sourceManageSeletor } from '../index';\r\nimport { InitStateType } from '../store/actions/memberInfo';\r\nimport { SpriteFramePathDefine } from '../sourceDefine/spriteDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport type SignInDataType = {\r\n\t/**金币 */\r\n\tgold: number,\r\n\t/**签到时间 周一到周天 */\r\n\tday: number,\r\n\t/**签到状态 0:未签到  1:已签到 2: 已过期 */\r\n\tstatus: number,\r\n\t/**是否可以点击 (0:否 ,1:是) */\r\n\ttap: number,\r\n\tvip: number,\r\n\tvipGold: number,\r\n}\r\n\r\nexport const enum WeekType {\r\n\tMONDAY = 'monday',\r\n\tTUESDAY = 'tuesday',\r\n\tWEDNESDAY = 'wednesday',\r\n\tTHURSDAY = 'thursday',\r\n\tFRIDAY = 'friday',\r\n\tSATURDAY = 'saturday',\r\n\tSUNDAY = 'sunday',\r\n\tULTIMATE = 'ultimate',\r\n}\r\n\r\nexport interface IState {\r\n\t/**当前签到类型 */\r\n\tweekType: WeekType,\r\n}\r\n\r\nexport interface IProps {\r\n\tmemberInfo?: InitStateType,\r\n\tsignInDatas?: SignInDataType[],\r\n\t/**签到成功 */\r\n\tsignSuccess?: boolean,\r\n}\r\nexport interface IEvent {\r\n\trequestGetSignInList: () => void,\r\n\trequestSign: (weekType: WeekType) => void,\r\n\tclose: () => void,\r\n\tonChangeGold: (value: number) => void,\r\n}\r\n\r\n@ccclass('Hall_SignIn')\r\nexport class Hall_SignIn extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_close: new Button(),\r\n\t\tprops_btn_menerima: new Button(),\r\n\t\tprops_btn_unMenerima: new Node(),\r\n\t\tprops_spr_signIn_vipbg: new Node(),\r\n\t\tprops_vip_num: new Label(),\r\n\t\tprops_vip_level: new Sprite(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tmemberInfo: null,\r\n\t\tsignInDatas: [],\r\n\t\tsignSuccess: false,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trequestGetSignInList: () => { },\r\n\t\trequestSign: (weekType: WeekType) => { },\r\n\t\tclose: () => { },\r\n\t\tonChangeGold: (value: number) => { },\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tweekType: null\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_close.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.close();\r\n\t\t});\r\n\t\tthis.propertyNode.props_spr_signIn_vipbg.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.close();\r\n\t\t\tglobal.openVipMain();\r\n\t\t});\r\n\t\tthis.propertyNode.props_btn_menerima.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tconst weekType = this.getSignInWeekType();\r\n\t\t\t// 签到防抖\r\n\t\t\tThrottler.isDebouncerAsync(ApiUrl.SIGN_IN + weekType, 500, true, () => {\r\n\t\t\t}).then(isPass => {\r\n\t\t\t\tthis.setState({ weekType });\r\n\t\t\t\tthis.events.requestSign(this.state.weekType);\r\n\t\t\t\tthis.updateSignStatus(false);\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 更新签到状态\r\n\t * @param active \r\n\t */\r\n\tprivate updateSignStatus(active: boolean) {\r\n\t\tthis.propertyNode.props_btn_menerima.node.active = active;\r\n\t\tthis.propertyNode.props_btn_unMenerima.active = !active;\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param weekType 星期类型\r\n\t * @param type 0：待签到，1：已签到 2：已过期\r\n\t * @param gold 显示的金币\r\n\t */\r\n\tprivate updatePositionStatus(signInDataType: SignInDataType) {\r\n\t\tconst weekType = this.getWeekType(signInDataType.day);\r\n\t\tconst type = signInDataType.status;\r\n\t\tconst gold = signInDataType.gold;\r\n\r\n\t\tconst signNode = this.getSignInNode(weekType);\r\n\t\tsignNode.active = true;\r\n\t\tconst goldNode = signNode.getChildByName(\"label_gold\");\r\n\t\tconst unclaimedNode = signNode.getChildByName(\"spr_unclaimed\");\r\n\t\tconst alreadyNode = signNode.getChildByName(\"spr_already\");\r\n\t\tgoldNode.active = false;\r\n\t\tunclaimedNode.active = false;\r\n\t\talreadyNode.active = false;\r\n\r\n\t\tif (type === 0) {\r\n\t\t\tgoldNode.active = true;\r\n\t\t\tgoldNode.getComponent(Label).string = gold.formatAmountWithLetter();\r\n\t\t} else if (type === 1) {\r\n\t\t\tsignNode.getChildByName('qiandao_dailingqu').active = false;\r\n\t\t\tsignNode.getChildByName('spr_gold').getComponent(Sprite).grayscale = true;\r\n\t\t\talreadyNode.active = true;\r\n\t\t} else if (type === 2) {\r\n\t\t\tsignNode.getChildByName('qiandao_dailingqu').active = false;\r\n\t\t\tsignNode.getChildByName('spr_gold').getComponent(Sprite).grayscale = true;\r\n\t\t\tunclaimedNode.active = true;\r\n\t\t} else {\r\n\t\t\tgoldNode.active = true;\r\n\t\t\tgoldNode.getComponent(Label).string = gold.formatAmountWithLetter();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSignInNode(nodename: WeekType) {\r\n\t\treturn this.node.getChildByName(\"Layout_\" + nodename);\r\n\t}\r\n\r\n\t/**播放签到动画 */\r\n\tprivate playSignInAnimaton(weekType: WeekType) {\r\n\t\tif (!weekType) return;\r\n\t\tconst signNode = this.getSignInNode(weekType);\r\n\t\tsignNode.getComponent(Animation).play();\r\n\t\tsignNode.setSiblingIndex(99);\r\n\r\n\t\tconst signInData = this.props.signInDatas.find(v => v.day === this.getDay(weekType));\r\n\t\tlet gold = signInData ? signInData.gold : 0;\r\n\r\n\t\tif (this.props.memberInfo.vipLevel >= signInData.vip) {\r\n\t\t\tgold += signInData.vipGold;\r\n\t\t}\r\n\r\n\t\t// 动画播放完成之后关闭窗口，星期天播放之后不马上关闭\r\n\t\tif (WeekType.SUNDAY !== weekType) {\r\n\t\t\tsignNode.getComponent(Animation).on(Animation.EventType.FINISHED, () => {\r\n\t\t\t\tthis.events.onChangeGold(gold);\r\n\t\t\t\tthis.events.close();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.events.onChangeGold(gold);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getWeekType(day: number) {\r\n\t\tif (day === 1) {\r\n\t\t\treturn WeekType.MONDAY;\r\n\t\t} else if (day === 2) {\r\n\t\t\treturn WeekType.TUESDAY;\r\n\t\t} else if (day === 3) {\r\n\t\t\treturn WeekType.WEDNESDAY;\r\n\t\t} else if (day === 4) {\r\n\t\t\treturn WeekType.THURSDAY;\r\n\t\t} else if (day === 5) {\r\n\t\t\treturn WeekType.FRIDAY;\r\n\t\t} else if (day === 6) {\r\n\t\t\treturn WeekType.SATURDAY;\r\n\t\t} else if (day === 7) {\r\n\t\t\treturn WeekType.SUNDAY;\r\n\t\t} else if (day === 8) {\r\n\t\t\treturn WeekType.ULTIMATE;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getDay(weekType: WeekType) {\r\n\t\tif (WeekType.MONDAY === weekType) {\r\n\t\t\treturn 1;\r\n\t\t} else if (WeekType.TUESDAY === weekType) {\r\n\t\t\treturn 2;\r\n\t\t} else if (WeekType.WEDNESDAY === weekType) {\r\n\t\t\treturn 3;\r\n\t\t} else if (WeekType.THURSDAY === weekType) {\r\n\t\t\treturn 4;\r\n\t\t} else if (WeekType.FRIDAY === weekType) {\r\n\t\t\treturn 5;\r\n\t\t} else if (WeekType.SATURDAY === weekType) {\r\n\t\t\treturn 6;\r\n\t\t} else if (WeekType.SUNDAY === weekType) {\r\n\t\t\treturn 7;\r\n\t\t} else if (WeekType.ULTIMATE === weekType) {\r\n\t\t\treturn 8;\r\n\t\t}\r\n\t}\r\n\r\n\t/**是否星期天签到 */\r\n\tprivate isSignSunday() {\r\n\t\treturn this.props.signInDatas.find(v => v.day === this.getDay(WeekType.SUNDAY));\r\n\t}\r\n\r\n\tprivate init(datas: SignInDataType[]) {\r\n\t\t// 可以签到的某一天\r\n\t\tconst signDay = datas.find(v => v.tap === 1);\r\n\t\tdatas.forEach(v => {\r\n\t\t\tthis.updatePositionStatus(v);\r\n\t\t})\r\n\t\tif (signDay) {\r\n\t\t\t// 如果是第8天，表示已经连续签到第7天，直接请求最后一次签到\r\n\t\t\tif (signDay.day === this.getDay(WeekType.ULTIMATE)) {\r\n\t\t\t\tthis.events.requestSign(WeekType.ULTIMATE);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.updateSignStatus(true);\r\n\t\t\tthis.updateChangeVip(signDay.vip);\r\n\t\t\tthis.propertyNode.props_vip_num.string = '+' + signDay.vipGold.formatAmountWithLetter();\r\n\t\t} else {\r\n\t\t\tthis.updateSignStatus(false);\r\n\t\t\t// 初始化没有可签到的选项时，同时上一次又是签到的星期天，就直接关闭窗口\r\n\t\t\t// 出现这种情况就是签到了星期天，但是没有连续签到7天\r\n\t\t\tif (this.state.weekType === WeekType.SUNDAY) {\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.events.close();\r\n\t\t\t\t}, 0.5);\r\n\t\t\t}\r\n\t\t\tconst lastSignDay = [...datas].reverse().find(v => v.status === 1)\r\n\t\t\tthis.updateChangeVip(lastSignDay.vip);\r\n\t\t\tthis.propertyNode.props_vip_num.string = '+' + lastSignDay.vipGold.formatAmountWithLetter();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSignInWeekType() {\r\n\t\tconst signDay = this.props.signInDatas.find(v => v.tap === 1);\r\n\t\treturn signDay && this.getWeekType(signDay.day);\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: Partial<IState>, cur: Partial<IState> }) {\r\n\t\tlog(\"signin use props\", key, value);\r\n\t\tif (key === 'signInDatas') {\r\n\t\t\tconst newData = value.cur as SignInDataType[];\r\n\t\t\tif (newData.length > 0) {\r\n\t\t\t\tthis.init(newData);\r\n\t\t\t}\r\n\t\t} else if (key === 'signSuccess' && value.cur) {\r\n\t\t\tconst signType = this.getSignInWeekType();\r\n\t\t\tthis.playSignInAnimaton(signType);\r\n\r\n\t\t\t// 星期天签到之后再请求一次，看能不能完成连续签到\r\n\t\t\tif (WeekType.SUNDAY === signType) {\r\n\t\t\t\tthis.events.requestGetSignInList();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateChangeVip(vipLevel: number) {\r\n\t\tvipLevel = vipLevel ? vipLevel : 0;\r\n\t\tthis.propertyNode.props_vip_level.spriteFrame = sourceManageSeletor('common').getFile(`resource/vip/b_VIP${vipLevel}/spriteFrame`).source;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.updateSignStatus(false);\r\n\t\tthis.node.children.filter(v => v.name.startsWith(\"Layout_\")).forEach(v => v.active = false);\r\n\t}\r\n\r\n\tupdate(deltaTime: number) { }\r\n}\r\n\r\n"]}