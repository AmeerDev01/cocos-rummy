{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfc/Slot/Component/gxfc_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Prefab","tween","UIOpacity","Vec3","BaseComponent","AudioManager","SoundList","getSpeedTime","ccclass","property","gxfc_RollerPanel","rollerList","isSpeed","layout2List","bindUI","rollerData","getRollProxy","getRepository","layout","node","getComponent","forEach","roller","index","rollerNode","bindRollerData","setPosition","position","y","root","addChild","push","ui","parent","addComponent","opacity","target","to","call","start","startAllRoll","stopIndexArr","getInstance","playSound","rollerFast","i","startRoll","togglesALLLayer","state","togglesThePopUpLayerState","stopAllRoll","isManualStop","callBack","stopRoll","time","isEnd","length","rollerComp","rollerIndex","isValid","wildRollerId","includes","addDockIcon","freeWildRollerId","showLayout2","scheduleOnce","iconFlicker","mode","targetArr","allstate","cb","setIconEffect","layout2flashing","setTimeout","clearStatus","iconDock","setIconBG","bgNameIndex","setBg","uninstall","done","destroy","bindEvent","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { ProxyDefine } from '../Const/ProxyDefine';\r\nimport BaseComponent from './BaseComponent';\r\nimport { gxfc_Roller } from './gxfc_Roller';\r\nimport { RollerType } from '../Repositories/SlotRepository';\r\nimport {AudioManager, SoundList} from \"../Managr/AudioManager\";\r\nimport { getSpeedTime } from '../../../../utils/SlotSpeedConfig';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('gxfc_RollerPanel')\r\nexport class gxfc_RollerPanel extends BaseComponent {\r\n\t@property(Prefab)\r\n\troller: Prefab = null\r\n\r\n\tpublic rollerList: Array<Node> = []\r\n\tprivate isSpeed;\r\n    private layout2List:any\r\n\tprotected bindUI(): void {\r\n\t\tconst rollerData = this.getRollProxy().getRepository()\r\n\t\tconst layout = this.node.getComponent(Layout)\r\n\t\t// layout.spacingX = 35\r\n\t\trollerData.rollerList.forEach((roller, index) => {\r\n\t\t\tconst rollerNode = instantiate(this.roller);\r\n\t\t\t(rollerNode.getComponent(\"gxfc_Roller\") as gxfc_Roller).bindRollerData(index, roller)\r\n\t\t\trollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n\t\t\tthis.root.addChild(rollerNode)\r\n\t\t\tthis.rollerList.push(rollerNode)\r\n\t\t})\r\n\r\n\r\n\t\t// const rollerNode = instantiate(this.roller);\r\n\t\t// (rollerNode.getComponent(\"Roller\") as Roller).bindRollerData(0, rollerData.rollerList.data[0])\r\n\t\t// rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n\t\t// this.root.addChild(rollerNode)\r\n\t\t// this.rollerList.push(rollerNode)\r\n\t\tconst ui = this.node.parent.addComponent(UIOpacity)\r\n\t\t// const ui = this.node.parent.getComponent(UIOpacity)\r\n\t\tui.opacity = 0;\r\n\t\ttween().target(ui).to(0.5, { opacity: 255 }).call(() => { }).start()\r\n\t}\r\n\r\n\t/**所有的滑槽都开始转动，传入停止信号发出后要停止的序列号(从1开始) */\r\n\tpublic startAllRoll(stopIndexArr: number[], isSpeed: boolean = false) {\r\n\t\tthis.isSpeed = isSpeed;\r\n        AudioManager.getInstance().playSound(SoundList.rollerFast);\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).startRoll(stopIndexArr[i], isSpeed)\r\n\t\t})\r\n\t}\r\n    public togglesALLLayer(state:boolean){\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).togglesThePopUpLayerState(state)\r\n        })\r\n    }\r\n\t/**发出停止的信号（启动的时候已经传入了停止位置，不是马上停止，转到位置才停，这里需要传入闪动的图标队列） */\r\n\tpublic stopAllRoll(isManualStop: boolean, callBack: () => void) {\r\n\t\tif(isManualStop){\r\n\t\t\tthis.isSpeed = true;\r\n\t\t}\r\n\t\tthis.stopRoll(0, callBack);\r\n\t}\r\n\t\r\n\tprivate stopRoll(i: number, callBack: () => void){\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = getSpeedTime(this.isSpeed)\r\n\t\tconst isEnd = i >= this.rollerList.length - 1;\r\n\t\tconst rollerComp = this.rollerList[i].getComponent(\"gxfc_Roller\") as gxfc_Roller;\r\n\t\trollerComp.stopRoll((rollerIndex: number, rollerData: RollerType) => {\r\n\t\t\t\tif(this.node.isValid){\r\n\t\t\t\t\t\tif(isEnd){\r\n\t\t\t\t\t\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t\t\t\t\t\tif( this.layout2List.wildRollerId.length>0){\r\n\t\t\t\t\t\t\t\t\t\tthis.layout2List.wildRollerId.includes(i)&&(<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).addDockIcon(0)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif( this.layout2List.freeWildRollerId.length>0){\r\n\t\t\t\t\t\t\t\t\t\tthis.layout2List.freeWildRollerId.includes(i)&&(<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).addDockIcon(1)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tcallBack()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t})\r\n\t\trollerComp.showLayout2();\r\n\t\tthis.scheduleOnce(()=>{\r\n\t\t\t\tif(this.node.isValid){\r\n\t\t\t\t\t\tif(!isEnd){\r\n\t\t\t\t\t\t\t\tthis.stopRoll(i+1, callBack)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t}, time)\r\n}\r\n\r\n\t/**图标闪动 */\r\n\tpublic iconFlicker(mode: 'index' | 'coord', targetArr: number[][], allstate: boolean = false, cb?) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect(mode, [],true)\r\n            if (targetArr[i].length && allstate) {\r\n                (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect(mode, targetArr[i]);\r\n                (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).layout2flashing(targetArr[i])\r\n                setTimeout(() => {\r\n                    this.clearStatus()\r\n                    cb()\r\n                }, 1000)\r\n            } else if (targetArr[i].length) {\r\n                (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect(mode, targetArr[i], true);\r\n            }\r\n        })\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect(mode, []);\r\n            targetArr[i].length && (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect(mode, targetArr[i])\r\n\t\t});\r\n\t}\r\n    public clearStatus(){\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setIconEffect('coord', [],true)\r\n        })\r\n    }\r\n\t/**图标定住 */\r\n\tpublic iconDock(mode: 'index' | 'coord', targetArr) {\r\n        this.layout2List=targetArr;\r\n\t}\r\n    public setIconBG(bgNameIndex){\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<gxfc_Roller>roller.getComponent(\"gxfc_Roller\")).setBg(bgNameIndex)\r\n        })\r\n    }\r\n\t/**卸载面板(淡出) */\r\n\tpublic uninstall(done?: () => void) {\r\n\t\tconst ui = this.node.parent.getComponent(UIOpacity)\r\n\t\ttween().target(ui).to(0.5, { opacity: 0 }).call(() => {\r\n\t\t\t// this.node.parent.removeAllChildren()\r\n\t\t\tthis.node.parent.destroy()\r\n\t\t\tdone && done()\r\n\t\t}).start()\r\n\r\n\t\t// tween().target(icon).to(0.5, {\r\n\t\t// \tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n\t\t// }, {\r\n\t\t// \teasing: \"backOut\"//\"elasticOut\"\r\n\t\t// }).call(() => {\r\n\t\t// \tcount++\r\n\t\t// \tif (count === this.RollerLayOut.children.length) {\r\n\t\t// \t\tthis.stopCallBack()\r\n\t\t// \t}\r\n\t\t// }).start()\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\n"]}