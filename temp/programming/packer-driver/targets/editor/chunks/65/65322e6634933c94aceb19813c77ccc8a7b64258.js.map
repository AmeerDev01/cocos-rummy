{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/FishGold.ts"],"names":["FishGold","Animation","AnimationClip","Node","Vec3","createAnimationNode","toNodeSpaceAR","ActionEffectPlayer","sqrt","Math","pow","fishGoldZOrder","FishGoldCreate","create","info","constructor","uiRoot","sourceManage","fishGoldConfig","textureConfig","actionConfig","commonConfig","object_id","data_config","is_alive","end_call","end_pos","start_pos","spr_lst","rootNode","init","obj_id","id","i","view_inf","v","ani_cfg","src_id","setPosition","active","getDataId","getObjectId","setUseState","buse","getUseState","setPlayEndCall","call","getEndPos","play","spos","epos","an","getComponent","on","EventType","FINISHED","an2","defaultClip","wrapMode","WrapMode","Loop","off","act_id","resumeOrgin","length","stop","setSiblingIndex","parent","children","getEndMoveTime","x","y","gold_move_v","getSize","size","runLastEff"],"mappings":";;;6KAsBaA,Q;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAtBJC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;AAChCC,MAAAA,mB,iBAAAA,mB;AAAqDC,MAAAA,a,iBAAAA,a;;AAErDC,MAAAA,kB,iBAAAA,kB;;;;;;;;;AAGT;AACA;AACA;AACMC,MAAAA,I,GAAOC,IAAI,CAACD,I;AACZE,MAAAA,G,GAAMD,IAAI,CAACC,G;AAEXC,MAAAA,c,GAAiB,M;;gCAEVC,c,GAA6B;AACxCC,QAAAA,MAAM,EAAGC,IAAD,IAAU;AAChB,iBAAO,IAAId,QAAJ,EAAP;AACD;AAHuC,O,GAM1C;;;0BAEaA,Q,GAAN,MAAMA,QAAN,CAAe;AAiBpBe,QAAAA,WAAW,GAAG;AAAA,eAhBPC,MAgBO;AAAA,eAdNC,YAcM;AAAA,eAbNC,cAaM;AAAA,eAZNC,aAYM;AAAA,eAXNC,YAWM;AAAA,eAVNC,YAUM;AAAA,eATNC,SASM;AAAA,eARNC,WAQM;AAAA,eAPNC,QAOM;AAAA,eANNC,QAMM;AAAA,eALNC,OAKM;AAAA,eAJNC,SAIM;AAAA,eAHNC,OAGM;AAAA,eAFNC,QAEM;AACZ,eAAKb,MAAL,GAAc,IAAIb,IAAJ,EAAd;AACD;;AAEM2B,QAAAA,IAAI,CAAChB,IAAD,EAAOG,YAAP,EAAmCC,cAAnC,EAAmDC,aAAnD,EAAkEC,YAAlE,EAAgFC,YAAhF,EAA8FQ,QAA9F,EAA8G;AACvH,eAAKZ,YAAL,GAAoBA,YAApB;AACA,eAAKC,cAAL,GAAsBA,cAAtB;AACA,eAAKC,aAAL,GAAqBA,aAArB;AACA,eAAKC,YAAL,GAAoBA,YAApB;AACA,eAAKC,YAAL,GAAoBA,YAApB;AACA,eAAKC,SAAL,GAAiBR,IAAI,CAACiB,MAAtB;AACA,eAAKF,QAAL,GAAgBA,QAAhB;AACA,eAAKN,WAAL,GAAmB,KAAKL,cAAL,CAAoBJ,IAAI,CAACkB,EAAzB,CAAnB;AACA,eAAKR,QAAL,GAAgB,KAAhB;AACA,eAAKC,QAAL,GAAgB,IAAhB;AACA,eAAKC,OAAL,GAAe,IAAItB,IAAJ,EAAf;AACA,eAAKuB,SAAL,GAAiB,IAAIvB,IAAJ,EAAjB;AAEA,eAAKwB,OAAL,GAAe,EAAf;;AACA,eAAK,MAAMK,CAAX,IAAgB,KAAKV,WAAL,CAAiBW,QAAjC,EAA2C;AACzC,kBAAMC,CAAC,GAAG,KAAKZ,WAAL,CAAiBW,QAAjB,CAA0BD,CAA1B,CAAV;AACA,gBAAIG,OAAO,GAAGjB,aAAa,CAACgB,CAAC,CAACE,MAAH,CAA3B;AACA,iBAAKT,OAAL,CAAaK,CAAb,IAAkB;AAAA;AAAA,4DAAoB,KAAKhB,YAAzB,EAAuC,KAAKD,MAA5C,EAAoDoB,OAApD,EAA6D,KAA7D,EAAoE,KAApE,CAAlB;AACA,iBAAKR,OAAL,CAAaK,CAAb,EAAgBK,WAAhB,CAA4B,CAA5B,EAA+B,CAA/B;AACA,iBAAKV,OAAL,CAAaK,CAAb,EAAgBM,MAAhB,GAA0B,KAA1B;AACD;;AAED,eAAKvB,MAAL,CAAYuB,MAAZ,GAAqB,KAArB,CAvBuH,CAyBvH;AACD;;AAEMC,QAAAA,SAAS,GAAG;AACjB,iBAAO,KAAKjB,WAAL,CAAiBS,EAAxB;AACD;;AAEMS,QAAAA,WAAW,GAAG;AACnB,iBAAO,KAAKnB,SAAZ;AACD;;AAEMoB,QAAAA,WAAW,CAACC,IAAD,EAAO;AACvB,eAAKnB,QAAL,GAAgBmB,IAAhB;AACD;;AAEMC,QAAAA,WAAW,GAAG;AACnB,iBAAO,KAAKpB,QAAZ;AACD,SA/DmB,CAiEpB;;;AACOqB,QAAAA,cAAc,CAACC,IAAD,EAAO;AAC1B,eAAKrB,QAAL,GAAgBqB,IAAhB;AACD;;AAEMC,QAAAA,SAAS,GAAG;AACjB,iBAAO,KAAKrB,OAAZ;AACD;;AAEMsB,QAAAA,IAAI,CAACC,IAAD,EAAOC,IAAP,EAAa;AACtB;AACA,eAAKlC,MAAL,CAAYsB,WAAZ,CAAwB;AAAA;AAAA,8CAAc,KAAKT,QAAnB,EAA6BoB,IAA7B,CAAxB;AACA,eAAKjC,MAAL,CAAYuB,MAAZ,GAAsB,IAAtB;AACA,eAAKb,OAAL,GAAewB,IAAf;AACA,eAAKvB,SAAL,GAAiBsB,IAAjB;;AAEA,cAAI,KAAKrB,OAAL,CAAa,CAAb,KAAmB,KAAKA,OAAL,CAAa,CAAb,CAAvB,EAAwC;AACtC,iBAAKA,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,IAA1B;AACA,iBAAKX,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,KAA1B;AAEA,kBAAMY,EAAE,GAAG,KAAKvB,OAAL,CAAa,CAAb,EAAgBwB,YAAhB,CAA6BnD,SAA7B,CAAX;AACAkD,YAAAA,EAAE,CAACH,IAAH;AAEAG,YAAAA,EAAE,CAACE,EAAH,CAAMpD,SAAS,CAACqD,SAAV,CAAoBC,QAA1B,EAAoC,MAAM;AACxC,mBAAK3B,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,KAA1B;AACA,mBAAKX,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,IAA1B;AACA,oBAAMiB,GAAG,GAAG,KAAK5B,OAAL,CAAa,CAAb,EAAgBwB,YAAhB,CAA6BnD,SAA7B,CAAZ;AACAuD,cAAAA,GAAG,CAACC,WAAJ,CAAgBC,QAAhB,GAA2BxD,aAAa,CAACyD,QAAd,CAAuBC,IAAlD;AACAJ,cAAAA,GAAG,CAACR,IAAJ;AACAG,cAAAA,EAAE,CAACU,GAAH,CAAO5D,SAAS,CAACqD,SAAV,CAAoBC,QAA3B;AAEA;AAAA;AAAA,4DAAmBP,IAAnB,CAAwB,KAAKhC,MAA7B,EAAqC,MAAM;AACzC,oBAAI,KAAKS,QAAT,EAAmB;AACjB,uBAAKA,QAAL,CAAc,IAAd;AACD;AACF,eAJD,EAIG,KAAKL,YAAL,CAAkB,KAAKG,WAAL,CAAiBW,QAAjB,CAA0B,CAA1B,EAA6B4B,MAA/C,CAJH;AAKD,aAbD;AAcD;AACF;;AAEMC,QAAAA,WAAW,GAAG;AACnB;AACA,eAAK/C,MAAL,CAAYsB,WAAZ,CAAwB;AAAA;AAAA,8CAAc,KAAKT,QAAnB,EAA6B,IAAIzB,IAAJ,CAAS,CAAT,EAAY,CAAZ,CAA7B,CAAxB;AACA,eAAKY,MAAL,CAAYuB,MAAZ,GAAsB,KAAtB;AACA,eAAKb,OAAL,GAAe,IAAItB,IAAJ,EAAf;AACA,eAAKuB,SAAL,GAAiB,IAAIvB,IAAJ,EAAjB;AACA,eAAKqB,QAAL,GAAgB,IAAhB;;AAEA,eAAK,IAAIQ,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,KAAKV,WAAL,CAAiBW,QAAjB,CAA0B8B,MAA/C,EAAuD/B,CAAC,EAAxD,EAA4D;AAC1D,iBAAKL,OAAL,CAAaK,CAAb,EAAgBmB,YAAhB,CAA6BnD,SAA7B,EAAwCgE,IAAxC;AACA,iBAAKrC,OAAL,CAAaK,CAAb,EAAgBM,MAAhB,GAA0B,KAA1B;AACD;;AACD,eAAKvB,MAAL,CAAYkD,eAAZ,CAA4B,KAAKlD,MAAL,CAAYmD,MAAZ,CAAmBC,QAAnB,CAA4BJ,MAAxD;AACD;;AAEMK,QAAAA,cAAc,GAAG;AACtB,iBAAQ7D,IAAI,CAACE,GAAG,CAAC,KAAKiB,SAAL,CAAe2C,CAAf,GAAmB,KAAK5C,OAAL,CAAa4C,CAAjC,EAAoC,CAApC,CAAH,GAA4C5D,GAAG,CAAC,KAAKiB,SAAL,CAAe4C,CAAf,GAAmB,KAAK7C,OAAL,CAAa6C,CAAjC,EAAoC,CAApC,CAAhD,CAAJ,GAA8F,KAAKlD,YAAL,CAAkBmD,WAAxH;AACD;;AAEMC,QAAAA,OAAO,GAAG;AACf,iBAAO,KAAKlD,WAAL,CAAiBmD,IAAxB;AACD;;AAEMC,QAAAA,UAAU,GAAG;AAClB,cAAI,KAAK/C,OAAL,CAAa,CAAb,CAAJ,EAAqB;AACnB,iBAAKA,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,KAA1B;AACA,iBAAKX,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,KAA1B;AACA,iBAAKX,OAAL,CAAa,CAAb,EAAgBW,MAAhB,GAA0B,IAA1B;AAEA,kBAAMY,EAAE,GAAG,KAAKvB,OAAL,CAAa,CAAb,EAAgBwB,YAAhB,CAA6BnD,SAA7B,CAAX;AACAkD,YAAAA,EAAE,CAACH,IAAH;AAEAG,YAAAA,EAAE,CAACE,EAAH,CAAMpD,SAAS,CAACqD,SAAV,CAAoBC,QAA1B,EAAoC,MAAM;AACxC,mBAAKQ,WAAL;AACA,mBAAKrB,WAAL,CAAiB,KAAjB;AACAS,cAAAA,EAAE,CAACU,GAAH,CAAO5D,SAAS,CAACqD,SAAV,CAAoBC,QAA3B;AACD,aAJD;AAKD;AACF;;AA/ImB,O","sourcesContent":["import { Animation, AnimationClip, Node, Vec3 } from \"cc\"\r\nimport { createAnimationNode, createSpriteNode, getAnimation, toNodeSpaceAR } from \"./FishTool\"\r\nimport SourceManage from \"../../base/SourceManage\"\r\nimport { ActionEffectPlayer } from \"./ActionEffectPlayer\"\r\nimport { ICreateObj } from \"./ObjectPool\"\r\n\r\n/**\r\n  金币\r\n */\r\nconst sqrt = Math.sqrt\r\nconst pow = Math.pow\r\n\r\nconst fishGoldZOrder = 700000\r\n\r\nexport const FishGoldCreate: ICreateObj = {\r\n  create: (info) => {\r\n    return new FishGold();\r\n  }\r\n}\r\n\r\n//////////////////////////////////////////////////////-\r\n\r\nexport class FishGold {\r\n  public uiRoot: Node;\r\n\r\n  private sourceManage: SourceManage;\r\n  private fishGoldConfig;\r\n  private textureConfig;\r\n  private actionConfig;\r\n  private commonConfig;\r\n  private object_id;\r\n  private data_config;\r\n  private is_alive: boolean;\r\n  private end_call;\r\n  private end_pos: Vec3;\r\n  private start_pos: Vec3;\r\n  private spr_lst: Node[];\r\n  private rootNode: Node;\r\n\r\n  constructor() {\r\n    this.uiRoot = new Node();\r\n  }\r\n\r\n  public init(info, sourceManage: SourceManage, fishGoldConfig, textureConfig, actionConfig, commonConfig, rootNode: Node) {\r\n    this.sourceManage = sourceManage\r\n    this.fishGoldConfig = fishGoldConfig\r\n    this.textureConfig = textureConfig\r\n    this.actionConfig = actionConfig\r\n    this.commonConfig = commonConfig\r\n    this.object_id = info.obj_id\r\n    this.rootNode = rootNode\r\n    this.data_config = this.fishGoldConfig[info.id]\r\n    this.is_alive = false\r\n    this.end_call = null\r\n    this.end_pos = new Vec3();\r\n    this.start_pos = new Vec3();\r\n\r\n    this.spr_lst = []\r\n    for (const i in this.data_config.view_inf) {\r\n      const v = this.data_config.view_inf[i];\r\n      let ani_cfg = textureConfig[v.src_id]\r\n      this.spr_lst[i] = createAnimationNode(this.sourceManage, this.uiRoot, ani_cfg, false, false)\r\n      this.spr_lst[i].setPosition(0, 0)\r\n      this.spr_lst[i].active = (false)\r\n    }\r\n\r\n    this.uiRoot.active = false\r\n\r\n    // this.uiRoot.setSiblingIndex(fishGoldZOrder)\r\n  }\r\n\r\n  public getDataId() {\r\n    return this.data_config.id\r\n  }\r\n\r\n  public getObjectId() {\r\n    return this.object_id\r\n  }\r\n\r\n  public setUseState(buse) {\r\n    this.is_alive = buse\r\n  }\r\n\r\n  public getUseState() {\r\n    return this.is_alive\r\n  }\r\n\r\n  //call(obj)\r\n  public setPlayEndCall(call) {\r\n    this.end_call = call\r\n  }\r\n\r\n  public getEndPos() {\r\n    return this.end_pos\r\n  }\r\n\r\n  public play(spos, epos) {\r\n    // this.uiRoot.setWorldPosition(new Vec3(spos.x, spos.y))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, spos))\r\n    this.uiRoot.active = (true)\r\n    this.end_pos = epos\r\n    this.start_pos = spos\r\n\r\n    if (this.spr_lst[1] && this.spr_lst[2]) {\r\n      this.spr_lst[1].active = (true)\r\n      this.spr_lst[2].active = (false)\r\n\r\n      const an = this.spr_lst[1].getComponent(Animation)\r\n      an.play();\r\n\r\n      an.on(Animation.EventType.FINISHED, () => {\r\n        this.spr_lst[1].active = (false)\r\n        this.spr_lst[2].active = (true)\r\n        const an2 = this.spr_lst[2].getComponent(Animation);\r\n        an2.defaultClip.wrapMode = AnimationClip.WrapMode.Loop;\r\n        an2.play();\r\n        an.off(Animation.EventType.FINISHED);\r\n\r\n        ActionEffectPlayer.play(this.uiRoot, () => {\r\n          if (this.end_call) {\r\n            this.end_call(this)\r\n          }\r\n        }, this.actionConfig[this.data_config.view_inf[2].act_id])\r\n      })\r\n    }\r\n  }\r\n\r\n  public resumeOrgin() {\r\n    // this.uiRoot.setWorldPosition(new Vec3(0, 0));\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(0, 0)))\r\n    this.uiRoot.active = (false)\r\n    this.end_pos = new Vec3()\r\n    this.start_pos = new Vec3()\r\n    this.end_call = null\r\n\r\n    for (let i = 1; i <= this.data_config.view_inf.length; i++) {\r\n      this.spr_lst[i].getComponent(Animation).stop();\r\n      this.spr_lst[i].active = (false)\r\n    }\r\n    this.uiRoot.setSiblingIndex(this.uiRoot.parent.children.length)\r\n  }\r\n\r\n  public getEndMoveTime() {\r\n    return (sqrt(pow(this.start_pos.x - this.end_pos.x, 2) + pow(this.start_pos.y - this.end_pos.y, 2)) / this.commonConfig.gold_move_v)\r\n  }\r\n\r\n  public getSize() {\r\n    return this.data_config.size\r\n  }\r\n\r\n  public runLastEff() {\r\n    if (this.spr_lst[3]) {\r\n      this.spr_lst[1].active = (false)\r\n      this.spr_lst[2].active = (false)\r\n      this.spr_lst[3].active = (true)\r\n\r\n      const an = this.spr_lst[3].getComponent(Animation)\r\n      an.play();\r\n\r\n      an.on(Animation.EventType.FINISHED, () => {\r\n        this.resumeOrgin()\r\n        this.setUseState(false)\r\n        an.off(Animation.EventType.FINISHED);\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\n\r\n"]}