{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/PHOENIX111/components/phoenix_dialogWin.ts"],"names":["_decorator","Label","Node","sp","BaseComponent","sourceManageSeletor","Task","TaskSchedulerDefault","StepNumber","SkeletonAnimationPlayer","ccclass","property","phoenix_dialogWin","winnerConfig","numberStop","propertyNode","props_sb_lbjs_BIGWIN","props_slots_common_game_bw_gold","props_slots_goldNum","props_tongyong_bw","props_slots_jackPot_goldNum","props","winning","glodAmount","keepTime","events","killSelfHandler","start","initState","bindEvent","on","EventType","TOUCH_END","getComponent","string","formatAmountWithCommas","useProps","key","value","cur","titleSkeleton","Skeleton","skeletonData","getFile","fileName","source","count","id","playAnimation","joinqQueue","done","active","numNode","pre","num","toFixed","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, Node, Skeleton, sp, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { DialogType } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport SkeletonAnimationPlayer from '../SkeletonPlay';\r\nimport { log } from '../../../common/fish/CalculteRule';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\twinning?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t},\r\n\tglodAmount?: number,\r\n\tkeepTime?: number\r\n}\r\nexport interface IEvent {\r\n\t/**自灭弹窗 */\r\n\tkillSelfHandler: () => void\r\n}\r\n\r\n@ccclass('phoenix_dialogWin')\r\nexport class phoenix_dialogWin extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate winnerConfig: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t}[] = []\r\n\tprivate numberStop: boolean = false;\r\n\tprotected propertyNode = {\r\n\t\tprops_sb_lbjs_BIGWIN: new Node(),\r\n\t\tprops_slots_common_game_bw_gold: new Node(),\r\n\t\tprops_slots_goldNum: new Node(),\r\n\t\tprops_tongyong_bw: new Node(),\r\n\t\tprops_slots_jackPot_goldNum:new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\twinning: null,\r\n\t\tglodAmount: 0,\r\n\t\tkeepTime: 3000\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tkillSelfHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_sb_lbjs_BIGWIN.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tif (this.numberStop) {\r\n\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t} else {\r\n\t\t\t\tthis.propertyNode.props_slots_goldNum.getComponent(Label).string = this.props.glodAmount.formatAmountWithCommas()\r\n\t\t\t\tthis.numberStop = true;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"winning\") {\r\n\t\t\tthis.winnerConfig = value.cur\r\n\t\t\tif (value.cur) {\r\n\t\t\t\tconst titleSkeleton = this.propertyNode.props_sb_lbjs_BIGWIN.getComponent(sp.Skeleton)\r\n\t\t\t\ttitleSkeleton.skeletonData = sourceManageSeletor().getFile(this.props.winning.fileName[0]).source\r\n\t\t\t\t\r\n\t\t\t\tlet count = 0;\r\n\t\t\t\tif (value.cur.id === 4) {\r\n\t\t\t\t\tnew SkeletonAnimationPlayer(titleSkeleton, 'a2', true, () => {\r\n\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t// if (this.numberStop && count > 1) {\r\n\t\t\t\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}).playAnimation()\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\r\n\t\t\t\t\tnew SkeletonAnimationPlayer(titleSkeleton, 'animation', true, () => {\r\n\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t// if (this.numberStop && count > 1) {\r\n\t\t\t\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t}).playAnimation()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"glodAmount\") {\r\n\t\t\tthis.numberStop = false;\r\n\t\t\tif (this.props.winning.id === 4) {\r\n\t\t\t\tTaskSchedulerDefault().joinqQueue(new Task((done) => {\r\n\t\t\t\t\tthis.propertyNode.props_slots_goldNum.active = false;\r\n\t\t\t\t\tthis.propertyNode.props_slots_jackPot_goldNum.active = true;\r\n\t\t\t\t\tlet numNode = this.propertyNode.props_slots_jackPot_goldNum.getComponent(Label);\r\n\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\tthis.propertyNode && numNode && (numNode.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tthis.numberStop = true;\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t})).start()\r\n\t\t\t\t}), true)\r\n\t\t\t} else {\r\n\t\t\t\t\r\n\t\t\t\tTaskSchedulerDefault().joinqQueue(new Task((done) => {\r\n\t\t\t\t\tthis.propertyNode.props_slots_jackPot_goldNum.active = false;\r\n\t\t\t\t\tthis.propertyNode.props_slots_goldNum.active = true;\r\n\t\t\t\t\tlet numNode = this.propertyNode.props_slots_goldNum.getComponent(Label);\r\n\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\tthis.propertyNode && numNode && (numNode.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tthis.numberStop = true;\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t})).start()\r\n\t\t\t\t}), true)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n"]}