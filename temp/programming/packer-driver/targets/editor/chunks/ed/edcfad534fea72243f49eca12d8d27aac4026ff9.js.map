{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/yxx/components/Yxx_Head.ts"],"names":["_decorator","Label","Node","Sprite","tween","Vec3","BaseComponent","getGoldShorten","omitStr","SpriteFramePathDefine","AnimationStatus","config","gameCacheData","global","sourceManageSeletor","GameType","ccclass","property","Yxx_Head","propertyNode","props_gold","props_gold_up","props_name","props_head","props_btn_user","props_head_bg_1","props_head_bg_2","props_head_bg_3","props_head_bg_4","props","headType","betData","animationStatus","events","giveGift","value","memberId","num","start","initState","bindEvent","node","on","EventType","TOUCH_END","userId","showGiftWindow","YXX","head","icon","gold","name","userInfo","useProps","key","oldData","pre","newData","cur","changeUserType","level","string","gameOption","nicknameOmitLength","loadHead","isMyBet","index","joggle","HEAD_ADD_GOLD","isMe","playAddGlodAnimation","winloss","spriteFrame","getFile","DEFAULT_HEAD","source","loadHeadSprite","offset","to","position","active","bindUI","initLocation","location","setPosition","startPosition","x","y","getComponent","by","call","scheduleOnce","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,K,OAAAA,K;AAAYC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAqBC,MAAAA,K,OAAAA,K;AAAoBC,MAAAA,I,OAAAA,I;;AACvEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,c,iBAAAA,c;AAAiCC,MAAAA,O,iBAAAA,O;;AACjCC,MAAAA,qB,iBAAAA,qB;;AACAC,MAAAA,e,iBAAAA,e;;AACFC,MAAAA,M;;AACEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,mB,iBAAAA,mB;;AACmBC,MAAAA,Q,kBAAAA,Q;;;;;;;;;OACtB;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBjB,U;;0BAejBkB,Q,WADZF,OAAO,CAAC,UAAD,C,gBAAR,MACaE,QADb;AAAA;AAAA,0CACoE;AAAA;AAAA;AAAA,eAIzDC,YAJyD,GAI1C;AACxBC,YAAAA,UAAU,EAAE,IAAInB,KAAJ,EADY;AAExBoB,YAAAA,aAAa,EAAE,IAAInB,IAAJ,EAFS;AAGxBoB,YAAAA,UAAU,EAAE,IAAIrB,KAAJ,EAHY;AAIxBsB,YAAAA,UAAU,EAAE,IAAIpB,MAAJ,EAJY;AAKxBqB,YAAAA,cAAc,EAAE,IAAIrB,MAAJ,EALQ;AAMxBsB,YAAAA,eAAe,EAAE,IAAIvB,IAAJ,EANO;AAOxBwB,YAAAA,eAAe,EAAE,IAAIxB,IAAJ,EAPO;AAQxByB,YAAAA,eAAe,EAAE,IAAIzB,IAAJ,EARO;AASxB0B,YAAAA,eAAe,EAAE,IAAI1B,IAAJ;AATO,WAJ0C;AAAA,eAgB5D2B,KAhB4D,GAgB5C;AACtBC,YAAAA,QAAQ,EAAE,IADY;AAEtBC,YAAAA,OAAO,EAAE,IAFa;AAGtBC,YAAAA,eAAe,EAAE;AAHK,WAhB4C;AAAA,eAsB5DC,MAtB4D,GAsB3C;AACvBC,YAAAA,QAAQ,EAAE,CAACC,KAAD,EAAgBC,QAAhB,EAAkCC,GAAlC,KAAkD,CAAG;AADxC,WAtB2C;AAAA;;AACnEC,QAAAA,KAAK,GAAG,CACP;;AAwBSC,QAAAA,SAAS,GAAG;AACrB,iBAAO,EAAP;AAEA;;AAESC,QAAAA,SAAS,GAAS;AAC3B,eAAKrB,YAAL,CAAkBI,UAAlB,CAA6BkB,IAA7B,CAAkCC,EAAlC,CAAqCxC,IAAI,CAACyC,SAAL,CAAeC,SAApD,EAA+D,MAAM;AACpE;AACA,gBAAI,KAAKf,KAAL,CAAWC,QAAX,CAAoBe,MAApB,IAA8B,KAAKhB,KAAL,CAAWC,QAAX,CAAoBe,MAApB,KAA+B;AAAA;AAAA,gDAAcT,QAA/E,EAAyF;AACxF;AAAA;AAAA,oCAAOU,cAAP,CAAsB;AAAA;AAAA,wCAASC,GAA/B,EAAoC;AACnCX,gBAAAA,QAAQ,EAAE,KAAKP,KAAL,CAAWC,QAAX,CAAoBe,MADK;AAEnCG,gBAAAA,IAAI,EAAE,KAAKnB,KAAL,CAAWC,QAAX,CAAoBmB,IAFS;AAGnCC,gBAAAA,IAAI,EAAE,KAAKrB,KAAL,CAAWC,QAAX,CAAoBoB,IAHS;AAInCC,gBAAAA,IAAI,EAAE,KAAKtB,KAAL,CAAWC,QAAX,CAAoBqB;AAJS,eAApC,EAKG,CAAChB,KAAD,EAAgBiB,QAAhB,KAAqC;AACvC,qBAAKnB,MAAL,CAAYC,QAAZ,CAAqBC,KAArB,EAA4BiB,QAA5B,EAAsC,CAAtC,EADuC,CAEvC;AACA;AACA,eATD;AAUA;AACD,WAdD;AAeA;;AAESC,QAAAA,QAAQ,CAACC,GAAD,EAAoBnB,KAApB,EAAmD;AACpE,cAAImB,GAAG,KAAK,UAAZ,EAAwB;AACvB;AACA,gBAAIC,OAAO,GAAGpB,KAAK,CAACqB,GAApB;AACA,gBAAIC,OAAO,GAAGtB,KAAK,CAACuB,GAApB;AAEA,gBAAI,CAACD,OAAL,EAAc;;AAEd,gBAAI,CAACF,OAAL,EAAc;AACb,mBAAKI,cAAL,CAAoBF,OAAO,CAACG,KAA5B;AACA,mBAAKzC,YAAL,CAAkBG,UAAlB,CAA6BuC,MAA7B,GAAsC;AAAA;AAAA,sCAAQJ,OAAO,CAACN,IAAhB,EAAsB;AAAA;AAAA,oCAAOW,UAAP,CAAkBC,kBAAxC,CAAtC;AACA,mBAAK5C,YAAL,CAAkBC,UAAlB,CAA6ByC,MAA7B,GAAsC;AAAA;AAAA,oDAAeJ,OAAO,CAACP,IAAvB,CAAtC;AACA,mBAAKc,QAAL,CAAcP,OAAO,CAACR,IAAtB;AACA;AACA;;AAED,gBAAIM,OAAO,CAACV,MAAR,KAAmBY,OAAO,CAACZ,MAA/B,EAAuC;AACtC,mBAAKc,cAAL,CAAoBF,OAAO,CAACG,KAA5B;AACA,mBAAKzC,YAAL,CAAkBG,UAAlB,CAA6BuC,MAA7B,GAAsC;AAAA;AAAA,sCAAQJ,OAAO,CAACN,IAAhB,EAAsB;AAAA;AAAA,oCAAOW,UAAP,CAAkBC,kBAAxC,CAAtC;AACA,mBAAK5C,YAAL,CAAkBC,UAAlB,CAA6ByC,MAA7B,GAAsC;AAAA;AAAA,oDAAeJ,OAAO,CAACP,IAAvB,CAAtC;AACA,mBAAKc,QAAL,CAAcP,OAAO,CAACR,IAAtB;AACA,aALD,MAKO;AACN,kBAAIM,OAAO,CAACL,IAAR,KAAiBO,OAAO,CAACP,IAA7B,EAAmC;AAClC,qBAAK/B,YAAL,CAAkBC,UAAlB,CAA6ByC,MAA7B,GAAsC;AAAA;AAAA,sDAAeJ,OAAO,CAACP,IAAvB,CAAtC;AACA;AACD;AACD,WAzBD,MAyBO,IAAII,GAAG,KAAK,SAAR,IAAqBnB,KAAK,CAACuB,GAA3B,IAAkC,CAACvB,KAAK,CAACuB,GAAN,CAAUO,OAA7C,IAAwD9B,KAAK,CAACuB,GAAN,CAAUQ,KAAV,KAAoB,KAAKrC,KAAL,CAAWC,QAAX,CAAoBoC,KAApG,EAA2G;AACjH,iBAAKC,MAAL;AACA,WAFM,MAEA,IAAIb,GAAG,KAAK,iBAAZ,EAA+B;AACrC,gBAAInB,KAAK,CAACuB,GAAN,KAAc;AAAA;AAAA,oDAAgBU,aAAlC,EAAiD;AAChD,eAAC,KAAKC,IAAL,EAAD,IAAgB,KAAKC,oBAAL,CAA0B,KAAKzC,KAAL,CAAWC,QAAX,CAAoByC,OAA9C,CAAhB;AACA,mBAAKpD,YAAL,CAAkBC,UAAlB,CAA6ByC,MAA7B,GAAsC;AAAA;AAAA,oDAAe,KAAKhC,KAAL,CAAWC,QAAX,CAAoBoB,IAAnC,CAAtC;AACA;AACD;AACD;;AAEOmB,QAAAA,IAAI,GAAG;AACd,iBAAO,KAAKxC,KAAL,CAAWC,QAAX,CAAoBe,MAApB,KAA+B;AAAA;AAAA,8CAAcT,QAApD;AACA;AACD;AACD;AACA;AACA;;;AACS4B,QAAAA,QAAQ,CAACf,IAAD,EAAqB;AACpC,cAAI,CAACA,IAAD,IAASA,IAAI,IAAI,CAArB,EAAwB;AACvB,iBAAK9B,YAAL,CAAkBI,UAAlB,CAA6BiD,WAA7B,GAA2C;AAAA;AAAA,8DAAsBC,OAAtB,CAA8B;AAAA;AAAA,gEAAsBC,YAApD,EAAkEC,MAA7G;AACA;AACA;;AAED;AAAA;AAAA,gCAAOC,cAAP,CAAsB3B,IAAtB,EAA4B,KAAK9B,YAAL,CAAkBI,UAA9C;AACA;AAED;AACD;AACA;;;AACS4C,QAAAA,MAAM,GAAS;AACtB,cAAID,KAAK,GAAG,KAAKrC,KAAL,CAAWC,QAAX,CAAoBoC,KAAhC;AAEA,cAAIW,MAAM,GAAGX,KAAK,GAAG,CAAR,GAAY,EAAZ,GAAiB,CAAC,EAA/B;AACA9D,UAAAA,KAAK,CAAC,KAAKe,YAAL,CAAkBK,cAAlB,CAAiCiB,IAAlC,CAAL,CACEqC,EADF,CACK,GADL,EACU;AAAEC,YAAAA,QAAQ,EAAE,IAAI1E,IAAJ,CAASwE,MAAT,EAAiB,CAAjB;AAAZ,WADV,EAEEC,EAFF,CAEK,GAFL,EAEU;AAAEC,YAAAA,QAAQ,EAAE,IAAI1E,IAAJ,CAAS,CAAT,EAAY,CAAZ;AAAZ,WAFV,EAGEiC,KAHF;AAIA;;AAEOqB,QAAAA,cAAc,CAACC,KAAD,EAAsB;AAC3C,eAAKzC,YAAL,CAAkBM,eAAlB,CAAkCuD,MAAlC,GAA2C,KAA3C;AACA,eAAK7D,YAAL,CAAkBO,eAAlB,CAAkCsD,MAAlC,GAA2C,KAA3C;AACA,eAAK7D,YAAL,CAAkBQ,eAAlB,CAAkCqD,MAAlC,GAA2C,KAA3C,CAH2C,CAI3C;;AAEA,cAAIpB,KAAK,KAAK,CAAd,EAAiB;AAChB,iBAAKzC,YAAL,CAAkBM,eAAlB,CAAkCuD,MAAlC,GAA2C,IAA3C;AACA,WAFD,MAEO,IAAIpB,KAAK,KAAK,CAAd,EAAiB;AACvB,iBAAKzC,YAAL,CAAkBO,eAAlB,CAAkCsD,MAAlC,GAA2C,IAA3C;AACA,WAFM,MAEA,IAAIpB,KAAK,KAAK,CAAd,EAAiB;AACvB,iBAAKzC,YAAL,CAAkBQ,eAAlB,CAAkCqD,MAAlC,GAA2C,IAA3C,CADuB,CAEvB;AACA;AACA;AACD;;AAESC,QAAAA,MAAM,GAAS,CACxB;AACA;;AAEMC,QAAAA,YAAY,CAACC,QAAD,EAAuB;AACzC,eAAK1C,IAAL,CAAU2C,WAAV,CAAsBD,QAAtB;AACA;;AAEOb,QAAAA,oBAAoB,CAACC,OAAD,EAAkB;AAC7C;AACA,cAAIA,OAAO,IAAI,CAAf,EAAkB;AAClB,gBAAMc,aAAa,GAAG,IAAIhF,IAAJ,CAAS,KAAKc,YAAL,CAAkBE,aAAlB,CAAgC0D,QAAhC,CAAyCO,CAAlD,EAAqD,KAAKnE,YAAL,CAAkBE,aAAlB,CAAgC0D,QAAhC,CAAyCQ,CAA9F,CAAtB;AACA,eAAKpE,YAAL,CAAkBE,aAAlB,CAAgCmE,YAAhC,CAA6CvF,KAA7C,EAAoD4D,MAApD,GAA6D,MAAM;AAAA;AAAA,gDAAeU,OAAf,CAAnE;AACA,eAAKpD,YAAL,CAAkBE,aAAlB,CAAgC2D,MAAhC,GAAyC,IAAzC;AACA5E,UAAAA,KAAK,CAAC,KAAKe,YAAL,CAAkBE,aAAnB,CAAL,CAAuCoE,EAAvC,CAA0C,CAA1C,EAA6C;AAAEV,YAAAA,QAAQ,EAAE,IAAI1E,IAAJ,CAAS,CAAT,EAAY,EAAZ;AAAZ,WAA7C,EAA4EqF,IAA5E,CAAiF,MAAM;AACtF,iBAAKC,YAAL,CAAkB,MAAM;AACvB,mBAAKxE,YAAL,CAAkBE,aAAlB,CAAgC2D,MAAhC,GAAyC,KAAzC;AACA,mBAAK7D,YAAL,CAAkBE,aAAlB,CAAgC+D,WAAhC,CAA4CC,aAA5C;AACA,aAHD,EAGG,GAHH;AAIA,WALD,EAKG/C,KALH;AAMA;;AAEDsD,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AA3JkE,O","sourcesContent":["import { _decorator, Label, log, Node, Sprite, SpriteFrame, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { getGoldShorten, loadRemoteImage, omitStr } from '../../../utils/tool';\r\nimport { SpriteFramePathDefine } from '../sourceDefine/spriteDefine';\r\nimport { AnimationStatus, BetData, HeadType } from '../type';\r\nimport config from '../config';\r\nimport { gameCacheData } from '../serverType';\r\nimport { global, sourceManageSeletor as hallSourceManageSeletor } from '../../../hall';\r\nimport { sourceManageSeletor } from '../index';\r\nimport GiftUserViewModel, { GameType } from '../../../common/viewModel/GiftUserViewModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n}\r\n\r\nexport interface IProps {\r\n\theadType: HeadType,\r\n\tbetData: BetData,\r\n\tanimationStatus: AnimationStatus,\r\n}\r\nexport interface IEvent {\r\n\tgiveGift: (value: number, memberId: string, num: number) => void\r\n}\r\n\r\n@ccclass('Yxx_Head')\r\nexport class Yxx_Head extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_gold: new Label(),\r\n\t\tprops_gold_up: new Node(),\r\n\t\tprops_name: new Label(),\r\n\t\tprops_head: new Sprite(),\r\n\t\tprops_btn_user: new Sprite(),\r\n\t\tprops_head_bg_1: new Node(),\r\n\t\tprops_head_bg_2: new Node(),\r\n\t\tprops_head_bg_3: new Node(),\r\n\t\tprops_head_bg_4: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\theadType: null,\r\n\t\tbetData: null,\r\n\t\tanimationStatus: null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tgiveGift: (value: number, memberId: string, num: number) => { },\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_head.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t// 不能给自己发\r\n\t\t\tif (this.props.headType.userId && this.props.headType.userId !== gameCacheData.memberId) {\r\n\t\t\t\tglobal.showGiftWindow(GameType.YXX, {\r\n\t\t\t\t\tmemberId: this.props.headType.userId,\r\n\t\t\t\t\thead: this.props.headType.icon,\r\n\t\t\t\t\tgold: this.props.headType.gold,\r\n\t\t\t\t\tname: this.props.headType.name,\r\n\t\t\t\t}, (value: number, userInfo: string) => {\r\n\t\t\t\t\tthis.events.giveGift(value, userInfo, 0);\r\n\t\t\t\t\t// global.flyGift(\"11\", \"2\", this.node.parent.getComponent(UITransform).convertToWorldSpaceAR(config.gameOption.myHeadPosition),\r\n\t\t\t\t\t// \tthis.propertyNode.props_head.node.worldPosition, value);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === 'headType') {\r\n\t\t\t// log(\"head props =====\", key, value);\r\n\t\t\tlet oldData = value.pre as HeadType;\r\n\t\t\tlet newData = value.cur as HeadType;\r\n\r\n\t\t\tif (!newData) return;\r\n\r\n\t\t\tif (!oldData) {\r\n\t\t\t\tthis.changeUserType(newData.level);\r\n\t\t\t\tthis.propertyNode.props_name.string = omitStr(newData.name, config.gameOption.nicknameOmitLength);\r\n\t\t\t\tthis.propertyNode.props_gold.string = getGoldShorten(newData.gold);\r\n\t\t\t\tthis.loadHead(newData.icon);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (oldData.userId !== newData.userId) {\r\n\t\t\t\tthis.changeUserType(newData.level);\r\n\t\t\t\tthis.propertyNode.props_name.string = omitStr(newData.name, config.gameOption.nicknameOmitLength);\r\n\t\t\t\tthis.propertyNode.props_gold.string = getGoldShorten(newData.gold);\r\n\t\t\t\tthis.loadHead(newData.icon);\r\n\t\t\t} else {\r\n\t\t\t\tif (oldData.gold !== newData.gold) {\r\n\t\t\t\t\tthis.propertyNode.props_gold.string = getGoldShorten(newData.gold);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (key === 'betData' && value.cur && !value.cur.isMyBet && value.cur.index === this.props.headType.index) {\r\n\t\t\tthis.joggle();\r\n\t\t} else if (key === \"animationStatus\") {\r\n\t\t\tif (value.cur === AnimationStatus.HEAD_ADD_GOLD) {\r\n\t\t\t\t!this.isMe() && this.playAddGlodAnimation(this.props.headType.winloss);\r\n\t\t\t\tthis.propertyNode.props_gold.string = getGoldShorten(this.props.headType.gold);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isMe() {\r\n\t\treturn this.props.headType.userId === gameCacheData.memberId;\r\n\t}\r\n\t/**\r\n\t * 加载玩家头像\r\n\t * @param headUrl \r\n\t */\r\n\tprivate loadHead(icon: number): void {\r\n\t\tif (!icon || icon <= 0) {\r\n\t\t\tthis.propertyNode.props_head.spriteFrame = sourceManageSeletor().getFile(SpriteFramePathDefine.DEFAULT_HEAD).source;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tglobal.loadHeadSprite(icon, this.propertyNode.props_head);\r\n\t}\r\n\r\n\t/**\r\n\t * 头像抖动\r\n\t */\r\n\tprivate joggle(): void {\r\n\t\tlet index = this.props.headType.index;\r\n\r\n\t\tlet offset = index < 3 ? 20 : -20;\r\n\t\ttween(this.propertyNode.props_btn_user.node)\r\n\t\t\t.to(0.1, { position: new Vec3(offset, 0) })\r\n\t\t\t.to(0.1, { position: new Vec3(0, 0) })\r\n\t\t\t.start();\r\n\t}\r\n\r\n\tprivate changeUserType(level: number): void {\r\n\t\tthis.propertyNode.props_head_bg_1.active = false;\r\n\t\tthis.propertyNode.props_head_bg_2.active = false;\r\n\t\tthis.propertyNode.props_head_bg_3.active = false;\r\n\t\t// this.propertyNode.props_head_bg_4.active = false;\r\n\r\n\t\tif (level === 1) {\r\n\t\t\tthis.propertyNode.props_head_bg_1.active = true;\r\n\t\t} else if (level === 2) {\r\n\t\t\tthis.propertyNode.props_head_bg_2.active = true;\r\n\t\t} else if (level === 3) {\r\n\t\t\tthis.propertyNode.props_head_bg_3.active = true;\r\n\t\t\t// } else if (level === 4) {\r\n\t\t\t// \tthis.propertyNode.props_head_bg_4.active = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\t// this.playAddGlodAnimation(100);\r\n\t}\r\n\r\n\tpublic initLocation(location: Vec3): void {\r\n\t\tthis.node.setPosition(location);\r\n\t}\r\n\r\n\tprivate playAddGlodAnimation(winloss: number) {\r\n\t\t// winloss = 1000;\r\n\t\tif (winloss <= 0) return;\r\n\t\tconst startPosition = new Vec3(this.propertyNode.props_gold_up.position.x, this.propertyNode.props_gold_up.position.y);\r\n\t\tthis.propertyNode.props_gold_up.getComponent(Label).string = \"+\" + getGoldShorten(winloss);\r\n\t\tthis.propertyNode.props_gold_up.active = true;\r\n\t\ttween(this.propertyNode.props_gold_up).by(1, { position: new Vec3(0, 30) }).call(() => {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.propertyNode.props_gold_up.active = false;\r\n\t\t\t\tthis.propertyNode.props_gold_up.setPosition(startPosition);\r\n\t\t\t}, 0.5);\r\n\t\t}).start();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}