{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fruit777/components/Fruit777_Roller.ts"],"names":["_decorator","Mask","Node","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","RollerIconViewModel","sourceManageSeletor","PrefabPathDefine","config","endRollingAction","setRollSpeed","ccclass","property","Fruit777_Roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","speed","rollerHeight","rollConfig","normalRollOption","outIconPool","propertyNode","props_roller","props_daqipao","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","isSpeedUp","stopMode","isSortStop","events","rollStart","rollEnd","rollerIndex","start","schedule","move","initState","roundEnd","bindEvent","useProps","key","value","pre","direction","DOWN","cur","iconQueue","length","initRoller","stopIconIndex","bringForwardEnd","dispatch","rolling","joinIcon","setState","speedUp","index","unschedule","displayIconListInside","filter","i","viewNode","position","y","getRollerHeight","l","item","indexOf","setProps","stopSpeed","cache","getComponent","height","bindUI","useState","node","enabled","LargeRoller","largeRollOption","width","left","intervalWidth","right","active","iconViewModel","iconData","mountView","getFile","ICON","source","shift","setPosition","appendTo","x","z","intervalHeight","some","uuid","push","moveIcon","lastChild","children","comp","queueIndex","geidArr","getIconStopSet","forEach","c","j","to","easing","scheduleOnce","child","viewModel","find","getPosition","removeFromParent","gridArr","start_y","nodeHeight","singleIntervalHeight","reverse","update","deltaTime","getRoundEnd","state","onDestroy","window","clearInterval"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Mask, Node, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { fruit777_Audio, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction, setRollSpeed } from '../store/actions/roller';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tisSpeedUp?: boolean,\r\n\tstopMode: 'index' | 'jump'\r\n\tisSortStop: boolean\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n}\r\n\r\n@ccclass('Fruit777_Roller')\r\nexport class Fruit777_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\t\tthis.schedule(this.move, 0.01)\r\n\t}\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\t/**最近一次加入的图标 */\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\t// private coordList: Array<number> = []\r\n\t/**主要用于启动的速度变化 */\r\n\tprivate speed: number = 0\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tprivate outIconPool: Array<RollerIconViewModel> = []\r\n\t// private stopGrid: Array<Array<number>> = [[0,0],[0,0],[0,0]]\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\tprops_daqipao: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tisSpeedUp: false,\r\n\t\tstopMode: 'jump',\r\n\t\tisSortStop: false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\trollEnd: (rollerIndex: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * 2024-1-4 02:30记录（地点：菲律宾）\r\n\t\t\t\t * 尼玛。这个问题找了2个小时，下面这个if一定要在rolling（this.events.rollStart()）判断之前处理，不然在某种特殊情况下，比如上一次最后加入的图标index此时等于将要停止的图标index，\r\n\t\t\t\t * 将没有机会joinIcon，直接停止。因为调整nextJoinIconIndex的操作还没有被执行。\r\n\t\t\t\t */\r\n\t\t\t\tif (this.props.rollerType.stopIconIndex && value.pre.stopIconIndex !== value.cur.stopIconIndex) {\r\n\t\t\t\t\tif (this.props.stopMode === \"jump\") {\r\n\t\t\t\t\t\t// 放弃这种模式(控制跳跃的距离来实现步停)\r\n\t\t\t\t\t\t// this.bringForwardEnd(this.props.rollerType, this.props.isSortStop ? 4 + this.props.rollerType.index * 8 : 4)\r\n\t\t\t\t\t\tthis.bringForwardEnd(this.props.rollerType, 5)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dispatch(setRollSpeed(this.props.isSpeedUp ? 1.5 : 1))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\t// while ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t\t\t// \t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tthis.joinIcon()\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\tthis.events.rollStart()\r\n\t\t\t\t\tconst speedUp = (index) => {\r\n\t\t\t\t\t\tif (this.speed < this.props.rollerType.speed) {\r\n\t\t\t\t\t\t\tthis.speed += this.props.rollerType.speed / 20;\r\n\t\t\t\t\t\t\t(this.speed > this.props.rollerType.speed) && (this.speed === this.props.rollerType.speed)\r\n\t\t\t\t\t\t} else if (this.speed === this.props.rollerType.speed) {\r\n\t\t\t\t\t\t\tthis.unschedule(speedUp)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.schedule(speedUp, 0.02)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.speed = 0\r\n\t\t\tconst displayIconListInside = this.displayIconList.filter(i => i.viewNode.position.y > -this.getRollerHeight(true))\r\n\t\t\tfor (let i = 0, l = displayIconListInside.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = displayIconListInside[index]\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**提前结束,这个停止方式，应该只支持indexTrgger这种触发方案 */\r\n\tprivate bringForwardEnd(rollerType: RollerType, stopSpeed: number = 4) {\r\n\t\tif (rollerType.stopIconIndex + stopSpeed >= this.props.rollerType.iconQueue.length) {\r\n\t\t\t// this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - rollerType.stopIconIndex\r\n\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed - this.props.rollerType.iconQueue.length\r\n\t\t} else {\r\n\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns \r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\t\t}, [\"roundEnd\"])\r\n\t}\r\n\r\n\r\n\tprivate initRoller() {\r\n\t\tthis.rollConfig = this.props.rollerType.LargeRoller ? config.largeRollOption : config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\t\tthis.propertyNode.props_daqipao.active = this.props.rollerType.LargeRoller\r\n\t\tthis.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1\r\n\t\twhile (!this.lastInsertIconViewModel || (this.lastInsertIconViewModel && this.lastInsertIconViewModel.viewNode.position.y < 200)) {\r\n\t\t\tthis.joinIcon()\r\n\t\t}\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tlet iconViewModel: RollerIconViewModel\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tif (this.outIconPool.length === 0) {\r\n\t\t\t// this.props.rollerType.index === 0 && console.log(this.props.rollerType.index, 'create')\r\n\t\t\ticonViewModel = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source)\r\n\t\t} else {\r\n\t\t\ticonViewModel = this.outIconPool.shift()\r\n\t\t\ticonViewModel.viewNode.setPosition(new Vec3(0, 0, 1))\r\n\t\t}\r\n\t\ticonViewModel.appendTo(this.propertyNode.props_roller).setProps({ iconData, iconEffect: IconEffectType.NONE })\r\n\t\tif (this.lastInsertIconViewModel) {\r\n\t\t\t//已经有图标\r\n\t\t\tconst { x, y, z } = this.lastInsertIconViewModel.viewNode.position\r\n\t\t\ticonViewModel.viewNode.setPosition(new Vec3(x, y + iconViewModel.viewNode.getComponent(UITransform).height + iconData.intervalHeight * 2, 1))\r\n\t\t} else {\r\n\t\t\ticonViewModel.viewNode.setPosition(new Vec3(0, -this.getRollerHeight(true) + iconViewModel.viewNode.getComponent(UITransform).height / 2 + iconData.intervalHeight, 1))\r\n\t\t}\r\n\t\tthis.nextJoinIconIndex--\r\n\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1);\r\n\r\n\t\t// console.log(iconViewModel.comp.props.iconData.iconId)\r\n\t\t(!this.displayIconList.some(i => i.viewNode.uuid === iconViewModel.viewNode.uuid)) && this.displayIconList.push(iconViewModel)\r\n\t\tthis.lastInsertIconViewModel = iconViewModel\r\n\t}\r\n\r\n\tprivate move() {\r\n\t\tif (!this.props.rollerType.rolling) return;\r\n\t\tthis.moveIcon()\r\n\t\t//最后一个完全进入\r\n\t\tconst lastChild = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1]\r\n\t\tif (lastChild.position.y < -(lastChild.getComponent(UITransform).height / 2)) {\r\n\t\t\tthis.joinIcon()\r\n\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t//需要停止的ICON出现\r\n\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\tconst geidArr = this.getIconStopSet()\r\n\t\t\t\tthis.propertyNode.props_roller.children.forEach((c, j) => {\r\n\t\t\t\t\ttween(c).to(this.rollConfig.stopSpeed, { position: new Vec3(c.position.x, geidArr[j], c.position.z) }, { easing: \"backOut\" }).start()\r\n\t\t\t\t})\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t//滑槽最后停止\r\n\t\t\t\t\tthis.moveIcon()\r\n\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t}, this.rollConfig.stopSpeed)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate moveIcon() {\r\n\t\t//删除图标\r\n\t\tthis.propertyNode.props_roller.children.forEach((child, i) => {\r\n\t\t\tconst viewModel = this.displayIconList.find(i => i.viewNode.uuid === child.uuid)\r\n\t\t\tconst { x, y, z } = child.getPosition()\r\n\t\t\tchild.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t//为了让临界溢出图标顺利被删除，后面多加一点提前量\r\n\t\t\tif (child.position.y <= -(this.getRollerHeight(true) + child.getComponent(UITransform).height / 2 + this.props.rollerType.iconQueue[this.nextJoinIconIndex].intervalHeight) + 60) {\r\n\t\t\t\t// this.props.rollerType.index === 0 && console.log(this.props.rollerType.index, 'remove')\r\n\t\t\t\t//超出底部\r\n\t\t\t\tchild.removeFromParent()\r\n\t\t\t\tthis.displayIconList = this.displayIconList.filter(i => i.viewNode.uuid !== child.uuid)\r\n\t\t\t\tviewModel && this.outIconPool.push(viewModel)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/**根据图标的序号获取停止为止，从最后一个开始，顶部对齐 */\r\n\tprivate getIconStopSet() {\r\n\t\tconst l = this.propertyNode.props_roller.children.length\r\n\t\tconst gridArr = []\r\n\t\tlet start_y = 0\r\n\t\tfor (let i = l - 1; i >= 0; i--) {\r\n\t\t\tconst nodeHeight = this.propertyNode.props_roller.children[i].getComponent(UITransform).height\r\n\t\t\tgridArr.push(start_y - (nodeHeight / 2 + this.rollConfig.singleIntervalHeight))\r\n\t\t\t//累加当前图标的纵向占位\r\n\t\t\tstart_y += -(nodeHeight + this.rollConfig.singleIntervalHeight * 2)\r\n\t\t}\r\n\t\treturn gridArr.reverse()\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n"]}