{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/Bullet.ts"],"names":["Bullet","pointDeg","dx","dy","rad","atan2","r","deg","Color","Graphics","Node","Rect","Vec3","misc","sp","view","createSkeleton","createSpriteNode","toNodeSpaceAR","BulletCreate","create","info","pi","Math","PI","pia","sin","cos","radiansToDegrees","degreesToRadians","BULLET_INVALIDE_ID","bulletZOrder","ORGIN_X","ORGIN_Y","isDrawBondingBox","constructor","bulletConfig","bondRect","bulletObj","uiRoot","moveV","bondingBox","dataID","netID","objectID","isAlive","angle","refectPos","linePos","objPos","offset","battery","isOutX","isOutY","userInfo","lockFishID","runSeconds","draw","batteryManager","sourceManage","fishNetManager","scaleRatio","initEnv","bulConfig","bSize","getVisibleSize","width","height","init","setSiblingIndex","bulletItem","id","ani","src","getComponent","Skeleton","setAnimation","active","setWorldPosition","act_v","bonding_box","net_id","obj_id","player_id","set_id","is_local","server_id","gold","head_id","level","vip_level","nick_name","battery_id","battery_score","isPowerBattery","room_id","ready","offline","bullet","addGraphics","addChild","node","graphics","addComponent","lineWidth","strokeColor","WHITE","resumeOrgin","reset","pos","playerID","serverID","isLocal","x","y","getBatteryByPlayerId","setPosition","getRootNode","ranti","shotSomething","play","getBondingBox","bbxs","k","v","newA","newB","a","b","push","update","dt","refPos","curX","curY","isChange","isLockFish","getLockFishId","getLockAngle","distance","clear","key","circle","stroke","getCurrentPos","getUserInfo","getDataId","getObjectId","getUseState","isMyBullet","getBulletPlayerId","getBulletServeId","getCurLockFishId"],"mappings":"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","sourcesContent":["import { Color, Graphics, Node, Rect, UITransform, Vec3, misc, sp, view } from \"cc\"\r\nimport { BatteryManager } from \"./BatteryManager\"\r\nimport { createSkeleton, createSpriteNode, toNodeSpaceAR } from \"./FishTool\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport { ICreateObj } from \"./ObjectPool\";\r\nimport { Battery, UserInfo } from \"./Battery\";\r\nimport { FishNetManager } from \"./FishNetManager\";\r\n\r\n\r\nexport const BulletCreate: ICreateObj = {\r\n  create: (info) => {\r\n    return new Bullet(info);\r\n  }\r\n}\r\n\r\n/**\r\n  子弹\r\n  side 1->left,2->right,3->top,4->bottom\r\n */\r\nconst pi = Math.PI\r\nconst pia = 180\r\nconst sin = Math.sin\r\nconst cos = Math.cos\r\nconst deg = misc.radiansToDegrees\r\nconst rad = misc.degreesToRadians\r\nconst atan2 = Math.atan2\r\nconst BULLET_INVALIDE_ID = -1;\r\nconst bulletZOrder = 600000\r\nconst ORGIN_X = -100;\r\nconst ORGIN_Y = -100;\r\n/**是否绘制包围盒 */\r\nconst isDrawBondingBox = false;\r\n\r\nfunction pointDeg(dx, dy) {\r\n  let rad = atan2(dy, dx)\r\n  let r = deg(rad)\r\n  if (r > 360) {\r\n    return r - 360\r\n  } else if (r < -360) {\r\n    return r + 360\r\n  } else {\r\n    return r\r\n  }\r\n}\r\n\r\nexport class Bullet {\r\n  private bulletConfig = null\r\n  private bondRect: Rect = null\r\n  private bulletObj: Node;\r\n  public uiRoot: Node = null;\r\n  private moveV = null\r\n  private bondingBox = null\r\n  private dataID = null\r\n  private netID = null\r\n  private objectID: number = null\r\n  private isAlive = null\r\n  private angle: number = 0\r\n  private refectPos: Vec3 = new Vec3(0, 0)\r\n  private linePos: Vec3 = new Vec3(0, 0)\r\n  private objPos: Vec3 = new Vec3(0, 0)\r\n  private offset: Vec3 = new Vec3(0, 0)\r\n  private battery: Battery = null\r\n  private isOutX = null\r\n  private isOutY = null\r\n  private userInfo: UserInfo = null\r\n  private lockFishID: number\r\n  private runSeconds: number\r\n\r\n  /**包围盒节点 */\r\n  private draw: Node;\r\n\r\n  private batteryManager: BatteryManager;\r\n  private sourceManage: SourceManage;\r\n  private fishNetManager: FishNetManager;\r\n  /**缩放比例 */\r\n  private scaleRatio: number = 1;\r\n\r\n  constructor(info) {\r\n  }\r\n\r\n  public initEnv(bulConfig, bSize, batteryManager: BatteryManager, sourceManage: SourceManage, fishNetManager: FishNetManager, scaleRatio: number = 1) {\r\n    this.batteryManager = batteryManager;\r\n    this.sourceManage = sourceManage;\r\n    this.bulletConfig = bulConfig\r\n    this.fishNetManager = fishNetManager;\r\n    this.scaleRatio = scaleRatio;\r\n    this.bondRect = new Rect(0, 0, view.getVisibleSize().width, view.getVisibleSize().height)\r\n    // this.bondRect = new Rect(0, 0, bSize.width, bSize.height)\r\n  }\r\n  public init(info) {\r\n    // ui root\r\n    this.uiRoot = new Node();\r\n    this.uiRoot.setSiblingIndex(bulletZOrder);\r\n\r\n    // create bullet obj\r\n    let bulletItem = this.bulletConfig[info.id]\r\n    this.bulletObj = null\r\n    if (bulletItem.ani === \"\") {\r\n      this.bulletObj = createSpriteNode(this.sourceManage, this.uiRoot, bulletItem.src);\r\n    } else {\r\n      // let jsFile = bulletItem.src + \".json\"\r\n      // let asFile = bulletItem.src + \".atlas\"\r\n      this.bulletObj = createSkeleton(this.sourceManage, this.uiRoot, bulletItem.src)\r\n      this.bulletObj.getComponent(sp.Skeleton).setAnimation(0, bulletItem.ani, true)\r\n    }\r\n    this.bulletObj.angle = 90;\r\n    this.bulletObj.active = (true)\r\n    this.bulletObj.setWorldPosition(new Vec3(0, 0))\r\n\r\n    this.uiRoot.active = (false)\r\n    this.uiRoot.setWorldPosition(new Vec3(ORGIN_X, ORGIN_Y))\r\n    this.uiRoot.angle = 0\r\n\r\n    this.moveV = bulletItem.act_v\r\n    this.bondingBox = bulletItem.bonding_box\r\n    this.dataID = bulletItem.id\r\n    this.netID = bulletItem.net_id\r\n    this.objectID = info.obj_id\r\n    this.isAlive = false\r\n    this.angle = 0\r\n    // this.refectPos = { x: 0, y: 0 }\r\n    // this.linePos = { x: 0, y: 0 }\r\n    // this.objPos = { x: 0, y: 0 }\r\n    // this.offset = { rx: 0, ry: 0 }\r\n    this.battery = null\r\n    this.isOutX = false\r\n    this.isOutY = false\r\n\r\n    this.userInfo = {\r\n      player_id: '',//玩家id\r\n      set_id: 0,\r\n      is_local: false,//是否为本地，区别自己与别人的炮台\r\n      server_id: BULLET_INVALIDE_ID,//服务器子弹id标识\r\n      gold: 0,//金币\r\n      head_id: 0,//头像\r\n      level: 0,//等级\r\n      vip_level: 0,//vip等级\r\n      nick_name: '',//昵称\r\n      battery_id: 0,//炮id\r\n      battery_score: 0,//炮分数\r\n      isPowerBattery: false, //是否能量炮\r\n      room_id: '',//房间号\r\n      ready: 0, //0:准备,1未准备\r\n      offline: 0, //0:没有离线,非0:离线\r\n      bullet: 0, //剩余子弹  \r\n    }\r\n\r\n    this.lockFishID = -1\r\n    this.runSeconds = 0\r\n\r\n\r\n    if (isDrawBondingBox) {\r\n      this.draw = new Node();\r\n      this.addGraphics(this.draw);\r\n      this.uiRoot.addChild(this.draw)\r\n    }\r\n  }\r\n  private addGraphics(node: Node) {\r\n    let graphics = node.getComponent(Graphics);\r\n    if (!graphics) {\r\n      graphics = node.addComponent(Graphics);\r\n    }\r\n    // 设置线条宽度和颜色\r\n    graphics.lineWidth = 2;\r\n    graphics.strokeColor = Color.WHITE;\r\n    return graphics\r\n  }\r\n\r\n  public resumeOrgin() {\r\n    this.uiRoot.angle = 0\r\n    this.uiRoot.active = (false)\r\n    this.uiRoot.setWorldPosition(new Vec3(ORGIN_X, ORGIN_Y))\r\n\r\n    this.userInfo.player_id = ''\r\n    this.userInfo.is_local = false\r\n    this.userInfo.server_id = BULLET_INVALIDE_ID\r\n    this.lockFishID = -1\r\n    this.runSeconds = 0\r\n    this.isAlive = false\r\n    this.battery = null\r\n  }\r\n\r\n  public reset(pos, angle, lockFishID, playerID, serverID, isLocal) {\r\n    this.refectPos.x = pos.x\r\n    this.refectPos.y = pos.y\r\n    this.objPos.x = pos.x\r\n    this.objPos.y = pos.y\r\n    this.linePos.x = 0\r\n    this.linePos.y = 0\r\n    this.angle = angle\r\n    this.lockFishID = lockFishID\r\n    this.runSeconds = 0\r\n    this.userInfo.player_id = playerID\r\n    this.userInfo.server_id = serverID\r\n    this.userInfo.is_local = isLocal\r\n    this.isAlive = true\r\n    this.battery = this.batteryManager.getBatteryByPlayerId(playerID)\r\n\r\n    // this.uiRoot.setWorldPosition(new Vec3(pos.x, pos.y))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.batteryManager.getRootNode(), pos));\r\n    // this.uiRoot.angle = 2 * pia - angle;\r\n    this.uiRoot.angle = pia + angle;\r\n    this.uiRoot.active = (true)\r\n\r\n    let ranti = rad(this.angle)\r\n    this.offset.x = cos(ranti)\r\n    this.offset.y = sin(ranti)\r\n  }\r\n\r\n  public shotSomething() {\r\n    this.fishNetManager.play({ pos: this.objPos, id: this.netID })\r\n  }\r\n\r\n  /**\r\n   * 获取子弹的碰撞盒\r\n   */\r\n  public getBondingBox() {\r\n    let ranti = rad(this.angle)\r\n    let bbxs = []\r\n    for (const k in this.bondingBox) {\r\n      const v = this.bondingBox[k];\r\n      if (!v) continue;\r\n      let newA = 0\r\n      let newB = 0\r\n      if (v.a !== 0 || v.b !== 0) {\r\n        newA = v.a * cos(ranti) + v.b * sin(ranti)\r\n        newB = v.b * cos(ranti) - v.a * sin(ranti)\r\n      }\r\n      bbxs.push({ a: newA + this.objPos.x, b: newB + this.objPos.y, r: v.r })\r\n    }\r\n    // console.log(\"bullet bbxs \", JSON.stringify(bbxs));\r\n    return bbxs\r\n  }\r\n\r\n  public update(dt) {\r\n    let offset = this.offset\r\n    let linePos = this.linePos\r\n    let refPos = this.refectPos\r\n    let objPos = this.objPos\r\n    let curX = refPos.x + linePos.x\r\n    let curY = refPos.y + linePos.y\r\n\r\n    if (!this.isOutX) {\r\n      if (curX < 0 || curX > this.bondRect.width) {\r\n        offset.x = -offset.x\r\n        this.isOutX = true\r\n      }\r\n    } else if (curX > 0 && curX < this.bondRect.width) {\r\n      this.isOutX = false\r\n    }\r\n\r\n    if (!this.isOutY) {\r\n      if (curY < 0 || curY > this.bondRect.height) {\r\n        offset.y = -offset.y\r\n        this.isOutY = true\r\n      }\r\n    } else if (curY > 0 && curY < this.bondRect.height) {\r\n      this.isOutY = false\r\n    }\r\n\r\n    let isChange = false\r\n    if (this.isOutX || this.isOutY) {\r\n      isChange = true\r\n      this.angle = pointDeg(offset.x, offset.y)\r\n      this.runSeconds = 0\r\n      refPos.x = curX\r\n      refPos.y = curY\r\n      linePos.x = 0\r\n      linePos.y = 0\r\n      // this.uiRoot.angle = 2 * pia - this.angle\r\n      this.uiRoot.angle = pia + this.angle\r\n    }\r\n\r\n    let battery = this.battery\r\n    if (battery && isChange === false) {\r\n      if (battery.isLockFish() && (battery.getLockFishId() === this.lockFishID && this.lockFishID !== -1)) {\r\n        this.angle = battery.getLockAngle()\r\n        let ranti = rad(this.angle)\r\n        offset.x = cos(ranti)\r\n        offset.y = sin(ranti)\r\n        // this.uiRoot.angle = 2 * pia - this.angle\r\n        this.uiRoot.angle = pia + this.angle\r\n      }\r\n    } else {\r\n      this.lockFishID = -1\r\n    }\r\n\r\n    this.runSeconds = this.runSeconds + dt\r\n    let distance = this.moveV * this.runSeconds\r\n    linePos.x = offset.x * distance\r\n    linePos.y = offset.y * distance\r\n    objPos.x = refPos.x + linePos.x\r\n    objPos.y = refPos.y + linePos.y\r\n\r\n\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.batteryManager.getRootNode(), objPos));\r\n    // this.uiRoot.setWorldPosition(new Vec3(objPos.x, objPos.y))\r\n    // console.log('ballet pos -------  : ', objPos.x, objPos.y);\r\n\r\n    if (isDrawBondingBox) {\r\n      const graphics = this.draw.getComponent(Graphics);\r\n      graphics.clear();\r\n      for (const key in this.bondingBox) {\r\n        const v = this.bondingBox[key];\r\n        if (!v) continue;\r\n        graphics.circle(v.a, v.b, v.r);\r\n        graphics.stroke();\r\n      }\r\n    }\r\n  }\r\n  public getCurrentPos() {\r\n    return this.objPos\r\n  }\r\n\r\n  public getUserInfo() {\r\n    return this.userInfo\r\n  }\r\n\r\n  public getDataId() {\r\n    return this.dataID\r\n  }\r\n\r\n  public getObjectId() {\r\n    return this.objectID\r\n  }\r\n\r\n  public getUseState() {\r\n    return this.isAlive\r\n  }\r\n\r\n  public isMyBullet() {\r\n    return this.userInfo.is_local\r\n  }\r\n\r\n  public getBulletPlayerId() {\r\n    return this.userInfo.player_id\r\n  }\r\n\r\n  public getBulletServeId() {\r\n    return this.userInfo.server_id\r\n  }\r\n\r\n  public getCurLockFishId() {\r\n    return this.lockFishID\r\n  }\r\n\r\n}\r\n"]}