{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealthV2/components/GodWealthV2_Roller.ts"],"names":["_decorator","Node","tween","UITransform","Vec3","BaseComponent","config","calBetAmount","GameType","getColumnLockIconArr","IconId","godWealthV2_Audio","mainViewModel","sourceManageSeletor","PrefabPathDefine","cacheData","GodWealthV2SingleIconRollerViewModel","getNodeByNameDeep","SoundPathDefine","ccclass","property","GodWealthV2_Roller","lastIndex","showIconCount","normalRollOption","stopIconIndex","columnIndex","iconPool","iconRollerQueue","isRoll","iconArr","intervalHeight","rollOverCallback","isSpeedBorder","props_column_effect_node","iconAnimationNode","props_lock_icon_list","speddBorderNode","isMergeIcon","lockIcons","singleIconRollerViewModels","rollerCount","bigNode","scatterNum","propertyNode","props_icon_list","props_big_icon","props","gameTypeInfo","lastGameType","MAIN","viewGameType","currGameType","leftCount","positionId","rollerStatus","isSpeed","events","onCheckNextLeftCount","start","initState","setColumnEffectNode","getChildByName","initSlot","Math","floor","random","length","initColumn","isSubGame2","addLockIcon","replaceSingleRollerIcon","iconCount","i","joinIcon","SUBGAME2","addIconIndex","index","value","newValue","isSubGame2SpecialIcon","id","BEETLE","iconId","iconConfig","icon","find","v","getIcon","position","getHeight","lastNode","y","getPosition","getNode","setPosition","push","amountNode","active","setBeetleAmount","getId","diff","calIndexDiff","lockIconDatas","fixedChessboardIcon","betAmount","amount","ceil","setAmount","lockIconData","index1","index2","bindEvent","useProps","key","node","isValid","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","hideScatterAnimation","comp","stopRoll","setSpeedBorderStatus","stopSingleRollerIcon","addLastJoinIconIndex","stopIndex","getStopIconIndex","totalCount","bindUI","getRollSpeed","expectRollerSpeed","rollerSpeed","mergeIcon","parentNode","getAlikeIconCount","pos","isWinIcon","worldPosition","clone","add","undefined","wp","rollerLaunchResult","dl","si","values","iconIndexs","isWinWild","WILD","show","setWorldPosition","x","playOneShot","FAST_ROLLER","buildSkeleton","count","filter","SCATTER","hideWin","pauseWinIcon","pauseWin","playWinIcon","playWin","playBaoHeAnimation","done","beetleArr","playOneScatterAnimation","element","rollIndex","rollerPanelViewModel","freeGame","freegame","isLoop","Object","keys","HA","faceAnimationNode","scale","rollOverHandle","SHELL_END","time","scheduleOnce","isPlayAnimation","lockValues","godWealthV2Icon","iconv","getIconIndex","replaceIcon","restore","removeSingleRollerIcon","getSlotIndex","unMount","splice","removeLockIcon","borderNode2","removeFromParent","getIconPosByIndex","height","singleRollerHeight","interval","lock","buildSingleRollerIcon","replaceMultiRollerIcon","firstIcon","getFirstIcon","addChild","viewModel","mountView","getFile","SINGLE_ICON_ROLLER","source","appendTo","viewNode","getComponent","subGameRollOption","singleIconMaskHeight","multiIconRoller","frist","shift","endIcon","to","call","isMultiRoll","SUBGAME1","getBeetleAmountNode","nodes","getAmountNode","getBaoHeParticleNode","ParticleNodes","ParticleNode","getParticleNode","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Node, sp, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { GodWealthV2Icon } from './GodWealthV2_Icon';\r\nimport { calBetAmount, GameType, GameTypeInfo, getColumnLockIconArr, IconId, RollerInfo, RollerStatus } from '../type';\r\nimport { godWealthV2_Audio, mainViewModel, sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport GodWealthV2SingleIconRollerViewModel from '../viewModel/GodWealthV2SingleIconRollerViewModel';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/** 选择的线id */\r\n\tpositionId: number,\r\n\trollerStatus: RollerStatus,\r\n\tisSpeed:boolean,\r\n}\r\nexport interface IEvent {\r\n\tonCheckNextLeftCount: () => void\r\n}\r\n\r\n@ccclass('GodWealthV2_Roller')\r\nexport class GodWealthV2_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = config.normalRollOption.showIconCount;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**是否正在滚动 */\r\n\tprivate isRoll = false;\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: GodWealthV2Icon[] = [];\r\n\t/**图标间隔 */\r\n\tprivate intervalHeight = config.normalRollOption.intervalHeight;\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**是否快速边框（期待scatter中奖边框） */\r\n\tprivate isSpeedBorder;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\t/**锁定图标节点 */\r\n\tprivate props_lock_icon_list: Node;\r\n\t/**快速滚动层节点 */\r\n\tprivate speddBorderNode: Node;\r\n\t/**是否合并图标了 */\r\n\tprivate isMergeIcon = false;\r\n\r\n\t/**锁定图标列表 */\r\n\tpublic lockIcons: GodWealthV2Icon[] = [];\r\n\t/**单个图标的滚动 */\r\n\tprivate singleIconRollerViewModels: GodWealthV2SingleIconRollerViewModel[] = [];\r\n\r\n\t/**滚动次数 */\r\n\tprivate rollerCount = -1;\r\n\r\n\t/**大图标 */\r\n\tprivate bigNode: Node;\r\n\r\n\t/**scatter图标数 */\r\n\tprivate scatterNum: number = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t\tprops_big_icon: new Node(),\r\n\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t// rollerInfo: undefined,\r\n\t\t// rollerStatus: RollerStatus.END,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0,\r\n\t\t},\r\n\t\tpositionId: 0,\r\n\t\trollerStatus: null,\r\n\t\tisSpeed: false,\r\n\t\t\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonCheckNextLeftCount: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t\tthis.speddBorderNode = this.props_column_effect_node.getChildByName(\"props_speed_border\")\r\n\t\tthis.props_lock_icon_list = getNodeByNameDeep(\"props_lock_icon_list\", this.props_column_effect_node);\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, iconPool: IconPool) {\r\n\t\tthis.iconPool = iconPool;\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.lastIndex = Math.floor(Math.random() * this.iconRollerQueue.length);\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.addLockIcon()\r\n\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\t/**是否小游戏2的特殊图标 */\r\n\tprivate isSubGame2SpecialIcon(id: number) {\r\n\t\treturn id === IconId.BEETLE \r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\t// 在子游戏2中，初始化不显示宝盒\r\n\t\tif (this.isSubGame2() && this.isSubGame2SpecialIcon(iconConfig.id)) {\r\n\t\t\tthis.joinIcon();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tconst position = new Vec3(0, this.intervalHeight + icon.getHeight() / 2);\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.intervalHeight;\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\t\tif (iconConfig.id === 12) {\r\n\t\t\ticon.amountNode.active = true;\r\n\t\t}\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置宝盒上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: GodWealthV2Icon) {\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff >= 3) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// console.log(`setBeetleAmount--- diff:${diff},stopIconIndex:${this.stopIconIndex},lastIndex:${this.lastIndex},columnIndex:${this.columnIndex}`);\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\t\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\t// 没有锁定图标就随机一个金额\r\n\t\t\tconst betAmount = calBetAmount(this.props.positionId)\r\n\t\t\tlet amount = Math.ceil(Math.random() * betAmount)\r\n\t\t\tamount = amount <= 0 ? amount = 1 : amount\r\n\t\t\ticon.setAmount(amount)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst index = diff === 2 ? 0 : diff === 0 ? 2 : 1;\r\n\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === index)\r\n\t\tif (lockIconData) {\r\n\t\t\tconst amount = lockIconData.amount >= 10000 ? lockIconData.amount : lockIconData.amount;\r\n\t\t\ticon.setAmount(amount)\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\r\n\t\t\tif (key === 'gameTypeInfo') {\r\n\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.singleIconRollerViewModels.length === 0) {\r\n\t\t\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t\t\t}\r\n\t\t\t} else if (key === \"rollerStatus\") {\r\n\t\t\t\t// if (RollerStatus.END === value.cur) {\r\n\t\t\t\t// \tif (this.props.isSpeed) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t// \t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.SHELL_END)\r\n\t\t\t\t// \t}\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.bigNode && this.bigNode.destroy();\r\n\t\tthis.bigNode = null;\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t\t\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.hideIconWin();\r\n\t\tthis.hideScatterAnimation();\r\n\t\tthis.rollerCount = -1;\r\n\t\tthis.isMergeIcon = false;\r\n\t\tthis.isSpeedBorder = false;\r\n\t\tthis.isRoll = true;\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.startRoll());\r\n\t\t}\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, isSpeedBorder: boolean = false) {\r\n\t\t// console.log(\"this.columnIndex--------\",this.columnIndex);\r\n\t\t\r\n\t\tthis.isSpeedBorder = isSpeedBorder;\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\t// let value = isSpeedBorder ? 15 : this.columnIndex + 1\r\n\r\n\t\tthis.rollerCount = 0;\r\n\r\n\t\tif (!this.isSubGame2()) {\r\n\t\t\tisSpeedBorder && this.setSpeedBorderStatus(true);\r\n\t\t\t// let value = isSpeedBorder ? 30 : 3;\r\n\t\t\t// this.addLastJoinIconIndex(this.stopIconIndex, 30);\r\n\t\t} else {\r\n\t\t\tthis.stopSingleRollerIcon();\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tif (stopIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet newValue = stopIndex + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\tthis.lastIndex = newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex}`);\r\n\t\tlet totalCount = 1 * (this.columnIndex + 1);\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\ttotalCount = 30;\r\n\t\t}\r\n\t\tif (this.rollerCount <= totalCount) {\r\n\t\t\tif (this.rollerCount === totalCount) {\r\n\t\t\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex},\tstopIconIndex:${this.stopIconIndex}`);\r\n\t\t\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3)\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\treturn config.normalRollOption.expectRollerSpeed;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tprivate mergeIcon(parentNode: Node) {\r\n\t\tlet iconCount = this.getAlikeIconCount();\r\n\t\tlet pos: Vec3;\r\n\t\tif (iconCount === this.showIconCount) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (!this.isWinIcon(i)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 3个图标取中间的图标的坐标\r\n\t\t\tpos = this.iconArr[1].getNode().worldPosition;\r\n\t\t} else if (iconCount === this.showIconCount - 1) {\r\n\t\t\t// 找出两个相邻的图标\r\n\t\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\t\tif (this.iconArr[i].getId() === this.iconArr[i + 1].getId() && this.isWinIcon(i) && this.isWinIcon(i + 1)) {\r\n\t\t\t\t\tpos = this.iconArr[i].getNode().worldPosition.clone().add(new Vec3(0, this.iconArr[i].getHeight() / 2 + this.intervalHeight));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if (pos) {\r\n\t\t// \tthis.buildSkeleton(parentNode, pos, iconCount);\r\n\t\t// \tthis.isMergeIcon = true;\r\n\t\t// }\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tpublic isWinIcon(index: number,iconId: IconId = undefined) {\r\n\t\tconst wp = cacheData.rollerLaunchResult.dl.si[0].wp\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否有中奖图标wild */\r\n\tpublic isWinWild() {\r\n\t\tif (cacheData.rollerLaunchResult) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (this.isWinIcon(i,  IconId.WILD)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate setSpeedBorderStatus(show: boolean) {\r\n\t\tthis.speddBorderNode.active = show;\r\n\t\tif (show) {\r\n\t\t\tthis.speddBorderNode.setWorldPosition(new Vec3(this.node.worldPosition.x + 11, this.node.worldPosition.y + 13));\r\n\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.FAST_ROLLER)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildSkeleton(parentNode: Node, pos: Vec3, iconCount: number) {\r\n\t\t// const fileName = iconCount === 2 ? PrefabPathDefine.TWO_ICON : PrefabPathDefine.THREE_ICON;\r\n\t\t// this.bigNode = instantiate(sourceManageSeletor().getFile(fileName).source);\r\n\t\t// this.bigNode.name = \"bigNode\";\r\n\t\t// parentNode.addChild(this.bigNode);\r\n\t\t// this.bigNode.setWorldPosition(pos);\r\n\t}\r\n\r\n\t/**获得相同图标个数 */\r\n\tprivate getAlikeIconCount() {\r\n\t\tlet count = 1;\r\n\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\tif (this.iconArr[i].getId() === IconId.WILD && this.iconArr[i].getId() === this.iconArr[i + 1].getId()) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**暂停赢的图标 */\r\n\tpublic pauseWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.pauseWin());\r\n\t}\r\n\r\n\tprivate hideScatterAnimation() {\r\n\t\tthis.iconArr.filter(v => v.getId() === IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tif (this.isRoll) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst icon = this.iconArr[index];\r\n\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\tif (icon.getId() !== IconId.WILD || !this.isMergeIcon) {\r\n\t\t\ticon.playWin(this.propertyNode.props_big_icon)\r\n\t\t}\r\n\t}\r\n\t/**播放宝盒动画 */\r\n\tpublic playBaoHeAnimation(done) {\r\n\t\tlet count = 0;\r\n\t\tconst beetleArr = this.iconArr.filter((v, index) => v.getId() === IconId.BEETLE && index < this.showIconCount)\r\n\t\t// console.log(\"beetleArr--------\",beetleArr);\r\n\t\t\r\n\t\tif (beetleArr.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbeetleArr.forEach(v => {\r\n\t\t\tv.playBaoHeAnimation(this.propertyNode.props_big_icon,() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= beetleArr.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**播放一次scatter动画 */\r\n\tprivate playOneScatterAnimation() {\r\n\t\t\r\n\t\t// 小游戏2不播放\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (this.node && this.node.isValid && cacheData.rollerLaunchResult) {\r\n\t\t\t\tconst rollIndex = mainViewModel.rollerPanelViewModel.comp.rollIndex;\r\n\t\t\t\tconst freeGame = cacheData.rollerLaunchResult.dl.si[0].freegame;\r\n\t\t\t\tconst isLoop = Object.keys(freeGame).length > 0 ? true : false;\t\r\n\t\t\t\t// this.scatterNum = mainViewModel.rollerPanelViewModel.comp.getScatterCount(rollIndex);\r\n\t\t\t\t// console.log(\"rollIndex\",rollIndex);\r\n\t\t\t\t\r\n\t\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.HA)\r\n\t\t\t\t\t// if (rollIndex < 3) {\r\n\t\t\t\t\t\telement.faceAnimationNode.scale = new Vec3(0.9, 0.9);\r\n\t\t\t\t\t\telement.playWin(this.propertyNode.props_big_icon, false, isLoop);\r\n\t\t\t\t\t\t// console.log(\"this.scatterNum\",this.scatterNum)\r\n\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t\t// if (this.scatterNum >=2) {\r\n\t\t\t\t\t\t// \telement.faceAnimationNode.scale = new Vec3(0.9, 0.9);\r\n\t\t\t\t\t\t// \telement.playWin(this.propertyNode.props_big_icon, false, isLoop);\r\n\t\t\t\t\t\t// \tconsole.log(\"this.scatterNum\",this.scatterNum)\r\n\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t// }\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle() {\r\n\t\tthis.isRoll = false;\r\n\t\tthis.stopIconIndex = -1;\r\n\r\n\t\tthis.isSpeedBorder && this.setSpeedBorderStatus(false);\r\n\t\t// this.mergeIcon(this.propertyNode.props_big_icon);\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\t\r\n\t\t\tthis.playOneScatterAnimation();\r\n\t\t}\r\n\t\t// 滚动结束时，只有在小游戏2才立马添加锁定图标\r\n\t\tthis.isSubGame2() && this.addLockIcon();\r\n\r\n\t\t// if (!this.props.isSpeed) {\r\n\t\t\t\r\n\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.SHELL_END)\r\n\t\t// }\r\n\t\t// 滚动停止之后需要延迟的时间\r\n\t\tconst time = this.isSubGame2() ? 1.5 : 0.05;\r\n\t\tthis.events.onCheckNextLeftCount();\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node && this.node.isValid && this.rollOverCallback();\r\n\t\t}, time)\r\n\r\n\t}\r\n\r\n\t/**添加锁定图标 */\r\n\tprivate addLockIcon(isPlayAnimation: boolean = true) {\r\n\t\tconst lockValues = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\t\t\r\n\t\tlockValues.forEach(v => {\r\n\t\t\tlet godWealthV2Icon = this.lockIcons.find(iconv => iconv.getIconIndex() === v.index)\r\n\t\t\tif (!godWealthV2Icon) {\r\n\t\t\t\tconst iconConfig = config.icon.find(icon => icon.id === v.iconId)\r\n\t\t\t\tgodWealthV2Icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, v.index);\r\n\t\t\t\tgodWealthV2Icon.setAmount(v.amount);\r\n\r\n\t\t\t\tconst replaceIcon = this.iconArr[v.index];\r\n\t\t\t\tgodWealthV2Icon.setPosition(replaceIcon.getPosition())\r\n\t\t\t\tif (iconConfig.id === 12) {\r\n\t\t\t\t\tgodWealthV2Icon.amountNode.active = true;\r\n\t\t\t\t}\r\n\t\t\t\treplaceIcon.restore();\r\n\r\n\t\t\t\tthis.iconArr[v.index] = godWealthV2Icon;\r\n\t\t\t\tthis.lockIcons.push(godWealthV2Icon)\r\n\r\n\t\t\t\tthis.removeSingleRollerIcon(v.index);\r\n\r\n\t\t\t\tisPlayAnimation && godWealthV2Icon.playBaoHeAnimation(this.propertyNode.props_big_icon,() => {\r\n\t\t\t\t\t// const endPos = this.node.getComponent(UITransform).convertToNodeSpaceAR(mainViewModel.getStartBtnPos());\r\n\t\t\t\t\t// let ParticleNode = instantiate(sourceManageSeletor().getFile(PrefabPathDefine.Particle2D).source);\r\n\t\t\t\t\t// const startPos = this.node.getComponent(UITransform).convertToNodeSpaceAR(ParticleNode.getWorldPosition());\r\n\t\t\t\t\t// ParticleNode.active = true;\r\n\t\t\t\t\t// console.log(\"ParticleNode\",ParticleNode);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// mainViewModel.rollerPanelViewModel.viewNode.addChild(ParticleNode);\r\n\t\t\t\t\t// ParticleNode.setPosition(startPos)\r\n\t\t\t\t\t// tween(ParticleNode).to(config.subGameRollOption.beetleFlyTime, { position: endPos }).call(() => {\r\n\t\t\t\t\t// \tParticleNode.destroy();\r\n\t\t\t\t\t// }).start()\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprivate removeSingleRollerIcon(index: number) {\r\n\t\tfor (let i = 0; i < this.singleIconRollerViewModels.length; i++) {\r\n\t\t\tconst element = this.singleIconRollerViewModels[i];\r\n\t\t\tif (element.comp.getSlotIndex() === index) {\r\n\t\t\t\telement.unMount();\r\n\t\t\t\tthis.singleIconRollerViewModels.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**删除锁定图标 */\r\n\tpublic removeLockIcon() {\r\n\t\tthis.lockIcons.forEach(v => {\r\n\t\t\tv.borderNode2.active = false;\r\n\t\t\tv.borderNode2.removeFromParent();\r\n\t\t})\r\n\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\t\r\n\t\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t\t}\r\n\t\t// this.lockIcons.forEach(v => v.destory());\r\n\t\tthis.lockIcons = [];\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number) {\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst interval = this.intervalHeight * (index + 1)\r\n\t\tconst y = interval + height / 2 + height * index;\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**替换单个滚动图标 */\r\n\tpublic replaceSingleRollerIcon() {\r\n\t\tconst lockValues = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\tconst v = this.iconArr[i];\r\n\t\t\t// 替换不是甲壳虫和太阳神图标\r\n\t\t\t// if (!this.isSubGame2SpecialIcon(v.getId())) {\r\n\t\t\tif (!lockValues.find(lock => lock.index === i)) {\r\n\t\t\t\tthis.buildSingleRollerIcon(i, v.getPosition(), v);\r\n\t\t\t\tv.getNode().active = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换多个滚动图标 */\r\n\tpublic replaceMultiRollerIcon() {\r\n\t\tthis.singleIconRollerViewModels.forEach(v => {\r\n\t\t\tconst firstIcon = v.comp.getFirstIcon();\r\n\t\t\tfirstIcon.getNode().removeFromParent();\r\n\r\n\t\t\tconst index = v.comp.getSlotIndex();\r\n\t\t\tthis.propertyNode.props_icon_list.addChild(firstIcon.getNode());\r\n\t\t\tfirstIcon.setPosition(this.getIconPosByIndex(index))\r\n\t\t\tthis.iconArr[index] = firstIcon;\r\n\r\n\t\t\tv.unMount();\r\n\t\t})\r\n\r\n\t\tthis.lockIcons = [];\r\n\t\tthis.singleIconRollerViewModels = [];\r\n\t}\r\n\r\n\t/**构建单个图标滚动 */\r\n\tprivate buildSingleRollerIcon(index: number, pos: Vec3, icon: GodWealthV2Icon) {\r\n\t\tconst viewModel = new GodWealthV2SingleIconRollerViewModel()\r\n\t\t\t.mountView(sourceManageSeletor().getFile(PrefabPathDefine.SINGLE_ICON_ROLLER).source)\r\n\t\t\t.appendTo(this.propertyNode.props_icon_list)\r\n\t\tviewModel.viewNode.getComponent(UITransform).height = config.subGameRollOption.singleIconMaskHeight;\r\n\t\tthis.singleIconRollerViewModels.push(viewModel);\r\n\t\tviewModel.viewNode.setPosition(pos);\r\n\r\n\t\tviewModel.comp.initSlot(this.columnIndex, index, icon.getIconIndex(), this.iconPool);\r\n\t}\r\n\r\n\t/**多图标滚动 */\r\n\tprivate multiIconRoller() {\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - this.getRollSpeed()));\r\n\t\t})\r\n\r\n\t\tconst frist = this.iconArr[0];\r\n\t\tif (frist.getPosition().y <= -(frist.getHeight() / 2 + this.intervalHeight)) {\r\n\t\t\tif (this.rollerCount >= 0) {\r\n\t\t\t\tthis.rollerCount++;\r\n\t\t\t}\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[2]\r\n\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\t// console.log(`xxxxxxxxxxx-----columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex},endIcon.getIconIndex():${endIcon.getIconIndex()},this.getStopIconIndex():${this.getStopIconIndex()}`);\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\r\n\t\t\t\t// 结束之后计算每个图标的最终位置，\r\n\t\t\t\tlet count = 0;\r\n\t\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\t\ttween(icon.getNode()).to(0.1, { position: this.getIconPosByIndex(i) }).call(() => {\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\tif (count >= this.iconArr.length) {\r\n\t\t\t\t\t\t\tthis.node && this.node.isValid && this.rollOverHandle();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).start();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isMultiRoll() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**停止单个图标的滚动 */\r\n\tprivate stopSingleRollerIcon() {\r\n\t\tlet count = 0;\r\n\t\tif (this.singleIconRollerViewModels.length === 0) {\r\n\t\t\tthis.isRoll = false;\r\n\t\t\tthis.node && this.node.isValid && this.rollOverHandle();\r\n\t\t} else {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.stopRoll(this.stopIconIndex, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.singleIconRollerViewModels.length) {\r\n\t\t\t\t\tthis.isRoll = false;\r\n\t\t\t\t\tthis.node && this.node.isValid && this.rollOverHandle();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得宝盒上面的数字节点 */\r\n\tpublic getBeetleAmountNode() {\r\n\t\tconst nodes: Node[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (this.isSubGame2SpecialIcon(element.getId())) {\r\n\t\t\t\tconst amountNode = element.getAmountNode();\r\n\t\t\t\tamountNode && nodes.push(amountNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\t/**获得宝盒上面的数字节点 */\r\n\tpublic getBaoHeParticleNode() {\r\n\t\tconst ParticleNodes: Node[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (this.isSubGame2SpecialIcon(element.getId())) {\r\n\t\t\t\tconst ParticleNode = element.getParticleNode();\r\n\t\t\t\tParticleNode && ParticleNodes.push(ParticleNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParticleNodes;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll  && this.iconArr.length > 0) {\r\n\t\t\tif (this.isMultiRoll()) {\r\n\t\t\t\tthis.multiIconRoller();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}