{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/SignInViewModel.ts"],"names":["SignInViewModel","ViewModel","ApiUrl","fetcher","changeGold","constructor","begin","getSignInList","setEvent","requestGetSignInList","requestSign","weekType","signIn","onChangeGold","value","dispatch","unMountCallBack","connect","inject","state","memberInfo","send","GET_MEMBER_SIGN_IN_LIST","then","rsp","setProps","signInDatas","signSuccess","catch","e","SIGN_IN"],"mappings":";;;sEAQMA,e;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARCC,MAAAA,S;;AAEEC,MAAAA,M,iBAAAA,M;;AAEAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;AAGHJ,MAAAA,e,GAAN,MAAMA,eAAN;AAAA;AAAA,kCAAqE;AACnEK,QAAAA,WAAW,GAAG;AACZ,gBAAM,aAAN;AACD;;AAESC,QAAAA,KAAK,GAAG;AAChB,eAAKC,aAAL;AAEA,eAAKC,QAAL,CAAc;AACZC,YAAAA,oBAAoB,EAAE,MAAM;AAC1B,mBAAKF,aAAL;AACD,aAHW;AAIZG,YAAAA,WAAW,EAAGC,QAAD,IAAwB;AACnC,mBAAKC,MAAL,CAAYD,QAAZ;AACD,aANW;AAOZ;AACA;AACA;AACAE,YAAAA,YAAY,EAAGC,KAAD,IAAmB;AAC/B,mBAAKC,QAAL,CAAc;AAAA;AAAA,4CAAWD,KAAX,CAAd;AACD;AAZW,WAAd;AAcD;;AAESE,QAAAA,eAAe,GAAG,CAC3B;;AAEMC,QAAAA,OAAO,GAAG;AACf,eAAKC,MAAL,CAAY,EAAZ,EAAiBC,KAAD,IAAsB;AACpC,mBAAO;AACLC,cAAAA,UAAU,EAAED,KAAK,CAACC;AADb,aAAP;AAGD,WAJD;AAKA,iBAAO,IAAP;AACD;;AAEMb,QAAAA,aAAa,GAAG;AACrB;AAAA;AAAA,kCAAQc,IAAR,CAAa;AAAA;AAAA,gCAAOC,uBAApB,EAA6C,EAA7C,EAAiD,KAAjD,EAAwDC,IAAxD,CAA8DC,GAAD,IAAS;AACpE,iBAAKC,QAAL,CAAc;AACZC,cAAAA,WAAW,EAAEF,GADD;AAEZG,cAAAA,WAAW,EAAE;AAFD,aAAd;AAID,WALD,EAKGC,KALH,CAKUC,CAAD,IAAO,CACd;AACD,WAPD;AAQD;;AAEOjB,QAAAA,MAAM,CAACD,QAAD,EAAqB;AACjC;AAAA;AAAA,kCAAQU,IAAR,CAAa;AAAA;AAAA,gCAAOS,OAApB,EAA6B,EAA7B,EAAiC,MAAjC,EAAyCP,IAAzC,CAA+CC,GAAD,IAAS;AACrD,iBAAKC,QAAL,CAAc;AACZE,cAAAA,WAAW,EAAE;AADD,aAAd;AAGD,WAJD,EAIGC,KAJH,CAIUC,CAAD,IAAO,CACd;AACD,WAND;AAOD;;AAvDkE,O;;yBA0DtD7B,e","sourcesContent":["import ViewModel from \"../../base/ViewModel\"\r\nimport { EffectType } from \"../../utils/NodeIOEffect\"\r\nimport { ApiUrl } from \"../apiUrl\"\r\nimport { Hall_SignIn, IEvent, IProps, WeekType } from \"../components/Hall_SignIn\"\r\nimport { fetcher } from \"../index\"\r\nimport { changeGold } from \"../store/actions/memberInfo\"\r\nimport { StateType } from \"../store/reducer\"\r\n\r\nclass SignInViewModel extends ViewModel<Hall_SignIn, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_SignIn')\r\n  }\r\n\r\n  protected begin() {\r\n    this.getSignInList();\r\n\r\n    this.setEvent({\r\n      requestGetSignInList: () => {\r\n        this.getSignInList();\r\n      },\r\n      requestSign: (weekType: WeekType) => {\r\n        this.signIn(weekType);\r\n      },\r\n      // close: () => {\r\n      //   this.unMount(EffectType.EFFECT2);\r\n      // },\r\n      onChangeGold: (value: number) => {\r\n        this.dispatch(changeGold(value));\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack() {\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      return {\r\n        memberInfo: state.memberInfo\r\n      }\r\n    })\r\n    return this\r\n  }\r\n\r\n  public getSignInList() {\r\n    fetcher.send(ApiUrl.GET_MEMBER_SIGN_IN_LIST, {}, \"get\").then((rsp) => {\r\n      this.setProps({\r\n        signInDatas: rsp,\r\n        signSuccess: false,\r\n      })\r\n    }).catch((e) => {\r\n      //this.dispatch(addToastAction({ content: e }))\r\n    })\r\n  }\r\n\r\n  private signIn(weekType: WeekType) {\r\n    fetcher.send(ApiUrl.SIGN_IN, {}, \"post\").then((rsp) => {\r\n      this.setProps({\r\n        signSuccess: true,\r\n      })\r\n    }).catch((e) => {\r\n      //this.dispatch(addToastAction({ content: e }))\r\n    })\r\n  }\r\n}\r\n\r\nexport default SignInViewModel"]}