{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egypt/Slot/Proxy/SocketProxy.ts"],"names":["SocketProxy","global","lang","addToastAction","CommandDefine","ProxyDefine","BgMediatorConst","RollerMediatorConst","SocketRepository","config","getBgProxy","BaseProxy","SubGameType","goldState","SKT_MAG_TYPE","dataMap","sktMsgListener","add","key","id","handler","sortId","item","find","i","handlerList","push","dispath","data","sort","a","b","forEach","remove","filter","removeAllListener","constructor","proxyName","ws","heartBeatTimer","socketConfig","switcher","repository","initSocket","cbFn","err","WebSocket","OPEN","readyState","close","socketIp","onopen","event","console","log","connectCallback","window","setInterval","sendSktMessage","HEART_BEAT","undefined","onerror","onmessage","ev","onclose","clearInterval","e","sendNotification","SHOW_TOAST","content","evData","JSON","parse","msgArr","code","split","success","gameCode","error","typeCode","hallDispatch","write","k","WebSocketModule","socketConnectDateFail","placeStr","includes","closeSubGame","confirmContent","msgType","send","stringify","closeSocket","sendAnth","AUTH","token","gameId","roomId","calculateTheBalanceStatus","gold","rollerLaunchResult","dl","si","bl","betAmount","getShiftAmount","value","linesQueue","length","InsufficientBalanceDisplay","sendLaunch","openShop","LAUNCH","positionId","userServerData","tableId","direction","userSwitch","SETGREYOUT","state","val","UPDATE_JACKPOT_TOTAL","total","winning","minRate","initUserSwitch","betSwitcher","map","lv","level","amount","setTimeout","getTransferGameInfo","stopIndexArr","rollerId","targetList","_linesDir","wp","freegameDir","freegame","linesDir","lineList","lineIndex","lines","coord","item2","index2","t","item3","getDockIcon","fixedChessboardIcon","line","gameType","MAIN","getIconStay","iconStay","setIconStay","getOpenBoxEffect","lw","getRemainTimes","freeCount","getCurrentScore","order","tbb","tw","freeGameAmount","getMagnification","magnification","getUserLevel","getNumberOfRounds","getUserGold","OLD_GOLD","PROCESS_GOLD","blab","topUpCoins","setGametType","getLocalCacheDataProxy","facade","retrieveProxy","LOCAL_CACHE_DATA","Object","assign","ROLLER","INIT_ROLLER_PANEL","SUB_GAME1","SUB_GAME2","initGameData","UPDATE_USER_GOLD","TOGGLETHESTARTBUTTON","INITSCORE","setGameInfo","JACKPOT","setJackPot","JACKPOT_TOTAL","REFRESHCOINS","VACATETHEROOM","UpdateModule","GameNotice","UPDATE_JACKPOT","jackPotData","gameTypePre","UPDATE_BTN_LABEL","frequency","gameTypeNew","setIsChangeNextGameType","UPDATE_GAME_STATUS","freeGameCount","INITIALIZETHEPANEL"],"mappings":"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","sourcesContent":["import { global, lang } from \"../../../../hall\";\r\nimport { addToastAction } from \"../../../../hall/store/actions/baseBoard\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SocketRepository } from \"../Repositories/SocketRepository\";\r\nimport config from \"../config\";\r\nimport { getBgProxy } from \"../utils\";\r\nimport BaseProxy from \"./BaseProxy\";\r\nimport { LocalCacheDataProxy } from \"./LocalCacheDataProxy\";\r\nexport enum SubGameType {\r\n    /**主滑槽游戏 */\r\n    MAIN,\r\n    /**开宝箱游戏 */\r\n    SUB_GAME1,\r\n    /**大滑槽游戏 */\r\n    SUB_GAME2\r\n}\r\nexport enum goldState {\r\n    /**默认金币 || 结算金币*/\r\n    OLD_GOLD,\r\n    /**扣除金币 */\r\n    PROCESS_GOLD,\r\n    /**充值刷新金币 */\r\n    topUpCoins\r\n}\r\nexport enum SKT_MAG_TYPE {\r\n    /**心跳 */\r\n    HEART_BEAT = \"1\",\r\n    /**认证 */\r\n    AUTH = \"2\",\r\n    /**排行榜 */\r\n    JACKPOT = \"8\",\r\n    /**总数 */\r\n    JACKPOT_TOTAL = \"7\",\r\n    /**退出 */\r\n    EXIT = \"3\",\r\n    /**启动 */\r\n    LAUNCH = \"501\",\r\n    /**通知刷新金币 */\r\n    REFRESHCOINS = \"10\",\r\n    /**清退房间 */\r\n    VACATETHEROOM = \"3\"\r\n}\r\n\r\ntype SktMessageType = {\r\n    code: string,\r\n    messageId: string,\r\n    success: boolean,\r\n    data?: any\r\n}\r\n\r\nlet dataMap: Array<{\r\n    key: SKT_MAG_TYPE,\r\n    handlerList: Array<{\r\n        id: string,\r\n        sortId: number,\r\n        handler: (data: any) => void\r\n    }>\r\n}> = []\r\n/**自定义的监听器 */\r\nexport const sktMsgListener = {\r\n    add: (key: SKT_MAG_TYPE, id: string, handler: (data: any) => void, sortId: number = 0) => {\r\n        let item = dataMap.find(i => i.key === key)\r\n        if (!item) {\r\n            item = {\r\n                key,\r\n                handlerList: [{ id, sortId, handler }]\r\n            }\r\n            dataMap.push(item)\r\n        } else {\r\n            item.handlerList.push({ id, sortId, handler })\r\n        }\r\n    },\r\n    dispath: (key: SKT_MAG_TYPE, data: any) => {\r\n        const item = dataMap.find(i => i.key === key)\r\n        item && item.handlerList.sort((a, b) => a.sortId - b.sortId).forEach(item => item.handler(data))\r\n    },\r\n    remove: (key: SKT_MAG_TYPE, id?: string) => {\r\n        if (id) {\r\n            let item = dataMap.find(item => item.key === key)\r\n            item.handlerList = item.handlerList.filter(item => item.id !== id)\r\n        } else {\r\n            dataMap = dataMap.filter(item => item.key !== key)\r\n        }\r\n    },\r\n    removeAllListener: () => {\r\n        dataMap = []\r\n    }\r\n}\r\n\r\nexport class SocketProxy extends BaseProxy<SocketRepository> {\r\n    private ws: WebSocket\r\n    private heartBeatTimer: number\r\n    private socketConfig: {\r\n        socketIp: string;\r\n        token: string;\r\n        gameId: number;\r\n        roomId: string;\r\n    }\r\n    private switcher = []\r\n    constructor(proxyName: string = null, data: any = null) {\r\n        super(proxyName, data)\r\n        this.repository = new SocketRepository()\r\n        this.socketConfig = null\r\n    }\r\n\r\n    public async initSocket(cbFn: () => void, err: (e) => void) {\r\n        try {\r\n            this.socketConfig = await this.repository.socketConfig()\r\n            if (this.ws && WebSocket.OPEN == this.ws.readyState) {\r\n                this.ws.close()\r\n                this.ws = null\r\n            }\r\n\r\n            this.ws = new WebSocket(this.socketConfig.socketIp)\r\n            /**当连接建立成功后，这个函数就会被调用 */\r\n            this.ws.onopen = (event) => {\r\n                console.log(\"WebSocket connected\")\r\n                this.connectCallback()\r\n                cbFn && cbFn()\r\n                //this.sendSktMessage(SKT_MAG_TYPE.JACKPOT_TOTAL, undefined)\r\n                this.heartBeatTimer = window.setInterval(() => {\r\n                    this.sendSktMessage(SKT_MAG_TYPE.HEART_BEAT, undefined)\r\n                   // this.sendSktMessage(SKT_MAG_TYPE.JACKPOT_TOTAL, undefined)\r\n                }, 5000)\r\n                // this.sendNotification(CommandDefine.START_UP);\r\n            }\r\n            this.ws.onerror = (event) => {\r\n                err && err(event)\r\n            }\r\n            this.ws.onmessage = (ev: MessageEvent<any>) => {\r\n                this.onmessage(ev)\r\n            }\r\n            this.ws.onclose = () => {\r\n                //重连\r\n                window.clearInterval(this.heartBeatTimer)\r\n                this.ws = new WebSocket(this.socketConfig.socketIp)\r\n                console.log(\"exit and reconnect\")\r\n            }\r\n        } catch (e) {\r\n            this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: `网络错误：${e}` })\r\n        }\r\n    }\r\n\r\n    public onmessage(ev: MessageEvent<any> | SktMessageType) {\r\n        const evData = JSON.parse(ev.data) as SktMessageType\r\n        // evData.code !== `${config.gameCode}:-${SKT_MAG_TYPE.HEART_BEAT}` && console.log(evData)\r\n        const msgArr = evData.code.split(\":-\")\r\n        if (evData.success) {\r\n            if (msgArr[0] !== config.gameCode) {\r\n                this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: \"错误的游戏代码\" })\r\n                console.error('服务错误', '错误的游戏代码')\r\n                return\r\n            }\r\n            const typeCode = msgArr[1]//(parseInt(msgArr[1]) * -1) + ''\r\n            sktMsgListener.dispath(typeCode as SKT_MAG_TYPE, evData.data)\r\n        } else {\r\n            global.hallDispatch(addToastAction({ content: lang.write(k => k.WebSocketModule.socketConnectDateFail, {}, { placeStr: \"连接失败\" }) }))\r\n            if (evData['code'].includes('-2')) {\r\n                global.closeSubGame({ confirmContent: evData['reason'] })\r\n            }\r\n            console.error(`服务错误`, evData)\r\n        }\r\n    }\r\n\r\n    public sendSktMessage(msgType: SKT_MAG_TYPE, data: string | ArrayBuffer | Blob | ArrayBufferView | any) {\r\n        this.ws && this.ws.send(JSON.stringify({\r\n            code: `${config.gameCode}:${msgType}`, data\r\n        }))\r\n    }\r\n    public closeSocket() {\r\n        if (this.ws) {\r\n            this.ws.close()\r\n            this.ws = null\r\n        }\r\n    }\r\n    public sendAnth() {\r\n        this.sendSktMessage(SKT_MAG_TYPE.AUTH,\r\n            {\r\n                \"token\": this.socketConfig.token,\r\n                \"gameId\": this.socketConfig.gameId,\r\n                \"roomId\": this.socketConfig.roomId\r\n            }\r\n        )\r\n    }\r\n    public calculateTheBalanceStatus() {\r\n        let gold = this.repository.rollerLaunchResult.dl.si[0].bl\r\n        let betAmount = (this.getShiftAmount(\"curr\").value) * config.linesQueue.length\r\n        this.sendNotification(BgMediatorConst.InsufficientBalanceDisplay, { bl: gold < betAmount });\r\n        return gold < betAmount\r\n    }\r\n    /**发送下注请求 */\r\n    public sendLaunch() {\r\n        // socket断开的时候临时这样搞\r\n        // window.setTimeout(() => {\r\n        //   sktMsgListener.dispath(SKT_MAG_TYPE.LAUNCH, this.repository.rollerLaunchResult)\r\n        // }, 100)\r\n        // return\r\n        let bl = this.calculateTheBalanceStatus()\r\n        if (bl) {\r\n            global.openShop()\r\n        } else {\r\n            this.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n                \"positionId\": this.getShiftAmount(\"curr\").positionId,\r\n                \"tableId\": this.repository.userServerData.tableId\r\n            })\r\n        }\r\n    }\r\n\r\n    /**获取下一档位数据(根据用户级别取得可以下注的额度列表),传max就是获取最大档位 */\r\n    public getShiftAmount(direction: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n        //先获取用户\r\n        if (direction === \"add\" && this.repository.userSwitch < this.switcher.length) {\r\n            this.repository.userSwitch++\r\n        } else if (direction === \"add\" && this.repository.userSwitch === this.switcher.length) {\r\n            //this.repository.userSwitch = 1\r\n        }\r\n\r\n        if (direction === \"subtract\" && this.repository.userSwitch > 1) {\r\n            this.repository.userSwitch--\r\n        } else if (direction === \"subtract\" && this.repository.userSwitch === 1) {\r\n            //this.repository.userSwitch = switcher.length\r\n        }\r\n        if (this.repository.userSwitch != 1 && this.repository.userSwitch !== this.switcher.length) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 0 });\r\n        } else if (this.repository.userSwitch - 1 <= 1) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n        } else {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n        }\r\n        if (direction === \"max\") {\r\n            this.repository.userSwitch = this.switcher.length\r\n        }\r\n        if (this.repository.userSwitch < 6) {\r\n            let val = this.switcher[this.repository.userSwitch - 1].value\r\n            this.sendNotification(BgMediatorConst.UPDATE_JACKPOT_TOTAL, { total: val * config.winning[3].minRate })\r\n        }\r\n        return this.switcher[this.repository.userSwitch - 1]\r\n    }\r\n    public initUserSwitch(val) {\r\n        this.repository.userSwitch = val - 1 < 1 ? 1 : val\r\n        this.switcher = []\r\n        config.betSwitcher.map(item => {\r\n            if (this.repository.userServerData.lv >= item.level[0]) {\r\n                this.switcher.push(...item.amount)\r\n            }\r\n        })\r\n        if (this.repository.userSwitch <= 1) {\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n            }, 200)\r\n        } else if(this.repository.userSwitch == this.switcher.length){\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n            }, 200)\r\n        }\r\n    }\r\n    /**获取转义的游戏数据 */\r\n    public getTransferGameInfo() {\r\n        return {\r\n            // 获取停止的序号\r\n            stopIndexArr: () => {\r\n                // return this.repository.rollerLaunchResult.dl.si[0].rl.map(item => item[0])\r\n                return this.repository.rollerLaunchResult.dl.si[0].rollerId\r\n            },\r\n            /**获取需要闪动的图标列表，转成平铺数组，不闪动的加-1 */\r\n            targetList: () => {\r\n                let _linesDir = this.repository.rollerLaunchResult.dl.si[0].wp\r\n                const freegameDir = this.repository.rollerLaunchResult.dl.si[0].freegame || {}\r\n                const linesDir = {\r\n                    ..._linesDir,\r\n                    ...freegameDir\r\n                }\r\n                const lineList: Array<{ lineIndex: string, coord: Array<Array<any>> }> = []\r\n                for (let lineIndex in linesDir) {\r\n                    const lines: number[][] = linesDir[lineIndex]\r\n                    /**\r\n                     [[0,1],[0,2],[1,1],[2,2]]\r\n                     */\r\n                    const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                    coord.forEach((item2, index2) => {\r\n                        const t = lines.filter((item3) => item3[0] === index2).map(i => i[1]);\r\n                        // const t = lines.find((item3) => item3[0] === index2)\r\n                        t.length && (item2[1] = t)\r\n                    })\r\n                    lineList.push({ lineIndex, coord })\r\n                }\r\n                return lineList\r\n            },\r\n            /**获取需要停靠的图标 */\r\n            getDockIcon: () => {\r\n                let lineList: { lineIndex: string, coord: Array<Array<any>> }\r\n                const lines: number[][] = this.repository.rollerLaunchResult.dl.si[0].fixedChessboardIcon || []\r\n                /**\r\n                 [[0,1],[0,2],[1,1],[2,2]]\r\n                 */\r\n                const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                coord.forEach((item2, index2) => {\r\n                    const t = lines.filter((line) => line[0] === index2).map(i => [i[1], i[2], i[3]]);\r\n                    // const t = lines.find((item3) => item3[0] === index2)\r\n                    t.length && (item2[1] = t)\r\n                })\r\n                return coord\r\n            },\r\n            /**获取gameType */\r\n            gameType: () => {\r\n                if (!this.repository.rollerLaunchResult) {\r\n                    return SubGameType.MAIN\r\n                }\r\n                return this.repository.rollerLaunchResult.dl.si[0].gameType as SubGameType\r\n            },\r\n            getIconStay: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].iconStay\r\n            },\r\n            setIconStay(key) {\r\n                this.repository.rollerLaunchResult.dl.si[0].iconStay = key\r\n            },\r\n            /**获取要执行的宝箱效果 */\r\n            getOpenBoxEffect: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].lw\r\n            },\r\n            /**获取剩余抽奖次数 */\r\n            getRemainTimes: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            /**获取当前的总奖励 */\r\n            getCurrentScore: (order: 'curr' | 'total' | 'auto') => {\r\n                if (this.repository.rollerLaunchResult.dl.si[0].tbb != 0) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].tw\r\n                } else {\r\n                    if (order === 'curr') {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].tw || this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    } else {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    }\r\n                }\r\n            },\r\n            /**获取奖励倍数 */\r\n            getMagnification: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].magnification\r\n            },\r\n            /**获取用户级别 */\r\n            getUserLevel: () => {\r\n                return this.repository.userServerData.lv\r\n            },\r\n            /* 获取第几局*/\r\n            getNumberOfRounds: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            getUserGold: (state: goldState) => {\r\n                if (state === goldState.OLD_GOLD) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].bl\r\n                } else if (state === goldState.PROCESS_GOLD) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].blab\r\n                } else if (state === goldState.topUpCoins) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].bl\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public setGametType(gameType: number) {\r\n        this.repository.rollerLaunchResult.dl.si[0].gameType = gameType\r\n    }\r\n\r\n    public close() {\r\n        this.ws.close()\r\n    }\r\n\r\n    getLocalCacheDataProxy(): LocalCacheDataProxy {\r\n        return <LocalCacheDataProxy>this.facade.retrieveProxy(ProxyDefine.LOCAL_CACHE_DATA);\r\n    }\r\n\r\n    private connectCallback() {\r\n        sktMsgListener.add(SKT_MAG_TYPE.AUTH, 'proxy', (data) => {\r\n            this.repository.userServerData = Object.assign({}, data)\r\n            this.setGametType(data.gameType)\r\n            if (data.gameType === SubGameType.MAIN) {\r\n                //主游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 0 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME1) {\r\n                // 次数游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 1 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME2) {\r\n                //大滑槽\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 2 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            }\r\n            this.initGameData(data)\r\n        })\r\n        sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult = Object.assign({}, data)\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.PROCESS_GOLD })\r\n            if (this.getTransferGameInfo().gameType() === 0) {\r\n                // 按钮状态\r\n                this.sendNotification(BgMediatorConst.TOGGLETHESTARTBUTTON, { state: false });\r\n                this.sendNotification(BgMediatorConst.INITSCORE)\r\n            }\r\n            this.setGameInfo()\r\n        }, 1)\r\n        sktMsgListener.add(SKT_MAG_TYPE.JACKPOT, 'proxy', (data) => {\r\n            this.setJackPot(data)\r\n        }, 1)\r\n        sktMsgListener.add(SKT_MAG_TYPE.JACKPOT_TOTAL, 'proxy', (data) => {\r\n            if (this.repository.userSwitch > 5) {\r\n                this.sendNotification(BgMediatorConst.UPDATE_JACKPOT_TOTAL, { total: data })\r\n            } else {\r\n                let val = this.switcher[this.repository.userSwitch - 1].value\r\n                this.sendNotification(BgMediatorConst.UPDATE_JACKPOT_TOTAL, { total: val * config.winning[3].minRate })\r\n            }\r\n        }, 1)\r\n        // 后台刷新金币\r\n        sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult.dl.si[0].bl = data\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.topUpCoins })\r\n        }, 1)\r\n        // 清退用户\r\n        sktMsgListener.add(SKT_MAG_TYPE.VACATETHEROOM, 'proxy', (data) => {\r\n            global.closeSubGame({ confirmContent: lang.write(k => k.UpdateModule.GameNotice, {}, { placeStr: \"对不起，系统维护中，请稍后再尝试登录\" }) })\r\n        }, 1)\r\n    }\r\n    public setJackPot(data) {\r\n        this.sendNotification(BgMediatorConst.UPDATE_JACKPOT, { jackPotData: data })\r\n    }\r\n    public setGameInfo() {\r\n        const gameTypePre = this.getTransferGameInfo().gameType();\r\n        //更新数据[\r\n        this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL, { frequency: this.getTransferGameInfo().getNumberOfRounds() })\r\n        const gameTypeNew = this.getTransferGameInfo().gameType();\r\n        getBgProxy().setIsChangeNextGameType(gameTypePre, gameTypeNew)\r\n        this.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n    }\r\n    public initGameData(data) {\r\n        this.repository.rollerLaunchResult.dl.si[0].freeCount = data.freeGameCount\r\n        Object.assign(this.repository.rollerLaunchResult.dl.si[0], data)\r\n        this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.OLD_GOLD })\r\n        this.sendNotification(BgMediatorConst.INITIALIZETHEPANEL)\r\n        this.setGameInfo()\r\n    }\r\n}\r\n"]}