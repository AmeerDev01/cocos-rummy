{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_Turntable/Turntable.ts"],"names":["_decorator","assetManager","Button","instantiate","Label","Node","Sprite","SpriteFrame","tween","BaseComponent","EffectType","global","hallAudio","lang","sourceManageSeletor","SKT_MAG_TYPE","sktInstance","sktMsgListener","PrefabPathDefine","SoundPathDefine","addToastAction","ToastType","BaseViewModel","ActivityType","ccclass","property","Turntable","speed","resetPosition","startPosition","CarouselData","str","interval","timer","currentIndex","moveDistance","count","startSpinning","isSpinning","quickStop","slowingDown","spinTime","totalSpinTime","maxAngle","slowdownTime","totalSlowdownTime","turntableData","winData","winState","propertyNode","props_btn_off","props_btn_turntable_arow","props_spr_truntable","props_label_times","props_tum_gift","stopRaAge","rotationData","gift_1","gift_2","gift_3","gift_4","gift_5","gift_6","gift_7","props","TurntableData","events","onClosePanel","setCount","num","setReadStatus","value","start","initState","bindEvent","node","on","EventType","CLICK","hallDispatch","content","write","k","palyingModule","GameExit","placeStr","type","ERROR","remove","TURNTABLESEND","onMouseDown","add","data","TURNPLATE","getComponent","grayscale","playOneShot","WHIRL","string","children","forEach","item","turntableId","turntablePrizeEntity","id","values","name","Number","getRandomBetween","reasonlang","WebSocketModule","ConfigGameFaild","reason","event","sendSktMessage","turntable","useProps","key","turntablePrizeEntities","cur","j","I","loadTurntableImg","setPosition","i","addChild","bindUI","min","max","Math","random","toFixed","picture","loadRemote","err","asset","nativeUrl","spriteFrame","createWithImage","getChildByName","prizeValue","active","HallModule","LoadFaild","update","dt","angle","to","easing","call","loadWin","t","easeInOut","WINLOTTERY","win","mountView","getFile","HELL_ACTIVITY_TURNTABLEWIN","source","appendTo","effectType","EFFECT1","isModal","setEvent","unMount","EFFECT2","setProps","pow","easeOut","sin","PI"],"mappings":"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","sourcesContent":["import { _decorator, assetManager, Button, ImageAsset, instantiate, Label, Node, Sprite, SpriteFrame, tween } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { EffectType } from '../../../utils/NodeIOEffect';\r\nimport { global, hallAudio, lang, sourceManageSeletor } from '../../index';\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from '../../socketConnect';\r\nimport { PrefabPathDefine } from '../../sourceDefine/prefabDefine';\r\nimport { SoundPathDefine } from '../../sourceDefine/soundDefine';\r\nimport { addToastAction, ToastType } from '../../store/actions/baseBoard';\r\nimport BaseViewModel from '../../viewModel/BaseViewModel';\r\nimport { ActivityType } from '../Hall_ActivityPanel';\r\nimport { IEvent as CBEvent, IProps as CBProps, IState as CBState, TurntableWin } from './TurntableWin';\r\nconst { ccclass, property } = _decorator;\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n    TurntableData: any\r\n}\r\nexport interface IEvent {\r\n    onClosePanel: () => void\r\n    setCount: (data) => void,\r\n    setReadStatus?: (value: string) => void,\r\n}\r\n\r\n@ccclass('Turntable')\r\nexport class Turntable extends BaseComponent<IState, IProps, IEvent> {\r\n    speed = 100 // 每秒移动的像素\r\n    resetPosition = -200 // 当节点移动到此位置时重置\r\n    startPosition = 0 // 节点的起始位置\r\n    CarouselData = [{ str: 1 }, { str: 2 }, { str: 3 }]\r\n    interval = 5 // 每条信息显示的时间（秒）\r\n    timer = 0\r\n    currentIndex = 0\r\n    moveDistance = 50 // 文本向上移动的距离\r\n    count = 0 // 文本移动完成所需的时间（秒）\r\n    startSpinning = true\r\n    start() {\r\n\r\n    }\r\n    private isSpinning: boolean = false; // 转盘是否正在旋转\r\n    private quickStop: boolean = false; // 是否快速停止\r\n    private slowingDown: boolean = false; // 是否正在减速\r\n    private spinTime: number = 0; // 当前旋转的时间\r\n    private totalSpinTime: number = 4; // 总旋转时间\r\n    private maxAngle: number = 3600; // 最大旋转角度（10圈）\r\n    private slowdownTime: number = 5; // 减速时间\r\n    private totalSlowdownTime: number = 3; // 总减速时间\r\n    private turntableData: any;\r\n    private winData: any;\r\n    private winState = false\r\n    protected propertyNode = {\r\n        props_btn_off: new Button,\r\n        props_btn_turntable_arow: new Button,\r\n        props_spr_truntable: new Node,\r\n        props_label_times: new Node,\r\n        props_tum_gift: new Node,\r\n    }\r\n    private stopRaAge = 0\r\n    private rotationData = {\r\n        gift_1: [46, 80],\r\n        gift_2: [-14, 28],\r\n        gift_3: [290, 336],\r\n        gift_4: [234, 280],\r\n        gift_5: [180, 226],\r\n        gift_6: [126, 170],\r\n        gift_7: [95, 115],\r\n    }\r\n    public props: IProps = {\r\n        TurntableData: {}\r\n    }\r\n\r\n    public events: IEvent = {\r\n        onClosePanel: () => { },\r\n        setCount: (num) => { },\r\n        setReadStatus: (value: string) => { },\r\n    }\r\n\r\n    protected initState() {\r\n        return {\r\n\r\n        }\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n        this.propertyNode.props_btn_off.node.on(Button.EventType.CLICK, () => {\r\n            if (this.isSpinning) {\r\n                global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.GameExit, {}, { placeStr: \"正在游戏中\" }), type: ToastType.ERROR }))\r\n            } else {\r\n                sktMsgListener.remove(SKT_MAG_TYPE.TURNTABLESEND, \"main\",)\r\n                this.events.onClosePanel()\r\n            }\r\n        })\r\n        this.propertyNode.props_btn_turntable_arow.node.on(Button.EventType.CLICK, this.onMouseDown, this);\r\n        sktMsgListener.add(SKT_MAG_TYPE.TURNTABLESEND, \"main\", (data) => {\r\n            if (this.count > 0) {\r\n                this.count--\r\n                this.winData = data\r\n                if (data.count == 0) {\r\n                    this.events.setReadStatus(ActivityType.TURNPLATE + '')\r\n                    this.propertyNode.props_btn_turntable_arow.getComponent(Sprite).grayscale = true\r\n                }\r\n                this.events.setCount(data)\r\n                hallAudio.playOneShot(SoundPathDefine.WHIRL)\r\n                this.propertyNode.props_label_times.getComponent(Label).string = this.count + ' kali'\r\n                this.propertyNode.props_spr_truntable.children.forEach((item: any) => {\r\n                    if (item.turntableId == data.turntablePrizeEntity.id) {\r\n                        let values = this.rotationData[item.name]\r\n                        this.stopRaAge = Number(this.getRandomBetween(values[0], values[1]))\r\n                        this.startSpinning = true\r\n                        this.isSpinning = true;\r\n                        this.quickStop = false;\r\n                        this.slowingDown = false;\r\n                        this.spinTime = 0;\r\n                    }\r\n                })\r\n\r\n            } else {\r\n                global.hallDispatch(addToastAction({ content: data.reasonlang.write(k => k.WebSocketModule.ConfigGameFaild, {}, { placeStr: data.reason }), type: ToastType.ERROR }))\r\n            }\r\n        })\r\n    }\r\n\r\n    // 处理鼠标点击事件\r\n    onMouseDown(event) {\r\n        if (this.count <= 0) {\r\n            this.events.setReadStatus(ActivityType.TURNPLATE + '')\r\n            this.propertyNode.props_btn_turntable_arow.getComponent(Sprite).grayscale = true\r\n        } else if (this.startSpinning) {\r\n            if (!this.winState) {\r\n                this.startSpinning = false\r\n                if (this.isSpinning) {\r\n                    // 如果已经在旋转，启动快速停止\r\n                    this.quickStop = true;\r\n                    this.slowingDown = true;\r\n                    this.slowdownTime = 0;\r\n                    this.startSpinning = true\r\n                } else {\r\n                    sktInstance.sendSktMessage(SKT_MAG_TYPE.TURNTABLESEND, { turntableId: this.turntableData.turntable.id })\r\n                }\r\n            }\r\n        }\r\n    }\r\n    protected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n        if (key == 'TurntableData') {\r\n            let { turntable, turntablePrizeEntities, count } = value.cur\r\n            this.count = count\r\n            if (this.count <= 0) {\r\n                this.propertyNode.props_btn_turntable_arow.getComponent(Sprite).grayscale = true\r\n            }\r\n            this.turntableData = value.cur\r\n            this.propertyNode.props_label_times.getComponent(Label).string = count + ' kali'\r\n            turntablePrizeEntities.forEach((j, I) => {\r\n                let node: any = instantiate(this.propertyNode.props_tum_gift)\r\n                this.loadTurntableImg(j, node)\r\n                node.setPosition(0, 0)\r\n                this.propertyNode.props_spr_truntable.children.forEach((k: any, i) => {\r\n                    if (I === i) {\r\n                        k.turntableId = j.id\r\n                        k.addChild(node)\r\n                    }\r\n                })\r\n            })\r\n\r\n        }\r\n\r\n    }\r\n    protected bindUI(): void {\r\n\r\n    }\r\n    private getRandomBetween(min, max) {\r\n        return (Math.random() * (max - min) + min).toFixed(0)\r\n    }\r\n    private loadTurntableImg(item, node) {\r\n        item.picture && assetManager.loadRemote(item.picture, (err, asset: ImageAsset) => {\r\n            if (this.propertyNode && !err && (item.picture === asset.nativeUrl)) {\r\n                node.getComponent(Sprite).spriteFrame = SpriteFrame.createWithImage(asset)\r\n                node.getChildByName('props_gift_name').getComponent(Label).string = item.prizeValue + ''\r\n                node.active = true\r\n            }\r\n            if (err) {\r\n                global.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.LoadFaild, {}, { placeStr: \"加载资源失败\" }), type: ToastType.ERROR }))\r\n            }\r\n        })\r\n    }\r\n    update(dt: number) {\r\n        if (this.isSpinning) {\r\n            if (this.slowingDown) {\r\n                this.isSpinning = false;\r\n                this.slowingDown = false\r\n                this.propertyNode.props_spr_truntable.angle = 720\r\n                this.winState = true\r\n                tween(this.propertyNode.props_spr_truntable)\r\n                    .to(5, { angle: this.stopRaAge }, { easing: 'quartOut' })\r\n                    .call(() => {\r\n                        this.loadWin()\r\n                    })\r\n                    .start()\r\n            } else {\r\n                this.spinTime += dt;\r\n                let t = this.spinTime / this.totalSpinTime;\r\n                if (t >= 1) {\r\n                    // 时间到达，停止旋转\r\n                    this.spinTime = 0;\r\n                    this.isSpinning = false;\r\n                    this.propertyNode.props_spr_truntable.angle = 720\r\n                    this.winState = true\r\n                    tween(this.propertyNode.props_spr_truntable)\r\n                        .to(5, { angle: this.stopRaAge }, { easing: 'quartOut' })\r\n                        .call(() => {\r\n                            this.loadWin()\r\n                        })\r\n                        .start()\r\n                    return;\r\n                }\r\n                let speed = this.easeInOut(t);\r\n                this.propertyNode.props_spr_truntable.angle -= speed * dt * this.maxAngle / this.totalSpinTime;\r\n            }\r\n        }\r\n    }\r\n    loadWin() {\r\n        if (this.winData) {\r\n            hallAudio.playOneShot(SoundPathDefine.WINLOTTERY)\r\n            const win = new BaseViewModel<TurntableWin, CBState, CBProps, CBEvent>('TurntableWin').mountView(sourceManageSeletor().getFile(PrefabPathDefine.HELL_ACTIVITY_TURNTABLEWIN).source)\r\n                .appendTo(this.node, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n                    onClosePanel: () => {\r\n                        win.unMount(EffectType.EFFECT2)\r\n                    }\r\n                }).setProps({ TurntableData: this.winData })\r\n            this.winState = false\r\n        }\r\n\r\n    }\r\n    // 自定义缓动函数，启动时更快\r\n    easeInOut(t) {\r\n        if (t < 0.5) {\r\n            return 10 * t * t * t * t; // 初期更加迅速\r\n        }\r\n        else {\r\n            return 1 - Math.pow(-2 * t + 2, 4) / 2;// 中期加速\r\n        }\r\n    }\r\n    // 减速时使用的缓动函数\r\n    easeOut(t) {\r\n        return Math.sin((t * Math.PI) / 2);\r\n    }\r\n}\r\n\r\n"]}