{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealthV2/components/GodWealthV2_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Node","tween","UITransform","Vec3","BaseComponent","IconPool","config","GodWealthV2RollerViewModel","DialogType","GameType","IconId","isAuto","isSubGameToSubGame","RollerStatus","updateRollerStatus","cacheData","changeGame","updateGold","updateSubGameAnimationPlayInfo","updateWinloss","godWealthV2_Audio","mainViewModel","SoundPathDefine","ccclass","property","GodWealthV2_RollerPanel","rollerViewModelArr","iconPool","icon","isManualStop","inStop","isWaitEnding","isAllEnd","rollIndex","propertyNode","props_column_list","props_roller_column","props_column_effect","props","rollerStatus","END","isSpeed","autoLauncherInfo","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","winloss","gold","events","start","initState","initRoller","i","columnCount","column","roller","mountViewNode","appendTo","connect","push","comp","setColumnEffectNode","setEvent","onCheckNextLeftCount","checkNextLeftCount","initSlot","forEach","v","index","startRoll","isMainGame","dispatch","unscheduleAllCallbacks","endRoll","rollTime","scheduleOnce","rollerLaunchResult","node","isValid","stopRollAll","RUNNING","ENDING","stopRoll","rollEndHandle","bind","magnification","dl","si","bigWinConfig","getBigWinConfig","isSubGameLastPoint","auto","winLine","startPlayWinIcon","normalRollOption","winIconFlickerTime","playWildAudio","updateRollerStatusEnd","nextLeftCount","isSubGame2","undefined","isWinWild","playOneShot","WILD","roundTw","tw","isMain","isChangeGame","SUBGAME2","bl","freeGameAmount","isEnterSubGame2","dialogCallback","playBeetleAnimation","removeLockIcon","changeGameHandle","LING","playBaoHeAnimation","SUBGAME1","showDialogWin","dialogType","name","params","count","length","done","nodes","ParticleNodes","concat","getBeetleAmountNode","getBaoHeParticleNode","endPos","getComponent","convertToNodeSpaceAR","getGoodLuckPos","SUN_GOD","p","startPos","getWorldPosition","cloneNode","active","addChild","setPosition","to","subGameRollOption","beetleFlyTime","position","call","destroy","isSubGame","changeToSubGame","changeToMainGame","viewGameCountOver","changeSubGameToSubGame","FREE_GAME_ENTRY","BAO_HE_GAME_ENTRY","freeCount","gameType","param","FREE_GAME_SETTLEMENT","BAO_HE_GAME_SETTLEMENT","winning","find","minRate","maxRate","getIsSpeed","callBack","time","isEnd","rollerComp","stopIconIndex","rollerId","scatterCount","getScatterCount","nextColmunIsBorder","isSpeedBorder","isSubGame1","endColumnIndex","scatter","iconIndex","queue","iconRollerQueue","showIconCount","SCATTER","linePlayTime","wp","lines","key","executeWinIcon","lineNumber","winIconArr","pauseWinIcon","columnIndex","playWinIcon","bindEvent","useProps","value","cur","columnListLayout","rollerWindowX","rollerWindowY","spacingX","columnInterval","replaceMultiRollerIcon","element","bindUI","removeAllChildren","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,W,OAAAA,W;AAAmBC,MAAAA,I,OAAAA,I;;AACjEC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,Q,iBAAAA,Q;;AACFC,MAAAA,M;;AACAC,MAAAA,0B;;AACoBC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,Q,iBAAAA,Q;AAAwBC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,kB,iBAAAA,kB;AAAoBC,MAAAA,Y,iBAAAA,Y;;AAC1FC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,U,iBAAAA,U;AAAYC,MAAAA,8B,iBAAAA,8B;AAAgCC,MAAAA,a,iBAAAA,a;;AACxDC,MAAAA,iB,kBAAAA,iB;AAAmBC,MAAAA,a,kBAAAA,a;;AACnBC,MAAAA,e,kBAAAA,e;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwB3B,U;;yCAyBjB4B,uB,WADZF,OAAO,CAAC,yBAAD,C,gBAAR,MACaE,uBADb;AAAA;AAAA,0CACmF;AAAA;AAAA;AAAA,eAK1EC,kBAL0E,GAKvB,EALuB;AAAA,eAM1EC,QAN0E,GAMrD;AAAA;AAAA,oCAAa;AAAA;AAAA,gCAAOC,IAApB,CANqD;AAAA,eAO1EC,YAP0E,GAOlD,KAPkD;AAAA,eAQ1EC,MAR0E,GAQjE,KARiE;AAAA,eAU1EC,YAV0E,GAU3D,KAV2D;;AAYlF;AAZkF,eAa3EC,QAb2E,GAavD,KAbuD;;AAclF;AAdkF,eAe3EC,SAf2E,GAevD,CAfuD;AAAA,eAgBxEC,YAhBwE,GAgBzD;AACxBC,YAAAA,iBAAiB,EAAE,IAAInC,IAAJ,EADK;AAExBoC,YAAAA,mBAAmB,EAAE,IAAIpC,IAAJ,EAFG;AAGxBqC,YAAAA,mBAAmB,EAAE,IAAIrC,IAAJ;AAHG,WAhByD;AAAA,eAsB3EsC,KAtB2E,GAsB3D;AACtB;AACAC,YAAAA,YAAY,EAAE;AAAA;AAAA,8CAAaC,GAFL;AAGtBC,YAAAA,OAAO,EAAE,KAHa;AAItBC,YAAAA,gBAAgB,EAAE,IAJI;AAKtBC,YAAAA,YAAY,EAAE;AACbC,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASC,IADV;AAEbC,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASD,IAFV;AAGbE,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASF,IAHV;AAIbG,cAAAA,SAAS,EAAE;AAJE,aALQ;AAWtBC,YAAAA,OAAO,EAAE,CAXa;AAYtBC,YAAAA,IAAI,EAAE;AAZgB,WAtB2D;AAAA,eAsC3EC,MAtC2E,GAsC1D,EAtC0D;AAAA;;AAClFC,QAAAA,KAAK,GAAG,CAEP;;AAuCSC,QAAAA,SAAS,GAAG;AACrB,iBAAO,EAAP;AACA;;AACOC,QAAAA,UAAU,GAAG;AACpB,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG;AAAA;AAAA,gCAAOC,WAA3B,EAAwCD,CAAC,EAAzC,EAA6C;AAC5C,kBAAME,MAAM,GAAG3D,WAAW,CAAC,KAAKoC,YAAL,CAAkBE,mBAAnB,CAA1B;AACA,kBAAMsB,MAAM,GAAG;AAAA;AAAA,4EAAiCC,aAAjC,CAA+CF,MAA/C,EAAuDG,QAAvD,CAAgE,KAAK1B,YAAL,CAAkBC,iBAAlF,EAAqG0B,OAArG,EAAf;AACA,iBAAKnC,kBAAL,CAAwBoC,IAAxB,CAA6BJ,MAA7B;AACAA,YAAAA,MAAM,CAACK,IAAP,CAAYC,mBAAZ,CAAgC,KAAK9B,YAAL,CAAkBG,mBAAlD;AACAqB,YAAAA,MAAM,CAACO,QAAP,CAAgB;AACfC,cAAAA,oBAAoB,EAAE,MAAM;AAC3B,qBAAKC,kBAAL;AACA;AAHc,aAAhB;AAKA;AACD;;AAEMC,QAAAA,QAAQ,GAAG;AACjB,eAAK1C,kBAAL,CAAwB2C,OAAxB,CAAgC,CAACC,CAAD,EAAIC,KAAJ,KAAc;AAC7CD,YAAAA,CAAC,CAACP,IAAF,CAAOK,QAAP,CAAgBG,KAAhB,EAAuB,KAAK5C,QAA5B;AACA,WAFD;AAGA;;AAEO6C,QAAAA,SAAS,GAAG;AACnB,gBAAMC,UAAU,GAAG,KAAKnC,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASF,IAArE;;AACA,cAAI4B,UAAJ,EAAgB;AACf,iBAAKC,QAAL,CAAc;AAAA;AAAA,gDAAc,CAAd,CAAd;AACA;;AACD,eAAKC,sBAAL;AACA,eAAKjD,kBAAL,CAAwB2C,OAAxB,CAAgC,CAACC,CAAD,EAAIC,KAAJ,KAAc;AAC7CD,YAAAA,CAAC,CAACP,IAAF,CAAOS,SAAP;AACA,WAFD;AAIA,eAAKI,OAAL;AACA;;AAEOA,QAAAA,OAAO,GAAG;AACjB;AACA,gBAAMC,QAAQ,GAAG,KAAKvC,KAAL,CAAWG,OAAX,GAAqB,GAArB,GAA2B,CAA5C;AAEA,eAAKqC,YAAL,CAAkB,MAAM;AACvB,gBAAI,CAAC;AAAA;AAAA,wCAAUC,kBAAf,EAAmC;AAClC,mBAAKhD,YAAL,GAAoB,IAApB;AACA,aAFD,MAEO;AACN,mBAAKiD,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAAvB,IAAkC,KAAKC,WAAL,EAAlC;AACA;AACD,WAND,EAMGL,QANH;AAOA;;AAEOK,QAAAA,WAAW,CAACrD,YAAqB,GAAG,KAAzB,EAAgC;AAClD,cAAI,KAAKC,MAAT,EAAiB;AAChB;AACA;;AACD,eAAK6C,sBAAL;AAEA,eAAK7C,MAAL,GAAc,IAAd;AACA,eAAKD,YAAL,GAAoBA,YAApB;;AAEA,cAAI;AAAA;AAAA,4CAAasD,OAAb,KAAyB,KAAK7C,KAAL,CAAWC,YAAxC,EAAsD;AACrD,iBAAKmC,QAAL,CAAc;AAAA;AAAA,0DAAmB;AAAA;AAAA,8CAAaU,MAAhC,CAAd;AACA;;AAED,eAAKC,QAAL,CAAc,CAAd,EAAiB,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAjB;AACA;AAED;AACD;AACA;;;AACSD,QAAAA,aAAa,GAAG;AACvB,gBAAME,aAAa,GAAG;AAAA;AAAA,sCAAUT,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCF,aAA5D;AACA,gBAAMG,YAAY,GAAG,KAAKC,eAAL,CAAqBJ,aAArB,CAArB,CAFuB,CAGvB;;AACA,gBAAMK,kBAAkB,GAAG,KAAKvD,KAAL,CAAWK,YAAX,CAAwBK,SAAxB,IAAqC,CAAhE;AAEA,eAAKlB,MAAL,GAAc,KAAd;AACA,gBAAMgE,IAAI,GAAG;AAAA;AAAA,gCAAO,KAAKxD,KAAL,CAAWI,gBAAlB,EAAoC,KAAKJ,KAAL,CAAWK,YAA/C,CAAb;AACA,gBAAMoD,OAAO,GAAG,KAAKC,gBAAL,CAAsB;AAAA;AAAA,gCAAOC,gBAAP,CAAwBC,kBAA9C,EAAkE,MAAM,CACvF,CADe,CAAhB;AAEA,eAAKC,aAAL;;AACA,cAAI,CAACL,IAAD,IAASC,OAAO,KAAK,CAAzB,EAA4B;AAC3B,iBAAKK,qBAAL,CAA2BT,YAA3B,EAAyCG,IAAzC,EAA+CD,kBAA/C;AACA,WAFD,MAEO;AACN;AACA,iBAAKf,YAAL,CAAkB,MAAM;AACvB,mBAAKsB,qBAAL,CAA2BT,YAA3B,EAAyCG,IAAzC,EAA+CD,kBAA/C;AACA,aAFD,EAEG,CAFH;AAGA;;AAED,cAAI,CAACF,YAAL,EAAmB;AAClB,iBAAKxE,aAAL;AACA;AACD;;AAEOgD,QAAAA,kBAAkB,GAAG;AAC5B,gBAAMkC,aAAa,GAAG,KAAK/D,KAAL,CAAWK,YAAX,CAAwB0D,aAA9C,CAD4B,CAE5B;;AACA,cAAI,KAAKC,UAAL,MAAqBD,aAAa,IAAI,CAA1C,EAA6C;AAC5C,iBAAK3B,QAAL,CAAc;AAAA;AAAA,0CAAW,EACxB,GAAG,KAAKpC,KAAL,CAAWK,YADU;AAExBK,cAAAA,SAAS,EAAEqD,aAFa;AAGxBA,cAAAA,aAAa,EAAEE;AAHS,aAAX,CAAd;AAKA;AACD;;AAEOJ,QAAAA,aAAa,GAAG;AACvB,cAAI,KAAKK,SAAL,EAAJ,EAAsB;AACrB;AAAA;AAAA,wDAAkBC,WAAlB,CAA8B;AAAA;AAAA,oDAAgBC,IAA9C;AACA,WAFD,MAEO,CACN;AACA;AACD;;AAEOvF,QAAAA,aAAa,GAAG;AACvB;AACA,gBAAMuE,EAAE,GAAC;AAAA;AAAA,sCAAUX,kBAAV,IAAgC;AAAA;AAAA,sCAAUA,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,CAAzC;AACA,gBAAMiB,OAAO,GAAGjB,EAAE,CAACkB,EAAnB;;AACA,cAAI,KAAKC,MAAL,EAAJ,EAAmB;AAClB,gBAAIF,OAAO,IAAI,CAAf,EAAkB;AACjB;AACA,aAHiB,CAKlB;;;AACA,gBAAI,CAAC,KAAKG,YAAL,EAAD,IAAwB,KAAKxE,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,sCAASiE,QAA9E,EAAwF;AACvF,mBAAKrC,QAAL,CAAc;AAAA;AAAA,kDAAciC,OAAd,CAAd,EADuF,CAEvF;;AACA,mBAAKjC,QAAL,CAAc;AAAA;AAAA,4CAAWgB,EAAE,CAACsB,EAAd,CAAd;AACA,aAViB,CAWlB;AACA;AACA;AACA;AACA;;AACA,WAhBD,MAgBO;AACN,gBAAI,CAAC,KAAKV,UAAL,EAAL,EAAwB;AACvB,oBAAMrD,OAAO,GAAG,KAAKX,KAAL,CAAWW,OAAX,GAAqB0D,OAArC;AACA,mBAAKjC,QAAL,CAAc;AAAA;AAAA,kDAAczB,OAAd,CAAd;AACA,aAHD,MAGO,IAAI,KAAK6D,YAAL,EAAJ,EAAyB;AAC/B;AACA,mBAAKpC,QAAL,CAAc;AAAA;AAAA,kDAAc;AAAA;AAAA,0CAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCuB,cAApD,CAAd;AACA;AACD;AACD;AAGD;AACD;AACA;AACA;AACA;AACA;;;AACSb,QAAAA,qBAAqB,CAACT,YAAD,EAAeG,IAAf,EAA8BD,kBAA9B,EAA2D;AACvF;AACA;AACA,cAAIqB,eAAe,GAAG,KAAtB;AACA,gBAAMJ,YAAY,GAAG,KAAKA,YAAL,EAArB;;AACA,cAAI,CAACI,eAAD,IAAoBvB,YAAxB,EAAsC;AACrC;AACA,kBAAMwB,cAAc,GAAG,MAAM;AAE5B,kBAAIL,YAAJ,EAAkB;AACjB,oBAAI,KAAKxE,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,0CAASgE,QAAlD,IAA8D,KAAKzE,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,0CAASiE,QAApH,EAA8H;AAE7H,uBAAKK,mBAAL,CAAyB,MAAM;AAC9B,yBAAK1C,QAAL,CAAc;AAAA;AAAA,wDAAc;AAAA;AAAA,gDAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCuB,cAApD,CAAd;AACA,yBAAKvC,QAAL,CAAc;AAAA;AAAA,kDAAW;AAAA;AAAA,gDAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCsB,EAAjD,CAAd;AACA,yBAAKtF,kBAAL,CAAwB2C,OAAxB,CAAgC,CAACC,CAAD,EAAIf,CAAJ,KAAU;AACzCe,sBAAAA,CAAC,CAACP,IAAF,CAAOsD,cAAP;AACA,qBAFD,EAH8B,CAM9B;;AACA,yBAAKvC,YAAL,CAAkB,MAAM;AACvB,2BAAKwC,gBAAL,CAAsBzB,kBAAtB;AACA,qBAFD,EAEE,CAFF;AAGA,mBAVD;AAWA,iBAbD,MAaO;AACN,sBAAI,KAAKvD,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,4CAASiE,QAAtD,EAAgE;AAC/D;AAAA;AAAA,gEAAkBN,WAAlB,CAA8B;AAAA;AAAA,4DAAgBc,IAA9C,EAAoD,GAApD,EAAyD,KAAzD;AACA,yBAAKC,kBAAL,CAAwB3B,kBAAxB;AACA,mBAHD,MAGO;AAEN,wBAAI,KAAKvD,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,8CAAS2E,QAAtD,EAAgE;AAC/D;AAAA;AAAA,kEAAkBhB,WAAlB,CAA8B;AAAA;AAAA,8DAAgBc,IAA9C,EAAoD,GAApD,EAAyD,KAAzD;AACA,2BAAKzC,YAAL,CAAkB,MAAM;AACvB,6BAAKwC,gBAAL,CAAsBzB,kBAAtB;AACA,uBAFD,EAEE,CAFF;AAGA,qBALD,MAKO;AACN,2BAAKyB,gBAAL,CAAsBzB,kBAAtB;AACA;AACD;AAED;AACD,eA/BD,MA+BO;AACN,qBAAKnB,QAAL,CAAc;AAAA;AAAA,8DAAmB;AAAA;AAAA,kDAAalC,GAAhC,CAAd;AACA;AAED,aArCD,CAFqC,CAyCrC;;;AACA,iBAAKsC,YAAL,CAAkB,MAAM;AACvB,oBAAMY,EAAE,GAAG;AAAA;AAAA,0CAAUX,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,CAAX;AACA,oBAAMzC,OAAO,GAAG,KAAKqD,UAAL,MAAqBT,kBAArB,GAA0CH,EAAE,CAACuB,cAA7C,GAA8DvB,EAAE,CAACkB,EAAjF,CAFuB,CAGvB;;AACA,mBAAK5B,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAAvB,IAAkC;AAAA;AAAA,kDAAcyC,aAAd,CAA4B;AAC7DC,gBAAAA,UAAU,EAAEhC,YAAY,CAACiC,IADoC;AAE7DC,gBAAAA,MAAM,EAAE,CAAC5E,OAAD;AAFqD,eAA5B,EAG/B,MAAMkE,cAAc,EAHW,CAAlC;AAKA,eAAC,KAAKb,UAAL,EAAD,IAAsB,KAAKnF,aAAL,EAAtB;AACA,aAVD,EAUG,CAVH;AAWA,WArDD,MAqDM;AACL,gBAAI2F,YAAJ,EAAkB;AACjB,kBAAI,KAAKxE,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,wCAASiE,QAAtD,EAAgE;AAC5D;AAEH,qBAAKS,kBAAL,CAAwB3B,kBAAxB;AACA,eAJD,MAIO;AACN,oBAAI,KAAKvD,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,0CAASgE,QAAtD,EAAgE;AAC/D,uBAAKK,mBAAL,CAAyB,MAAM;AAC9B,yBAAK1F,kBAAL,CAAwB2C,OAAxB,CAAgC,CAACC,CAAD,EAAIf,CAAJ,KAAU;AACzCe,sBAAAA,CAAC,CAACP,IAAF,CAAOsD,cAAP;AACA,qBAFD;AAGA,yBAAK3C,QAAL,CAAc;AAAA;AAAA,wDAAc;AAAA;AAAA,gDAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCuB,cAApD,CAAd;AACA,yBAAKK,gBAAL,CAAsBzB,kBAAtB;AACA,yBAAKnB,QAAL,CAAc;AAAA;AAAA,kDAAW;AAAA;AAAA,gDAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCsB,EAAjD,CAAd;AACA,mBAPD;AAQA,iBATD,MASO;AACN,uBAAKM,gBAAL,CAAsBzB,kBAAtB;AACA;AACD;AACD,aAnBD,MAmBO;AACN,mBAAKnB,QAAL,CAAc;AAAA;AAAA,4DAAmB;AAAA;AAAA,gDAAalC,GAAhC,CAAd;AACA;AACD;AAED;AAGD;;;AACQgF,QAAAA,kBAAkB,CAAC3B,kBAAD,EAA8B;AACvD,cAAIiC,KAAK,GAAG,CAAZ;AACA,eAAKpG,kBAAL,CAAwB2C,OAAxB,CAAgCC,CAAC,IAAI;AACpCA,YAAAA,CAAC,CAACP,IAAF,CAAOyD,kBAAP,CAA0B,MAAM;AAC/BM,cAAAA,KAAK;;AACL,kBAAIA,KAAK,IAAI,KAAKpG,kBAAL,CAAwBqG,MAArC,EAA6C;AAC5C,qBAAKT,gBAAL,CAAsBzB,kBAAtB;AACA;AACD,aALD;AAMA,WAPD;AAQA;;AAGOuB,QAAAA,mBAAmB,CAACY,IAAD,EAAO;AACjC,cAAIC,KAAa,GAAG,EAApB;AACA,cAAIC,aAAqB,GAAG,EAA5B;AACA,eAAKxG,kBAAL,CAAwB2C,OAAxB,CAAgCC,CAAC,IAAI;AACpC2D,YAAAA,KAAK,GAAGA,KAAK,CAACE,MAAN,CAAa7D,CAAC,CAACP,IAAF,CAAOqE,mBAAP,EAAb,CAAR;AACAF,YAAAA,aAAa,GAAGA,aAAa,CAACC,MAAd,CAAqB7D,CAAC,CAACP,IAAF,CAAOsE,oBAAP,EAArB,CAAhB;AACA,WAHD;AAKA,gBAAMC,MAAM,GAAG,KAAKtD,IAAL,CAAUuD,YAAV,CAAuBrI,WAAvB,EAAoCsI,oBAApC,CAAyD;AAAA;AAAA,8CAAcC,cAAd,EAAzD,CAAf;AACA,cAAIX,KAAK,GAAG,CAAZ;AACA;AAAA;AAAA,sDAAkBrB,WAAlB,CAA8B;AAAA;AAAA,kDAAgBiC,OAA9C,EAAsD,GAAtD,EAA0D,KAA1D;AACAR,UAAAA,aAAa,CAAC7D,OAAd,CAAsB,CAACsE,CAAD,EAAIpF,CAAJ,KAAU;AAC/B,kBAAMqF,QAAQ,GAAG,KAAK5D,IAAL,CAAUuD,YAAV,CAAuBrI,WAAvB,EAAoCsI,oBAApC,CAAyDG,CAAC,CAACE,gBAAF,EAAzD,CAAjB;AACA,kBAAMC,SAAS,GAAGhJ,WAAW,CAAC6I,CAAD,CAA7B;AACAG,YAAAA,SAAS,CAACC,MAAV,GAAmB,IAAnB;AACA,iBAAK/D,IAAL,CAAUgE,QAAV,CAAmBF,SAAnB;AACAA,YAAAA,SAAS,CAACG,WAAV,CAAsBL,QAAtB;AACAX,YAAAA,KAAK,CAAC1E,CAAD,CAAL,CAASwF,MAAT,GAAkB,KAAlB;AACA9I,YAAAA,KAAK,CAAC6I,SAAD,CAAL,CACEI,EADF,CACK;AAAA;AAAA,kCAAOC,iBAAP,CAAyBC,aAD9B,EAC6C;AAAEC,cAAAA,QAAQ,EAAEf;AAAZ,aAD7C,EAEEgB,IAFF,CAEO,MAAM;AACXR,cAAAA,SAAS,CAACS,OAAV;AACAzB,cAAAA,KAAK;;AACL,kBAAIA,KAAK,IAAIG,KAAK,CAACF,MAAnB,EAA2B;AAC1BC,gBAAAA,IAAI,IAAIA,IAAI,EAAZ;AACA;AACD,aARF,EASE5E,KATF;AAUA,WAjBD,EAXiC,CA8BjC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEOkE,QAAAA,gBAAgB,CAACzB,kBAAD,EAA8B;AACrD,cAAI,KAAK2D,SAAL,CAAe,KAAKlH,KAAL,CAAWK,YAAX,CAAwBG,YAAvC,CAAJ,EAA0D;AACzD,iBAAK2G,eAAL,CAAqB,KAAKnH,KAAL,CAAWK,YAAX,CAAwBG,YAA7C,EAA2D+C,kBAA3D;AACA,WAFD,MAEO,IAAI,KAAKvD,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,oCAASD,IAAtD,EAA4D;AAClE,iBAAK6G,gBAAL,CAAsB,KAAKpH,KAAL,CAAWK,YAAX,CAAwBI,YAA9C;AACA;AACD;AAED;AACD;AACA;AACA;AACA;AACA;;;AACS0G,QAAAA,eAAe,CAAC3G,YAAD,EAAyB6G,iBAAzB,EAAqD;AAE3E,cAAIA,iBAAJ,EAAuB;AACtB,iBAAKC,sBAAL,CAA4B9G,YAA5B;AACA,WAFD,MAEO;AACN;AACA;AACA;AAAA;AAAA,gDAAc4E,aAAd,CAA4B;AAC3BC,cAAAA,UAAU,EAAE,KAAKrF,KAAL,CAAWK,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,wCAAS2E,QAAlD,GAA4D;AAAA;AAAA,4CAAWoC,eAAvE,GAAuF;AAAA;AAAA,4CAAWC,iBADnF;AAE3BjC,cAAAA,MAAM,EAAE,CAAC;AAAA;AAAA,0CAAU9C,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCqE,SAAvC;AAFmB,aAA5B,EAGG,MAAM;AACR;AAEA;AACA;AACA,mBAAKrF,QAAL,CAAc;AAAA;AAAA,oFAA+B;AAC5CsF,gBAAAA,QAAQ,EAAElH,YADkC;AAE5CmH,gBAAAA,KAAK,EAAE,CAFqC,CAEnC;;AAFmC,eAA/B,CAAd;;AAIA,kBAAInH,YAAY,KAAK;AAAA;AAAA,wCAAS2E,QAA9B,EAAwC;AAEvC,qBAAK/C,QAAL,CAAc;AAAA;AAAA,8CAAW;AAAA;AAAA,4CAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCsB,EAAjD,CAAd;AACA;AACD,aAhBD;AAkBA;AAED;AAED;;;AACQ0C,QAAAA,gBAAgB,CAACM,QAAD,EAAqB;AAE5C;AACA;AAEA,cAAI,KAAKR,SAAL,CAAeQ,QAAf,CAAJ,EAA8B;AAC7B;AACA;AAAA;AAAA,gDAActC,aAAd,CAA4B;AAC3BC,cAAAA,UAAU,EAAE,KAAKrF,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,wCAAS0E,QAAlD,GAA4D;AAAA;AAAA,4CAAWyC,oBAAvE,GAA4F;AAAA;AAAA,4CAAWC,sBADxF;AAE3BtC,cAAAA,MAAM,EAAE,CAAC;AAAA;AAAA,0CAAU9C,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCuB,cAAvC;AAFmB,aAA5B,EAGG,MAAM;AACR;AAEA;AACA,mBAAKvC,QAAL,CAAc;AAAA;AAAA,oFAA+B;AAC5CsF,gBAAAA,QAAQ,EAAEA,QADkC;AAE5CC,gBAAAA,KAAK,EAAE,CAFqC,CAEnC;;AAFmC,eAA/B,CAAd,EAJQ,CAQR;;AACA,mBAAKjJ,UAAL,CAAgB;AAAA;AAAA,wCAAS6B,IAAzB;AACA,mBAAK6B,QAAL,CAAc;AAAA;AAAA,4CAAW;AAAA;AAAA,0CAAUK,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCsB,EAAjD,CAAd;AACA,aAdD;AAeA,WAjBD,MAiBO;AACN,iBAAKhG,UAAL,CAAgB;AAAA;AAAA,sCAAS6B,IAAzB;AACA,iBAAK6B,QAAL,CAAc;AAAA;AAAA,0DAAmB;AAAA;AAAA,8CAAalC,GAAhC,CAAd;AACA;AACD;AAED;;;AACQoH,QAAAA,sBAAsB,CAACI,QAAD,EAAqB;AAClD;AACA;AAAA;AAAA,8CAActC,aAAd,CAA4B;AAC3BC,YAAAA,UAAU,EAAE;AAAA;AAAA,0CAAWuC,oBADI;AAE3BrC,YAAAA,MAAM,EAAE,CAAC;AAAA;AAAA,wCAAU9C,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCuB,cAAvC;AAFmB,WAA5B,EAGG,MAAM;AACR;AACA,iBAAKvC,QAAL,CAAc;AAAA;AAAA,kFAA+B;AAC5CsF,cAAAA,QAAQ,EAAEA,QADkC;AAE5CC,cAAAA,KAAK,EAAE,CAFqC,CAEnC;;AAFmC,aAA/B,CAAd,EAFQ,CAMR;;AACA,iBAAKjJ,UAAL,CAAgBgJ,QAAhB;AACA,WAXD;AAYA;AAED;;;AACQlD,QAAAA,YAAY,GAAG;AACtB,cAAI,CAAC,KAAKxE,KAAL,CAAWK,YAAhB,EAA8B;AAC7B,mBAAO,KAAP;AACA;;AAED,cAAI;AAAA;AAAA,wDAAmB,KAAKL,KAAL,CAAWK,YAAX,CAAwBI,YAA3C,EAAyD,KAAKT,KAAL,CAAWK,YAAX,CAAwBG,YAAjF,CAAJ,EAAoG;AACnG,mBAAO,IAAP;AACA;;AAED,iBAAO,KAAKR,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC,KAAKT,KAAL,CAAWK,YAAX,CAAwBG,YAAxE;AACA;;AAEO+D,QAAAA,MAAM,GAAG;AAChB,iBAAO,KAAKvE,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASF,IAAzD;AACA;;AAEO2G,QAAAA,SAAS,CAACQ,QAAD,EAAqB;AACrC,iBAAOA,QAAQ,KAAK;AAAA;AAAA,oCAASvC,QAAtB,IAAkCuC,QAAQ,KAAK;AAAA;AAAA,oCAASjD,QAA/D;AACA;;AAEOnB,QAAAA,eAAe,CAACJ,aAAD,EAAwB;AAC9C,iBAAO;AAAA;AAAA,gCAAO4E,OAAP,CAAeC,IAAf,CAAoB/F,CAAC,IAAIA,CAAC,CAACgG,OAAF,IAAa9E,aAAb,IAA8BA,aAAa,IAAIlB,CAAC,CAACiG,OAA1E,CAAP;AACA;;AACOC,QAAAA,UAAU,GAAG;AACpB,cAAI,KAAKlE,UAAL,EAAJ,EAAuB;AACtB,mBAAO,KAAP;AACA;;AACD,cAAI,KAAKzE,YAAT,EAAuB;AACtB,mBAAO,IAAP;AACA;;AACD,iBAAO,KAAKS,KAAL,CAAWG,OAAlB;AACA;;AAEO4C,QAAAA,QAAQ,CAAC9B,CAAD,EAAYkH,QAAZ,EAAkC;AACjD,gBAAMhI,OAAO,GAAG,KAAKZ,YAAL,GAAoB,IAApB,GAA2B,KAAKS,KAAL,CAAWG,OAAtD,CADiD,CAEjD;;AACA,gBAAMiI,IAAI,GAAG,KAAKF,UAAL,KAAoB,CAApB,GAAwB,GAArC;AACA,gBAAMG,KAAK,GAAGpH,CAAC,IAAI,KAAK7B,kBAAL,CAAwBqG,MAAxB,GAAiC,CAApD;AACA,eAAK/F,QAAL,GAAgBuB,CAAC,IAAI,KAAK7B,kBAAL,CAAwBqG,MAAxB,GAAiC,CAAtD,CALiD,CAMjD;;AAEA,eAAK9F,SAAL,GAAiBsB,CAAjB;AACA,gBAAMqH,UAAU,GAAG,KAAKlJ,kBAAL,CAAwB6B,CAAxB,CAAnB,CATiD,CAUjD;AACA;;AACA,gBAAMsH,aAAa,GAAG;AAAA;AAAA,sCAAU9F,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCoF,QAAtC,CAA+CvH,CAA/C,CAAtB;AAEA,gBAAMwH,YAAY,GAAG,KAAKC,eAAL,CAAqBzH,CAArB,CAArB,CAdiD,CAejD;;AACA,gBAAM0H,kBAAkB,GAAG,KAAKD,eAAL,CAAqBzH,CAAC,GAAG,CAAzB,KAA+B,CAA1D,CAhBiD,CAkBjD;AACA;;AACA,gBAAM2H,aAAa,GAAGH,YAAY,IAAI,CAAtC;AACAH,UAAAA,UAAU,CAAC7G,IAAX,CAAgBsB,QAAhB,CAAyBwF,aAAzB,EAAwC,MAAM;AAC7C,gBAAI,KAAK7F,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAA3B,EAAoC;AACnC,kBAAI0F,KAAJ,EAAW;AACVF,gBAAAA,QAAQ;AACR,eAFD,MAEO;AACNQ,gBAAAA,kBAAkB,IAAI,KAAK5F,QAAL,CAAc9B,CAAC,GAAG,CAAlB,EAAqBkH,QAArB,CAAtB;AACA;AACD;AACD,WARD,EAQGS,aARH,EArBiD,CA8BjD;;AACA,cAAI,KAAK5E,UAAL,EAAJ,EAAuB;AACtB,gBAAI,CAACqE,KAAL,EAAY;AACX,mBAAKtF,QAAL,CAAc9B,CAAC,GAAG,CAAlB,EAAqBkH,QAArB;AACA;AACD,WAJD,MAIO;AACN,aAACQ,kBAAD,IAAuB,KAAKnG,YAAL,CAAkB,MAAM;AAC9C,kBAAI,KAAKE,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAA3B,EAAoC;AACnC,oBAAI,CAAC0F,KAAL,EAAY;AACX,uBAAKtF,QAAL,CAAc9B,CAAC,GAAG,CAAlB,EAAqBkH,QAArB;AACA;AACD;AACD,aANsB,EAMpBC,IANoB,CAAvB;AAOA;AACD;;AAEOpE,QAAAA,UAAU,GAAG;AACpB,iBAAO,KAAKhE,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASgE,QAAzD;AACA;;AACOoE,QAAAA,UAAU,GAAG;AACpB,iBAAO,KAAK7I,KAAL,CAAWK,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAAS0E,QAAzD;AAEA;AAED;;;AACOuD,QAAAA,eAAe,CAACI,cAAD,EAAyB;AAC9C;AACA,cAAIA,cAAc,GAAG,CAAjB,IAAsB,KAAK9E,UAAL,EAA1B,EAA6C;AAC5C,mBAAO,CAAP;AACA;;AACD8E,UAAAA,cAAc,GAAGA,cAAc,IAAI,KAAK1J,kBAAL,CAAwBqG,MAA1C,GAAmD,KAAKrG,kBAAL,CAAwBqG,MAA3E,GAAoFqD,cAArG;AACA,gBAAMN,QAAQ,GAAG;AAAA;AAAA,sCAAU/F,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCoF,QAAvD;AACA,cAAIO,OAAO,GAAG,CAAd;;AACA,eAAK,IAAI9H,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6H,cAApB,EAAoC7H,CAAC,EAArC,EAAyC;AACxC,gBAAI+H,SAAS,GAAGR,QAAQ,CAACvH,CAAD,CAAxB;AACA,kBAAMgI,KAAK,GAAG;AAAA;AAAA,kCAAOC,eAAP,CAAuBjI,CAAvB,CAAd;;AACA,iBAAK,IAAIA,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG;AAAA;AAAA,kCAAO0C,gBAAP,CAAwBwF,aAA5C,EAA2DlI,CAAC,EAA5D,EAAgE;AAC/D,kBAAIgI,KAAK,CAACD,SAAD,CAAL,KAAqB;AAAA;AAAA,oCAAOI,OAAhC,EAAyC;AACxCL,gBAAAA,OAAO;AACP;AACA;;AACD,kBAAI,EAAEC,SAAF,IAAeC,KAAK,CAACxD,MAAzB,EAAiC;AAChCuD,gBAAAA,SAAS,GAAG,CAAZ;AACA;AACD;AACD;;AACD,iBAAOD,OAAP;AACA;AAED;AACD;AACA;AACA;AACA;;;AACSrF,QAAAA,gBAAgB,CAAC2F,YAAD,EAAuB3D,IAAvB,EAA6B;AACpD,cAAIjC,OAAO,GAAG,CAAd;;AACA,cAAI;AAAA;AAAA,sCAAUhB,kBAAd,EAAkC;AACjC,kBAAM6G,EAAE,GAAG;AAAA;AAAA,wCAAU7G,kBAAV,CAA6BU,EAA7B,CAAgCC,EAAhC,CAAmC,CAAnC,EAAsCkG,EAAjD;AACA,kBAAMC,KAAY,GAAG,EAArB;;AACA,iBAAK,MAAMC,GAAX,IAAkBF,EAAlB,EAAsB;AACrBC,cAAAA,KAAK,CAAC/H,IAAN,CAAWgI,GAAX;AACA;;AAED/F,YAAAA,OAAO,GAAG8F,KAAK,CAAC9D,MAAhB;;AAEA,gBAAI8D,KAAK,CAAC9D,MAAN,GAAe,CAAnB,EAAsB;AACrB,mBAAKgE,cAAL,CAAoB,CAAC,CAArB,EAAwBF,KAAxB,EAA+BD,EAA/B,EAAmCD,YAAnC,EAAiD3D,IAAjD;AACA,aAFD,MAEO;AACNA,cAAAA,IAAI;AACJ;AACD;;AACD,iBAAOjC,OAAP;AACA;AAED;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACSgG,QAAAA,cAAc,CAACxH,KAAD,EAAgBsH,KAAhB,EAA8BD,EAA9B,EAAkCD,YAAlC,EAAwD3D,IAAxD,EAA8D;AACnF,cAAI,CAAC;AAAA;AAAA,sCAAUjD,kBAAf,EAAmC;AAClC;AACA;;AACD,cAAIR,KAAK,IAAIsH,KAAK,CAAC9D,MAAnB,EAA2B;AAC1BxD,YAAAA,KAAK,GAAG,CAAC,CAAT;AACAyD,YAAAA,IAAI,IAAIA,IAAI,EAAZ;AACA;;AACD,gBAAMgE,UAAU,GAAGH,KAAK,CAACtH,KAAD,CAAxB;AACA,cAAI0H,UAAU,GAAG,EAAjB;;AACA,cAAI1H,KAAK,KAAK,CAAC,CAAf,EAAkB;AACjBoH,YAAAA,YAAY,GAAG,CAAf;;AACA,iBAAK,MAAMG,GAAX,IAAkBF,EAAlB,EAAsB;AACrBK,cAAAA,UAAU,GAAGA,UAAU,CAAC9D,MAAX,CAAkByD,EAAE,CAACE,GAAD,CAApB,CAAb;AACA;AACD,WALD,MAKO;AACNG,YAAAA,UAAU,GAAGA,UAAU,CAAC9D,MAAX,CAAkByD,EAAE,CAACI,UAAD,CAApB,CAAb,CADM,CAEN;;AACAL,YAAAA,YAAY,GAAGM,UAAU,CAAClE,MAA1B;AACA;;AACD,eAAKrG,kBAAL,CAAwB2C,OAAxB,CAAgCC,CAAC,IAAIA,CAAC,CAACP,IAAF,CAAOmI,YAAP,EAArC;AACAD,UAAAA,UAAU,CAAC5H,OAAX,CAAmBC,CAAC,IAAI;AACvB,kBAAM6H,WAAW,GAAG7H,CAAC,CAAC,CAAD,CAArB;AACA,kBAAMgH,SAAS,GAAGhH,CAAC,CAAC,CAAD,CAAnB;AACA,iBAAK5C,kBAAL,CAAwByK,WAAxB,EAAqCpI,IAArC,CAA0CqI,WAA1C,CAAsDd,SAAtD;AACA,WAJD;AAMA,eAAKxG,YAAL,CAAkB,MAAM;AACvB,iBAAKiH,cAAL,CAAoB,EAAExH,KAAtB,EAA6BsH,KAA7B,EAAoCD,EAApC,EAAwCD,YAAxC,EAAsD3D,IAAtD;AACA,WAFD,EAEG2D,YAFH;AAGA;;AAESU,QAAAA,SAAS,GAAS,CAC3B;;AAESC,QAAAA,QAAQ,CAACR,GAAD,EAAoBS,KAApB,EAAmD;AACpE,cAAI,KAAKvH,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAA3B,EAAoC;AAEnC,gBAAI6G,GAAG,KAAK,cAAZ,EAA4B;AAC3B,kBAAI;AAAA;AAAA,gDAAa3G,OAAb,KAAyBoH,KAAK,CAACC,GAAnC,EAAwC;AACvC,qBAAKhI,SAAL;AACA,eAFD,MAEO,IAAI;AAAA;AAAA,gDAAaY,MAAb,KAAwBmH,KAAK,CAACC,GAAlC,EAAuC;AAC7C,qBAAKtH,WAAL,CAAiB,IAAjB;AACA;AACD,aAND,MAMO,IAAI4G,GAAG,KAAK,cAAZ,EAA4B;AAClC,mBAAK9K,UAAL,CAAgB,KAAKsB,KAAL,CAAWK,YAAX,CAAwBI,YAAxC;AACA;AACD;AACD;;AAEO/B,QAAAA,UAAU,CAACgJ,QAAD,EAAqB;AACtC,gBAAMyC,gBAAgB,GAAG,KAAKvK,YAAL,CAAkBC,iBAAlB,CAAoCoG,YAApC,CAAiDxI,MAAjD,CAAzB;AACA,gBAAMuG,UAAU,GAAG0D,QAAQ,KAAK;AAAA;AAAA,oCAASjD,QAAzC;AACA,gBAAMF,MAAM,GAAGmD,QAAQ,KAAK;AAAA;AAAA,oCAASnH,IAArC;;AACA,cAAIgE,MAAM,IAAIP,UAAd,EAA0B;AACzB,iBAAKtB,IAAL,CAAUqE,QAAV,GAAqB,IAAIlJ,IAAJ,CAAS;AAAA;AAAA,kCAAO8F,gBAAP,CAAwByG,aAAjC,EAAgD;AAAA;AAAA,kCAAOzG,gBAAP,CAAwB0G,aAAxE,CAArB;AACAF,YAAAA,gBAAgB,CAACG,QAAjB,GAA4B;AAAA;AAAA,kCAAO3G,gBAAP,CAAwB4G,cAApD;AACA,WAHD,MAGO;AACN,iBAAK7H,IAAL,CAAUqE,QAAV,GAAqB,IAAIlJ,IAAJ,CAAS;AAAA;AAAA,kCAAOgJ,iBAAP,CAAyBuD,aAAlC,EAAiD;AAAA;AAAA,kCAAOvD,iBAAP,CAAyBwD,aAA1E,CAArB;AACAF,YAAAA,gBAAgB,CAACG,QAAjB,GAA4B;AAAA;AAAA,kCAAOzD,iBAAP,CAAyB0D,cAArD;AACA;;AAED,cAAIhG,MAAJ,EAAY;AACX,iBAAKnF,kBAAL,CAAwB2C,OAAxB,CAAgCC,CAAC,IAAIA,CAAC,CAACP,IAAF,CAAO+I,sBAAP,EAArC;AACA;AACD;;AAEMtG,QAAAA,SAAS,GAAG;AAClB,eAAK,IAAIjD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK7B,kBAAL,CAAwBqG,MAA5C,EAAoDxE,CAAC,EAArD,EAAyD;AACxD,kBAAMwJ,OAAO,GAAG,KAAKrL,kBAAL,CAAwB6B,CAAxB,CAAhB;;AACA,gBAAIwJ,OAAO,CAAChJ,IAAR,CAAayC,SAAb,EAAJ,EAA8B;AAC7B,qBAAO,IAAP;AACA;AACD;;AACD,iBAAO,KAAP;AACA;;AAESwG,QAAAA,MAAM,GAAS;AACxB,eAAK9K,YAAL,CAAkBC,iBAAlB,CAAoC8K,iBAApC;AAEA,eAAK3J,UAAL;AACA;;AAED4J,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACzB,cAAI,KAAKpL,YAAL,IAAqB;AAAA;AAAA,sCAAUgD,kBAAnC,EAAuD;AACtD,iBAAKhD,YAAL,GAAoB,KAApB;AACA,iBAAKiD,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAAvB,IAAkC,KAAKC,WAAL,EAAlC;AACA;AACD;;AAxqBiF,O","sourcesContent":["import { _decorator, instantiate, Layout, Node, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport GodWealthV2RollerViewModel from '../viewModel/GodWealthV2RollerViewModel';\r\nimport { AutoLauncherInfo, DialogType, GameType, GameTypeInfo, IconId, isAuto, isSubGameToSubGame, RollerStatus } from '../type';\r\nimport { updateRollerStatus } from '../store/actions/roller';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { changeGame, updateGold, updateSubGameAnimationPlayInfo, updateWinloss } from '../store/actions/game';\r\nimport { godWealthV2_Audio, mainViewModel } from '../index';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\t/**滚动状态 */\r\n\trollerStatus: RollerStatus,\r\n\t/**是否加速 */\r\n\tisSpeed: boolean,\r\n\t/** 自动运行信息 */\r\n\tautoLauncherInfo: AutoLauncherInfo,\r\n\t/**游戏类型信息 */\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/**总输赢 */\r\n\twinloss: number,\r\n\tgold: number,\r\n\t\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('GodWealthV2_RollerPanel')\r\nexport class GodWealthV2_RollerPanel extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate rollerViewModelArr: GodWealthV2RollerViewModel[] = [];\r\n\tprivate iconPool: IconPool = new IconPool(config.icon);\r\n\tprivate isManualStop: boolean = false;\r\n\tprivate inStop = false;\r\n\r\n\tprivate isWaitEnding = false;\r\n\r\n\t/**所有滚轴结束 */\r\n\tpublic isAllEnd: boolean = false;\r\n\t/** 当前滚轴 */\r\n\tpublic rollIndex: number = 0;\r\n\tprotected propertyNode = {\r\n\t\tprops_column_list: new Node(),\r\n\t\tprops_roller_column: new Node(),\r\n\t\tprops_column_effect: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t/**滚动状态 */\r\n\t\trollerStatus: RollerStatus.END,\r\n\t\tisSpeed: false,\r\n\t\tautoLauncherInfo: null,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\twinloss: 0,\r\n\t\tgold: 0,\r\n\t\t\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\tprivate initRoller() {\r\n\t\tfor (let i = 0; i < config.columnCount; i++) {\r\n\t\t\tconst column = instantiate(this.propertyNode.props_roller_column);\r\n\t\t\tconst roller = new GodWealthV2RollerViewModel().mountViewNode(column).appendTo(this.propertyNode.props_column_list).connect();\r\n\t\t\tthis.rollerViewModelArr.push(roller);\r\n\t\t\troller.comp.setColumnEffectNode(this.propertyNode.props_column_effect);\r\n\t\t\troller.setEvent({\r\n\t\t\t\tonCheckNextLeftCount: () => {\r\n\t\t\t\t\tthis.checkNextLeftCount()\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initSlot() {\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.initSlot(index, this.iconPool);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate startRoll() {\r\n\t\tconst isMainGame = this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t\tif (isMainGame) {\r\n\t\t\tthis.dispatch(updateWinloss(0))\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.startRoll()\r\n\t\t});\r\n\r\n\t\tthis.endRoll();\r\n\t}\r\n\r\n\tprivate endRoll() {\r\n\t\t// 前期滚动的事件\r\n\t\tconst rollTime = this.props.isSpeed ? 0.1 : 1;\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\t\tthis.isWaitEnding = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis.node && this.node.isValid && this.stopRollAll();\r\n\t\t\t}\r\n\t\t}, rollTime)\r\n\t}\r\n\r\n\tprivate stopRollAll(isManualStop: boolean = false) {\r\n\t\tif (this.inStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\r\n\t\tthis.inStop = true;\r\n\t\tthis.isManualStop = isManualStop;\r\n\r\n\t\tif (RollerStatus.RUNNING === this.props.rollerStatus) {\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.ENDING))\r\n\t\t}\r\n\r\n\t\tthis.stopRoll(0, this.rollEndHandle.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * 动画滚动结束处理\r\n\t */\r\n\tprivate rollEndHandle() {\r\n\t\tconst magnification = cacheData.rollerLaunchResult.dl.si[0].magnification;\r\n\t\tconst bigWinConfig = this.getBigWinConfig(magnification)\r\n\t\t// 是否小游戏最后一局\r\n\t\tconst isSubGameLastPoint = this.props.gameTypeInfo.leftCount <= 1;\r\n\r\n\t\tthis.inStop = false;\r\n\t\tconst auto = isAuto(this.props.autoLauncherInfo, this.props.gameTypeInfo);\r\n\t\tconst winLine = this.startPlayWinIcon(config.normalRollOption.winIconFlickerTime, () => {\r\n\t\t});\r\n\t\tthis.playWildAudio()\r\n\t\tif (!auto || winLine === 0) {\r\n\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint);\r\n\t\t} else {\r\n\t\t\t// 中奖之后延迟一点结束\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint);\r\n\t\t\t}, 1)\r\n\t\t}\r\n\r\n\t\tif (!bigWinConfig) {\r\n\t\t\tthis.updateWinloss();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate checkNextLeftCount() {\r\n\t\tconst nextLeftCount = this.props.gameTypeInfo.nextLeftCount;\r\n\t\t// 在转动结束之后如果发现下一局的剩余局数有值，就变更一次\r\n\t\tif (this.isSubGame2() && nextLeftCount >= 0) {\r\n\t\t\tthis.dispatch(changeGame({\r\n\t\t\t\t...this.props.gameTypeInfo,\r\n\t\t\t\tleftCount: nextLeftCount,\r\n\t\t\t\tnextLeftCount: undefined\r\n\t\t\t}))\r\n\t\t}\r\n\t}\r\n\r\n\tprivate playWildAudio() {\r\n\t\tif (this.isWinWild()) {\r\n\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.WILD)\r\n\t\t} else {\r\n\t\t\t// godWealthV2_Audio.playOneShot(SoundPathDefine.haveCoin)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateWinloss() {\r\n\t\t// 本局输赢\r\n\t\tconst si=cacheData.rollerLaunchResult && cacheData.rollerLaunchResult.dl.si[0]\r\n\t\tconst roundTw = si.tw\r\n\t\tif (this.isMain()) {\r\n\t\t\tif (roundTw <= 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// 在切到小游戏2时，输赢金额不更新，因为中奖的金额在加到小游戏里\r\n\t\t\tif (!this.isChangeGame() || this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\t\tthis.dispatch(updateWinloss(roundTw))\r\n\t\t\t\t// 小游戏要在结算时更新余额\r\n\t\t\t\tthis.dispatch(updateGold(si.bl))\r\n\t\t\t}\r\n\t\t\t// this.dispatch(updateWinloss(roundTw))\r\n\t\t\t// if (!this.isChangeGame()) {\r\n\t\t\t// \t// 小游戏要在结算时更新余额\r\n\t\t\t// \tthis.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t// }\r\n\t\t} else {\r\n\t\t\tif (!this.isSubGame2()) {\r\n\t\t\t\tconst winloss = this.props.winloss + roundTw;\r\n\t\t\t\tthis.dispatch(updateWinloss(winloss))\r\n\t\t\t} else if (this.isChangeGame()) {\r\n\t\t\t\t// this.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t\tthis.dispatch(updateWinloss(cacheData.rollerLaunchResult.dl.si[0].freeGameAmount))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * 更新结束滚动状态\r\n\t * @param bigWinConfig 大奖配置\r\n\t * @param auto \r\n\t * @param isSubGameLastPoint 是否小游戏最后一局\r\n\t */\r\n\tprivate updateRollerStatusEnd(bigWinConfig, auto: boolean, isSubGameLastPoint: boolean) {\r\n\t\t// 是否进入小游戏2\r\n\t\t// let isEnterSubGame2 = this.props.gameTypeInfo.viewGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.currGameType === GameType.SUBGAME2;\r\n\t\tlet isEnterSubGame2 = false;\r\n\t\tconst isChangeGame = this.isChangeGame();\r\n\t\tif (!isEnterSubGame2 && bigWinConfig) {\r\n\t\t\t// 大奖提示框消失后的回调\r\n\t\t\tconst dialogCallback = () => {\r\n\r\n\t\t\t\tif (isChangeGame) {\r\n\t\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\r\n\t\t\t\t\t\tthis.playBeetleAnimation(() => {\r\n\t\t\t\t\t\t\tthis.dispatch(updateWinloss(cacheData.rollerLaunchResult.dl.si[0].freeGameAmount))\r\n\t\t\t\t\t\t\tthis.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t\t\t\t\tthis.rollerViewModelArr.forEach((v, i) => {\r\n\t\t\t\t\t\t\t\tv.comp.removeLockIcon()\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t\t\t\t},1)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME2) {\r\n\t\t\t\t\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.LING, 1.0, false)\r\n\t\t\t\t\t\t\tthis.playBaoHeAnimation(isSubGameLastPoint);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME1) {\r\n\t\t\t\t\t\t\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.LING, 1.0, false)\r\n\t\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t\t\t\t\t},1)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\t// 延迟一点点播放大奖\r\n\t\t\tthis.scheduleOnce(() => {\t\r\n\t\t\t\tconst si = cacheData.rollerLaunchResult.dl.si[0];\r\n\t\t\t\tconst winloss = this.isSubGame2() && isSubGameLastPoint ? si.freeGameAmount : si.tw;\r\n\t\t\t\t// 中大奖提示框\r\n\t\t\t\tthis.node && this.node.isValid && mainViewModel.showDialogWin({\r\n\t\t\t\t\tdialogType: bigWinConfig.name,\r\n\t\t\t\t\tparams: [winloss],\r\n\t\t\t\t}, () => dialogCallback())\r\n\r\n\t\t\t\t!this.isSubGame2() && this.updateWinloss();\r\n\t\t\t}, 1)\r\n\t\t}else {\r\n\t\t\tif (isChangeGame) {\r\n\t\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME2) {\r\n\t\t\t\t    // godWealthV2_Audio.playOneShot(SoundPathDefine.LING,1.0,false)\r\n\r\n\t\t\t\t\tthis.playBaoHeAnimation(isSubGameLastPoint);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t\t\t\tthis.playBeetleAnimation(() => {\r\n\t\t\t\t\t\t\tthis.rollerViewModelArr.forEach((v, i) => {\r\n\t\t\t\t\t\t\t\tv.comp.removeLockIcon()\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tthis.dispatch(updateWinloss(cacheData.rollerLaunchResult.dl.si[0].freeGameAmount))\r\n\t\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t\t\t\tthis.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t/**播放宝盒动画，播放完成之后进去切换游戏 */\r\n\tprivate playBaoHeAnimation(isSubGameLastPoint: boolean) {\r\n\t\tlet count = 0;\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tv.comp.playBaoHeAnimation(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.rollerViewModelArr.length) {\r\n\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tprivate playBeetleAnimation(done) {\r\n\t\tlet nodes: Node[] = [];\r\n\t\tlet ParticleNodes: Node[] = [];\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tnodes = nodes.concat(v.comp.getBeetleAmountNode());\r\n\t\t\tParticleNodes = ParticleNodes.concat(v.comp.getBaoHeParticleNode());\r\n\t\t})\r\n\t\r\n\t\tconst endPos = this.node.getComponent(UITransform).convertToNodeSpaceAR(mainViewModel.getGoodLuckPos());\r\n\t\tlet count = 0;\r\n\t\tgodWealthV2_Audio.playOneShot(SoundPathDefine.SUN_GOD,1.0,false)\r\n\t\tParticleNodes.forEach((p, i) => {\r\n\t\t\tconst startPos = this.node.getComponent(UITransform).convertToNodeSpaceAR(p.getWorldPosition());\r\n\t\t\tconst cloneNode = instantiate(p);\r\n\t\t\tcloneNode.active = true;\r\n\t\t\tthis.node.addChild(cloneNode);\r\n\t\t\tcloneNode.setPosition(startPos);\r\n\t\t\tnodes[i].active = false;\r\n\t\t\ttween(cloneNode)\r\n\t\t\t\t.to(config.subGameRollOption.beetleFlyTime, { position: endPos })\r\n\t\t\t\t.call(() => {\r\n\t\t\t\t\tcloneNode.destroy();\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tif (count >= nodes.length) {\r\n\t\t\t\t\t\tdone && done();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.start();\r\n\t\t});\r\n\r\n\t\t// let currentIndex = 0;\r\n\t\r\n\t\t// function flyNextParticle(that) {\r\n\t\t// \tgodWealthV2_Audio.playOneShot(SoundPathDefine.SUN_GOD)\r\n\t\t// \tif (currentIndex >= ParticleNodes.length) {\r\n\t\t// \t\t// 所有粒子都飞完了，执行完成回调\r\n\t\t// \t\tdone && done();\r\n\t\t// \t\treturn;\r\n\t\t// \t}\r\n\t\r\n\t\t// \tconst p = ParticleNodes[currentIndex];\r\n\t\t\t\r\n\t\t// \tconst startPos = that.node.getComponent(UITransform).convertToNodeSpaceAR(p.getWorldPosition());\r\n\t\t// \tconst cloneNode = instantiate(p);\r\n\t\t// \tcloneNode.active = true;\r\n\t\t// \tthat.node.addChild(cloneNode);\r\n\t\t// \tcloneNode.setPosition(startPos);\r\n\t\t// \tnodes[currentIndex].active = false;\r\n\t       \r\n\t\t// \ttween(cloneNode)\r\n\t\t// \t\t.to(config.subGameRollOption.beetleFlyTime, { position: endPos })\r\n\t\t// \t\t.call(() => {\r\n\t\t// \t\t\tcloneNode.destroy();\r\n\t\t// \t\t\tcurrentIndex++;\r\n\t\t// \t\t\tflyNextParticle(that); // 递归调用处理下一个粒子\r\n\t\t// \t\t})\r\n\t\t// \t\t.start();\r\n\t\t// }\r\n\t\r\n\t\t// // 开始飞行第一个粒子\r\n\t\t// flyNextParticle(this);\r\n\t}\r\n\r\n\tprivate changeGameHandle(isSubGameLastPoint: boolean) {\r\n\t\tif (this.isSubGame(this.props.gameTypeInfo.currGameType)) {\r\n\t\t\tthis.changeToSubGame(this.props.gameTypeInfo.currGameType, isSubGameLastPoint);\r\n\t\t} else if (this.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n\t\t\tthis.changeToMainGame(this.props.gameTypeInfo.viewGameType)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 切换到小游戏处理\r\n\t * @param currGameType 当前游戏\r\n\t * @param viewGameCountOver 当前小游戏次数是否结束\r\n\t * @param nextGameType 下一个游戏\r\n\t */\r\n\tprivate changeToSubGame(currGameType: GameType, viewGameCountOver: boolean) {\r\n\t\t\r\n\t\tif (viewGameCountOver) {\r\n\t\t\tthis.changeSubGameToSubGame(currGameType);\r\n\t\t} else {\r\n\t\t\t// console.log(\"changeToSubGame````` gameTypeInfo\",this.props.gameTypeInfo);\r\n\t\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\tdialogType: this.props.gameTypeInfo.currGameType === GameType.SUBGAME1? DialogType.FREE_GAME_ENTRY:DialogType.BAO_HE_GAME_ENTRY,\r\n\t\t\t\tparams: [cacheData.rollerLaunchResult.dl.si[0].freeCount],\r\n\t\t\t}, () => {\r\n\t\t\t\t// console.log(\"dispatch updateSubGameAnimationPlayInfo\",currGameType);\r\n\t\t\t\t\r\n\t\t\t\t// this.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\tgameType: currGameType,\r\n\t\t\t\t\tparam: 0 //开门类型\r\n\t\t\t\t}))\r\n\t\t\t\tif (currGameType === GameType.SUBGAME1) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**切换到主游戏的处理 */\r\n\tprivate changeToMainGame(gameType: GameType) {\r\n\r\n\t\t// console.log(\"changeToMainGame  this.props.gameTypeInfo``````````\",this.props.gameTypeInfo);\r\n\t\t// console.log(\"this.isSubGame(gameType)\",this.isSubGame(gameType),gameType);\r\n\t\t\r\n\t\tif (this.isSubGame(gameType)) {\r\n\t\t\t// 弹出结算面板\r\n\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\tdialogType: this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1? DialogType.FREE_GAME_SETTLEMENT:DialogType.BAO_HE_GAME_SETTLEMENT,\r\n\t\t\t\tparams: [cacheData.rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t\t}, () => {\r\n\t\t\t\t// console.log(\"dispatch updateSubGameAnimationPlayInfo222\",gameType);\r\n\r\n\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\tgameType: gameType,\r\n\t\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t\t}))\r\n\t\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\t\tthis.changeGame(GameType.MAIN);\r\n\t\t\t\tthis.dispatch(updateGold(cacheData.rollerLaunchResult.dl.si[0].bl))\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tthis.changeGame(GameType.MAIN);\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t}\r\n\t}\r\n\r\n\t/**切换小游戏到小游戏，弹出结算面板 */\r\n\tprivate changeSubGameToSubGame(gameType: GameType) {\r\n\t\t// 弹出结算面板\r\n\t\tmainViewModel.showDialogWin({\r\n\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\tparams: [cacheData.rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t}, () => {\r\n\t\t\t// 播放切换游戏动画\r\n\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\tgameType: gameType,\r\n\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t}))\r\n\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\tthis.changeGame(gameType);\r\n\t\t})\r\n\t}\r\n\r\n\t/**是否准备切换游戏 */\r\n\tprivate isChangeGame() {\r\n\t\tif (!this.props.gameTypeInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isSubGameToSubGame(this.props.gameTypeInfo.viewGameType, this.props.gameTypeInfo.currGameType)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this.props.gameTypeInfo.viewGameType !== this.props.gameTypeInfo.currGameType;\r\n\t}\r\n\r\n\tprivate isMain() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t}\r\n\r\n\tprivate isSubGame(gameType: GameType) {\r\n\t\treturn gameType === GameType.SUBGAME1 || gameType === GameType.SUBGAME2\r\n\t}\r\n\r\n\tprivate getBigWinConfig(magnification: number) {\r\n\t\treturn config.winning.find(v => v.minRate <= magnification && magnification <= v.maxRate)\r\n\t}\r\n\tprivate getIsSpeed() {\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.isManualStop) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this.props.isSpeed;\r\n\t}\r\n\r\n\tprivate stopRoll(i: number, callBack: () => void) {\r\n\t\tconst isSpeed = this.isManualStop ? true : this.props.isSpeed;\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = this.getIsSpeed() ? 0 : 0.2;\r\n\t\tconst isEnd = i >= this.rollerViewModelArr.length - 1;\r\n\t\tthis.isAllEnd = i >= this.rollerViewModelArr.length - 1;\r\n\t\t// console.log(\"iiiiiiii\",i);\r\n\t\t\r\n\t\tthis.rollIndex = i;\r\n\t\tconst rollerComp = this.rollerViewModelArr[i];\r\n\t\t// const stopIconIndex = Math.floor(Math.random() * config.iconRollerQueue[i].length);\r\n\t\t// 获得停下来的数据\r\n\t\tconst stopIconIndex = cacheData.rollerLaunchResult.dl.si[0].rollerId[i];\r\n\r\n\t\tconst scatterCount = this.getScatterCount(i);\r\n\t\t// 下一个列是否有边框\r\n\t\tconst nextColmunIsBorder = this.getScatterCount(i + 1) >= 2;\r\n        \r\n\t\t// console.log(\"scatterCount\", scatterCount, i, stopIconIndex);\r\n\t\t// 是否快速边框，前面出现2个以上的scatter，这个参数才为true\r\n\t\tconst isSpeedBorder = scatterCount >= 2;\r\n\t\trollerComp.comp.stopRoll(stopIconIndex, () => {\r\n\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\tif (isEnd) {\r\n\t\t\t\t\tcallBack()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnextColmunIsBorder && this.stopRoll(i + 1, callBack)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, isSpeedBorder)\r\n\t\t// 小游戏2滚轴一起停\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tif (!isEnd) {\r\n\t\t\t\tthis.stopRoll(i + 1, callBack)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t!nextColmunIsBorder && this.scheduleOnce(() => {\r\n\t\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\t\tif (!isEnd) {\r\n\t\t\t\t\t\tthis.stopRoll(i + 1, callBack)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, time)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t\t\r\n\t}\r\n\r\n\t/**获得前面几列的scatter个数 */\r\n\tpublic getScatterCount(endColumnIndex: number) {\r\n\t\t// 前两列不计算数量或者小游戏2也不计算\r\n\t\tif (endColumnIndex < 2 || this.isSubGame2()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tendColumnIndex = endColumnIndex >= this.rollerViewModelArr.length ? this.rollerViewModelArr.length : endColumnIndex;\r\n\t\tconst rollerId = cacheData.rollerLaunchResult.dl.si[0].rollerId;\r\n\t\tlet scatter = 0;\r\n\t\tfor (let i = 0; i < endColumnIndex; i++) {\r\n\t\t\tlet iconIndex = rollerId[i] as number;\r\n\t\t\tconst queue = config.iconRollerQueue[i]\r\n\t\t\tfor (let i = 0; i < config.normalRollOption.showIconCount; i++) {\r\n\t\t\t\tif (queue[iconIndex] === IconId.SCATTER) {\r\n\t\t\t\t\tscatter++;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (++iconIndex >= queue.length) {\r\n\t\t\t\t\ticonIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scatter;\r\n\t}\r\n\r\n\t/**\r\n\t * 显示中奖图标\r\n\t * @param linePlayTime \r\n\t * @param done 所有线路播放完之后执行\r\n\t */\r\n\tprivate startPlayWinIcon(linePlayTime: number, done) {\r\n\t\tlet winLine = 0;\r\n\t\tif (cacheData.rollerLaunchResult) {\r\n\t\t\tconst wp = cacheData.rollerLaunchResult.dl.si[0].wp\r\n\t\t\tconst lines: any[] = [];\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\tlines.push(key);\r\n\t\t\t}\r\n\r\n\t\t\twinLine = lines.length;\r\n\r\n\t\t\tif (lines.length > 0) {\r\n\t\t\t\tthis.executeWinIcon(-1, lines, wp, linePlayTime, done);\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn winLine;\r\n\t}\r\n\r\n\t/**\r\n\t * 播放赢的图标\r\n\t * @param index 线的索引\r\n\t * @param lines 中奖线的数组\r\n\t * @param wp 中间对象\r\n\t * @param linePlayTime 播放一条线的时间\r\n\t * @param done\r\n\t * @returns \r\n\t */\r\n\tprivate executeWinIcon(index: number, lines: any[], wp, linePlayTime: number, done) {\r\n\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (index >= lines.length) {\r\n\t\t\tindex = -1;\r\n\t\t\tdone && done();\r\n\t\t}\r\n\t\tconst lineNumber = lines[index];\r\n\t\tlet winIconArr = [];\r\n\t\tif (index === -1) {\r\n\t\t\tlinePlayTime = 2;\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\twinIconArr = winIconArr.concat(wp[key])\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twinIconArr = winIconArr.concat(wp[lineNumber])\r\n\t\t\t// 一条线中了几个图标就播放多少秒\r\n\t\t\tlinePlayTime = winIconArr.length;\r\n\t\t}\r\n\t\tthis.rollerViewModelArr.forEach(v => v.comp.pauseWinIcon())\r\n\t\twinIconArr.forEach(v => {\r\n\t\t\tconst columnIndex = v[0];\r\n\t\t\tconst iconIndex = v[1];\r\n\t\t\tthis.rollerViewModelArr[columnIndex].comp.playWinIcon(iconIndex);\r\n\t\t})\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.executeWinIcon(++index, lines, wp, linePlayTime, done);\r\n\t\t}, linePlayTime);\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\r\n\t\t\tif (key === 'rollerStatus') {\r\n\t\t\t\tif (RollerStatus.RUNNING === value.cur) {\r\n\t\t\t\t\tthis.startRoll();\r\n\t\t\t\t} else if (RollerStatus.ENDING === value.cur) {\r\n\t\t\t\t\tthis.stopRollAll(true);\t\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'gameTypeInfo') {\r\n\t\t\t\tthis.changeGame(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changeGame(gameType: GameType) {\r\n\t\tconst columnListLayout = this.propertyNode.props_column_list.getComponent(Layout);\r\n\t\tconst isSubGame2 = gameType === GameType.SUBGAME2;\r\n\t\tconst isMain = gameType === GameType.MAIN;\r\n\t\tif (isMain || isSubGame2) {\r\n\t\t\tthis.node.position = new Vec3(config.normalRollOption.rollerWindowX, config.normalRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.normalRollOption.columnInterval;\r\n\t\t} else {\r\n\t\t\tthis.node.position = new Vec3(config.subGameRollOption.rollerWindowX, config.subGameRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.subGameRollOption.columnInterval;\r\n\t\t}\r\n\r\n\t\tif (isMain) {\r\n\t\t\tthis.rollerViewModelArr.forEach(v => v.comp.replaceMultiRollerIcon());\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isWinWild() {\r\n\t\tfor (let i = 0; i < this.rollerViewModelArr.length; i++) {\r\n\t\t\tconst element = this.rollerViewModelArr[i];\r\n\t\t\tif (element.comp.isWinWild()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_column_list.removeAllChildren();\r\n\r\n\t\tthis.initRoller();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isWaitEnding && cacheData.rollerLaunchResult) {\r\n\t\t\tthis.isWaitEnding = false;\r\n\t\t\tthis.node && this.node.isValid && this.stopRollAll();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}