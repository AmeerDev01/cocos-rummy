{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thorV2/components/ThorV2_SubGameCalculate.ts"],"names":["_decorator","Label","Node","sp","BaseComponent","thorv2_Audio","DialogType","GameType","isAuto","StepNumber","config","getNodeByNameDeep","SoundPathDefine","ccclass","property","ThorV2_SubGameCalculate","stepNumber","propertyNode","props_calcuate_box","props_node_start","props_node_end","props","dialogInfo","gameTypeInfo","lastGameType","NONE","currGameType","viewGameType","leftCount","autoLauncherInfo","events","onUnMount","onWindowCloseHandler","start","initState","bindEvent","node","on","EventType","TOUCH_END","dialogType","useProps","key","value","isValid","FREE_GAME_ENTRY","showFreeEntry","FREE_GAME_SETTLEMENT","showFreeSettlement","stop","play","THOR_FREE_DIALOG_WAIT","getComponent","Skeleton","setAnimation","active","labelNode","string","params","detryCloseWindow","playOneShot","THOR_FREE_SUMMARY","numberLabel","startStepNumber","label","end","done","num","Number","toFixed","formatAmountWithCommas","set","normalRollOption","numberRollerTime","scheduleOnce","dialogWinShowTime","onDestroy","longStop","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Label, Node, sp } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { thorv2_Audio } from '../index';\r\nimport { AutoLauncherInfo, DialogInfo, DialogType, GameType, GameTypeInfo, isAuto } from '../type';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport config from '../config';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tdialogInfo?: DialogInfo,\r\n\tgameTypeInfo?: GameTypeInfo,\r\n\t/** 自动运行信息 */\r\n\tautoLauncherInfo?: AutoLauncherInfo\r\n}\r\nexport interface IEvent {\r\n\tonUnMount: () => void\r\n\tonWindowCloseHandler: (dialogType: DialogType) => void\r\n}\r\n\r\n@ccclass('ThorV2_SubGameCalculate')\r\nexport class ThorV2_SubGameCalculate extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate stepNumber: StepNumber;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_calcuate_box: new Node(),\r\n\t\tprops_node_start: new Node(),\r\n\t\tprops_node_end: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tdialogInfo: null,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.NONE,\r\n\t\t\tcurrGameType: GameType.NONE,\r\n\t\t\tviewGameType: GameType.NONE,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\tautoLauncherInfo: null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonUnMount: () => { },\r\n\t\tonWindowCloseHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onUnMount();\r\n\t\t\tthis.events.onWindowCloseHandler(this.props.dialogInfo.dialogType);\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps | '_setDone', value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === '_setDone') {\r\n\t\t\t\tif (this.props.dialogInfo.dialogType === DialogType.FREE_GAME_ENTRY) {\r\n\t\t\t\t\tthis.showFreeEntry();\r\n\t\t\t\t} else if (this.props.dialogInfo.dialogType === DialogType.FREE_GAME_SETTLEMENT) {\r\n\t\t\t\t\tthis.showFreeSettlement();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate showFreeEntry() {\r\n\t\tthorv2_Audio.stop();\r\n\t\tthorv2_Audio.play(SoundPathDefine.THOR_FREE_DIALOG_WAIT, true)\r\n\t\tthis.propertyNode.props_calcuate_box.getComponent(sp.Skeleton).setAnimation(0, 'keep', true)\r\n\t\tthis.propertyNode.props_node_start.active = true;\r\n\t\tconst labelNode = getNodeByNameDeep(\"props_label_sgNum\", this.propertyNode.props_node_start)\r\n\t\tlabelNode.getComponent(Label).string = this.props.dialogInfo.params[0];\r\n\r\n\t\t// 如果是自动模式，就等待关闭窗口\r\n\t\tif (isAuto(this.props.autoLauncherInfo, this.props.gameTypeInfo)) {\r\n\t\t\tthis.detryCloseWindow();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate showFreeSettlement() {\r\n\t\tthorv2_Audio.playOneShot(SoundPathDefine.THOR_FREE_SUMMARY)\r\n\t\tthis.propertyNode.props_calcuate_box.getComponent(sp.Skeleton).setAnimation(0, 'keep2', true)\r\n\t\tthis.propertyNode.props_node_end.active = true;\r\n\t\tconst numberLabel = getNodeByNameDeep(\"props_label_goldNum\", this.propertyNode.props_node_end)\r\n\r\n\t\tthis.startStepNumber(numberLabel.getComponent(Label), 0, this.props.dialogInfo.params[0], () => {\r\n\t\t\t// 如果是自动模式，就等待关闭窗口\r\n\t\t\tif (this.node && this.node.isValid && isAuto(this.props.autoLauncherInfo, this.props.gameTypeInfo)) {\r\n\t\t\t\tthis.detryCloseWindow();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tprivate startStepNumber(label: Label, start, end, done) {\r\n\t\tthis.stepNumber = new StepNumber(start, end, (num) => {\r\n\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\tlabel.string = Number(num.toFixed(0)).formatAmountWithCommas();\r\n\t\t\t}\r\n\t\t}, () => this.node && this.node.isValid && done());\r\n\t\tthis.stepNumber.set(config.normalRollOption.numberRollerTime).start();\r\n\t}\r\n\r\n\tprivate detryCloseWindow() {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\tthis.events.onUnMount();\r\n\t\t\t\tthis.events.onWindowCloseHandler(this.props.dialogInfo.dialogType);\r\n\t\t\t}\r\n\t\t}, config.normalRollOption.dialogWinShowTime)\r\n\t}\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tthis.stepNumber && this.stepNumber.stop();\r\n\t\tthorv2_Audio.longStop();\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}