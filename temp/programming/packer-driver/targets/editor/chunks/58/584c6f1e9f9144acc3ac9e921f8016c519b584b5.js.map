{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/bandar/index.ts"],"names":["Prefab","assetManager","bundlePkgName","PrefabPathDefine","LoaderPanelViewModel","BandarFileMap","SubGameRunState","config","subGameList","dtConfig","socketConnect","GameBoardViewModel","AudioMgr","SoundPathDefine","UseSetOption","global","lang","setSubGameRunState","sourceManageMap","bundleCommon","bundleBanDar","sourceManageSelector","bundleName","find","i","bundle","name","startUp","rootNode","loadBundle","err","commonBundle","load","LOADING_PANEL","progress","total","hallDispatch","LOADING","setSubGameGate","gameId","prefab","isAllowOpenSubGame","READY","loaderViewModel","mountView","appendTo","setProps","loadBarType","setEvent","onLoadDone","_sourceManageMap","bandar_Audio","gameConfig","item","comp","setTipContent","write","k","WebSocketModule","GameInit","placeStr","RUN","then","unMount","mainGameViewModel","getFile","MAIN_GAME","source","connect","play","MAIN_BG","Instance","option","music","catch","e","versionStr","md5","startLoad","playMainBg","playGame","playOneShot","START_BET","playBtnClick","BTN_CLICK","playChip","FLY_CHIP","playTimeout","TIME_OUT","playGetCoin","GET_COIN","playTurnCard","TURN_CARD","playDealCard","DEAL_CARD","stopBet","STOP_BET","playMyWin","MY_WIN","playMyLose","MY_LOSE","playChooseChip","CHOOSE_CHIP"],"mappings":"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","sourcesContent":["import { AssetManager, Node, Prefab, assetManager, find, instantiate, log } from \"cc\"\r\nimport bandarStore from './store';\r\nimport { bundlePkgName } from \"./sourceDefine\";\r\nimport { PrefabPathDefine } from \"./sourceDefine/prefabDefine\";\r\nimport LoaderPanelViewModel from \"../../common/viewModel/LoaderPanelViewModel\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport BandarFileMap from './sourceDefine';\r\nimport { SubGameRunState, config, subGameList } from \"../../hall/config\";\r\nimport dtConfig from \"./config\";\r\nimport socketConnect from \"./socketConnect\";\r\nimport GameBoardViewModel from \"./viewModel/BandarGameBoardViewModel\";\r\nimport { listenerFactoy } from \"../../common/listenerFactoy\";\r\nimport { AudioMgr } from \"../../utils/AudioMgr\";\r\nimport { SoundPathDefine } from \"./sourceDefine/soundDefine\";\r\nimport UseSetOption, { setActiveAudio } from \"../../utils/UseSetOption\";\r\nimport { global, lang } from \"../../hall\";\r\nimport { setSubGameRunState } from \"../../hall/store/actions/baseBoard\";\r\n\r\nlet sourceManageMap: Array<SourceManage> = []\r\nexport let bundleCommon: AssetManager.Bundle = null\r\nexport let bundleBanDar: AssetManager.Bundle = null\r\nexport let mainGameViewModel: GameBoardViewModel\r\nexport let bandar_Audio: AudioMgr<SoundPathDefine>\r\nexport const sourceManageSelector = (bundleName: string = 'bandar') => sourceManageMap.find(i => i.bundle.name === bundleName)\r\n\r\n\r\nexport const startUp = (rootNode: Node) => {\r\n\r\n  assetManager.loadBundle(\"common\", (err, commonBundle) => {\r\n    bundleCommon = commonBundle\r\n    assetManager.loadBundle(bundlePkgName, Prefab, (err, bundle) => {\r\n      bundleBanDar = bundle\r\n      bundleBanDar.load(PrefabPathDefine.LOADING_PANEL, Prefab, (progress, total) => {\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.LOADING))\r\n        global.setSubGameGate(dtConfig.gameId, (progress / total))\r\n      }, (err, prefab) => {\r\n        if (!global.isAllowOpenSubGame(dtConfig.gameId)) return\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.READY))\r\n        const loaderViewModel = new LoaderPanelViewModel().mountView(prefab).appendTo(rootNode).setProps({\r\n          loadBarType: 1\r\n        }).setEvent({\r\n          onLoadDone: (_sourceManageMap) => {\r\n            sourceManageMap = _sourceManageMap\r\n            bandar_Audio = new AudioMgr<SoundPathDefine>(sourceManageSelector(\"bandar\"))\r\n            config.gameConfig.find(item => item.name === \"bandar\")\r\n            loaderViewModel.comp.setTipContent(lang.write(k => k.WebSocketModule.GameInit, {}, { placeStr: \"Game init...\" }))\r\n            global.hallDispatch(setSubGameRunState(SubGameRunState.RUN))\r\n            socketConnect().then(() => {\r\n              loaderViewModel.unMount().then(() => {\r\n\r\n                mainGameViewModel = new GameBoardViewModel().mountView(sourceManageSelector(\"bandar\").getFile(PrefabPathDefine.MAIN_GAME).source).appendTo(rootNode).connect()\r\n                bandar_Audio.play(SoundPathDefine.MAIN_BG, UseSetOption.Instance().option.music)\r\n              })\r\n            }).catch(e => loaderViewModel.comp.setTipContent(e || 'error'))\r\n          }\r\n        })\r\n          .setProps({\r\n            versionStr: `md5: ${subGameList.find(i => i.gameId === dtConfig.gameId).md5}`\r\n          })\r\n        loaderViewModel.comp.startLoad([bundle], [...BandarFileMap])\r\n\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 背景音乐\r\n */\r\nexport const playMainBg = () => {\r\n  bandar_Audio.play(SoundPathDefine.MAIN_BG, true);\r\n}\r\n/**\r\n* 游戏开始\r\n*/\r\nexport const playGame = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.START_BET);\r\n}\r\n/**\r\n* 按钮单击音效\r\n*/\r\nexport const playBtnClick = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.BTN_CLICK);\r\n}\r\n\r\n/**\r\n* 下注飞筹码音效\r\n*/\r\nexport const playChip = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.FLY_CHIP);\r\n}\r\n\r\n/**\r\n* 3秒倒计时\r\n*/\r\nexport const playTimeout = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.TIME_OUT);\r\n}\r\n/**\r\n* 金币收集音效\r\n*/\r\nexport const playGetCoin = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.GET_COIN);\r\n}\r\n/**\r\n* 翻牌声\r\n*/\r\nexport const playTurnCard = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.TURN_CARD);\r\n}\r\n\r\n/**\r\n* 发牌声\r\n*/\r\nexport const playDealCard = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.DEAL_CARD);\r\n}\r\n\r\n/**\r\n* 停止下注\r\n*/\r\nexport const stopBet = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.STOP_BET);\r\n}\r\n/**\r\n * 玩家赢\r\n */\r\nexport const playMyWin = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.MY_WIN);\r\n}\r\n\r\n/**\r\n * 玩家输\r\n */\r\nexport const playMyLose = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.MY_LOSE);\r\n}\r\n\r\n/**\r\n * 选择筹码\r\n */\r\nexport const playChooseChip = () => {\r\n  bandar_Audio.playOneShot(SoundPathDefine.CHOOSE_CHIP);\r\n}"]}