{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/domino/components/Domino_MainBoard.ts"],"names":["_decorator","bezier","instantiate","Label","misc","Node","Toggle","tween","UIOpacity","UITransform","Vec3","BaseComponent","config","playBtnClick","playCoin","playFapai","playGameBegin","sourceManageSeletor","PrefabPathDefine","CardPosition","DeskStatus","genCardItem","getComposeCardValue","PlayerSatus","CardViewModel","ccclass","property","Domino_MainBoard","middleCardView","leftLastCardView","rightLastCardView","lastCardView","leftViews","rightViews","leftOutlineNode","rightOutlineNode","beginGameCountdownT","beginGameCountdownCount","outCardAreaInitX","outCardAreaInitY","propertyNode","props_btn_title_menu","props_player_wrap","props_center_cards_wrap","props_spr_turn_up","props_out_cards","props_btn_title_shop","props_spr_gold","props_domino_begin_cutdown","props_label_cutdown_num","props","statue","WAITING","noShowCardNumber","outCardItem","leftOutCardItem","rightOutCardItem","playerMap","lastActiveSeatIndex","currActiveSeatIndex","newCardItem","intendOutCard","quitRoomAction","readyCountdown","gold","balanceOdds","events","openSetPanel","toggle","openShopPanel","flyCard","cardPanelNode","cardNode","seatIndex","getSeatPosition","onQuitRoom","dealerBeginOut","start","initState","bindEvent","on","EventType","TOGGLE","getComponent","isChecked","TOUCH_END","useProps","key","value","console","log","DISTRIBUTE","beginDistributeCards","resetOutCardArea","clearData","playCardTip","COUNTDOWNING","time","beginGameCountdown","cur","removeOutlineNode","addCardItem","addOutlineNode","updateBalanceOdds","bindUI","active","position","x","y","setPosition","getDealNumber","getGameCount","filter","v","gameData","state","length","addCardUIOpacity","children","forEach","addComponent","opacity","getFile","SEND_CARD","source","addChild","beginDeal","getDealderSeatIndex","index","total","node","isValid","scheduleOnce","destroy","dealAnimeSpeed","getChildByName","getNextSeatIndex","dealer","find","isMaster","lastIndex","count","seatNumber","nextIndex","player","READY","endPostiton","setSiblingIndex","endPos","convertToWorldSpaceAR","duration","to","worldPosition","call","getOutCardWrapNode","getPlayerWrapNode","isAnima","angle","cardItem","addCard","azimuth","isReconnect","symbol","isOutline","isHide","lastViews","lastView","cardPosition","upFace","downFace","VERTICAL","HORIZONTAL","cellCount","vericalEndCellCount","secondLineCellCount","isBend","calCellCount","getOriginalWidth","isVericalEnd","getVericalEndCellCount","getVericalEndIndex","isHorizontal","poseAzimuth","prefabPath","CARD","cardViewModel","mountView","setInitHide","appendTo","setProps","alignValue","type","isShow","isBright","connect","cardWidth","getWidth","laseWidth","xOffset","getOriginalHeight","comp","outCardAreaY","isVertical","moveOutCardArea","horizontal","setOpacity","push","isAddOutline","cardItems","composeCardValue","composeCardItem","undefined","views","startIndex","endIndex","i","getCellCount","element","flyGold","done","transform","tweenNode","playGoldTween","startPos","convertToNodeSpaceAR","setWorldPosition","getMidPoint","fromPos","toPos","centerX","centerY","getMidVerticalPoint","offsetAngin","midPoint","bafAngle","calAngle","radian","degreesToRadians","zhongdian","clone","subtract","cd","Math","tan","dg","sin","gc","cos","midDisPoint","atan2","PI","playTime","callBack","startAngle","eulerAngles","fruitTween","mid","mixY","maxY","mixX","maxX","progressX","end","current","t","progressY","parallel","easing","progress","onUpdate","outFlyCard","isDisable","lastCard","endNode","speed","scale","unMount","removeAllChildren","getBeginGameCountdownCount","setBeginGameCountdownCount","destroyCallBack","window","clearInterval","updateGeginGameCountdownLabel","setInterval","string","recentCardView","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, bezier, instantiate, Label, misc, Node, Toggle, tween, UIOpacity, UITransform, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport config from '../config';\r\nimport { playBtnClick, playCoin, playFapai, playGameBegin, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { CardItem, CardPosition, Countdown, DeskStatus, genCardItem, getComposeCardValue, Player, PlayerSatus } from '../type';\r\nimport CardViewModel from '../viewModel/CardViewModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tstatue: DeskStatus\r\n\t/**还未显示的牌点 */\r\n\tnoShowCardNumber: number[]\r\n\t/**已经在桌面打出的牌组 */\r\n\toutCardItem: CardItem[],\r\n\t/**左边出牌 */\r\n\tleftOutCardItem: CardItem[],\r\n\t/**右边出牌 */\r\n\trightOutCardItem: CardItem[],\r\n\t/**玩家 */\r\n\tplayerMap: Player[],\r\n\t/**上一个做动作的玩家 */\r\n\tlastActiveSeatIndex: number,\r\n\t/**当前要做动作的用户 */\r\n\tcurrActiveSeatIndex: number,\r\n\t/**最新出的牌 */\r\n\tnewCardItem: CardItem,\r\n\t/**准备出的牌 */\r\n\tintendOutCard: CardItem,\r\n\tquitRoomAction: number,\r\n\t/**准备倒计时 */\r\n\treadyCountdown: Countdown,\r\n\tgold: number,\r\n\tbalanceOdds: number,\r\n}\r\nexport interface IEvent {\r\n\topenSetPanel: (toggle: boolean) => void,\r\n\topenShopPanel: () => void,\r\n\tflyCard: (cardPanelNode: Node, cardNode: Node, seatIndex: number) => void,\r\n\tgetSeatPosition: (seatIndex: number) => Vec3,\r\n\tonQuitRoom: () => void,\r\n\t/**庄家开始出牌 */\r\n\tdealerBeginOut: () => void,\r\n}\r\n\r\n@ccclass('Domino_MainBoard')\r\nexport class Domino_MainBoard extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate middleCardView: CardViewModel;\r\n\tprivate leftLastCardView: CardViewModel;\r\n\tprivate rightLastCardView: CardViewModel;\r\n\tprivate lastCardView: CardViewModel;\r\n\r\n\tprivate leftViews: CardViewModel[] = [];\r\n\tprivate rightViews: CardViewModel[] = [];\r\n\r\n\tprivate leftOutlineNode: Node;\r\n\tprivate rightOutlineNode: Node;\r\n\r\n\tprivate beginGameCountdownT = 0;\r\n\tprivate beginGameCountdownCount = 0;\r\n\r\n\tprivate outCardAreaInitX = 0;\r\n\tprivate outCardAreaInitY = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_title_menu: new Node(),\r\n\t\tprops_player_wrap: new Node(),\r\n\t\t/**放置出牌的队列 */\r\n\t\tprops_center_cards_wrap: new Node(),\r\n\t\tprops_spr_turn_up: new Node(),\r\n\t\tprops_out_cards: new Node(),\r\n\t\tprops_btn_title_shop: new Node(),\r\n\t\t/**金币 */\r\n\t\tprops_spr_gold: new Node(),\r\n\t\t/**开始游戏倒计时 */\r\n\t\tprops_domino_begin_cutdown: new Node(),\r\n\t\t/**开始游戏倒计时 */\r\n\t\tprops_label_cutdown_num: new Label(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tstatue: DeskStatus.WAITING,\r\n\t\tnoShowCardNumber: [],\r\n\t\toutCardItem: [],\r\n\t\tleftOutCardItem: [],\r\n\t\trightOutCardItem: [],\r\n\t\tplayerMap: [null, null, null, null],\r\n\t\tlastActiveSeatIndex: -1,\r\n\t\tcurrActiveSeatIndex: -1,\r\n\t\tnewCardItem: null,\r\n\t\tintendOutCard: null,\r\n\t\tquitRoomAction: 0,\r\n\t\treadyCountdown: null,\r\n\t\tgold: 0,\r\n\t\tbalanceOdds: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\topenSetPanel: (toggle: boolean) => { },\r\n\t\topenShopPanel: () => { },\r\n\t\tflyCard: (cardPanelNode: Node, cardNode: Node, seatIndex: number) => { },\r\n\t\tgetSeatPosition: (seatIndex: number) => { return new Vec3(0, 0) },\r\n\t\tonQuitRoom: () => { },\r\n\t\tdealerBeginOut: () => { },\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_title_menu.on(Toggle.EventType.TOGGLE, () => {\r\n\t\t\tplayBtnClick();\r\n\t\t\tthis.events.openSetPanel(this.propertyNode.props_btn_title_menu.getComponent(Toggle).isChecked)\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_title_shop.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tplayBtnClick();\r\n\t\t\tthis.events.openShopPanel();\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"statue\") {\r\n\t\t\tconsole.log('usrpro ============ ', key, value);\r\n\t\t\tif (this.props.statue === DeskStatus.DISTRIBUTE) {\r\n\t\t\t\t// 开始发牌\r\n\t\t\t\tthis.beginDistributeCards()\r\n\t\t\t\tthis.resetOutCardArea();\r\n\t\t\t} else if (this.props.statue === DeskStatus.WAITING) {\r\n\t\t\t\tthis.clearData();\r\n\t\t\t\tthis.playCardTip(false, true);\r\n\t\t\t\tthis.resetOutCardArea();\r\n\t\t\t} else if (this.props.statue === DeskStatus.COUNTDOWNING) {\r\n\t\t\t\tthis.clearData();\r\n\t\t\t\tthis.playCardTip(false, true);\r\n\t\t\t\tthis.resetOutCardArea();\r\n\t\t\t\t// this.beginGameCountdown(this.props.readyCountdown.time);\r\n\t\t\t}\r\n\t\t} else if (key === 'readyCountdown') {\r\n\t\t\tconsole.log('usrpro ============ ', key, value);\r\n\t\t\tconst time = this.props.readyCountdown ? this.props.readyCountdown.time : 0;\r\n\t\t\tthis.beginGameCountdown(time);\r\n\t\t} else if (key === 'currActiveSeatIndex' && value.cur >= 0) {\r\n\t\t\tthis.playCardTip(true, true);\r\n\t\t} else if (key === 'newCardItem' && value.cur) {\r\n\t\t\tthis.removeOutlineNode();\r\n\t\t\tthis.addCardItem(value.cur);\r\n\t\t} else if (key === 'intendOutCard' && value.cur) {\r\n\t\t\tthis.addOutlineNode(value.cur);\r\n\t\t} else if (key === 'quitRoomAction' && value.cur) {\r\n\t\t\tthis.events.onQuitRoom();\r\n\t\t} else if (key === 'balanceOdds') {\r\n\t\t\tthis.updateBalanceOdds();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_spr_turn_up.active = false;\r\n\t\tthis.propertyNode.props_domino_begin_cutdown.active = false;\r\n\r\n\t\tthis.outCardAreaInitX = this.propertyNode.props_out_cards.position.x;\r\n\t\tthis.outCardAreaInitY = this.propertyNode.props_out_cards.position.y;\r\n\t}\r\n\r\n\t/**还原出牌区域 */\r\n\tprivate resetOutCardArea() {\r\n\t\tthis.propertyNode.props_out_cards.setPosition(new Vec3(this.outCardAreaInitX, this.outCardAreaInitY));\r\n\t}\r\n\r\n\t/**获得发牌张数 */\r\n\tprivate getDealNumber() {\r\n\t\treturn this.getGameCount() * 7;\r\n\t}\r\n\r\n\tprivate getGameCount() {\r\n\t\treturn this.props.playerMap.filter(v => v && v.gameData.state !== PlayerSatus.WAITING).length;\r\n\t}\r\n\r\n\tprivate addCardUIOpacity(cardPanelNode: Node) {\r\n\t\tcardPanelNode.children.forEach(v => {\r\n\t\t\tv.addComponent(UIOpacity).opacity = 255;\r\n\t\t})\r\n\t}\r\n\r\n\t/**开始发牌 */\r\n\tpublic beginDistributeCards() {\r\n\t\tplayGameBegin();\r\n\t\tconst cardPanelNode = instantiate(sourceManageSeletor().getFile(PrefabPathDefine.SEND_CARD).source);\r\n\t\tthis.addCardUIOpacity(cardPanelNode);\r\n\r\n\t\tthis.propertyNode.props_center_cards_wrap.addChild(cardPanelNode);\r\n\t\tthis.beginDeal(cardPanelNode, 1, this.getDealNumber(), this.getDealderSeatIndex());\r\n\t}\r\n\r\n\t/**开始发牌 */\r\n\tprivate beginDeal(cardPanelNode: Node, index: number, total: number, seatIndex: number) {\r\n\t\tif (!this.node.isValid || !cardPanelNode.isValid || this.props.statue === DeskStatus.WAITING) return;\r\n\t\tif (index > total) {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tif (this.isValid && cardPanelNode.isValid) {\r\n\t\t\t\t\tcardPanelNode.destroy();\r\n\t\t\t\t\tthis.events.dealerBeginOut();\r\n\t\t\t\t}\r\n\t\t\t}, config.dealAnimeSpeed);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// const dealSpeed = 0.5 - 0.1 * this.getGameCount();\r\n\t\tconst cardNode = cardPanelNode.getChildByName(\"props_spr_card_bg\" + index);\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.isValid && cardPanelNode.isValid) {\r\n\t\t\t\tthis.events.flyCard(cardPanelNode, cardNode, seatIndex);\r\n\t\t\t\tseatIndex = this.getNextSeatIndex(seatIndex);\r\n\t\t\t\tthis.beginDeal(cardPanelNode, ++index, total, seatIndex);\r\n\t\t\t}\r\n\t\t}, config.dealAnimeSpeed);\r\n\t}\r\n\r\n\tprivate getDealderSeatIndex() {\r\n\t\tconst dealer = this.props.playerMap.find(v => v && v.gameData.isMaster)\r\n\t\treturn dealer ? dealer.seatIndex : 0;\r\n\t}\r\n\r\n\tprivate getNextSeatIndex(lastIndex: number, count: number = 0) {\r\n\t\tif (count > config.seatNumber || !this.props || !this.node.isValid) return -1;\r\n\t\tconst nextIndex = lastIndex + 1 >= config.seatNumber ? 0 : lastIndex + 1;\r\n\t\tconst player = this.props.playerMap[nextIndex];\r\n\t\tif (player && player.gameData.state === PlayerSatus.READY) {\r\n\t\t\treturn player.seatIndex;\r\n\t\t}\r\n\t\treturn this.getNextSeatIndex(nextIndex, ++count);\r\n\t}\r\n\r\n\t/**飞牌 */\r\n\tpublic flyCard(cardPanelNode: Node, cardNode: Node, endPostiton: Vec3, seatIndex: number) {\r\n\t\tif (!cardPanelNode.isValid || !endPostiton) return;\r\n\t\tplayFapai();\r\n\t\tcardNode.setSiblingIndex(100);\r\n\t\tconst endPos = cardPanelNode.getComponent(UITransform).convertToWorldSpaceAR(endPostiton);\r\n\r\n\t\tconst duration = config.dealAnimeSpeed;\r\n\t\tseatIndex > 0 && tween(cardNode.getComponent(UIOpacity)).to(duration, { opacity: 0 }).start();\r\n\t\ttween(cardNode).to(duration, { worldPosition: endPos }).call(() => {\r\n\t\t\tcardNode.isValid && cardNode.destroy()\r\n\t\t}).start();\r\n\t}\r\n\r\n\t/**获取中央的出牌队列的节点 */\r\n\tpublic getOutCardWrapNode() {\r\n\t\treturn this.propertyNode.props_out_cards\r\n\t}\r\n\tpublic getPlayerWrapNode() {\r\n\t\treturn this.propertyNode.props_player_wrap\r\n\t}\r\n\r\n\t/**出牌提示 */\r\n\tprivate playCardTip(active: boolean, isAnima: boolean) {\r\n\t\tthis.propertyNode.props_spr_turn_up.active = active;\r\n\r\n\t\tif (!active) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst seatIndex = this.props.currActiveSeatIndex;\r\n\t\tlet angle = 0;\r\n\t\tswitch (seatIndex) {\r\n\t\t\tcase 0: angle = 180; break;\r\n\t\t\tcase 1: angle = 90; break;\r\n\t\t\tcase 2: angle = 0; break;\r\n\t\t\tcase 3: angle = 270; break;\r\n\t\t}\r\n\r\n\t\tif (isAnima) {\r\n\t\t\ttween(this.propertyNode.props_spr_turn_up).to(0.3, { angle }).start();\r\n\t\t} else {\r\n\t\t\tthis.propertyNode.props_spr_turn_up.angle = angle;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic addCardItem(cardItem: CardItem) {\r\n\t\tthis.addCard(cardItem, cardItem.azimuth === 0 ? 1 : -1, false, !cardItem.isReconnect);\r\n\t}\r\n\r\n\t/**\r\n\t * 添加牌\r\n\t * @param cardItem \r\n\t * @param symbol 符号，-1表示右边，1表示左边 \r\n\t * @param isHide 是否隐藏\r\n\t * @param isOutline 是否轮廓\r\n\t */\r\n\tprivate addCard(cardItem: CardItem, symbol: -1 | 1, isOutline: boolean, isHide: boolean = true) {\r\n\t\tlet lastViews = symbol < 0 ? this.rightViews : this.leftViews;\r\n\t\tlet lastView = symbol < 0 ? this.rightLastCardView : this.leftLastCardView;\r\n\t\tlet x = 0;\r\n\t\tlet y = 0;\r\n\t\tlet cardPosition = cardItem.upFace === cardItem.downFace ? CardPosition.VERTICAL : CardPosition.HORIZONTAL;\r\n\t\tlet cellCount = 0;\r\n\t\t// 纵向结束格子数\r\n\t\tlet vericalEndCellCount = 0;\r\n\t\t// 第二行格子数\r\n\t\tlet secondLineCellCount = 0;\r\n\t\t// 是否拐弯处\r\n\t\tlet isBend = false;\r\n\t\tif (this.middleCardView) {\r\n\t\t\t// 加上中间的一个格子\r\n\t\t\tcellCount = this.calCellCount(lastViews, 0);\r\n\t\t\t// 这里开始拐弯了，拐弯就必须是纵向的\r\n\t\t\tif (cellCount >= 8 && cellCount <= 11) {\r\n\t\t\t\tcardPosition = CardPosition.VERTICAL;\r\n\t\t\t\tisBend = true;\r\n\t\t\t\t// 第8个格子的时候减去前一个格子的一半才能对齐\r\n\t\t\t\tif (cellCount === 8) {\r\n\t\t\t\t\ty += (lastView.getOriginalWidth() / 2) * symbol;\r\n\t\t\t\t} else if (cellCount >= 9) {\r\n\t\t\t\t\t// 最后两个连续是纵向，那么下一个就强制横向\r\n\t\t\t\t\tif (this.isVericalEnd(lastViews)) {\r\n\t\t\t\t\t\tcardPosition = CardPosition.HORIZONTAL;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 计算出纵向结束的时到之前的格子数\r\n\t\t\t\t\tvericalEndCellCount = this.getVericalEndCellCount(lastViews);\r\n\t\t\t\t}\r\n\t\t\t\t// 第二行横向格子超过19个了，就开始又拐弯了\r\n\t\t\t} else if (cellCount > 11) {\r\n\t\t\t\t// 从第一个拐弯开始时的格子数，到了19个以上又开始拐弯了\r\n\t\t\t\tsecondLineCellCount = this.calCellCount(lastViews, this.getVericalEndIndex(lastViews));\r\n\t\t\t\tif (secondLineCellCount === 18) {\r\n\t\t\t\t\tvericalEndCellCount = this.getVericalEndCellCount(lastViews);\r\n\t\t\t\t}\r\n\t\t\t\t// 第二行19个格子减去前一个格子的一半，同时前一个格子是横向的\r\n\t\t\t\tif (lastView.isHorizontal() && secondLineCellCount === 19) {\r\n\t\t\t\t\ty += (lastView.getOriginalWidth() / 2) * symbol;\r\n\t\t\t\t}\r\n\t\t\t\t// 拐弯必须是纵向的\r\n\t\t\t\tif (secondLineCellCount >= 19) {\r\n\t\t\t\t\tisBend = true;\r\n\t\t\t\t\tcardPosition = CardPosition.VERTICAL;\r\n\t\t\t\t} else if (cellCount >= 29 && secondLineCellCount >= 1) { // 第二个拐弯已经完成了，因此 secondLineCellCount 从1开始了\r\n\t\t\t\t\t// 第二行拐弯的第一个必须横向\r\n\t\t\t\t\tif (secondLineCellCount === 1) {\r\n\t\t\t\t\t\tisBend = true;\r\n\t\t\t\t\t\tcardPosition = CardPosition.HORIZONTAL;\r\n\t\t\t\t\t\tvericalEndCellCount = this.getVericalEndCellCount(lastViews);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 7个格子的位置，同时是横向的，就强制纵向\r\n\t\t\tif (cardPosition === CardPosition.VERTICAL && (cellCount === 7 || secondLineCellCount === 17)) {\r\n\t\t\t\tcardPosition = CardPosition.HORIZONTAL;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet poseAzimuth = cardItem.azimuth;\r\n\t\tconst prefabPath = PrefabPathDefine.CARD;\r\n\t\tconst cardViewModel = new CardViewModel()\r\n\t\t\t.mountView(sourceManageSeletor().getFile(prefabPath).source)\r\n\t\t\t.setInitHide(false)\r\n\t\t\t.appendTo(this.propertyNode.props_out_cards)\r\n\t\t\t.setProps({\r\n\t\t\t\tisOutline: isOutline,\r\n\t\t\t\tposeAzimuth: poseAzimuth,\r\n\t\t\t\tupFace: cardItem.upFace,\r\n\t\t\t\tdownFace: cardItem.downFace,\r\n\t\t\t\talignValue: cardItem.alignValue,\r\n\t\t\t\tvalue: cardItem.value,\r\n\t\t\t\ttype: 1,\r\n\t\t\t\tposition: cardPosition,\r\n\t\t\t\tisShow: true,\r\n\t\t\t\tisBright: true,\r\n\t\t\t}).connect();\r\n\t\tif (this.middleCardView) {\r\n\t\t\tconst cardWidth = cardViewModel.getWidth();\r\n\t\t\tif (lastView) {\r\n\t\t\t\tconst laseWidth = lastView.getWidth();\r\n\t\t\t\tlet xOffset = -(laseWidth / 2 + cardWidth / 2) * symbol;\r\n\t\t\t\t// 拐弯之后的y与纵向对齐\r\n\t\t\t\tif (vericalEndCellCount > 0 && cellCount >= vericalEndCellCount) {\r\n\t\t\t\t\t// 纵向的一半的一半\r\n\t\t\t\t\ty += (lastView.getOriginalHeight() / 2 / 2) * symbol\r\n\t\t\t\t}\r\n\t\t\t\t// console.log(`cellcount ${cellCount} , vericalEndCellCount ${vericalEndCellCount} secondLineCellCount : ${secondLineCellCount}`)\r\n\t\t\t\t// 右边10格子之后，从右往左走\r\n\t\t\t\tif (cellCount >= 10 && (cellCount <= 29 || secondLineCellCount >= 18)) {\r\n\t\t\t\t\txOffset = -xOffset;\r\n\t\t\t\t\tif (cardViewModel.isHorizontal()) {\r\n\t\t\t\t\t\t// 方位取反，用于摆放位置\r\n\t\t\t\t\t\tposeAzimuth = poseAzimuth === 0 ? 1 : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tx = lastView.comp.node.position.x + xOffset;\r\n\t\t\t\ty += lastView.comp.node.position.y;\r\n\t\t\t\tif (lastView.isHorizontal()) {\r\n\t\t\t\t\tif (cellCount === 9) {\r\n\t\t\t\t\t\t// 右边是往下走，因此设置为负数\r\n\t\t\t\t\t\ty += (laseWidth / 2 + cardWidth / 2) * symbol;\r\n\t\t\t\t\t\t// 第一行纵向是靠左\r\n\t\t\t\t\t\tx += cardWidth * symbol;\r\n\t\t\t\t\t} else if (secondLineCellCount === 20) {\r\n\t\t\t\t\t\t// 右边是往下走，因此设置为负数\r\n\t\t\t\t\t\ty += (laseWidth / 2 + cardWidth / 2) * symbol;\r\n\t\t\t\t\t\t// 第二行纵向是靠右了\r\n\t\t\t\t\t\tx += -cardWidth * symbol;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet outCardAreaY = 0;\r\n\t\t\t\tif (cardViewModel.isVertical()) {\r\n\t\t\t\t\t// 第一个纵向时，出牌区域要移动\r\n\t\t\t\t\toutCardAreaY = 15;\r\n\t\t\t\t\tif (lastView.isVertical()) {\r\n\t\t\t\t\t\ty += lastView.getOriginalHeight() * symbol;\r\n\t\t\t\t\t\tx = lastView.comp.node.position.x;\r\n\r\n\t\t\t\t\t\t// 第二个纵向时，出牌区域要移动得多点\r\n\t\t\t\t\t\toutCardAreaY = 25;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (lastView.isVertical()) {\r\n\t\t\t\t\t// 纵向之后的横向也要移动一点点\r\n\t\t\t\t\toutCardAreaY = 15;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!isOutline && isBend && outCardAreaY > 0 && cellCount >= 8) {\r\n\t\t\t\t\t// 左边是往下移动，因此是负数，右边是往上移动，因此是正数\r\n\t\t\t\t\tthis.moveOutCardArea(-outCardAreaY * symbol);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tx = -(cardWidth / 2 + this.middleCardView.getWidth() / 2) * symbol;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcardViewModel.setProps({\r\n\t\t\tposeAzimuth: poseAzimuth\r\n\t\t})\r\n\t\tcardViewModel.comp.horizontal();\r\n\r\n\t\tisHide && cardViewModel.setOpacity(false);\r\n\t\tcardViewModel.comp.node.setPosition(new Vec3(x, y));\r\n\t\tif (!isOutline) {\r\n\t\t\tcardViewModel.symbol = symbol;\r\n\t\t\tthis.lastCardView = cardViewModel;\r\n\t\t\tif (!this.middleCardView) {\r\n\t\t\t\tthis.middleCardView = cardViewModel;\r\n\t\t\t} else if (symbol === 1) {\r\n\t\t\t\tthis.leftLastCardView = cardViewModel;\r\n\t\t\t\tthis.leftViews.push(cardViewModel);\r\n\t\t\t} else if (symbol === -1) {\r\n\t\t\t\tthis.rightLastCardView = cardViewModel;\r\n\t\t\t\tthis.rightViews.push(cardViewModel);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (symbol === 1) {\r\n\t\t\t\tthis.leftOutlineNode = cardViewModel.comp.node;\r\n\t\t\t} else {\r\n\t\t\t\tthis.rightOutlineNode = cardViewModel.comp.node;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 添加轮廓\r\n\t * @param intendOutCard 准备要出的牌\r\n\t */\r\n\tpublic addOutlineNode(intendOutCard: CardItem) {\r\n\t\tthis.removeOutlineNode();\r\n\t\tif (intendOutCard) {\r\n\t\t\tintendOutCard.azimuth = 0;\r\n\t\t\tif (this.isAddOutline(this.props.leftOutCardItem, intendOutCard)) {\r\n\t\t\t\t// 轮廓节点把值搞成负数\r\n\t\t\t\tconst cardItem = genCardItem(intendOutCard.value);\r\n\t\t\t\tcardItem.upFace -= 10;\r\n\t\t\t\tcardItem.downFace -= 10;\r\n\t\t\t\tthis.addCard(cardItem, 1, true, false);\r\n\t\t\t}\r\n\t\t\tintendOutCard.azimuth = 1;\r\n\t\t\tif (this.isAddOutline(this.props.rightOutCardItem, intendOutCard)) {\r\n\t\t\t\t// 轮廓节点把值搞成负数\r\n\t\t\t\tconst cardItem = genCardItem(intendOutCard.value);\r\n\t\t\t\tcardItem.upFace -= 10;\r\n\t\t\t\tcardItem.downFace -= 10;\r\n\t\t\t\tthis.addCard(cardItem, -1, true, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isAddOutline(cardItems: CardItem[], intendOutCard: CardItem) {\r\n\t\tif (this.props.outCardItem.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tlet composeCardValue;\r\n\t\tif (cardItems.length === 0) {\r\n\t\t\tcomposeCardValue = intendOutCard.azimuth === 0 ? this.props.outCardItem[0].upFace : this.props.outCardItem[0].downFace;\r\n\t\t} else {\r\n\t\t\tconst composeCardItem = cardItems[cardItems.length - 1];\r\n\t\t\tcomposeCardValue = getComposeCardValue(composeCardItem);\r\n\t\t}\r\n\t\t// 最后一张牌与准备出的牌作比较，如果能够街上\r\n\t\treturn composeCardValue === intendOutCard.upFace || composeCardValue === intendOutCard.downFace;\r\n\t}\r\n\r\n\t/**删除轮廓节点 */\r\n\tprivate removeOutlineNode() {\r\n\t\tthis.leftOutlineNode && this.leftOutlineNode.destroy();\r\n\t\tthis.rightOutlineNode && this.rightOutlineNode.destroy();\r\n\r\n\t\tthis.leftOutlineNode = undefined;\r\n\t\tthis.rightOutlineNode = undefined;\r\n\t}\r\n\r\n\t/**移动出牌区域 */\r\n\tprivate moveOutCardArea(y: number, isAnima: boolean = true) {\r\n\t\tconst position = this.propertyNode.props_out_cards.position\r\n\t\tconst endPostiton = new Vec3(position.x, position.y + y)\r\n\t\tif (isAnima) {\r\n\t\t\ttween(this.propertyNode.props_out_cards).to(0.3, { position: endPostiton }).start();\r\n\t\t} else {\r\n\t\t\tthis.propertyNode.props_out_cards.setPosition(endPostiton);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 计算格子数\r\n\t * @param views \r\n\t * @param startIndex 起始位置\r\n\t * @param endIndex 结束位置\r\n\t * @returns \r\n\t */\r\n\tprivate calCellCount(views: CardViewModel[], startIndex: number, endIndex: number = 0) {\r\n\t\tif (startIndex < 0) return 0;\r\n\t\tendIndex = endIndex <= 0 ? views.length - 1 : endIndex;\r\n\t\tendIndex = endIndex >= views.length ? views.length - 1 : endIndex;\r\n\t\tlet count = 0;\r\n\t\tfor (let i = startIndex; i <= endIndex; i++) {\r\n\t\t\tcount += views[i].getCellCount();\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**纵向结束时的格子数 */\r\n\tprivate getVericalEndCellCount(views: CardViewModel[]) {\r\n\t\tlet endIndex = this.getVericalEndIndex(views);\r\n\t\tif (endIndex < 0) return 0;\r\n\t\treturn this.calCellCount(views, 0, endIndex);\r\n\t}\r\n\r\n\t/**纵向结束索引位置 */\r\n\tprivate getVericalEndIndex(views: CardViewModel[]) {\r\n\t\tfor (let i = views.length - 1; i >= 0; i--) {\r\n\t\t\tconst element = views[i];\r\n\t\t\tif (element.isVertical() && (i > 0 && views[i - 1].isVertical())) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**是否纵向结束点 */\r\n\tprivate isVericalEnd(views: CardViewModel[]) {\r\n\t\treturn views[views.length - 1].isVertical() &&\r\n\t\t\tviews[views.length - 2].isVertical()\r\n\t}\r\n\r\n\t/**\r\n\t * 飞金币\r\n\t * @param startIndex 开始位置\r\n\t * @param endIndex 结束位置\r\n\t */\r\n\tpublic flyGold(startIndex: number, endIndex: number, done) {\r\n\t\tlet count = 0;\r\n\t\tconst length = 6;\r\n\t\tplayCoin();\r\n\t\tfor (let i = 1; i <= length; i++) {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\t\tconst transform = this.node.getComponent(UITransform)\r\n\t\t\t\t\tconst tweenNode = instantiate(this.propertyNode.props_spr_gold);\r\n\t\t\t\t\tthis.node.addChild(tweenNode);\r\n\t\t\t\t\ttweenNode.active = true;\r\n\t\t\t\t\tthis.playGoldTween\r\n\t\t\t\t\tconst startPos = transform.convertToWorldSpaceAR(this.events.getSeatPosition(startIndex));\r\n\t\t\t\t\tconst endPos = transform.convertToNodeSpaceAR(transform.convertToWorldSpaceAR(this.events.getSeatPosition(endIndex)));\r\n\t\t\t\t\ttweenNode.setWorldPosition(startPos);\r\n\t\t\t\t\tthis.playGoldTween(tweenNode, endPos, 1, () => {\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\tif (count >= length) {\r\n\t\t\t\t\t\t\tdone();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}, 0.1 * i);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getMidPoint(fromPos: Vec3, toPos: Vec3) {\r\n\t\tvar centerX = fromPos.x + (toPos.x - fromPos.x) / 2;\r\n\r\n\t\tvar centerY = fromPos.y + (toPos.y - fromPos.y) / 2;\r\n\r\n\t\t//取离中点指定距离点\r\n\r\n\t\treturn new Vec3(centerX, centerY)\r\n\r\n\t}\r\n\r\n\tpublic getMidVerticalPoint(fromPos: Vec3, toPos: Vec3, offsetAngin: number = 0) {\r\n\t\t//得到中点C的坐标值\r\n\t\tlet midPoint = this.getMidPoint(fromPos, toPos)\r\n\t\t// 计算∠BAF的两个点的角度\r\n\t\tconst bafAngle = this.calAngle(fromPos, toPos);\r\n\t\t// ∠BAF=∠ECA的角度，那么90-∠BAF就是∠DCE的角度\r\n\t\tlet angle = 90 - this.calAngle(fromPos, toPos);\r\n\t\t// 把偏移的角度换算成弧度\r\n\t\tlet radian = misc.degreesToRadians(offsetAngin)\r\n\t\t// 计算出AB的中点AC的距离\r\n\t\tconst zhongdian = toPos.clone().subtract(fromPos).length() / 2;\r\n\t\t// 三角函数公式计算出CD的距离，tan = 对边/邻边，那么邻边知道了，tanx角度也知道了，就可以计算出CD的值\r\n\t\tconst cd = zhongdian * Math.tan(radian);\r\n\t\t// 把∠DCE的角度换算为弧度\r\n\t\tradian = misc.degreesToRadians(angle)\r\n\t\t// 根据三角函数公式 sin = 对边/斜边，那么斜边知道了，sinx角度值也知道就是angle，就可以计算出DG的值\r\n\t\tconst dg = cd * Math.sin(radian);\r\n\t\tlet y = midPoint.y + dg;\r\n\t\t// 根据三角函数公式 cos = 邻边/斜边，那么斜边知道了，cosx角度值也知道就是angle，就可以计算出GC的值\r\n\t\tconst gc = cd * Math.cos(radian);\r\n\t\tconst x = midPoint.x - gc;\r\n\t\tlet midDisPoint = new Vec3(x, y)\r\n\t\treturn midDisPoint\r\n\t}\r\n\r\n\tprivate calAngle(fromPos: Vec3, toPos: Vec3) {\r\n\t\treturn Math.atan2(toPos.y - fromPos.y, toPos.x - fromPos.x) * 180 / Math.PI\r\n\t}\r\n\r\n\t/**飞星星抛物线动画 */\r\n\tprivate playGoldTween(tweenNode: Node, endPos: Vec3, playTime: number, callBack?: Function) {\r\n\t\tconst startPos = tweenNode.position;\r\n\t\tconst startAngle = tweenNode.eulerAngles;\r\n\t\tconst fruitTween = tween(startPos);\r\n\r\n\t\tconst mid = this.getMidVerticalPoint(startPos, endPos, 40)\r\n\r\n\t\tconst mixY = mid.y\r\n\t\tconst maxY = mid.y\r\n\t\tconst mixX = mid.x;\r\n\t\tconst maxX = mid.x;\r\n\t\tvar progressX = function (start, end, current, t) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tcurrent = bezier(start, mixX, maxX, end, t);\r\n\t\t\treturn current;\r\n\t\t}\r\n\t\tvar progressY = function (start, end, current, t) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tcurrent = bezier(start, mixY, maxY, end, t);\r\n\t\t\treturn current;\r\n\t\t}\r\n\r\n\t\tfruitTween.parallel(\r\n\t\t\ttween().to(playTime, { x: endPos.x }, {\r\n\t\t\t\teasing: 'quadOutIn',\r\n\t\t\t\tprogress: progressX, onUpdate: () => {\r\n\t\t\t\t\ttweenNode.isValid && tweenNode.setPosition(startPos);\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttween().to(playTime, { y: endPos.y }, {\r\n\t\t\t\teasing: 'quadOutIn',\r\n\t\t\t\tprogress: progressY, onUpdate: () => {\r\n\t\t\t\t\ttweenNode.isValid && tweenNode.setPosition(startPos);\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t).call(() => {\r\n\t\t\ttweenNode.destroy()\r\n\t\t\tcallBack();\r\n\t\t}).start();\r\n\t\t// tween(startAngle).to(playTime, { z: 360 }, {\r\n\t\t// \tonUpdate: () => {\r\n\t\t// \t\tif (tweenNode.isValid) {\r\n\t\t// \t\t\ttweenNode.eulerAngles = startAngle;\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// }).call(() => callBack()).start();\r\n\t}\r\n\r\n\t/**出牌飞牌 */\r\n\tpublic outFlyCard(startPos: Vec3) {\r\n\t\tstartPos = this.propertyNode.props_out_cards.getComponent(UITransform).convertToNodeSpaceAR(startPos);\r\n\r\n\t\tconst cardItem = this.props.newCardItem;\r\n\t\tconst cardViewModel = new CardViewModel()\r\n\t\t\t.mountView(sourceManageSeletor().getFile(PrefabPathDefine.CARD).source)\r\n\t\t\t.setInitHide(false)\r\n\t\t\t.appendTo(this.propertyNode.props_out_cards)\r\n\t\t\t.setProps({\r\n\t\t\t\tupFace: cardItem.upFace,\r\n\t\t\t\tdownFace: cardItem.downFace,\r\n\t\t\t\talignValue: cardItem.alignValue,\r\n\t\t\t\tvalue: cardItem.value,\r\n\t\t\t\tposition: CardPosition.VERTICAL,\r\n\t\t\t\tisShow: true,\r\n\t\t\t\tisBright: true,\r\n\t\t\t\tisDisable: true\r\n\t\t\t}).connect();\r\n\t\tcardViewModel.comp.node.setPosition(startPos);\r\n\r\n\t\tconst lastCard = this.lastCardView;\r\n\t\tconst endNode = lastCard.comp.node;\r\n\t\tconst speed = 0.5;\r\n\t\ttween(cardViewModel.comp.node).to(speed, { position: endNode.position, scale: endNode.scale, angle: endNode.angle })\r\n\t\t\t.call(() => {\r\n\t\t\t\tlastCard.comp && lastCard.comp.isValid && lastCard.setOpacity(true);\r\n\t\t\t\tcardViewModel.comp && cardViewModel.comp.isValid && cardViewModel.unMount();\r\n\t\t\t})\r\n\t\t\t.start();\r\n\t}\r\n\r\n\t/**清理数据 */\r\n\tpublic clearData() {\r\n\t\tthis.middleCardView && this.middleCardView.unMount();\r\n\t\tthis.middleCardView = undefined;\r\n\t\tthis.leftLastCardView = undefined;\r\n\t\tthis.rightLastCardView = undefined;\r\n\t\tthis.lastCardView = undefined;\r\n\t\tthis.leftViews.forEach(v => v.unMount());\r\n\t\tthis.leftViews = [];\r\n\t\tthis.rightViews.forEach(v => v.unMount());\r\n\t\tthis.rightViews = [];\r\n\t\tthis.leftOutlineNode = undefined;\r\n\t\tthis.rightOutlineNode = undefined;\r\n\t\tthis.propertyNode.props_center_cards_wrap.removeAllChildren();\r\n\t\tthis.propertyNode.props_out_cards.removeAllChildren();\r\n\t}\r\n\r\n\r\n\tpublic getBeginGameCountdownCount() {\r\n\t\treturn this.beginGameCountdownCount;\r\n\t}\r\n\r\n\tpublic setBeginGameCountdownCount(value: number) {\r\n\t\t// this.beginGameCountdownCount = value;\r\n\t\t// console.log('setBeginGameCountdownCount =============== ', this.beginGameCountdownCount)\r\n\t}\r\n\r\n\tprotected destroyCallBack(): void {\r\n\t\tthis.beginGameCountdownT && window.clearInterval(this.beginGameCountdownT);\r\n\t}\r\n\r\n\tprivate beginGameCountdown(value: number) {\r\n\t\tthis.beginGameCountdownCount = value;\r\n\t\tthis.beginGameCountdownT && window.clearInterval(this.beginGameCountdownT);\r\n\t\tthis.propertyNode.props_domino_begin_cutdown.active = false;\r\n\t\tconsole.log('beginGameCountdown =============== ', this.beginGameCountdownCount, value)\r\n\t\tif (this.beginGameCountdownCount > 0) {\r\n\t\t\tthis.propertyNode.props_domino_begin_cutdown.active = true;\r\n\t\t\tthis.updateGeginGameCountdownLabel(this.beginGameCountdownCount);\r\n\t\t\tthis.beginGameCountdownT = window.setInterval(() => {\r\n\t\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\t\tthis.updateGeginGameCountdownLabel(--this.beginGameCountdownCount);\r\n\t\t\t\t\tif (this.beginGameCountdownCount <= 0) {\r\n\t\t\t\t\t\tthis.propertyNode.props_domino_begin_cutdown.active = false;\r\n\t\t\t\t\t\twindow.clearInterval(this.beginGameCountdownT);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.clearInterval(this.beginGameCountdownT);\r\n\t\t\t\t}\r\n\t\t\t}, 1000)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateGeginGameCountdownLabel(count: number) {\r\n\t\tthis.propertyNode.props_label_cutdown_num.string = count < 10 ? '0' + count : count + '';\r\n\t}\r\n\r\n\tprivate updateBalanceOdds() {\r\n\t\tif (this.props.balanceOdds < 1) return;\r\n\t\tthis.middleCardView && this.middleCardView.comp.setProps({ isBright: false });\r\n\t\tthis.leftViews.forEach(v => v.comp.setProps({ isBright: false }))\r\n\t\tthis.rightViews.forEach(v => v.comp.setProps({ isBright: false }))\r\n\r\n\t\tif (this.props.balanceOdds > 1) {\r\n\t\t\tthis.lastCardView.comp.setProps({ isBright: true })\r\n\t\t\tlet recentCardView;\r\n\t\t\tif (this.lastCardView.symbol === 1) {\r\n\t\t\t\tconst length = this.leftViews.length - 2;\r\n\t\t\t\trecentCardView = length < 0 ? this.middleCardView : this.leftViews[length];\r\n\t\t\t} else {\r\n\t\t\t\tconst length = this.rightViews.length - 2;\r\n\t\t\t\trecentCardView = length < 0 ? this.middleCardView : this.rightViews[length];\r\n\t\t\t}\r\n\t\t\trecentCardView.comp.setProps({ isBright: true })\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}