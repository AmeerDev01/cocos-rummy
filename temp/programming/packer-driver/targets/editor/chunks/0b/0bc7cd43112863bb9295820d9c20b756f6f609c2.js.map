{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealth111/viewModel/FooterViewModel.ts"],"names":["UIOpacity","sys","Animation","ViewModel","StoreInject","getStore","AutoLauncherViewModel","playFastRoller","sourceManageSeletor","PrefabPathDefine","EffectType","BaseViewModel","SKT_MAG_TYPE","sktInstance","beginRollAction","setRollSpeed","dataTransfer","DataKeyType","AutoLauncherType","GameType","changeAutoLauncherType","changeProfit","setAutoLaunchedTimes","setFreeGameRate","setShowAuthLaunch","setSortStop","setWaiting","updateSubGameTimes","global","lang","addToastAction","FooterViewModel","constructor","autoLauncherPanel","helpPanelPanel","positionId","betAmount","gameType","viewGameType","remainSubTimes","freeGamePositionId","begin","mountView","getFile","AUTO_LAUNCHER","source","appendTo","comp","getAutoLauncherBaseNBoard","connect","viewNode","getComponent","opacity","setEvent","openAutoLauncher","MAIN","dispatch","getPropertyNode","props_down_chooseBg","play","closeAutoLauncher","isClear","NONE","openHelpPanel","RULE","parent","effectType","EFFECT1","isModal","closeHandler","unMount","changeBetAmount","value","manualBetHandler","changeSpeedUpSwitch","isChecked","unMountCallBack","isConnect","props","balance","hallDispatch","content","write","k","palyingModule","RechangeGlod","placeStr","openShop","GAME_TYPE","SUBGAME1","SUBGAME2","sendSktMessage","LAUNCHER_BET","tableId","JSON","parse","localStorage","getItem","inject","autoLauncherType","getState","game","state","currGameType","remainSubGameTimes","isRollEnd","roller","roundAllEnd","profit","subGameTimes","isShowAutoLaunch","autoLaunchedTimes","isJumpStop","stopMode","isSortStop","jackpotAmount"],"mappings":"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","sourcesContent":["import { Node, UIOpacity, sys, Animation } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { GodWealth_footer, IProps, IEvent } from \"../components/GodWealth_footer\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { getStore } from \"../store\"\r\nimport AutoLauncherViewModel from \"./AutoLauncherViewModel\"\r\nimport { godWealth_Audio, playFastRoller, sourceManageSeletor } from \"../index\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport BaseViewModel from \"../../../common/viewModel/BaseViewModel\"\r\nimport { GodWealth_helpPanel, IProps as FIProps, IState as FIState, IEvent as FIEvent } from \"../components/GodWealth_helpPanel\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { beginRollAction, setRollSpeed } from \"../store/actions/roller\"\r\nimport dataTransfer, { DataKeyType } from \"../dataTransfer\"\r\nimport { AutoLauncherType, GameType, SMALLGAME } from \"../type\"\r\nimport { changeAutoLauncherType, changeProfit, setAutoLaunchedTimes, setFreeGameRate, setShowAuthLaunch, setSortStop, setStopMode, setWaiting, updateSubGameTimes } from \"../store/actions/game\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\n\r\n@StoreInject(getStore())\r\nclass FooterViewModel extends ViewModel<GodWealth_footer, IProps, IEvent> {\r\n  constructor() {\r\n    super('GodWealth_footer')\r\n  }\r\n  public autoLauncherPanel: AutoLauncherViewModel\r\n  public helpPanelPanel: BaseViewModel<GodWealth_helpPanel, FIState, FIProps, FIEvent>\r\n  private positionId: number = 0\r\n  private betAmount: number = 0\r\n  private gameType: GameType;\r\n  private viewGameType: GameType;\r\n  private remainSubTimes:number\r\n  private freeGamePositionId: SMALLGAME;\r\n\r\n  protected begin() {\r\n    this.autoLauncherPanel = new AutoLauncherViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.AUTO_LAUNCHER).source).appendTo(this.comp.getAutoLauncherBaseNBoard()).connect()\r\n    this.autoLauncherPanel.viewNode.getComponent(UIOpacity).opacity = 0\r\n    this.setEvent({\r\n      openAutoLauncher: () => {\r\n        if (this.viewGameType !== GameType.MAIN ) return;//小游戏不能打开自动下注\r\n        this.dispatch(setShowAuthLaunch(true));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_up')\r\n      },\r\n      closeAutoLauncher: (isClear) => {\r\n        this.dispatch(setShowAuthLaunch(false));\r\n        isClear && this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE));\r\n        isClear && this.dispatch(setAutoLaunchedTimes(0));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_down')\r\n        // isClear && this.dispatch(setRollSpeed(1))\r\n      },\r\n      openHelpPanel: () => {\r\n        this.helpPanelPanel = new BaseViewModel<GodWealth_helpPanel, FIState, FIProps, FIEvent>(\"GodWealth_helpPanel\").mountView(sourceManageSeletor().getFile(PrefabPathDefine.RULE).source)\r\n          .appendTo(this.viewNode.parent, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n            closeHandler: () => {\r\n              this.helpPanelPanel.unMount(EffectType.EFFECT1)\r\n            }\r\n          })\r\n      },\r\n      changeBetAmount: (betAmount: number, positionId: number, value: number) => {\r\n        this.positionId = positionId\r\n        this.betAmount = betAmount\r\n      },\r\n      manualBetHandler: () => {\r\n        this.manualBetHandler()\r\n      },\r\n      changeSpeedUpSwitch: (isChecked) => {\r\n        // this.dispatch(setStopMode(isChecked ? 'jump' : 'index'))\r\n        this.dispatch(setSortStop(!isChecked))\r\n        // debugger\r\n        this.dispatch(setRollSpeed(isChecked ? 1.3 : 1))\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n    this.dispatch(setAutoLaunchedTimes(0))\r\n  }\r\n\r\n  public manualBetHandler() {\r\n    if (!sktInstance || (sktInstance && !sktInstance.isConnect)) return\r\n    if (this.comp.props.balance < this.betAmount) {\r\n      global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.RechangeGlod, {}, { placeStr: \"对不起，您的金币不足，请充值!\" }) }))\r\n      global.openShop()\r\n      this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n      this.dispatch(setAutoLaunchedTimes(0))\r\n      return\r\n    }\r\n    //先转起来\r\n    this.dispatch(beginRollAction(-1));\r\n    //如果主游戏，清理奖池\r\n    if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.MAIN) {\r\n      this.dispatch(changeProfit(0))\r\n    }\r\n    //如果是小游戏，清除气泡倍率值\r\n    if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.SUBGAME1 || dataTransfer(DataKeyType.GAME_TYPE) === GameType.SUBGAME2) {\r\n      this.dispatch(setFreeGameRate(0));\r\n      if (this.remainSubTimes > 0) {   \r\n        this.dispatch(updateSubGameTimes(this.remainSubTimes-1)); //第一次进入转一次小游戏剩余次数\r\n      }\r\n    }\r\n    //发送下注\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCHER_BET, {\r\n      positionId: this.positionId,\r\n      tableId: JSON.parse(sys.localStorage.getItem('godWealth')).tableId\r\n    })\r\n\r\n    this.dispatch(setWaiting(false))\r\n    playFastRoller()\r\n  }\r\n  public connect() {\r\n    this.inject({\r\n      autoLauncherType: getStore().getState().game.autoLauncherType\r\n\r\n    }, (state: StateType) => {\r\n      this.gameType = state.game.currGameType;\r\n      this.freeGamePositionId = state.game.freeGamePositionId;\r\n      this.viewGameType = state.game.viewGameType;\r\n      this.remainSubTimes = state.game.remainSubGameTimes;\r\n      return {\r\n        isRollEnd: state.roller.roundAllEnd,\r\n        profit: state.game.profit,\r\n        subGameTimes: state.game.subGameTimes,\r\n        remainSubGameTimes: state.game.remainSubGameTimes,\r\n        currGameType: state.game.currGameType,\r\n        viewGameType: state.game.viewGameType,\r\n        isShowAutoLaunch: state.game.isShowAutoLaunch,\r\n        autoLauncherType: state.game.autoLauncherType,\r\n        autoLaunchedTimes: state.game.autoLaunchedTimes,\r\n        balance: state.game.balance,\r\n        isJumpStop: state.game.stopMode === \"jump\" ? true : false,\r\n        isSortStop: state.game.isSortStop,\r\n        freeGamePositionId: state.game.freeGamePositionId,\r\n        jackpotAmount: state.game.jackpotAmount,\r\n        \r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default FooterViewModel"]}