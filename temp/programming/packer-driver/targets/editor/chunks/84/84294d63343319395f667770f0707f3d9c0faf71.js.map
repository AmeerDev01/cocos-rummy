{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/utils/Guide.ts"],"names":["Guide","Prefab","find","instantiate","Node","PrefabPathDefine","sourceManageSeletor","effectFade","getNodePositionInCanvas","constructor","focusNode","explainNode","mainBgNode","doneHandler","creatorBg","Promise","resovle","reject","getFileAsync","_GUIDE_PANEL","then","source","catch","begin","bgNode","addChild","enter","position","_focusNode","_explainNode","active","setPosition","once","EventType","TOUCH_END","out","destroy","bindDone","done"],"mappings":";;;4LAOqBA,K;;;;;;;;;;;;;;;;;;;;;;;;;;;AAPZC,MAAAA,M,OAAAA,M;AAAgBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AACtBC,MAAAA,I,OAAAA,I;;AACAC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,mB,iBAAAA,mB;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,uB,iBAAAA,uB;;;;;;;;;;;yBAEYR,K,GAAN,MAAMA,KAAN,CAAY;AAKzBS,QAAAA,WAAW,CAACC,SAAD,EAAkBC,WAAlB,EAAqC;AAAA,eAJxCD,SAIwC;AAAA,eAHxCC,WAGwC;AAAA,eAFxCC,UAEwC;AAAA,eADxCC,WACwC;AAC9C,eAAKH,SAAL,GAAiBA,SAAjB;AACA,eAAKC,WAAL,GAAmBA,WAAnB;AACD;;AACOG,QAAAA,SAAS,GAAkB;AACjC,iBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC;AAAA;AAAA,8DAAsBC,YAAtB,CAAmC;AAAA;AAAA,sDAAiBC,YAApD,EAAkElB,MAAlE,EAA0EmB,IAA1E,CAA+E,CAAC;AAAEC,cAAAA;AAAF,aAAD,KAAgB;AAC7FL,cAAAA,OAAO,CAACb,WAAW,CAACkB,MAAD,CAAZ,CAAP;AACD,aAFD,EAEGC,KAFH,CAES,MAAM;AACbL,cAAAA,MAAM,CAAC,OAAD,CAAN;AACD,aAJD;AAKD,WANM,CAAP;AAOD;;AACMM,QAAAA,KAAK,GAAG;AACb,eAAKT,SAAL,GAAiBM,IAAjB,CAAsBI,MAAM,IAAI;AAC9B,iBAAKZ,UAAL,GAAkBY,MAAlB;AACAtB,YAAAA,IAAI,CAAC,QAAD,CAAJ,CAAeuB,QAAf,CAAwB,KAAKb,UAA7B;AACA;AAAA;AAAA,0CAAW,KAAKA,UAAhB,EAA4Bc,KAA5B;AACA,kBAAMC,QAAQ,GAAG;AAAA;AAAA,oEAAwB,KAAKjB,SAA7B,CAAjB;;AACA,kBAAMkB,UAAU,GAAGzB,WAAW,CAAC,KAAKO,SAAN,CAA9B;;AACA,kBAAMmB,YAAY,GAAG1B,WAAW,CAAC,KAAKQ,WAAN,CAAhC;;AACAkB,YAAAA,YAAY,CAACC,MAAb,GAAsB,IAAtB;;AACAF,YAAAA,UAAU,CAACG,WAAX,CAAuBJ,QAAvB;;AACA,iBAAKf,UAAL,CAAgBa,QAAhB,CAAyBG,UAAzB;AACA,iBAAKhB,UAAL,CAAgBa,QAAhB,CAAyBI,YAAzB;AACA,iBAAKjB,UAAL,CAAgBoB,IAAhB,CAAqB5B,IAAI,CAAC6B,SAAL,CAAeC,SAApC,EAA+C,MAAM;AACnD;AAAA;AAAA,4CAAW,KAAKtB,UAAhB,EAA4BuB,GAA5B,GAAkCf,IAAlC,CAAuC,MAAM;AAC3C,qBAAKR,UAAL,CAAgBwB,OAAhB;AACD,eAFD;AAGA,mBAAKvB,WAAL,IAAoB,KAAKA,WAAL,EAApB;AACD,aALD;AAMD,WAjBD;AAkBA,iBAAO,IAAP;AACD;;AACMwB,QAAAA,QAAQ,CAACC,IAAD,EAAO;AACpB,eAAKzB,WAAL,GAAmByB,IAAnB;AACD;;AAzCwB,O","sourcesContent":["import { Prefab, Widget, find, instantiate } from 'cc'\r\nimport { Node } from 'cc'\r\nimport { PrefabPathDefine } from '../hall/sourceDefine/prefabDefine'\r\nimport { sourceManageSeletor } from '../hall'\r\nimport { effectFade } from './NodeIOEffect'\r\nimport { getNodePositionInCanvas } from './tool'\r\n\r\nexport default class Guide {\r\n  private focusNode: Node\r\n  private explainNode: Node\r\n  private mainBgNode: Node\r\n  private doneHandler: () => void\r\n  constructor(focusNode: Node, explainNode: Node) {\r\n    this.focusNode = focusNode\r\n    this.explainNode = explainNode\r\n  }\r\n  private creatorBg(): Promise<Node> {\r\n    return new Promise((resovle, reject) => {\r\n      sourceManageSeletor().getFileAsync(PrefabPathDefine._GUIDE_PANEL, Prefab).then(({ source }) => {\r\n        resovle(instantiate(source))\r\n      }).catch(() => {\r\n        reject('error')\r\n      })\r\n    })\r\n  }\r\n  public begin() {\r\n    this.creatorBg().then(bgNode => {\r\n      this.mainBgNode = bgNode\r\n      find('Canvas').addChild(this.mainBgNode)\r\n      effectFade(this.mainBgNode).enter()\r\n      const position = getNodePositionInCanvas(this.focusNode)\r\n      const _focusNode = instantiate(this.focusNode)\r\n      const _explainNode = instantiate(this.explainNode)\r\n      _explainNode.active = true\r\n      _focusNode.setPosition(position)\r\n      this.mainBgNode.addChild(_focusNode)\r\n      this.mainBgNode.addChild(_explainNode)\r\n      this.mainBgNode.once(Node.EventType.TOUCH_END, () => {\r\n        effectFade(this.mainBgNode).out().then(() => {\r\n          this.mainBgNode.destroy()\r\n        })\r\n        this.doneHandler && this.doneHandler()\r\n      })\r\n    })\r\n    return this\r\n  }\r\n  public bindDone(done) {\r\n    this.doneHandler = done\r\n  }\r\n}"]}