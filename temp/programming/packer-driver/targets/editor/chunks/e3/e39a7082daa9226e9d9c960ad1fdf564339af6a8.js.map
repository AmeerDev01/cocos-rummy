{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dragon/Slot/Component/dragon_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Prefab","tween","UIOpacity","Vec3","BaseComponent","getSocketProxy","AudioManager","SoundList","getSpeedTime","ccclass","property","dragon_RollerPanel","rollerList","isSpeed","bindUI","rollerData","getRollProxy","getRepository","layout","node","getComponent","forEach","roller","index","rollerNode","bindRollerData","setPosition","position","y","root","addChild","push","getParent","setSiblingIndex","ui","parent","target","to","opacity","call","start","startAllRoll","stopIndexArr","getInstance","playSound","rollerFast","i","startRoll","togglesALLLayer","state","togglesThePopUpLayerState","stopAllRoll","isManualStop","callBack","stopRoll","time","isEnd","length","rollerComp","rollerIndex","isValid","scheduleOnce","controlTheHeightOfTheRingOfFire","Change","getTransferGameInfo","getChange","oldMoveRingOfFire","key","moveRingOfFire","RingOfFirePanl","theRingOfFireIsHidden","iconFlicker","mode","targetArr","allstate","cb","setIconEffect","setTimeout","clearStatus","iconDock","removeAllDockIcon","addDockIcon","uninstall","done","destroy","bindEvent","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { ProxyDefine } from '../Const/ProxyDefine';\r\nimport BaseComponent from './BaseComponent';\r\nimport { dragon_Roller } from './dragon_Roller';\r\nimport { RollerType } from '../Repositories/SlotRepository';\r\nimport { getSocketProxy } from \"../utils\";\r\nimport { AudioManager, SoundList } from '../Managr/AudioManager';\r\nimport { getSpeedTime } from '../../../../utils/SlotSpeedConfig';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('dragon_RollerPanel')\r\nexport class dragon_RollerPanel extends BaseComponent {\r\n\t@property(Prefab)\r\n\troller: Prefab = null\r\n\r\n\tpublic rollerList: Array<Node> = []\r\n\tprivate isSpeed;\r\n\tprotected bindUI(): void {\r\n\t\tconst rollerData = this.getRollProxy().getRepository()\r\n\t\tconst layout = this.node.getComponent(Layout)\r\n\t\t// layout.spacingX = 35\r\n\r\n\t\trollerData.rollerList.forEach((roller, index) => {\r\n\t\t\tconst rollerNode = instantiate(this.roller);\r\n\t\t\t(rollerNode.getComponent(\"dragon_Roller\") as dragon_Roller).bindRollerData(index, roller)\r\n\t\t\trollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n\t\t\tthis.root.addChild(rollerNode)\r\n\t\t\tthis.rollerList.push(rollerNode)\r\n\t\t})\r\n\r\n\r\n\t\t// const rollerNode = instantiate(this.roller);\r\n\t\t// (rollerNode.getComponent(\"Roller\") as Roller).bindRollerData(0, rollerData.rollerList.data[0])\r\n\t\t// rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n\t\t// this.root.addChild(rollerNode)\r\n\t\t// this.rollerList.push(rollerNode)\r\n\r\n\t\t// this.node.getParent().setScale(0.95, 0.95)\r\n\t\tthis.node.getParent().setSiblingIndex(100)\r\n\r\n\t\tconst ui = this.node.parent.getComponent(UIOpacity)\r\n\t\t// ui.opacity = 0;\r\n\t\ttween().target(ui).to(0.5, { opacity: 255 }).call(() => { }).start()\r\n\t}\r\n\r\n\t/**所有的滑槽都开始转动，传入停止信号发出后要停止的序列号(从1开始) */\r\n\tpublic startAllRoll(stopIndexArr: number[], isSpeed: boolean = false) {\r\n\t\tthis.isSpeed = isSpeed;\r\n\t\tAudioManager.getInstance().playSound(SoundList.rollerFast);\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).startRoll(stopIndexArr[i], isSpeed)\r\n\t\t})\r\n\t}\r\n\tpublic togglesALLLayer(state: boolean) {\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).togglesThePopUpLayerState(state)\r\n\t\t})\r\n\t}\r\n\t/**发出停止的信号（启动的时候已经传入了停止位置，不是马上停止，转到位置才停，这里需要传入闪动的图标队列） */\r\n\tpublic stopAllRoll(isManualStop: boolean, callBack: () => void) {\r\n\t\tif(isManualStop){\r\n\t\t\tthis.isSpeed = true;\r\n\t\t}\r\n\t\tthis.stopRoll(0, callBack)\r\n\t}\r\n\r\n\tprivate stopRoll(i: number, callBack: () => void) {\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = getSpeedTime(this.isSpeed)\r\n\t\tconst isEnd = i >= this.rollerList.length - 1;\r\n\t\tconst rollerComp = this.rollerList[i].getComponent(\"dragon_Roller\") as dragon_Roller;\r\n\t\trollerComp.stopRoll((rollerIndex: number, rollerData: RollerType) => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tif (isEnd) {\r\n\t\t\t\t\tcallBack()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tif (!isEnd) {\r\n\t\t\t\t\tthis.stopRoll(i + 1, callBack)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, time)\r\n\t}\r\n\r\n\tpublic controlTheHeightOfTheRingOfFire() {\r\n\t\tlet Change = getSocketProxy().getTransferGameInfo().getChange();\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).oldMoveRingOfFire();\r\n\t\t})\r\n\t\tfor (const key in Change) {\r\n\t\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t\tif (Change[key][0] === i) {\r\n\t\t\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).moveRingOfFire(Change[key]);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tpublic RingOfFirePanl(state){\r\n\t\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).theRingOfFireIsHidden(state);\r\n\t\t\t})\r\n\t}\r\n\t/**图标闪动 */\r\n\tpublic iconFlicker(mode: 'index' | 'coord', targetArr: number[][], allstate: boolean = false, cb?) {\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).setIconEffect(mode, [], true)\r\n\t\t\tif (targetArr[i].length && allstate) {\r\n\t\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).setIconEffect(mode, targetArr[i]);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.clearStatus()\r\n\t\t\t\t\tcb()\r\n\t\t\t\t}, 1000)\r\n\t\t\t} else if (targetArr[i].length) {\r\n\t\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).setIconEffect(mode, targetArr[i], true);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tpublic clearStatus() {\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).setIconEffect('coord', [], true)\r\n\t\t})\r\n\t}\r\n\t/**图标定住 */\r\n\tpublic iconDock(mode: 'index' | 'coord', targetArr: number[][][]) {\r\n\t\tthis.rollerList.forEach((roller, i) => {\r\n\t\t\t(<dragon_Roller>roller.getComponent(\"dragon_Roller\")).removeAllDockIcon()\r\n\t\t\ttargetArr[i][1].length && (<dragon_Roller>roller.getComponent(\"dragon_Roller\")).addDockIcon(targetArr[i][1])\r\n\t\t})\r\n\t}\r\n\r\n\t/**卸载面板(淡出) */\r\n\tpublic uninstall(done?: () => void) {\r\n\t\tconst ui = this.node.parent.getComponent(UIOpacity)\r\n\t\ttween().target(ui).to(0.5, { opacity: 0 }).call(() => {\r\n\t\t\t// this.node.parent.removeAllChildren()\r\n\t\t\tthis.node.parent.destroy()\r\n\t\t\tdone && done()\r\n\t\t}).start()\r\n\r\n\t\t// tween().target(icon).to(0.5, {\r\n\t\t// \tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n\t\t// }, {\r\n\t\t// \teasing: \"backOut\"//\"elasticOut\"\r\n\t\t// }).call(() => {\r\n\t\t// \tcount++\r\n\t\t// \tif (count === this.RollerLayOut.children.length) {\r\n\t\t// \t\tthis.stopCallBack()\r\n\t\t// \t}\r\n\t\t// }).start()\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\n"]}