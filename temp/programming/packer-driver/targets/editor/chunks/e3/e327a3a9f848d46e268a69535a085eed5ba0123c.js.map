{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/BulletManager.ts"],"names":["BulletManager","ObjectClassType","bulletConfig","bulletBondingSize","aliveBulletObjectList","aliveBulletBBXList","objectPool","sourceManage","batteryManager","scaleRatio","init","bondSize","bulConfig","uninit","sendBullet","bulletID","startPos","angle","side","playerID","serverID","lockFishID","isLocal","obj","getObject","type_bullet","reset","getObjectId","player_id","bbx","getBondingBox","bullet","update","dt","k","length","v","getBulletAliveLst","getBulletBondingInfoLst","removeBulletObject","objID","shotSomething","resumeOrgin","removeBulletObjectByPlayerId","getBulletPlayerId","getBulletBBX"],"mappings":"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","sourcesContent":["/**\r\n  子弹对象管理\r\n */\r\n\r\nimport SourceManage from \"../../base/SourceManage\"\r\nimport { BatteryManager } from \"./BatteryManager\"\r\nimport { Bullet } from \"./Bullet\"\r\nimport { ObjectClassType, ObjectPool } from \"./ObjectPool\"\r\n\r\n//////////////////////////////////////////////////////-\r\nexport class BulletManager {\r\n  // config\r\n  private bulletConfig = null\r\n\r\n  // member\r\n  private bulletBondingSize = null\r\n  private aliveBulletObjectList: Bullet[] = []\r\n  private aliveBulletBBXList = {}\r\n\r\n  private objectPool: ObjectPool;\r\n  private sourceManage: SourceManage;\r\n  private batteryManager: BatteryManager;\r\n  /**缩放比例 */\r\n  private scaleRatio: number = 1;\r\n\r\n  /**\r\n   * 初始化\r\n   * @param bondSize 子弹绑定尺寸\r\n   * @param bulConfig 子弹配置\r\n   * @param objectPool 对象池\r\n   * @param sourceManage 资源管理\r\n   * @param batteryManager 炮台管理\r\n   */\r\n  public init(bondSize, bulConfig, objectPool: ObjectPool, sourceManage: SourceManage, batteryManager: BatteryManager, scaleRatio: number = 1) {\r\n    this.bulletConfig = bulConfig\r\n    this.bulletBondingSize = bondSize\r\n    this.objectPool = objectPool\r\n    this.sourceManage = sourceManage\r\n    this.batteryManager = batteryManager\r\n    this.scaleRatio = scaleRatio\r\n\r\n    this.aliveBulletObjectList = []\r\n    this.aliveBulletBBXList = {}\r\n  }\r\n\r\n  public uninit() {\r\n    this.bulletConfig = null\r\n    this.bulletBondingSize = null\r\n    this.aliveBulletObjectList = null\r\n    this.aliveBulletBBXList = null\r\n    this.objectPool = null\r\n    this.sourceManage = null\r\n    this.batteryManager = null\r\n  }\r\n\r\n  /**\r\n   * 发射子弹\r\n   * @param bulletID 子弹ID\r\n   * @param startPos 子弹起始位置\r\n   * @param angle 子弹角度\r\n   * @param side 子弹方向\r\n   * @param playerID 玩家ID\r\n   * @param serverID 服务器ID\r\n   * @param lockFishID 锁定鱼ID\r\n   * @param isLocal 是否是本地\r\n   */\r\n  public sendBullet(bulletID, startPos, angle, side, playerID, serverID, lockFishID, isLocal) {\r\n    let obj: Bullet = this.objectPool.getObject(ObjectClassType.type_bullet, bulletID)\r\n    if (obj) {\r\n      obj.reset(startPos, angle, lockFishID, playerID, serverID, isLocal)\r\n      this.aliveBulletObjectList[obj.getObjectId()] = obj\r\n      this.aliveBulletBBXList[obj.getObjectId()] = { player_id: playerID, bbx: obj.getBondingBox(), bullet: obj }\r\n    }\r\n  }\r\n\r\n  public update(dt) {\r\n    for (let k = 0; k < this.aliveBulletObjectList.length; k++) {\r\n      const v = this.aliveBulletObjectList[k];\r\n      if (v == null) continue;\r\n      v.update(dt)\r\n      this.aliveBulletBBXList[k].bbx = v.getBondingBox()\r\n    }\r\n  }\r\n  public getBulletAliveLst() {\r\n    return this.aliveBulletObjectList\r\n  }\r\n  public getBulletBondingInfoLst() {\r\n    return this.aliveBulletBBXList\r\n  }\r\n\r\n  public removeBulletObject(objID) {\r\n    let obj = this.aliveBulletObjectList[objID]\r\n    if (obj) {\r\n      obj.shotSomething()\r\n      obj.resumeOrgin()\r\n      this.aliveBulletObjectList[objID] = null\r\n      this.aliveBulletBBXList[objID] = null\r\n    }\r\n  }\r\n\r\n  public removeBulletObjectByPlayerId(playerID) {\r\n    for (let k = 0; k < this.aliveBulletObjectList.length; k++) {\r\n      const v = this.aliveBulletObjectList[k];\r\n      if (v == null) continue;\r\n      if (playerID == v.getBulletPlayerId()) {\r\n        v.resumeOrgin()\r\n        this.aliveBulletObjectList[k] = null\r\n        this.aliveBulletBBXList[k] = null\r\n      }\r\n    }\r\n  }\r\n\r\n  public getBulletBBX(objID) {\r\n    return this.aliveBulletBBXList[objID]\r\n  }\r\n\r\n}\r\n\r\n\r\n"]}