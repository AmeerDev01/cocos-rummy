{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dragon/Slot/Component/dragon_Roller.ts"],"names":["_decorator","Node","UITransform","Size","Prefab","instantiate","Vec3","tween","Mask","BaseComponent","AudioManager","SoundList","ccclass","property","dragon_Roller","rollerDataRep","isRoll","rollerData","rollerIndex","endFlag","initStartIndex","lastJoinIconIndex","stopHandler","historicalCircleOfFireList","MoveHeight","isSpeed","start","bindUI","getRollProxy","getRepository","rootUi","root","getComponent","anchorY","rollerUi","RollerLayOut","data","length","setContentSize","intervalWidth","rollerWidth","intervalHeight","rollerheight","portraitNum","setPosition","position","x","i","icon","y","addChild","index","setFace","initRollerLayOut2","RollerLayOut2","bindEvent","bindRollerData","startRoll","stopIndex","joinIcon","setStopIndex","children","forEach","setEffect","node","enabled","stopRoll","cbFn","addLastJoinIconIndex","showResult","setSiblingIndex","stopCallBack","getInstance","playSound","theRollerStops","destroy","oldMoveRingOfFire","getChildByName","item","active","nodeMOve","theRingOfFireIsHidden","state","destroyAllChildren","moveRingOfFire","targetY","RingOfFire","showWlid","isDestroy","duration","to","z","call","scheduleOnce","uniqueByFirstTwo","arr","uniqueArr","map","Map","key","slice","join","has","set","push","setIconEffect","mode","target","allState","comp","some","iconId","iconIndex","addDockIcon","targetArr","removeAllDockIcon","icon2","hiddenAmounts","e","console","error","removeAllChildren","togglesThePopUpLayerState","amountNum","rollWithCell","rollSpeed","window","setTimeout","deviation","Math","abs","_lastJoinIconIndex","count","easing","lastChild","value","newValue","update","deltaTime","lateUpdate"],"mappings":"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","sourcesContent":["import { _decorator, Node, Label, UITransform, Size, Prefab, instantiate, Vec3, Layout, tween, log, Mask } from 'cc';\r\nimport BaseComponent from './BaseComponent';\r\nimport { SlotRepository, RollerType } from '../Repositories/SlotRepository';\r\nimport { dragon_Icon } from './dragon_Icon';\r\nimport { SlotProxy } from '../Proxy/SlotProxy';\r\nimport config from '../config';\r\nimport { AudioManager, SoundList } from '../Managr/AudioManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 动画停止回调\r\n */\r\ntype StopHandlerType = (rollerIndex: number, rollerData: RollerType) => void\r\n\r\n@ccclass('dragon_Roller')\r\nexport class dragon_Roller extends BaseComponent {\r\n\t@property(Node)\r\n\tRollerLayOut: Node = null\r\n\r\n\t@property(Node)\r\n\tRollerLayOut2: Node = null\r\n\t@property(Node)\r\n\tRingOfFire: Node = null\r\n\r\n\t@property(Prefab)\r\n\ticon: Prefab = null\r\n\r\n\t@property(Prefab)\r\n\ticon2: Prefab = null\r\n\r\n\tprivate rollerDataRep: SlotRepository\r\n\tprivate isRoll = false\r\n\tprivate rollerData: RollerType\r\n\t/**第几条滑槽，序号 */\r\n\tprivate rollerIndex: number\r\n\t/**此值存在，即要检测停止了 */\r\n\tprivate endFlag: boolean = true\r\n\t/**初始化时，图标开始的排列序号 */\r\n\tprivate initStartIndex = 0\r\n\t/**下一个要加入的图标 */\r\n\tprivate lastJoinIconIndex = 0\r\n\t// private target: number = -1\r\n\t/**动态效果停止后的动态回调函数 */\r\n\tprivate stopHandler: StopHandlerType\r\n\tprivate historicalCircleOfFireList: [][] = []\r\n\tprivate MoveHeight = -138\r\n\r\n\tprivate isSpeed = false;\r\n\r\n\tstart() { }\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerDataRep = this.getRollProxy().getRepository();\r\n\t\t// const layout = this.RollerLayOut.getComponent(Layout)\r\n\t\t// layout.spacingY = this.rollerData.roller.intervalHeight\r\n\t\t// 配置滑槽宽高度(也就是蒙板宽高)\r\n\t\tconst rootUi = this.root.getComponent(UITransform) as UITransform\r\n\t\trootUi.anchorY = 1\r\n\t\tconst rollerUi = this.RollerLayOut.getComponent(UITransform) as UITransform\r\n\t\t// rootUi.anchorX = 0\r\n\t\trollerUi.anchorY = 1\r\n\t\t// rollerUi.anchorX = 0\r\n\t\tthis.lastJoinIconIndex = this.initStartIndex - 1\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// 设置蒙版组件高度\r\n\t\trootUi.setContentSize(new Size(this.rollerData.intervalWidth + this.rollerData.rollerWidth,\r\n\t\t\t((this.rollerData.intervalHeight + this.rollerData.rollerheight) * this.rollerData.portraitNum) + this.rollerData.intervalHeight))\r\n\t\t//设置滑道高度，多一个高度\r\n\t\trollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n\t\t\t(this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum + 1)))\r\n\t\t// 滑道网上顶一个单位（但是上沿有遮挡，再降30）\r\n\t\tthis.RollerLayOut.setPosition(this.RollerLayOut.position.x, (this.rollerData.intervalHeight + this.rollerData.rollerheight) - this.rollerData.intervalHeight)\r\n\t\t// 初始化即将开始的图标\r\n\t\tfor (let i = 0; i < this.rollerData.portraitNum; i++) {\r\n\t\t\tconst icon = instantiate(this.icon)\r\n\t\t\ticon.setPosition(new Vec3(0, icon.position.y - (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (i + 1)))\r\n\t\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t\tconst index = this.initStartIndex + i;\r\n\t\t\t(<dragon_Icon>icon.getComponent(\"dragon_Icon\")).setFace(this.rollerData.data[index])\r\n\t\t}\r\n\t\t// this.bubble.active = this.rollerData.isBigIcon\r\n\t\tthis.initRollerLayOut2()\r\n\t}\r\n\r\n\tprivate initRollerLayOut2() {\r\n\t\tconst rollerUi = this.RollerLayOut2.getComponent(UITransform) as UITransform\r\n\t\trollerUi.anchorY = 1\r\n\t\trollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n\t\t\t(this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum)))\r\n\t}\r\n\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\t/**指定滑槽数据 */\r\n\tpublic bindRollerData(rollerIndex: number, data: RollerType) {\r\n\t\tthis.rollerData = data\r\n\t\tthis.rollerIndex = rollerIndex\r\n\t}\r\n\t/**\r\n\t * 开始滚动\r\n\t * @param stopIndex 设定要停止的序号（从1开始的）\r\n\t */\r\n\tpublic startRoll(stopIndex: number, isSpeed: boolean = false) {\r\n\t\tthis.isSpeed = isSpeed;\r\n\t\t// 往上移动一个网格，以便放上下一个要显示的icon\r\n\t\tthis.joinIcon();\r\n\t\t// console.log(this.rollerIndex, stopIndex);\r\n\t\t(this.getRollProxy() as SlotProxy).setStopIndex(this.rollerIndex, stopIndex)\r\n\t\tthis.isRoll = true\r\n\t\tthis.endFlag = false\r\n\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t(<dragon_Icon>icon.getComponent(\"dragon_Icon\")).setEffect()\r\n\t\t})\r\n\t\tthis.node.getComponent(Mask).enabled = true\r\n\t\t// this.rollWithCell('down')\r\n\t\t// console.log(this.getRollProxy().getRepository())\r\n\t}\r\n\t// 停止滚动\r\n\tpublic stopRoll(cbFn: StopHandlerType) {\r\n\t\tthis.endFlag = true\r\n\t\tthis.stopHandler = cbFn\r\n\t\tthis.addLastJoinIconIndex(this.rollerData.showResult.stopIndex, 3);\r\n\t\t// (this.getRollProxy() as FruitsSlotProxy).setStopIndex(this.rollerIndex)\r\n\t}\r\n\tprivate joinIcon() {\r\n\t\t// this.lastJoinIconIndex === this.rollerData.data.length && (this.lastJoinIconIndex = 0)\r\n\t\t// console.log(this.lastJoinIconIndex)\r\n\t\tconst icon = instantiate(this.icon)\r\n\t\ticon.setPosition(icon.position.x, 0)\r\n\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t(<dragon_Icon>icon.getComponent(\"dragon_Icon\")).setFace(this.rollerData.data[this.lastJoinIconIndex])\r\n\t\ticon.setSiblingIndex(0)\r\n\t\tthis.lastJoinIconIndex--\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// this.RollerLayOut.removeChild(this.RollerLayOut.children[this.RollerLayOut.children.length - 1])\r\n\t\t// this.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n\t\r\n\tprivate stopCallBack() {\r\n\t\tthis.node.getComponent(Mask).enabled = false\r\n\t\tthis.stopHandler && this.stopHandler(this.rollerIndex, this.rollerData)\r\n\t\t// this.RollerLayOut.children.forEach(icon => {\r\n\t\t// \tconst comp = (<Icon>icon.getComponent(\"Icon\"))\r\n\t\t// \tif (comp.iconId === this.target) {\r\n\t\t// \t\tcomp.setEffect('animation')\r\n\t\t// \t}\r\n\t\t// })\r\n\t\tAudioManager.getInstance().playSound(SoundList.theRollerStops)\r\n\t\tthis.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n\t/* 老火圈滚动动逻辑*/\r\n\toldMoveRingOfFire() {\r\n\t\tthis.node.getChildByName('RingOfFireBOX').children.forEach(item => {\r\n\t\t\titem.getChildByName('wlid').active = false\r\n\t\t\tif (item.position.y + this.MoveHeight < this.MoveHeight * 2) {\r\n\t\t\t\tthis.nodeMOve(item, item.position.y + this.MoveHeight, true)\r\n\t\t\t} else {\r\n\t\t\t\tthis.nodeMOve(item, item.position.y + this.MoveHeight)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// 火圈隐藏\r\n\ttheRingOfFireIsHidden(state){\r\n\t\tthis.node.getChildByName('RingOfFireBOX').active=state\r\n\t\tif(!state){\r\n\t\t\tthis.node.getChildByName('RingOfFireBOX').destroyAllChildren()\r\n\t\t}\r\n\t}\r\n\t/* 火圈滚动逻辑*/\r\n\tmoveRingOfFire(data) {\r\n\t\tlet targetY = 0;\r\n\t\tif (data[1] === 0) {\r\n\t\t\ttargetY = this.MoveHeight * 2\r\n\t\t}\r\n\t\tif (data[1] === 1) {\r\n\t\t\ttargetY = this.MoveHeight\r\n\t\t}\r\n\t\tif (data[1] === 2) {\r\n\t\t\ttargetY = 0\r\n\t\t}\r\n\t\tlet node = instantiate(this.RingOfFire);\r\n\t\tnode.active = true;\r\n\t\tnode.setSiblingIndex(999);\r\n\t\tthis.nodeMOve(node, targetY)\r\n\t\tlet children = this.node.getChildByName('RingOfFireBOX').children\r\n\t\tif (children.length > 0) {\r\n\t\t\tfor (let i = 0; i <= children.length; i++) {\r\n\t\t\t\tif (children[i]?.position.y === targetY - this.MoveHeight) {\r\n\t\t\t\t\tif (data[2]) {\r\n\t\t\t\t\t\tthis.showWlid(children[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.node.getChildByName('RingOfFireBOX').addChild(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (data[2]) {\r\n\t\t\t\tthis.showWlid(node)\r\n\t\t\t}\r\n\t\t\tthis.node.getChildByName('RingOfFireBOX').addChild(node);\r\n\t\t}\r\n\r\n\t}\r\n\t/* 火圈移动*/\r\n\tprivate nodeMOve(item: Node, targetY, isDestroy = false) {\r\n\t\tlet duration = 1\r\n\t\ttween(item).to(duration, { position: new Vec3(item.position.x, targetY, item.position.z) })\r\n\t\t\t.call(() => {\r\n\t\t\t\tif (isDestroy) {\r\n\t\t\t\t\titem.destroy()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.start();\r\n\t}\r\n\t/* 显示wlid*/\r\n\tprivate showWlid(item) {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\titem&&(item.getChildByName('wlid').active = true)\r\n\t\t}, 1)\r\n\t}\r\n\t/* 去重*/\r\n\tprivate uniqueByFirstTwo(arr) {\r\n\t\tconst uniqueArr = [];\r\n\t\tconst map = new Map();\r\n\r\n\t\tfor (const item of arr) {\r\n\t\t\tconst key = item.slice(0, 2).join(',');\r\n\r\n\t\t\tif (!map.has(key)) {\r\n\t\t\t\tmap.set(key, true);\r\n\t\t\t\tuniqueArr.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn uniqueArr;\r\n\t}\r\n\t/**\r\n\t * 设置当前滑槽的闪动图标()\r\n\t * @param mode 传入的是光标id，还是左边序列号\r\n\t * @param target 光标位置或者y轴坐标序列\r\n\t */\r\n\tpublic setIconEffect(mode: 'index' | 'coord', target: number[], allState: boolean = false) {\r\n\t\tif (mode === 'index') {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\tconst comp = (<dragon_Icon>icon.getComponent(\"dragon_Icon\"))\r\n\t\t\t\tif (target.some(i => i === comp.iconId)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcomp.setEffect()\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tlet iconIndex = this.rollerData.portraitNum\r\n\t\t\tthis.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t\ticonIndex--\r\n\t\t\t\tconst comp = (<dragon_Icon>icon.getComponent(\"dragon_Icon\"))\r\n\t\t\t\tif (target.some(i => i === iconIndex)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (allState) {\r\n\t\t\t\t\t\tcomp.setEffect()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\r\n\t\t\t//向上数第几个光标闪动\r\n\t\t\t// for (let i = 2; i >= 0; i--) {\r\n\t\t\t// \tconst comp = (<Icon>this.RollerLayOut.children[i].getComponent(\"Icon\"))\r\n\t\t\t// \tif (!comp) continue\r\n\t\t\t// \tif (i === target) {\r\n\t\t\t// \t\tcomp.setEffect(1)\r\n\t\t\t// \t} else {\r\n\t\t\t// \t\tcomp.setEffect()\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 添加停靠图标\r\n\t * @param index 停靠的序号，从下到上\r\n\t */\r\n\tpublic addDockIcon(targetArr: number[]) {\r\n\t\tthis.removeAllDockIcon()\r\n\t\ttargetArr.forEach((item, index) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst icon = instantiate(this.icon2);\r\n\t\t\t\tif (item[0] === 0) {\r\n\t\t\t\t\titem[0] = 2\r\n\t\t\t\t} else if (item[0] === 2) {\r\n\t\t\t\t\titem[0] = 0\r\n\t\t\t\t}\r\n\t\t\t\t(<dragon_Icon>icon.getComponent(\"dragon_Icon\")).hiddenAmounts(item[1])\r\n\t\t\t\ticon.setPosition(new Vec3(0, -item[0] * this.rollerData.rollerheight))\r\n\t\t\t\tthis.RollerLayOut2.addChild(icon);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('sss')\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t}\r\n\r\n\tpublic removeAllDockIcon() {\r\n\t\tthis.RollerLayOut2.removeAllChildren()\r\n\t}\r\n\t//隐藏显示弹出层2\r\n\tpublic togglesThePopUpLayerState(state: boolean) {\r\n\t\tthis.RollerLayOut2.active = state\r\n\t}\r\n\tpublic hiddenAmounts(state, amountNum) {\r\n\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t// (<Icon>icon.getComponent(\"Icon\")).hiddenAmounts(state,amountNum)\r\n\t\t})\r\n\t}\r\n\t/**滚动一个格子 */\r\n\tprivate rollWithCell(position: 'up' | 'down') {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t// icon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t\ttween(icon).to(this.rollerData.rollSpeed / 1000, { position: new Vec3(icon.position.x, icon.position.y - ((this.rollerData.intervalHeight + this.rollerData.rollerheight))) }).start()\r\n\t\t\t})\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\t\t// if (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation = Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t\t\t\ttween().target(icon).to(this.rollerData.rollSpeed / 1000 + 0.3, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.rollWithCell(position)\r\n\t\t\t\t}\r\n\t\t\t}, this.rollerData.rollSpeed)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\t\tlet newValue = stopIndex + value;\r\n\t\t\tif (newValue >= this.rollerData.data.length) {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue - this.rollerData.data.length;\r\n\t\t\t} else {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue;\r\n\t\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\ticon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t})\r\n\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\tif (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation = 0// Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t\t\t\t\ttween().target(icon).to(0.5, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight) + index * 18)\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlateUpdate() {\r\n\t\t// if (this.RollerLayOut.children.length) {\r\n\t\t// \tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t// \tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t// \t\tlastChild.destroy()\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n}\r\n\r\n"]}