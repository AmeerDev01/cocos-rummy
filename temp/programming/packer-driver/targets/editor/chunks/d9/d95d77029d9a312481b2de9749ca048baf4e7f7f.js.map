{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/login_v2/RegV2ViewModel.ts"],"names":["RegV2ViewModel","sys","ViewModel","EffectType","ApiUrl","fetcher","deviceInfo","getPackageName","registerAppsflyerEvents","constructor","begin","setProps","setEvent","closeHandler","unMount","EFFECT2","regHandler","loginName","password","send","REG","pkgCode","macCode","getUniqueId","memberName","then","data","values","split","token","length","localStorage","setItem","comp","events","regDoneHandler","catch","e","console","log","connect","initProps","inject","state"],"mappings":";;;iLAUqBA,c;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAVNC,MAAAA,G,OAAAA,G;;AACRC,MAAAA,S;;AAGEC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,uB,iBAAAA,uB;;;;;;;;;yBAEJR,c,GAAN,MAAMA,cAAN;AAAA;AAAA,kCAAuE;AACpFS,QAAAA,WAAW,GAAG;AACZ,gBAAM,gBAAN;AACD;;AACSC,QAAAA,KAAK,GAAG;AAChB,eAAKC,QAAL,CAAc,EAAd;AAGA,eAAKC,QAAL,CAAc;AACZC,YAAAA,YAAY,EAAE,MAAM;AAClB,mBAAKC,OAAL,CAAa;AAAA;AAAA,4CAAWC,OAAxB;AACD,aAHW;AAIZC,YAAAA,UAAU,EAAE,CAACC,SAAD,EAAYC,QAAZ,KAAyB;AACnC;AAAA;AAAA,sCAAQC,IAAR,CAAa;AAAA;AAAA,oCAAOC,GAApB,EAAyB;AACvBC,gBAAAA,OAAO,EAAE;AAAA;AAAA,uDADc;AAEvBC,gBAAAA,OAAO,EAAE;AAAA;AAAA,8CAAWC,WAAX,EAFc;AAGvBC,gBAAAA,UAAU,EAAEP,SAHW;AAGAC,gBAAAA;AAHA,eAAzB,EAIGO,IAJH,CAISC,IAAD,IAAU;AAChB,sBAAMC,MAAM,GAAGD,IAAI,CAACE,KAAL,CAAW,GAAX,CAAf;AACA,oBAAIC,KAAK,GAAGF,MAAM,CAACG,MAAP,KAAkB,CAAlB,GAAsBJ,IAAtB,GAA6BC,MAAM,CAAC,CAAD,CAA/C,CAFgB,CAGhB;;AACA1B,gBAAAA,GAAG,CAAC8B,YAAJ,CAAiBC,OAAjB,CAAyB,OAAzB,EAAkCH,KAAlC;AACA,qBAAKI,IAAL,CAAUC,MAAV,CAAiBC,cAAjB;AACA;AAAA;AAAA,wEAAwBlB,SAAxB,EAAmCC,QAAnC;AACD,eAXD,EAWGkB,KAXH,CAWUC,CAAD,IAAO;AACdC,gBAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,eAbD;AAcD;AAnBW,WAAd;AAqBD;;AACMG,QAAAA,OAAO,CAACC,SAA0B,GAAG,EAA9B,EAAkC;AAC9C,eAAKC,MAAL,CAAYD,SAAZ,EAAwBE,KAAD,IAAsB;AAC3C,mBAAO,EAAP;AACD,WAFD;AAGA,iBAAO,IAAP;AACD;;AAnCmF,O","sourcesContent":["import { Node, sys } from \"cc\"\r\nimport ViewModel from \"../../../base/ViewModel\"\r\nimport { StateType } from \"../../store/reducer\"\r\nimport { Hall_RegPageV2, IProps, IEvent } from \"../../components/login_v2/Hall_RegPageV2\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport { ApiUrl } from \"../../apiUrl\"\r\nimport { fetcher, sourceManageSeletor } from \"../../index\"\r\nimport { deviceInfo } from \"../../config\"\r\nimport { getPackageName, registerAppsflyerEvents } from \"../../../common/bridge\"\r\n\r\nexport default class RegV2ViewModel extends ViewModel<Hall_RegPageV2, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_RegPageV2')\r\n  }\r\n  protected begin() {\r\n    this.setProps({\r\n\r\n    })\r\n    this.setEvent({\r\n      closeHandler: () => {\r\n        this.unMount(EffectType.EFFECT2)\r\n      },\r\n      regHandler: (loginName, password) => {\r\n        fetcher.send(ApiUrl.REG, {\r\n          pkgCode: getPackageName(),\r\n          macCode: deviceInfo.getUniqueId(),\r\n          memberName: loginName, password\r\n        }).then((data) => {\r\n          const values = data.split(\",\")\r\n          let token = values.length === 1 ? data : values[0];\r\n          //注册成功\r\n          sys.localStorage.setItem('token', token)\r\n          this.comp.events.regDoneHandler()\r\n          registerAppsflyerEvents(loginName, password);\r\n        }).catch((e) => {\r\n          console.log(e)\r\n        })\r\n      }\r\n    })\r\n  }\r\n  public connect(initProps: Partial<IProps> = {}) {\r\n    this.inject(initProps, (state: StateType) => {\r\n      return {}\r\n    })\r\n    return this\r\n  }\r\n}"]}