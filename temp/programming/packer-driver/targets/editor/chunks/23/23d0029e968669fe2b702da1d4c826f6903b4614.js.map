{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fish/viewModel/MainViewModel.ts"],"names":["view","sourceManageSelector","ViewModel","StoreInject","BatteryManager","BulletCreate","BulletManager","FishGoldManager","FishManager","FishNetCreate","FishNetManager","ObjectEffectWorld","ObjectClassType","ObjectPool","fishActionConfig","fishBatteryConfig","fishBatteryPosConfig","fishBatterySkinConfig","fishBondingBoxConfig","fishBullteConfig","fishCommondConfig","fishCurveConfig","fishConfig","fishGoldConfig","fishHitLabelConfig","fishLabelFntConfig","fishNetConfig","fishTexturesConfig","getStore","fishFntResConfig","FishLabelFntManager","FishGoldCreate","FishLabelFntCreate","SkillPlayer","fishSkillConfig","BackgroundSceneManager","fishBackgroundConfig","SkillRegisterFunc","MusicEffectPlayer","fishMusicResConfig","fishMusicEffectConfig","fishBgmConfig","RoomChooseViewModel","PrefabPathDefine","SKT_MAG_TYPE","sktInstance","sktMsgListener","config","RoomViewModel","quitGame","global","ToastType","addToastAction","MainViewModel","constructor","initCallback","fishManager","objectPool","bulletManager","batteryManager","objectEffectWorld","fishNetManager","fishGoldManager","fishLabelFntManager","skillPlayer","backgroundSceneManager","musicEffectPlayer","sourceManage","skillRegisterFunc","send_yrby_ReqHit","bsend_shot_to_server","insteadSendBulletPlayers","roomChooseViewModel","roomViewModel","scale","setFishNetManager","setFishLabelFntManager","begin","getVisibleSize","width","scene_size","initManager","listenerSocket","initUI","comp","scheduleOnce","initRoomChooseNode","initRoomModel","initMusicEffectPlayer","initObjectPool","initFish","initBullet","initObjectEffectWorld","initFishGold","initBattery","initBackgroundSceneManager","initFishLabelFntManager","initSkillPlayer","initSkillRegisterFunc","setEvent","update","deltaTime","getScaleRatio","setScale","isTest","getFishManager","getBatteryManager","getBackgroundSceneManager","viewNode","init","getBatteryNode","getRootNode","initConfig","registerObjectCreater","type_bullet","k","v","newSomeObject","id","type_fish_net","type_fish_gold","type_fish_fnt","getFishPondNode","bonding_size","registerCallback","onShotCallback","bind","funs","getBackgroundNode","createSeawaveObj","shotLst","bulletObj","isMyBullet","msg","playerId","getBulletPlayerId","bulletId","getBulletServeId","fishId","fishObj","getObjectId","fishConfigId","getFishConfigId","battery","getBatteryByPlayerId","minusBulletNum","m","n","removeBulletObject","setSendYrbyReqHit","sendSktMessage","HIT_FISH","fishDeath","player_id","fshid","score","bat_obj","fsh_obj","getFishObjById","setScoreVal","setGoldMoveEndPos","getBatteryPos","setUserInfo","getUserInfo","removeFish","fishLstDeath","lst","length","fsh_id","i","first_obj","addLineRelObj","setHitScore","unMountCallBack","uninit","unMount","unListenerSocket","dispatch","mountView","getFile","ROOM_CHOOSE","source","appendTo","getRoomListNode","connect","exitGame","onExitGame","GAME_ROOM","getGameMainSenceNode","active","closeSubGame","enterRoom","add","JOIN_ROOM","name","data","error","ERROR_MSG","msgId","hallDispatch","content","type","NORMAL","remove","inject","state"],"mappings":"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","sourcesContent":["; import { sourceManageSelector } from \"../index\";\r\nimport SourceManage from \"../../../base/SourceManage\";\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { BatteryManager } from \"../../../common/fish/BatteryManager\";\r\nimport { BulletCreate } from \"../../../common/fish/Bullet\";\r\nimport { BulletManager } from \"../../../common/fish/BulletManager\";\r\nimport { FishGoldManager } from \"../../../common/fish/FishGoldManager\";\r\nimport { FishManager } from \"../../../common/fish/FishManager\";\r\nimport { FishNetCreate } from \"../../../common/fish/FishNet\";\r\nimport { FishNetManager } from \"../../../common/fish/FishNetManager\";\r\nimport { ObjectEffectWorld, ShotInfo } from \"../../../common/fish/ObjectEffectWorld\";\r\nimport { ObjectClassType, ObjectPool } from \"../../../common/fish/ObjectPool\";\r\nimport { Fish_Main, IEvent, IProps } from \"../components/Fish_Main\"\r\nimport { fishActionConfig } from \"../config/ByActionConfig\";\r\nimport { fishBatteryConfig } from \"../config/ByBatteryConfig\";\r\nimport { fishBatteryPosConfig } from \"../config/ByBatteryPositionConfig\";\r\nimport { fishBatterySkinConfig } from \"../config/ByBatterySkinConfig\";\r\nimport { fishBondingBoxConfig } from \"../config/ByBondingBoxConfig\";\r\nimport { fishBullteConfig } from \"../config/ByBulletConfig\";\r\nimport { fishCommondConfig } from \"../config/ByCommonConfig\";\r\nimport { fishCurveConfig } from \"../config/ByCurveConfig\";\r\nimport { fishConfig } from \"../config/ByFishConfig\";\r\nimport { fishGoldConfig } from \"../config/ByFishGoldConfig\";\r\nimport { fishHitLabelConfig } from \"../config/ByFishHitLabelConfig\";\r\nimport { fishLabelFntConfig } from \"../config/ByFishLabelFntConfig\";\r\nimport { fishNetConfig } from \"../config/ByFishNetConfig\";\r\nimport { fishTexturesConfig } from \"../config/ByTexturesConfig\";\r\nimport { getStore } from \"../store\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { fishFntResConfig } from \"../config/ByFntResConfig\";\r\nimport { FishLabelFntManager } from \"../../../common/fish/FishLabelFntManager\";\r\nimport { FishGoldCreate } from \"../../../common/fish/FishGold\";\r\nimport { FishLabelFntCreate } from \"../../../common/fish/FishLabelFnt\";\r\nimport { SkillPlayer } from \"../../../common/fish/SkillPlayer\";\r\nimport { fishSkillConfig } from \"../config/BySkillConfig\";\r\nimport { BackgroundSceneManager } from \"../../../common/fish/BackgroundSceneManager\";\r\nimport { fishBackgroundConfig } from \"../config/ByBackgroundConfig\";\r\nimport { Fish } from \"../../../common/fish/Fish\";\r\nimport { Battery } from \"../../../common/fish/Battery\";\r\nimport { SkillRegisterFunc } from \"../../../common/fish/utils/SkillRegisterFunc\";\r\nimport { MusicEffectPlayer } from \"../../../common/fish/MusicEffectPlayer\";\r\nimport { fishMusicResConfig } from \"../config/ByMusicResConfig\";\r\nimport { fishMusicEffectConfig } from \"../config/ByMusicEffectConfig\";\r\nimport { fishBgmConfig } from \"../config/ByBgmConfig\";\r\nimport RoomChooseViewModel from \"./RoomChooseViewModel\";\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\";\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\";\r\nimport config from \"../config\";\r\nimport RoomViewModel from \"./RoomViewModel\";\r\nimport { EnterRoomVo, ErrorMsgVo } from \"../type\";\r\nimport { quitGame } from \"../store/action/game\";\r\nimport { UITransform, view } from \"cc\";\r\nimport { global } from \"../../../hall\";\r\nimport { ToastType, addToastAction } from \"../../../hall/store/actions/baseBoard\";\r\n\r\n@StoreInject(getStore())\r\nclass MainViewModel extends ViewModel<Fish_Main, IProps, IEvent> {\r\n  private fishManager: FishManager;\r\n  private objectPool: ObjectPool;\r\n  private bulletManager: BulletManager;\r\n  private batteryManager: BatteryManager;\r\n  private objectEffectWorld: ObjectEffectWorld;\r\n  private fishNetManager: FishNetManager;\r\n  private fishGoldManager: FishGoldManager;\r\n  private fishLabelFntManager: FishLabelFntManager;\r\n  private skillPlayer: SkillPlayer;\r\n  private backgroundSceneManager: BackgroundSceneManager;\r\n  private musicEffectPlayer: MusicEffectPlayer;\r\n\r\n  private sourceManage: SourceManage;\r\n  private skillRegisterFunc: SkillRegisterFunc;\r\n\r\n  private send_yrby_ReqHit;\r\n\r\n  private bsend_shot_to_server = true;\r\n  private insteadSendBulletPlayers = { 1: 1 };\r\n\r\n  private roomChooseViewModel: RoomChooseViewModel;\r\n  public roomViewModel: RoomViewModel;\r\n  private scale = 0;\r\n\r\n  private initCallback;\r\n\r\n  constructor(initCallback) {\r\n    super('Fish_Main')\r\n\r\n    this.initCallback = initCallback;\r\n\r\n    this.fishManager = new FishManager();\r\n    this.objectPool = new ObjectPool();\r\n    this.bulletManager = new BulletManager();\r\n    this.batteryManager = new BatteryManager();\r\n    this.objectEffectWorld = new ObjectEffectWorld(this.bulletManager, this.batteryManager, this.fishManager);\r\n    this.fishNetManager = new FishNetManager(this.objectPool);\r\n    this.fishGoldManager = new FishGoldManager();\r\n    this.fishLabelFntManager = new FishLabelFntManager(this.objectPool);\r\n    this.skillPlayer = new SkillPlayer();\r\n    this.backgroundSceneManager = new BackgroundSceneManager();\r\n\r\n    this.objectPool.setFishNetManager(this.fishNetManager);\r\n    this.objectPool.setFishLabelFntManager(this.fishLabelFntManager);\r\n\r\n    this.sourceManage = sourceManageSelector();\r\n\r\n    this.skillRegisterFunc = new SkillRegisterFunc(this.skillPlayer, this.backgroundSceneManager, this.sourceManage, this.batteryManager, '');\r\n  }\r\n  protected begin() {\r\n    this.scale = view.getVisibleSize().width / fishCommondConfig.scene_size.width;\r\n    this.initManager();\r\n\r\n    this.listenerSocket();\r\n    this.initUI();\r\n\r\n    this.comp.scheduleOnce(() => {\r\n      this.initCallback && this.initCallback();\r\n    }, 0.5)\r\n  }\r\n\r\n  private initManager() {\r\n    this.initRoomChooseNode();\r\n    this.initRoomModel();\r\n\r\n    this.initMusicEffectPlayer();\r\n    this.initObjectPool();\r\n    this.initFish();\r\n    this.initBullet();\r\n    this.initObjectEffectWorld();\r\n    this.initFishGold();\r\n    this.initBattery();\r\n    this.initBackgroundSceneManager();\r\n    this.initFishLabelFntManager();\r\n    this.initSkillPlayer();\r\n    this.initSkillRegisterFunc();\r\n\r\n    this.setEvent({\r\n      update: (deltaTime: number) => {\r\n        this.fishManager.update(deltaTime);\r\n        this.bulletManager.update(deltaTime);\r\n        this.objectEffectWorld.update();\r\n        this.backgroundSceneManager.update(deltaTime);\r\n        this.fishLabelFntManager.update(deltaTime);\r\n        this.musicEffectPlayer.update(deltaTime);\r\n      }\r\n    })\r\n  }\r\n\r\n  /**获得缩放比例 */\r\n  public getScaleRatio() {\r\n    // let scale = view.getDesignResolutionSize().width / fishCommondConfig.scene_size.width\r\n    // this.scale = 1;\r\n    return this.scale;\r\n  }\r\n\r\n  public setScale(scale) {\r\n    this.scale = scale;\r\n    config.isTest && this.initManager();\r\n  }\r\n\r\n  public getFishManager() {\r\n    return this.fishManager;\r\n  }\r\n\r\n  public getBatteryManager() {\r\n    return this.batteryManager;\r\n  }\r\n\r\n  public getBackgroundSceneManager() {\r\n    return this.backgroundSceneManager;\r\n  }\r\n\r\n  private initMusicEffectPlayer() {\r\n    this.musicEffectPlayer = new MusicEffectPlayer(this.viewNode, this.sourceManage, fishMusicResConfig, fishMusicEffectConfig);\r\n  }\r\n\r\n  private initBattery() {\r\n    this.batteryManager.init(this.getBatteryNode(), this.getRootNode(), fishBatteryPosConfig, fishTexturesConfig, fishCommondConfig, fishBatteryConfig, fishBatterySkinConfig,\r\n      fishHitLabelConfig, fishFntResConfig, this.sourceManage, this.bulletManager, this.fishManager, this.backgroundSceneManager, this.musicEffectPlayer,\r\n      this.getScaleRatio());\r\n  }\r\n  private initObjectPool() {\r\n    this.objectPool.init(this.getBatteryNode());\r\n\r\n    this.objectPool.initConfig(fishBullteConfig, fishBatteryConfig, fishCommondConfig, fishConfig, fishTexturesConfig, fishHitLabelConfig,\r\n      fishLabelFntConfig, fishNetConfig, fishGoldConfig, fishActionConfig, fishFntResConfig, this.batteryManager, this.sourceManage,\r\n      this.getScaleRatio(), this.getRootNode())\r\n\r\n    // --注册子弹\r\n    this.objectPool.registerObjectCreater(ObjectClassType.type_bullet, BulletCreate);\r\n    for (const k in fishBullteConfig) {\r\n      const v = fishBullteConfig[k];\r\n      this.objectPool.newSomeObject(ObjectClassType.type_bullet, v.id, 5)//预分配子弹对象\r\n    }\r\n\r\n    //\t--注册鱼网\r\n    this.objectPool.registerObjectCreater(ObjectClassType.type_fish_net, FishNetCreate);\r\n    for (const k in fishNetConfig) {\r\n      const v = fishNetConfig[k];\r\n      this.objectPool.newSomeObject(ObjectClassType.type_fish_net, v.id, 5)//预分配鱼网对象\r\n    }\r\n    // --注册金币\r\n    this.objectPool.registerObjectCreater(ObjectClassType.type_fish_gold, FishGoldCreate);\r\n    for (const k in fishGoldConfig) {\r\n      const v = fishGoldConfig[k];\r\n      this.objectPool.newSomeObject(ObjectClassType.type_fish_gold, v.id, 20)//预分配金币对象\r\n    }\r\n    // --注册鱼数字对象\r\n    this.objectPool.registerObjectCreater(ObjectClassType.type_fish_fnt, FishLabelFntCreate);\r\n    for (const k in fishLabelFntConfig) {\r\n      const v = fishLabelFntConfig[k];\r\n      this.objectPool.newSomeObject(ObjectClassType.type_fish_fnt, v.id, 20)//预分配字体对象\r\n    }\r\n  }\r\n\r\n  private initFish() {\r\n    this.fishManager.init(this.getFishPondNode(), this.getRootNode(), this.sourceManage, fishConfig, fishBondingBoxConfig, fishCurveConfig, fishSkillConfig,\r\n      fishTexturesConfig, fishActionConfig, fishCommondConfig, this.batteryManager, this.fishGoldManager,\r\n      this.fishLabelFntManager, this.skillPlayer, this.musicEffectPlayer, this.backgroundSceneManager, this.getScaleRatio());\r\n  }\r\n\r\n  private initBullet() {\r\n    this.bulletManager.init(fishCommondConfig.bonding_size, fishBullteConfig, this.objectPool, this.sourceManage, this.batteryManager, this.getScaleRatio())\r\n  }\r\n\r\n  private initObjectEffectWorld() {\r\n    this.objectEffectWorld.registerCallback(this.onShotCallback.bind(this));\r\n  }\r\n\r\n  private initFishGold() {\r\n    this.fishGoldManager.init(fishGoldConfig, fishTexturesConfig, fishActionConfig, fishCommondConfig, this.objectPool, this.musicEffectPlayer, this.getRootNode());\r\n  }\r\n\r\n  private initSkillPlayer() {\r\n    this.skillPlayer.init(fishSkillConfig, fishCommondConfig, fishTexturesConfig, this.skillRegisterFunc.funs, this.getScaleRatio())\r\n  }\r\n\r\n  private initSkillRegisterFunc() {\r\n    this.skillRegisterFunc.init(this.getRootNode());\r\n  }\r\n\r\n  private initBackgroundSceneManager() {\r\n    this.backgroundSceneManager.init(this.getBackgroundNode(), fishBackgroundConfig, fishTexturesConfig, fishBgmConfig, fishCommondConfig.scene_size,\r\n      this.sourceManage, this.fishManager, this.musicEffectPlayer, this.getScaleRatio());\r\n\r\n    this.backgroundSceneManager.createSeawaveObj();\r\n  }\r\n\r\n  private initFishLabelFntManager() {\r\n    this.fishLabelFntManager.init(this.getRootNode());\r\n  }\r\n\r\n  //鱼碰撞回调\r\n  private onShotCallback(shotLst) {\r\n    for (const k in shotLst) {\r\n      const v = shotLst[k] as ShotInfo;\r\n      if (v == null) continue;\r\n      if (this.bsend_shot_to_server === true) {\r\n        if (v.bulletObj.isMyBullet()) {//自身子弹\r\n          let msg = {\r\n            playerId: v.bulletObj.getBulletPlayerId(),\r\n            bulletId: v.bulletObj.getBulletServeId(),\r\n            fishId: v.fishObj.getObjectId(),\r\n            fishConfigId: v.fishObj.getFishConfigId(),\r\n          }\r\n          this.send_yrby_ReqHit(msg)\r\n          const battery = this.batteryManager.getBatteryByPlayerId(msg.playerId)\r\n          battery.minusBulletNum()\r\n        }\r\n      }\r\n\r\n      //代发子弹\r\n      for (const m in this.insteadSendBulletPlayers) {\r\n        const n = this.insteadSendBulletPlayers[m];\r\n        if (n == null) continue;\r\n        if (v.bulletObj.getBulletPlayerId() === n) {\r\n          let msg = {\r\n            playerId: v.bulletObj.getBulletPlayerId(),\r\n            bulletId: v.bulletObj.getBulletServeId(),\r\n            fishId: v.fishObj.getObjectId(),\r\n            fishConfigId: v.fishObj.getFishConfigId(),\r\n          }\r\n          this.send_yrby_ReqHit(msg)\r\n          break\r\n        }\r\n      }\r\n\r\n      this.bulletManager.removeBulletObject(k)\r\n    }\r\n  }\r\n\r\n  public setSendYrbyReqHit(send_yrby_ReqHit) {\r\n    this.send_yrby_ReqHit = send_yrby_ReqHit;\r\n  }\r\n\r\n  private initUI() {\r\n    this.send_yrby_ReqHit = (msg) => {\r\n      !config.isTest && sktInstance.sendSktMessage(SKT_MAG_TYPE.HIT_FISH, msg);\r\n    }\r\n  }\r\n\r\n  public fishDeath(player_id, fshid, score) {\r\n    let bat_obj = this.batteryManager.getBatteryByPlayerId(player_id) as Battery\r\n    let fsh_obj = this.fishManager.getFishObjById(fshid) as Fish\r\n\r\n    if (bat_obj && fsh_obj) {\r\n      fsh_obj.setScoreVal(score)\r\n      fsh_obj.setGoldMoveEndPos(bat_obj.getBatteryPos())\r\n      fsh_obj.setUserInfo(bat_obj.getUserInfo())\r\n      // let pos = fsh_obj.getCurrentPos()\r\n      // bat_obj.setHitScore(score)\r\n    }\r\n    this.fishManager.removeFish(fshid)\r\n  }\r\n\r\n  public fishLstDeath(player_id, lst) {\r\n    if (lst.length <= 0) { return }\r\n    let score = 0\r\n\r\n    let fsh_id = -1\r\n    for (let i = 0; i < lst.length; i++) {\r\n      if (i === 0) {\r\n        fsh_id = lst[i].fishId\r\n      }\r\n\r\n      if (i > 0) {\r\n        let fsh_obj = this.fishManager.getFishObjById(lst[i].fishId) as Fish\r\n        let first_obj = this.fishManager.getFishObjById(fsh_id) as Fish\r\n        if (first_obj && fsh_obj) {\r\n          first_obj.addLineRelObj(fsh_obj)\r\n        }\r\n        this.fishDeath(player_id, lst[i].fishId, lst[i].score)\r\n      }\r\n      score = score + lst[i].score\r\n    }\r\n\r\n    this.fishDeath(player_id, lst[0].fishId, lst[0].score)\r\n\r\n    // if( BuyuManager.getRoomType() != GAME_TYPE_FRIENDROOM ){\r\n    let bat_obj = this.batteryManager.getBatteryByPlayerId(player_id) as Battery;\r\n    bat_obj.setHitScore(score)\r\n    // }\r\n\r\n    // print(\"get hit score ===== \"  +  score)\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    this.fishManager.uninit();\r\n    this.backgroundSceneManager.uninit();\r\n    this.objectPool.uninit();\r\n    this.objectEffectWorld.uninit();\r\n    this.bulletManager.uninit();\r\n    this.batteryManager.uninit();\r\n    this.fishGoldManager.uninit();\r\n    this.fishLabelFntManager.uninit();\r\n    this.fishNetManager.uninit();\r\n    this.skillPlayer.uninit();\r\n    this.musicEffectPlayer.uninit();\r\n    this.skillRegisterFunc.uninit();\r\n\r\n    this.roomChooseViewModel.unMount();\r\n    this.unListenerSocket();\r\n    this.dispatch(quitGame(0));\r\n  }\r\n\r\n  public initRoomChooseNode() {\r\n    if (this.roomChooseViewModel) return;\r\n    this.roomChooseViewModel = new RoomChooseViewModel().mountView(this.sourceManage.getFile(PrefabPathDefine.ROOM_CHOOSE).source)\r\n      .appendTo(this.comp.getRoomListNode()).connect();\r\n    this.roomChooseViewModel.comp.setEvent({\r\n      exitGame: () => {\r\n        this.onExitGame();\r\n      }\r\n    })\r\n  }\r\n\r\n  private initRoomModel() {\r\n    if (this.roomViewModel) {\r\n      // this.roomViewModel.viewNode.setScale(this.getScaleRatio(), this.getScaleRatio())\r\n      return\r\n    }\r\n    this.roomViewModel = new RoomViewModel(this.fishManager, this.bulletManager, this.batteryManager, this.backgroundSceneManager, this.skillPlayer, this.fishLabelFntManager)\r\n      .mountView(this.sourceManage.getFile(PrefabPathDefine.GAME_ROOM).source)\r\n      .appendTo(this.comp.getGameMainSenceNode()).connect();\r\n    // this.roomViewModel.viewNode.getComponent(UITransform).width = fishCommondConfig.scene_size.width;\r\n    // this.roomViewModel.viewNode.getComponent(UITransform).height = fishCommondConfig.scene_size.height;\r\n    // this.roomViewModel.viewNode.setScale(this.getScaleRatio(), this.getScaleRatio())\r\n    // this.roomViewModel.comp.setScale(this.getScaleRatio());\r\n    this.roomViewModel.viewNode.active = false;\r\n  }\r\n\r\n  private onExitGame() {\r\n    global.closeSubGame();\r\n  }\r\n\r\n  private getRootNode() {\r\n    return this.viewNode;\r\n  }\r\n\r\n  /**获得炮台层 */\r\n  private getBatteryNode() {\r\n    return this.roomViewModel.comp.getBatteryNode();\r\n  }\r\n\r\n  /**获得鱼池层 */\r\n  private getFishPondNode() {\r\n    return this.roomViewModel.comp.getFishPondNode();\r\n  }\r\n\r\n  /**获得背景层 */\r\n  public getBackgroundNode() {\r\n    return this.roomViewModel.comp.getBackgroundNode();\r\n  }\r\n\r\n  public enterRoom() {\r\n  }\r\n\r\n  private listenerSocket() {\r\n    sktMsgListener.add(SKT_MAG_TYPE.JOIN_ROOM, config.name, (data: EnterRoomVo, error: string) => {\r\n      // data.members.forEach(v=>{\r\n      //   this.roomViewModel.enterRoom('1', v)\r\n      // })\r\n      // this.backgroundSceneManager.cutBackgroundScene(0);\r\n      this.roomViewModel.enterRoom(data)\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.ERROR_MSG, config.name, (data: ErrorMsgVo, error: string) => {\r\n      if (data.msgId === 32) {\r\n        global.hallDispatch(addToastAction({ content: '余额低于下限', type: ToastType.NORMAL }))\r\n      } else if (data.msgId === 33) {\r\n        global.hallDispatch(addToastAction({ content: '余额超过上限', type: ToastType.NORMAL }))\r\n      } else if (data.msgId === 100002) {\r\n        global.hallDispatch(addToastAction({ content: '超过最大人数', type: ToastType.NORMAL }))\r\n      }\r\n    })\r\n  }\r\n\r\n  private unListenerSocket() {\r\n    sktMsgListener.remove(SKT_MAG_TYPE.JOIN_ROOM, config.name)\r\n    sktMsgListener.remove(SKT_MAG_TYPE.ERROR_MSG, config.name)\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      return {\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default MainViewModel"]}