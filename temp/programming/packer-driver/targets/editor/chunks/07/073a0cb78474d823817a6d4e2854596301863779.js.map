{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/bandar/components/Bandar_betArea.ts"],"names":["removeComma","str","newStr","replace","_decorator","instantiate","Label","Node","tween","UITransform","Vec3","bezier","game","Game","BaseComponent","formatNumber","getNodeByNameDeep","getNodePositionInCanvas","BetType","gameCacheData","GameStatus","global","lang","ToastPosition","addToastAction","ChipViewModel","mainGameViewModel","playChip","playGetCoin","sourceManageSelector","PrefabPathDefine","config","initBetData","SKT_MAG_TYPE","sktInstance","TaskScheduler","Task","changeGoldDataAction","footerViewModel","onlineViewModel","usersViewModel","ccclass","property","Bandar_betArea","betLoading","betAreaInfo","Map","isLockBet","isShowGame","isFlyStar","areaInfo","lastArr","amountArr","taskScheduler","sendBet","betId","propertyNode","props_btn_black","props_btn_red","props_btn_plum","props_btn_diamond","props","gameStatus","gold","selectChip","myInfo","newBetData","winArea","goldData","cardRate","allWinUsers","lastBet","tips","memberBet","cancelBetData","events","start","initState","bindEvent","on","EVENT_HIDE","EVENT_SHOW","EventType","TOUCH_END","myBet","BLACK","RED","PLUM","DIAMOND","useProps","key","value","cur","memberId","flyChip","cancelBet","undefined","Object","keys","length","areaNode","getNodeByBetType","getNodeToBetType","Number","getComponent","string","active","joinqQueue","done","window","setTimeout","isUnMount","forEach","item","flyWinAreaToUser","index","comp","copyWinAnimation","playAddGold","playWinAni","palyAddUp","clear","clearBetWinAreaAni","STOP_BET","playWinAnimation","flyToHeGuan","flyChipToWinArea","WAIT","clearAllBetAreaGold","BET","isBetStatus","betType","bet_remind","getPropertyNode","props_spr_bet_remind","betData","isMyBet","roomId","memberName","betAmount","isMe","sendSktMessage","BET_ALL","isFly","chipTypes","find","v","betArea","getChildByName","viewModel","createChip","radom","Math","random","chipNode","node","endPosition","randomBetEndPosition","addBetInfo","updateAllBet","uiTransform","startPosition","getBetStartPosition","setWorldPosition","convertToWorldSpaceAR","to","position","angle","easing","gameOption","winRateMaxIndex","betTypeIndex","indexOf","splice","flyStar","dispatch","clearBetAreaGold","hideAllWinRate","removeAllChildren","updateBetAreaGold","totalBetAmount","meTotalBetAmount","winAreaNode","playWinArea","type","parent","chipValue","mountView","getFile","MAIN_CHIP","source","appendTo","connect","setProps","myHeadPosition","x","y","seatNumber","onlineNumberPosition","headLocations","getFlyToHeadEndPosition","betInfo","width","height","chips","k","concat","FlyLossAreaToHe","chip","endPositon","dealerPosition","worldPosition","scale","call","unMount","flyWinChip","getMyHeadPosition","chipFlyToHead","betInfos","get","winBetData","odds","copyBetInfo","bb","userId","arr","Array","fill","push","filter","map","set","showWinRate","isValid","getStar","parentNode","starIcon","props_spr_icon","starNode","addChild","setPosition","playWinRateTween","scheduleOnce","destroy","tweenNode","endPos","playTime","callBack","startPos","startAngle","eulerAngles","fruitTween","mixY","maxY","mixX","maxX","progressX","end","current","t","progressY","parallel","progress","onUpdate","z","destroyCallBack","destoryQueue","stopQueue","i","formatAmountWithCommas","formatAmountWithLetter","hallDispatch","MIDDLE","content","write","InitGameModule","BetFaild","placeStr","format","bindUI"],"mappings":"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","sourcesContent":["import { _decorator,instantiate,Label,Node, tween, UITransform, Vec3, bezier, Quat, Skeleton, sp, game, Game, Component, } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { formatNumber, getNodeByNameDeep, getNodePositionInCanvas, initToggle } from '../../../utils/tool';\r\nimport { BetData, BetType, gameCacheData, GameStatus, HeadType, SendBet, TipsVo } from '../type';\r\nimport { global, lang } from '../../../hall';\r\nimport { ToastPosition, addToastAction } from '../../../hall/store/actions/baseBoard';\r\nimport ChipViewModel from '../viewModel/BandarChipViewModel';\r\nimport OnlineViewModel from '../viewModel/BandarOnlineViewModel';\r\nimport { mainGameViewModel, playChip, playGetCoin, sourceManageSelector, stopBet } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config, { initBetData } from '../config';\r\nimport { SKT_MAG_TYPE, sktInstance } from '../socketConnect';\r\nimport TaskScheduler, { Task } from '../../../utils/TaskScheduler';\r\nimport { WinUser, changeGoldDataAction, setLastBetAction, setNewBetDataAction } from '../store/actions/bet';\r\nimport { footerViewModel, onlineViewModel, usersViewModel } from '../viewModel/BandarGameBoardViewModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\ntype BetInfo = {\r\n\tindex: number,\r\n\tuserId: string,\r\n\tisMe: boolean,\r\n\tchips: ChipViewModel[]\r\n}\r\nexport function removeComma(str){\r\n\tconst newStr = str.replace(/,/g,\"\")\r\n\treturn newStr\r\n}\r\n\r\nexport interface IState {\r\n}\r\n\r\nexport interface IProps {\r\n\tgameStatus:GameStatus,\r\n\tgold:number,\r\n\t/**选择的筹码 */\r\n\tselectChip: number,\r\n\tmyInfo: HeadType,\r\n\tnewBetData:BetData,\r\n\twinArea: number[],\r\n\tgoldData:object,\r\n\tcardRate:number[],\r\n\tallWinUsers:WinUser[],\r\n\tlastBet: SendBet[],\r\n\ttips: TipsVo[],\r\n\tmemberBet: object,\r\n\tcancelBetData:BetData\r\n}\r\n\r\nexport interface IEvent {}\r\n\r\n\r\n@ccclass('Bandar_betArea')\r\nexport class Bandar_betArea extends BaseComponent<IState, IProps, IEvent> {\r\n\tprivate betLoading = false;\r\n\tpublic betAreaInfo: Map<BetType, BetInfo[]> = new Map();\r\n\t// 是否锁定下注\r\n\tprivate isLockBet: boolean = false;\r\n\tprivate isShowGame: boolean = true;\r\n\tprivate isFlyStar: boolean = false;\r\n\tprivate areaInfo :BetType[] = [1,2,3,4];\r\n\tpublic lastArr:SendBet[] = [];\r\n\tpublic amountArr:SendBet[] = [];\r\n\tprivate taskScheduler = new TaskScheduler();\r\n\tpublic sendBet: SendBet = null;\r\n\tprivate betId: number = 0;\r\n\tstart() {}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_black:new Node(),\r\n\t\tprops_btn_red:new Node(),\r\n\t\tprops_btn_plum:new Node(),\r\n\t\tprops_btn_diamond:new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameStatus:null,\r\n\t\tgold:0,\r\n\t\tselectChip:1000,\r\n\t\tmyInfo:null,\r\n\t\tnewBetData:null,\r\n\t\twinArea:null,\r\n\t\tgoldData:null,\r\n\t\tcardRate:null,\r\n\t\tallWinUsers:null,\r\n\t\tlastBet: [],\r\n\t\ttips: null,\r\n\t\tmemberBet: null,\r\n\t\tcancelBetData:null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\t\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tgame.on(Game.EVENT_HIDE,()=>{//游戏切入后台\r\n\t\t\tthis.isShowGame = false\r\n\t\t})\r\n\t\tgame.on(Game.EVENT_SHOW,()=>{//游戏进入\r\n\t\t\tthis.isShowGame = true;\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_black.on(Node.EventType.TOUCH_END,()=>{this.myBet(BetType.BLACK)});\r\n\t\tthis.propertyNode.props_btn_red.on(Node.EventType.TOUCH_END,()=>{this.myBet(BetType.RED)});\r\n\t\tthis.propertyNode.props_btn_plum.on(Node.EventType.TOUCH_END,()=>{this.myBet(BetType.PLUM)});\r\n\t\tthis.propertyNode.props_btn_diamond.on(Node.EventType.TOUCH_END,()=>{this.myBet(BetType.DIAMOND)});\r\n      \r\n\t}\r\n\t\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n      if(key === \"selectChip\"){}\r\n\t  if (key === \"newBetData\" && value.cur) {\r\n\t\t  if (!value.cur) { return }\r\n\t\t  if (value.cur.memberId === gameCacheData.memberId) {\r\n\t\t\t// this.amountArr.push(this.sendBet);\t\r\n\t\t\treturn\r\n\t\t  };\r\n\t\t  this.flyChip(value.cur)\r\n\t\t}\r\n\t\tif (key === 'cancelBetData') {\r\n\t\t\tthis.cancelBet(value.cur);\r\n\t\t}\r\n\t\tif (key === \"goldData\") {\r\n\t\t\tif (!value.cur || value.cur === undefined) { return };\r\n\t\t\tif(value.cur && Object.keys(value.cur).length != 0){   \r\n\t\t\t\tfor(let key in value.cur){\r\n\t\t\t\t  let areaNode = this.getNodeByBetType(this.getNodeToBetType(Number(key)))\r\n\t\t\t\t\tif(value.cur[key] === 0){\r\n\t\t\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\", areaNode).getComponent(Label).string = \"\"\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\", areaNode).getComponent(Label).string = formatNumber(value.cur[key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t  }   \r\n\t    }\r\n\t\tif (key === \"memberBet\") {\r\n\t\t\tif (!value.cur || value.cur === undefined) { return };\r\n\t\t\tif (Object.keys(value.cur).length != 0) { \r\n\t\t\t  for(let key in value.cur){\r\n\t\t\t\tlet areaNode = this.getNodeByBetType(this.getNodeToBetType(Number(key)))\r\n\t\t\t\t\tif(value.cur[key] === 0){\r\n\t\t\t\t\t\tgetNodeByNameDeep(\"Label_bet_mine\", areaNode).getComponent(Label).string = \"\"\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgetNodeByNameDeep(\"spr_bet_bg\", areaNode).active = true;\r\n\t\t\t\t\t\tgetNodeByNameDeep(\"Label_bet_mine\", areaNode).getComponent(Label).string = formatNumber(value.cur[key]);\r\n\t\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t}\r\n\t    }\t\r\n\t  if(key === \"allWinUsers\"){\r\n\t\t  // console.log(\"allWinUsers\",value.cur);\r\n\t\tif(!value.cur){ return }\r\n\t\tthis.taskScheduler.joinqQueue(new Task((done)=>{\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\t\tif(value.cur){\r\n\t\t\t\t\tvalue.cur.forEach(item=>{\t\t \r\n\t\t\t\t\t\tthis.flyWinAreaToUser(item)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}, 100)\r\n\t\t\t\r\n\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t}),false).joinqQueue(new Task((done)=>{\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\t\tif(!value.cur){\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tvalue.cur.forEach(item=>{\r\n\t\t\t\t\tif(item.memberId !== gameCacheData.memberId){\r\n\t\t\t\t\t\tif(item.index < 6 && item.index >= 0){\r\n\t\t\t\t\t\t\tusersViewModel.comp.copyWinAnimation(item.index);\r\n\t\t\t\t\t\t\tusersViewModel.comp.playAddGold(item ,item.gold)\r\n\t\t\t\t\t\t}else if(item.index > 6 ){\t\t\t\t\t\r\n\t\t\t\t\t\t\tonlineViewModel.comp.playWinAni()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tfooterViewModel.comp.palyAddUp(item)\r\n\t\t\t\t\t}\r\n\t\t\t\t  \r\n\t\t\t\t})\r\n\t\t\t},100)\r\n\t\t\r\n\t\t\twindow.setTimeout(()=>done(),1000)\r\n\t\t}),false).joinqQueue(new Task((done)=>{\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\t\t// 清理下注区域数据\r\n\t\t\t\tthis.betAreaInfo.clear();\r\n\t\t\t\tthis.clearBetWinAreaAni([1,2,3,4])\r\n\t\t\t}, 3000)\r\n\t\t\t\t\t\r\n\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t}))\r\n\t\t\r\n\t  }\r\n\t  if (key === \"winArea\") {}\r\n\t  if(key === \"lastBet\"){}\r\n\t  if (key === \"gameStatus\") {\r\n\t\t    // console.log(\"gameStatus\",value.cur);\r\n\t\t\t\r\n\t\t\tif (value.cur === GameStatus.STOP_BET) {\r\n\t\t\t\tif (mainGameViewModel.isUnMount) { return }\r\n\t\t\t\tthis.lastArr=[...this.amountArr];\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\tif (mainGameViewModel.isUnMount) { return }\r\n\t\t\t\t\t\tif (value.cur === GameStatus.STOP_BET && this.props) {\r\n                            // console.log(\"this.props.winArea\",this.props.winArea);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.playWinAnimation(this.props.winArea);\r\n\t\t\t\t\t\t\tthis.flyToHeGuan();\r\n\t\t\t\t\t\t}\t\r\n\t\t\t\t\t},4000)\r\n\t\t\t\t\t\r\n\t\t\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t\t\t}),false).joinqQueue(new Task((done) => {\r\n\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\t\t\t\tthis.flyChipToWinArea();\r\n\t\t\t\t\t},4000)\r\n\r\n\t\t\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t\t\t}),false)\r\n\t\t\t\r\n\t\t\t}else if(value.cur === GameStatus.WAIT){\r\n\t\t\t\tthis.betAreaInfo.clear();\r\n\t\t\t\tthis.clearAllBetAreaGold();\r\n\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\",this.propertyNode.props_btn_black).getComponent(Label).string = \"\"; \r\n\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\",this.propertyNode.props_btn_red).getComponent(Label).string = \"\"; \r\n\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\",this.propertyNode.props_btn_plum).getComponent(Label).string = \"\"; \r\n\t\t\t\tgetNodeByNameDeep(\"Label_bet_all\",this.propertyNode.props_btn_diamond).getComponent(Label).string = \"\"; \r\n\t\t\t} else if (value.cur === GameStatus.BET) {\r\n\t\t\t\tthis.betLoading = false;\r\n\t\t\t\tthis.areaInfo=[1,2,3,4]\r\n\t\t\t\tthis.clearBetWinAreaAni(this.areaInfo)\r\n\t\t\t}\r\n\t\t\r\n\t  }\r\n\t}\r\n\r\n\tprivate isBetStatus(): boolean {\r\n\t\treturn this.props.gameStatus === GameStatus.BET;\r\n\t}\r\n\t\r\n\t/**\r\n\t * 自己下注\r\n\t * @param betType \r\n\t * @returns \r\n\t */\r\n\tprivate myBet(betType: BetType): void {\r\n\t\tif (!this.isBetStatus()) {//下注阶段才能下注\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 等待下注返回后才能进行下一次下注\r\n\t\tif (this.betLoading) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.props.tips && this.props.tips.length > 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.isLockBet = this.props.gold < 5000) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.props.gold < this.props.selectChip*6) {\r\n\t\t\t// 提示用户余额不足\r\n\t\t\tlet bet_remind = footerViewModel.comp.getPropertyNode().props_spr_bet_remind as Node \r\n\t\t\tbet_remind.active = true;\r\n\t\t\twindow.setTimeout(()=>{\r\n\t\t\t\tbet_remind.active = false\r\n\t\t\t},2000)\r\n\t\t\t// global.hallDispatch(addToastAction({ content: \"余额不足，您只能下注账户余额的1/6!\" }));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n        // this.betId++\r\n\t\tconst betData = initBetData(this.props.myInfo.index, this.props.myInfo.memberId, betType, this.props.selectChip);\r\n\t\tbetData.isMyBet = true;//当前用户是否下注\r\n\t\tthis.betLoading = true;\r\n\t\tthis.sendBet = {\r\n\t\t\troomId: gameCacheData.roomId,\r\n            memberId: this.props.myInfo.memberId,\r\n            memberName: this.props.myInfo.memberName,\r\n            gold: betData.betAmount,\r\n            betType: betData.betType,\r\n\t\t\tisMe: betData.isMyBet,\r\n\t\t\tbetId:betData.betId\r\n\t\t}\r\n\t   // 下注信息发送给服务器\r\n\t   sktInstance.sendSktMessage(SKT_MAG_TYPE.BET_ALL, this.sendBet);\r\n\t   this.flyChip(betData);\r\n\r\n\t//    this.amountArr.push(this.sendBet);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * 飞筹码\r\n\t * @param betData \r\n\t * @param isFly 是否飞筹码的动画，false用于刚进入初始化筹码\r\n\t */\r\n\tpublic flyChip(betData: BetData, isFly: boolean = true): void {\r\n\t\tif (betData.isMyBet) {\r\n\t\t\tthis.betLoading = false;\r\n\t\t}\r\n\t\t// 下注筹码不存在，不处理\r\n\t\tif (!config.chipTypes.find(v => v.value === betData.betAmount)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tisFly = betData.isFly;\r\n\t\tisFly = this.isShowGame;\r\n\t\tconst betArea = this.getNodeByBetType(betData.betType).getChildByName(\"Layout_bet_chips\");\r\n\t\tconst viewModel = this.createChip(betData.betAmount, betArea);\r\n\t\tlet radom = Math.random()*90-90;//旋转角度\r\n\t\tconst chipNode = viewModel.comp.node;\r\n\t\tconst endPosition = this.randomBetEndPosition(betArea);\r\n\t\tthis.addBetInfo(betData,viewModel);\r\n\t\tthis.updateAllBet();\r\n\t\tif (isFly) {\r\n\t\t\tplayChip()\r\n\t\t\tconst uiTransform = this.node.getComponent(UITransform);\r\n\t\t\tconst startPosition = this.getBetStartPosition(betData);\r\n\t\t\tchipNode.setWorldPosition(uiTransform.convertToWorldSpaceAR(startPosition));\r\n\t\t\ttween(chipNode).to(0.3, { position: endPosition , angle:-radom,},{easing: 'quintOut'}).start();\r\n\t\t\t// if (!isWinRateBet && betData.index === config.gameOption.winRateMaxIndex) {\r\n\t\t\tif (betData.index === config.gameOption.winRateMaxIndex) {\r\n\t\t\t\t//判定是否是未展示星星的区域数组 若未展示，返回区域下标 否（即已展示） 返回-1\r\n\t\t\t\tlet betTypeIndex = this.areaInfo.indexOf(betData.betType);\r\n\r\n\t\t\t\tif(betTypeIndex >= 0){\r\n\t\t\t\t\tthis.areaInfo.splice(betTypeIndex,1);//移除展示了的区域\r\n\t\t\t\t\t// 飞星星\r\n                    this.flyStar(this.getNodeByBetType(betData.betType), betData.betType);\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// this.updateBetAreaGold(betData, betArea.parent);\r\n\t}\r\n\r\n\t/**下注总筹码 */\r\n\tprivate updateAllBet(){\r\n\t\t// for(let key in gameCacheData.goldData){\r\n\t\t// \tlet areaNode = this.getNodeByBetType(this.getNodeToBetType(Number(key)))\r\n\t\t// \tif(gameCacheData.goldData[key] === 0){\r\n\t\t// \t\tgetNodeByNameDeep(\"Label_bet_all\", areaNode).getComponent(Label).string = \"\"\r\n\t\t// \t}else{\r\n\t\t// \t\tgetNodeByNameDeep(\"Label_bet_all\", areaNode).getComponent(Label).string = formatNumber(gameCacheData.goldData[key]);\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n\r\n    /**清除所有下注区域的金币 */\r\n\tpublic clearAllBetAreaGold() {\r\n\t\tthis.dispatch(changeGoldDataAction({\"1\":0,\"2\":0,\"3\":0,\"4\":0}));\r\n\t\tthis.clearBetAreaGold(this.propertyNode.props_btn_black);\r\n\t\tthis.clearBetAreaGold(this.propertyNode.props_btn_red);\r\n\t\tthis.clearBetAreaGold(this.propertyNode.props_btn_plum);\r\n\t\tthis.clearBetAreaGold(this.propertyNode.props_btn_diamond);\r\n\t\tthis.hideAllWinRate();\r\n\t\tthis.areaInfo = [1, 2, 3, 4];\r\n\t\tthis.clearBetWinAreaAni(this.areaInfo);\r\n\t\t// this.lastArr = [...this.amountArr];//\r\n\t\tthis.amountArr = [];\r\n\t\t// this.betId = 0;\r\n\t}\r\n\r\n\tprivate clearBetAreaGold(betArea: Node) {\r\n\t\tbetArea.getChildByName(\"Layout_bet_chips\").removeAllChildren();\r\n\t\t\r\n\t\tthis.updateBetAreaGold({\r\n\t\t\tindex: 0, memberId: \"\", betAmount: 0, betType: null, betId: '', totalBetAmount: 0, meTotalBetAmount: 0\r\n\t\t}, betArea);\r\n\t}\r\n\r\n\r\n\t/**清除赢的区域动画 */\r\n\tprivate clearBetWinAreaAni(winArea){\r\n\t\t winArea.forEach(item=>{\r\n\t\t\tlet winAreaNode = this.getNodeByBetType(item);\r\n\t\t\tgetNodeByNameDeep(\"animation_win1\",winAreaNode).active = false;\r\n\t\t\tgetNodeByNameDeep(\"animation_win2\",winAreaNode).active = false;\r\n\t\t })\r\n\t}\r\n\t\r\n\t/** 播放赢的区域动画效果 */\r\n\tprivate playWinAnimation(winArea) {\r\n\r\n\t\tif (!winArea|| winArea.length === 0  ) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\twinArea.forEach((item,index)=>{\r\n             let winAreaNode = this.getNodeByBetType(item);\r\n\t\t\t getNodeByNameDeep(\"animation_win1\",winAreaNode).active = true;\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\t\tgetNodeByNameDeep(\"animation_win2\",winAreaNode).active = true;\r\n\t\t\t },500)\t\t\t \r\n\t\t })\r\n\t}\r\n\r\n\t/** 播放赢的区域动画效果 */\r\n\tpublic playWinArea(type) {\r\n\r\n\t\tlet winAreaNode = this.getNodeByBetType(type);\r\n\t\tgetNodeByNameDeep(\"animation_win1\",winAreaNode).active = true;\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tif(mainGameViewModel.isUnMount){ return }\r\n\t\t\tgetNodeByNameDeep(\"animation_win2\",winAreaNode).active = true;\r\n\t\t},500)\t\t\t \r\n\t\t\r\n\t}\r\n\r\n\t/** 下注总值 用户下注值 */\r\n\tprivate updateBetAreaGold(betData: BetData, betArea: Node): void {\r\n\t\tif (betData.totalBetAmount === 0) {\t\t\t\r\n\t\t\tgetNodeByNameDeep(\"Label_bet_all\", betArea).getComponent(Label).string = \"\"; \r\n\t\t\tgetNodeByNameDeep(\"Label_bet_mine\", betArea).getComponent(Label).string = \"\";\r\n\t\t\tgetNodeByNameDeep(\"Label_bet_mine\", betArea).parent.active = betData.meTotalBetAmount > 0;\r\n\t\t} else {\r\n\t\t\t// getNodeByNameDeep(\"Label_bet_all\", betArea).getComponent(Label).string = formatNumber(this.props.goldData);\r\n\t\t}\r\n\r\n\t\t// if (betData.memberId === gameCacheData.memberId) {\r\n\t\t// \tgetNodeByNameDeep(\"spr_bet_bg\", betArea).active = true;\r\n\t\t// \tlet mineAmount = getNodeByNameDeep(\"Label_bet_mine\", betArea).getComponent(Label).string;\r\n\t\t// \tlet totalMine = Number(removeComma(mineAmount) )+betData.betAmount;\r\n\t\t// \tgetNodeByNameDeep(\"Label_bet_mine\", betArea).getComponent(Label).string = formatNumber(totalMine);\r\n\t\t// \tgetNodeByNameDeep(\"Label_bet_mine\", betArea).parent.active = totalMine > 0;\r\n\t\t// }\r\n\r\n\t}\r\n\r\n    /** 创造对应选取的金币  */\r\n\tprivate createChip(chipValue: number, parent: Node): ChipViewModel {\r\n\t\treturn new ChipViewModel().mountView(sourceManageSelector().getFile(PrefabPathDefine.MAIN_CHIP).source).appendTo(parent).connect().setProps({ value: chipValue });\r\n\t}\r\n\r\n\t/** 获得下注筹码飞的开始坐标 */\r\n\tprivate getBetStartPosition(betData: BetData): Vec3 {\r\n\t\tif (betData.isMyBet) {\r\n\t\t\treturn new Vec3(config.gameOption.myHeadPosition.x, config.gameOption.myHeadPosition.y);\r\n\t\t}\r\n\r\n\t\tif (betData.index >= config.gameOption.seatNumber) {\r\n\t\t\treturn new Vec3(config.gameOption.onlineNumberPosition.x, config.gameOption.onlineNumberPosition.y);\r\n\t\t}\r\n\r\n\t\treturn new Vec3(config.headLocations[betData.index].x, config.headLocations[betData.index].y);\r\n\t}\r\n\t\r\n\t/**筹码飞向头像的结束坐标 */\r\n\tprivate getFlyToHeadEndPosition(betInfo: BetInfo) {\r\n\t\tif (betInfo.isMe) {\r\n\t\t\t// 播放获得金币的音效\r\n\t\t\tplayGetCoin();\r\n\t\t\treturn new Vec3(config.gameOption.myHeadPosition.x, config.gameOption.myHeadPosition.y);\r\n\t\t}\r\n\r\n\t\tif (betInfo.index >= config.gameOption.seatNumber) {\r\n\t\t\treturn new Vec3(config.gameOption.onlineNumberPosition.x, config.gameOption.onlineNumberPosition.y);\r\n\t\t}\r\n\r\n\t\treturn new Vec3(config.headLocations[betInfo.index].x, config.headLocations[betInfo.index].y);\r\n\t}\r\n\t/** 获得下注筹码飞的结束坐标 */\r\n\tprivate randomBetEndPosition(betArea: Node): Vec3 {\r\n\t\tconst uiTransform: UITransform = betArea.getComponent(UITransform);\r\n\t\tconst width = uiTransform.width * 0.8;\r\n\t\tconst height = uiTransform.height * 0.6;\r\n\t\tlet x = width / 2 - Math.random() * width;\r\n\t\tlet y = height / 2 - Math.random() * height;\r\n\r\n\t\treturn new Vec3(x, y);\r\n\t}\r\n\r\n\t/** 金币飞向荷官 */\r\n\tprivate flyToHeGuan(){//this.betAreaInfo 的chip存储了金币节点，可遍历它进行位置移动\r\n\t\t// playGetCoin()\r\n\t\tlet chips: ChipViewModel[] = [];\r\n\t\tthis.betAreaInfo.forEach((v, k) => {\r\n\t\t\tif(!this.props.winArea){//没有中奖区域\r\n\t\t\t\tv.forEach(betInfo => {\r\n\t\t\t\t\tchips = chips.concat(betInfo.chips);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// 找出未中奖的区域\r\n\t\t\tif(this.props.winArea){\r\n\t\t\t\t// playGetCoin()\r\n\t\t\t\tif (!this.props.winArea.find(betType => betType === k)) {\r\n\t\t\t\t\tv.forEach(betInfo => {\r\n\t\t\t\t\t\tchips = chips.concat(betInfo.chips);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t})\r\n\t\t\r\n\t\t//未中奖区域\r\n\t\tthis.FlyLossAreaToHe(chips)\r\n\t}\r\n\r\n    \r\n\t/** 未中奖区域飞金币到荷官位置 */\r\n\tprivate FlyLossAreaToHe(chips: ChipViewModel[]) {\r\n\t\tif (chips.length != 0) {\r\n\t\t\tplayGetCoin()\r\n\t\t}\r\n\t\tchips.forEach(chip => {\r\n\t\t\tconst chipNode = chip.comp.node;\r\n\t\t\tconst endPositon = new Vec3 (config.gameOption.dealerPosition.x,config.gameOption.dealerPosition.y);\r\n\t\t\tconst uiTransform = this.node.getComponent(UITransform);\r\n\r\n\t\t\ttween(chipNode).to(0.8, { worldPosition: uiTransform.convertToWorldSpaceAR(endPositon),scale:new Vec3(0.1,0.1) }, {easing: 'quintOut'})\r\n\t\t\t\t.call(() => {\r\n\t\t\t\t\t// this.lossAnimationEnd();\r\n\t\t\t\t\tchip.unMount();\r\n\t\t\t\t})\r\n\t\t\t\t.start();\r\n\t\t})\r\n\t}\r\n\r\n\t/** 荷官飞金币到赢的区域 */\r\n\tprivate flyChipToWinArea(){//需要当前赢的区域 获得赔率，添加对应翻倍金币移动到对应赢的区域\r\n\t\t// console.log(\"this.props.goldData\",this.props.goldData);\r\n        //  console.log(\"this.props.goldData\",!this.props.goldData);\r\n\t\t//  console.log(\"this.props.winArea\",this.props.winArea);\r\n\t\tif( mainGameViewModel.isUnMount ){ return }\r\n\t\tif(!this.props || !this.props.goldData || !this.props.winArea ){//没有任何下注 没有赢的区域\r\n\t\t\treturn\r\n\t\t}else{\r\n\t\t\tplayGetCoin()\r\n\t\t}\r\n\t\tthis.props.winArea.forEach((item,index)=>{\r\n\t\t\tconst betData = { betType:item, betAmount:this.props.goldData[item]};\r\n\t\t\tthis.flyWinChip(betData,index)\r\n\r\n\t\t})\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * 获得自己的头像位置\r\n\t * @returns \r\n\t */\r\n\tprivate getMyHeadPosition() {\r\n\t\treturn new Vec3(config.gameOption.myHeadPosition.x, config.gameOption.myHeadPosition.y);\r\n\t}\r\n\t/**筹码飞向用户头像 */\r\n\tprivate chipFlyToHead(chip: ChipViewModel, betInfo: BetInfo) {\r\n\t\tconst chipNode = chip.comp.node;\r\n\t\tconst endPositon = betInfo ? this.getFlyToHeadEndPosition(betInfo) : this.getMyHeadPosition();\r\n\t\tconst uiTransform = this.node.getComponent(UITransform);\r\n\t\ttween(chipNode).to(0.3, { worldPosition: uiTransform.convertToWorldSpaceAR(endPositon) })\r\n\t\t\t.call(() => {\r\n\t\t\t\tchip.unMount();\r\n\t\t\t})\r\n\t\t\t.start();\r\n\t}\r\n\t/** 赢的区域飞金币到用户头像 */\r\n\tprivate flyWinAreaToUser(betInfo,isFly: boolean = true): void{\r\n\t\t// console.log(\"this.props.winArea touser\",this.props.winArea);\r\n\t\t// console.log(\"betInfo\",betInfo);\r\n\t\tif (!this.props.winArea) { return }\r\n\t\tplayGetCoin()\r\n\t\tthis.props.winArea.forEach(v => {\r\n\t\t\tconst betInfos = this.betAreaInfo.get(v);\r\n\t\t\tif (betInfos) {\r\n\t\t\t\tbetInfos.forEach(betInfo => {\r\n\t\t\t\t\t// console.log(\"betinfo22\",betInfo);\r\n\t\t\t\t\t\r\n\t\t\t\t\tbetInfo.chips.forEach(chip => {\r\n\t\t\t\t\t\tconst chipNode = chip.comp.node;\r\n\t\t\t\t\t\tconst endPositon = this.getFlyToHeadEndPosition(betInfo);\r\n\t\t\t\t\t\tconst uiTransform = this.node.getComponent(UITransform);\r\n\r\n\t\t\t\t\t\ttween(chipNode).to(0.8, { worldPosition: uiTransform.convertToWorldSpaceAR(endPositon) ,scale:new Vec3(0.1,0.1)},{easing: 'quintOut'})\r\n\t\t\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\t\t\tchip.unMount();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.start();\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n    /** 飞向赢 区域*/\r\n\tprivate flyWinChip(winBetData,index:number , isFly: boolean = true){\r\n\t\tconst betInfos = this.betAreaInfo.get(winBetData.betType);\r\n\t\tif (!betInfos) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tisFly = this.isShowGame;\r\n\t\tlet odds=this.props.cardRate[index]-1\r\n\t\tconst betArea = this.getNodeByBetType(winBetData.betType).getChildByName(\"Layout_bet_chips\");\r\n\t\t// console.log(\"this.props.cardRate\",this.props.cardRate);\r\n\t\tconst copyBetInfo = this.copyBetInfo(betInfos, betArea, odds);\r\n\t\tlet chips: ChipViewModel[] = [];\r\n\t\tcopyBetInfo.forEach(v => chips = chips.concat(v.chips));\r\n\t\tconst uiTransform = this.node.getComponent(UITransform);\r\n\t\t// log(\"healerFlyToBetArea === \", chips.length);\r\n\t\tchips.forEach(v => {\r\n\t\t\tconst startPosition = new Vec3 (config.gameOption.dealerPosition.x,config.gameOption.dealerPosition.y);\r\n\t\t\tconst endPositon = this.randomBetEndPosition(betArea);\r\n\r\n\t\t\tconst chipNode = v.comp.node;\r\n\t\t\tchipNode.setWorldPosition(uiTransform.convertToWorldSpaceAR(startPosition));\r\n\r\n\t\t\ttween(chipNode).to(0.5, { position: endPositon },{easing: 'quintOut'})\r\n\t\t\t// .call(() => { this.flyHealerToBetAreaEnd() })\r\n\t\t\t.start();\r\n\t\t})\r\n\r\n\t\t// 把荷官赔付的筹码加入到用户下注的数组中去\r\n\t\tcopyBetInfo.forEach(v => {\r\n\t\t\tconst betInfo = betInfos.find(bb => bb.userId === v.userId);\r\n\t\t\tbetInfo.chips = betInfo.chips.concat(v.chips);\r\n\t\t})\r\n\t\t\r\n\t}\r\n\r\n\tprivate  copyBetInfo(betInfos: BetInfo[], parent: Node, odds: number): BetInfo[] {\r\n\t\tconst arr: BetInfo[] = [];\r\n\r\n\t\tnew Array(odds).fill(0).forEach(v => {\r\n\t\t\tbetInfos.forEach(betInfo => {\r\n\t\t\t\tarr.push({\r\n\t\t\t\t\tindex: betInfo.index,\r\n\t\t\t\t\tuserId: betInfo.userId,\r\n\t\t\t\t\tisMe: betInfo.isMe,\r\n\t\t\t\t\tchips: betInfo.chips.filter(chip => chip.comp.props).map(chip => this.createChip(chip.comp.props.value, parent))\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\treturn arr;\r\n\t}\r\n\r\n\t/**\r\n\t * 添加下注信息\r\n\t * @param betData \r\n\t * @param viewModel \r\n\t */\r\n\tprivate addBetInfo(betData: BetData, viewModel: ChipViewModel) {\r\n\t\tlet betInfos = this.betAreaInfo.get(betData.betType);\r\n\t\tif (!betInfos) {\r\n\t\t\tbetInfos = [];\r\n\t\t\tthis.betAreaInfo.set(betData.betType, betInfos);\r\n\t\t}\r\n\t\t\r\n\t\tlet betInfo = betInfos.find(v => v.userId === betData.memberId);\r\n\t\tif (betInfo) {\r\n\t\t\tbetInfo.chips.push(viewModel);\r\n\t\t} else {\r\n\t\t\tbetInfos.push({\r\n\t\t\t\tindex: betData.index,\r\n\t\t\t\tuserId: betData.memberId,\r\n\t\t\t\tisMe: betData.isMyBet,\r\n\t\t\t\tchips: [viewModel]\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**显示星星在下注区域 */\r\n\tprivate showWinRate(betType: BetType) {\r\n\t\tif (!this.node || !this.node.isValid) return;\r\n\t\tthis.getStar( this.getNodeByBetType(betType), betType ).active  =  true;\r\n\t}\r\n\r\n\t/**获得星星 */\r\n\tprivate getStar(parentNode:Node, betType: BetType) {\r\n\t\treturn parentNode.getChildByName(\"spr_bet_star\");\r\n\t}\r\n\r\n\t/** 隐藏星星 */\r\n\tprivate hideAllWinRate() {\r\n\t\tif (!this.node || !this.node.isValid) return;\r\n\t\tthis.propertyNode.props_btn_black.getChildByName(\"spr_bet_star\").active = false;\r\n\t\tthis.propertyNode.props_btn_red.getChildByName(\"spr_bet_star\").active = false;\r\n\t\tthis.propertyNode.props_btn_plum.getChildByName(\"spr_bet_star\").active = false;\r\n\t\tthis.propertyNode.props_btn_diamond.getChildByName(\"spr_bet_star\").active = false;\r\n\t}\r\n\t\r\n\t/**飞星星 */\r\n\tprivate flyStar(parentNode:Node, betType: BetType) {\r\n\t\tconst endPosition = getNodePositionInCanvas(this.getStar( parentNode, betType ));\r\n\t\tlet starIcon = usersViewModel.comp.getPropertyNode().props_spr_icon as Node\r\n\t\t// let starIcon = getNodeByNameDeep(\"props_spr_icon\",this.node.parent.getChildByName(\"prefabs_bandar_users\"));\r\n\t\tconst starNode  =  instantiate(starIcon);\r\n\t\tconst startPosition = getNodePositionInCanvas(starIcon)\r\n\t\tstarNode.active  =  true;\r\n\t\tthis.node.addChild(starNode);\r\n\t\tstarNode.setPosition(startPosition);\r\n        tween(starNode).to(0.5,{scale:new Vec3(0.8,0.8)}).start();\r\n\t\tthis.playWinRateTween(starNode, endPosition, 0.5, () => {\r\n\t\t\t\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.showWinRate(betType);\r\n\t\t\t\tstarNode.destroy();\r\n\t\t\t\tif(this.isFlyStar){this.isFlyStar = false}\r\n\t\t\t}, 0.5);\r\n\t\t});\r\n\t\t\r\n\t}\r\n\r\n\t/**飞星星抛物线动画 */\r\n\tprivate playWinRateTween(tweenNode: Node, endPos: Vec3, playTime: number, callBack: Function) {\r\n\t\tconst startPos  =  tweenNode.position;\r\n\t\tconst startAngle = tweenNode.eulerAngles;\r\n\t\tconst fruitTween = tween(startPos);\r\n\r\n\t\tconst x = (startPos.x + endPos.x) / 2;\r\n\t\tconst y = (startPos.y + endPos.y) / 2;\r\n\r\n\t\tconst mixY = y + y * 0.6;\r\n\t\tconst maxY = y + y * 0.6;\r\n\t\tconst mixX = x;\r\n\t\tconst maxX = x;\r\n\t\tvar progressX = function (start, end, current, t) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tcurrent = bezier(start, mixX, maxX, end, t);\r\n\t\t\treturn current;\r\n\t\t}\r\n\t\tvar progressY = function (start, end, current, t) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tcurrent = bezier(start, mixY, maxY, end, t);\r\n\t\t\treturn current;\r\n\t\t}\r\n\r\n\t\tfruitTween.parallel(\r\n\t\t\ttween().to(playTime, { x: endPos.x }, {\r\n\t\t\t\tprogress: progressX, onUpdate: () => {\r\n\t\t\t\t\ttweenNode.isValid && tweenNode.setPosition(startPos);\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttween().to(playTime, { y: endPos.y }, {\r\n\t\t\t\tprogress: progressY, onUpdate: () => {\r\n\t\t\t\t\ttweenNode.isValid && tweenNode.setPosition(startPos);\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t).start();\r\n\t\ttween(startAngle).to(playTime, { z: 360 }, {\r\n\t\t\tonUpdate: () => {\r\n\t\t\t\tif (tweenNode.isValid) {\r\n\t\t\t\t\ttweenNode.eulerAngles = startAngle;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).call(() => callBack()).start();\r\n\t}\r\n\r\n\t/** 获取点击区域的节点 */\r\n\tprivate getNodeByBetType(betType: BetType) {\r\n\t\tif (BetType.BLACK === betType) {\r\n\t\t\treturn this.propertyNode.props_btn_black;\r\n\t\t} else if (BetType.RED === betType) {\r\n\t\t\treturn this.propertyNode.props_btn_red;\r\n\t\t} else if (BetType.PLUM === betType) {\r\n\t\t\treturn this.propertyNode.props_btn_plum;\r\n\t\t} else if (BetType.DIAMOND === betType) {\r\n\t\t\treturn this.propertyNode.props_btn_diamond;\r\n\t\t} \r\n\t}\r\n\r\n\tprivate getNodeToBetType(betType: number) {\r\n\t\tif (1 === betType) {\r\n\t\t\treturn BetType.BLACK;\r\n\t\t} else if (2 === betType) {\r\n\t\t\treturn BetType.RED;\r\n\t\t} else if (3 === betType) {\r\n\t\t\treturn BetType.PLUM;\r\n\t\t} else if (4 === betType) {\r\n\t\t\treturn BetType.DIAMOND;\r\n\t\t} \r\n\t}\r\n\tprotected destroyCallBack(): void {\r\n\t\tthis.taskScheduler.destoryQueue();\r\n        this.taskScheduler.stopQueue(false)\r\n\t}\r\n\tprivate cancelBet(cancelBetData: BetData) {\r\n\t\t// console.log(\"cancelBetData\",cancelBetData);\r\n\t\t\r\n\t\tif (cancelBetData) {\r\n\t\t\tconst betInfos = this.betAreaInfo.get(cancelBetData.betType);\r\n\t\t\t// console.log(\"betInfos\",betInfos);\r\n\t\t\tif (betInfos === undefined) return;\r\n\t\t\tif (betInfos && betInfos.length > 0) {\r\n\t\t\t\tconst chips = betInfos.find(v => v.userId === gameCacheData.memberId || v.isMe).chips;\r\n\t\t\t\t// console.log(\"chips\",chips);\r\n\t\t\t\t\r\n\t\t\t\tfor (let i = 0; i < chips.length; i++) {\r\n\t\t\t\t\tconst chip = chips[i];\r\n\t\t\t\t\tif (chip.comp.props.value === cancelBetData.betAmount) {\r\n\t\t\t\t\t\tchips.splice(i, 1);\r\n\t\t\t\t\t\tthis.chipFlyToHead(chip, undefined);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst betArea = this.getNodeByBetType(cancelBetData.betType).getChildByName(\"Layout_bet_chips\");\r\n\t\t\t// this.updateBetAreaGold(cancelBetData, betArea.parent);\r\n\r\n\t\t\tconst betAmount = cancelBetData.betAmount < 10000 ? cancelBetData.betAmount.formatAmountWithCommas() : cancelBetData.betAmount.formatAmountWithLetter();\r\n\r\n\t\t\tglobal.hallDispatch(\r\n\t\t\t\taddToastAction({\r\n\t\t\t\t\tposition: ToastPosition.MIDDLE,\r\n\t\t\t\t\tcontent:\r\n\t\t\t\t\t\tlang.write(k => k.InitGameModule.BetFaild, {}, { placeStr: \"{0} 筹码下注失败\" }).format(betAmount)\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {}\r\n\r\n}"]}