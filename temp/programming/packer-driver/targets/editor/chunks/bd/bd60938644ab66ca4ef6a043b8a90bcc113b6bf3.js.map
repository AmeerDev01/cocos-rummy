{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/PHOENIX111/components/phoenix_roller.ts"],"names":["_decorator","Mask","Node","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","GameType","SMALLGAME","RollerIconViewModel","sourceManageSeletor","PrefabPathDefine","config","endRollingAction","setRollSpeed","ccclass","property","phoenix_roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","rollerHeight","rollConfig","normalRollOption","multiplierIcon","propertyNode","props_roller","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","isSpeedUp","stopMode","isSortStop","iconYuanBaoEffectData","iconFreeGameEffectData","viewGameType","freeGamePositionId","CHOSSE0","isJumpStop","events","rollStart","rollEnd","rollerIndex","start","initState","roundEnd","bindEvent","useProps","key","value","pre","direction","DOWN","cur","iconQueue","length","initRoller","rolling","comp","node","position","y","UP","getRollerHeight","creator","setState","stopIconIndex","bringForwardEnd","dispatch","filter","i","isUnMount","l","index","item","iconData","iconId","push","indexOf","setProps","iconYuanBaoEffect","iconFreeGameEffect","iconViewModel","joinIcon","insideCount","children","active","getPosition","itemHeight","getComponent","height","intervalHeight","setPosition","x","width","left","intervalWidth","right","stopSpeed","SUBGAME1","uiData","fileName","mountView","getFile","ICON","source","appendTo","connect","speed","cache","multiplier","callBack","count","console","log","forEach","playallPurpose","bindUI","useState","enabled","window","setInterval","iconMv","undefined","update","deltaTime","_node","z","queueIndex","unMount","then","singleRollerHeight","singleIntervalHeight","to","easing","call","state","getRoundEnd","onDestroy","clearInterval"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Mask, Node, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType, GameType, SMALLGAME } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { playFastRoller, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction, setRollSpeed } from '../store/actions/roller';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport dataTransfer, { DataKeyType } from '../dataTransfer';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tisSpeedUp?: boolean,\r\n\tstopMode: 'index' | 'jump'\r\n\tisSortStop: boolean\r\n\ticonYuanBaoEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\ticonFreeGameEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tviewGameType: GameType,\r\n\tfreeGamePositionId: SMALLGAME,\r\n\tisJumpStop: boolean,\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n}\r\n\r\n@ccclass('phoenix_roller')\r\nexport class phoenix_roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\t// private coordList: Array<number> = []\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\tprivate multiplierIcon = [];\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\t// props_daqipao: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tisSpeedUp: false,\r\n\t\tstopMode: 'jump',\r\n\t\tisSortStop: false,\r\n\t\ticonYuanBaoEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\ticonFreeGameEffectData:{\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tviewGameType: GameType.NONE,\r\n\t\tfreeGamePositionId: SMALLGAME.CHOSSE0,\r\n\t\tisJumpStop:false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\trollEnd: (rollerIndex: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\t//更新\r\n\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\t\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\t// console.log(\"this.props.isJumpStop isSortStop\",this.props.isSortStop);\r\n\t\t\t\t\t// // if (!this.props.isSortStop) {\r\n\t\t\t\t\t// \tplayFastRoller()\r\n\t\t\t\t\t// // }\r\n\t\t\t\t\tthis.events.rollStart()\r\n\t\t\t\t}\r\n\t\t\t\tif (value.pre.rolling === true && value.cur.rolling === false) {\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (value.pre.stopIconIndex !== value.cur.stopIconIndex) {\r\n\t\t\t\t\tif (this.props.stopMode === \"jump\") {\r\n\t\t\t\t\t\t// 放弃这种模式(控制跳跃的距离来实现步停)\r\n\t\t\t\t\t\tthis.bringForwardEnd(this.props.rollerType, 2)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dispatch(setRollSpeed(this.props.isSpeedUp ? 1.5 : 1))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\t\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tthis.multiplierIcon = [];\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (item.comp.props.iconData.iconId === 12) {\r\n\t\t\t\t\tthis.multiplierIcon.push(item);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconYuanBaoEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconYuanBaoEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconYuanBaoEffect: this.props.iconYuanBaoEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconYuanBaoEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconFreeGameEffectData\") {\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconFreeGameEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconFreeGameEffect: this.props.iconFreeGameEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconFreeGameEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**主要用于初始化的时候 */\r\n\tprivate creator() {\r\n\t\tconst iconViewModel = this.joinIcon()\r\n\t\tconst insideCount = this.propertyNode.props_roller.children.filter(i => i.active).length - 1\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -this.getRollerHeight() + (itemHeight / 2) + (insideCount * itemHeight), 1))\r\n\t\t\t\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -(insideCount * itemHeight) - (itemHeight / 2), 1))\r\n\t\t}\r\n\t\t// this.coordList.push(iconViewModel.comp.node.position.y)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**初始化 */\r\n\tprivate initRoller() {\r\n\t\t//取队列最后n个图标\t \r\n\t\tthis.rollConfig = config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\r\n\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t}\r\n\t}\r\n\t/**提前结束,这个停止方式，应该只支持indexTrgger这种触发方案 */\r\n\tprivate bringForwardEnd(rollerType: RollerType, stopSpeed: number = 4) {\r\n\t\tif (rollerType.stopIconIndex + stopSpeed >= this.props.rollerType.iconQueue.length) {\r\n\t\t\tif (rollerType.stopIconIndex === this.props.rollerType.iconQueue.length) {\r\n\t\t\t\tthis.nextJoinIconIndex = 2;\r\n\t\t\t} else {\t\t\t\t\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.iconQueue.length - rollerType.stopIconIndex\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// if (rollerType.stopIconIndex === 1) {\r\n\t\t\t// \tthis.nextJoinIconIndex = 3;\r\n\t\t\t// } else {\r\n\t\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed;\r\n\t\t\t// }\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 添加图标\r\n\t * @returns \r\n\t */\r\n\tprivate joinIcon() {\r\n\t\t//下一个要加入的图标\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex];\t\r\n\t\t// 进入小游戏凤凰图标资源更改\r\n\t\tif (this.props && this.props.viewGameType === GameType.SUBGAME1 && iconData && iconData.iconId === 12) {\r\n\t\t\tif (this.props && this.props.freeGamePositionId > 0) {\r\n\t\t\t\ticonData.uiData.fileName = `img/rollerIcon/wild/tubiao_xyx_niao${this.props.freeGamePositionId}`\r\n\t\t\t}\r\n\t\t}\r\n\t\t// if (this.props.rollerType.index === 0 || this.props.rollerType.index != 4) {\r\n\t\t// \tif (iconData && iconData.iconId === 13) {//当第一列或第五列出现元宝中奖图标时\r\n\t\t// \t\ticonData.uiData.animationArr=[\"\",\"animation\"]\r\n\t\t// \t}\r\n\t\t// }\r\n\t\tconst iconViewModel = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source).appendTo(this.propertyNode.props_roller).setProps({ iconData }).connect()\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\t//icon的高度加上上下纵向高度\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY + itemHeight - this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex--\r\n\t\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t\tthis.compensation = iconViewModel.comp.node.position.y\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY - itemHeight + this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex++\r\n\t\t\tthis.nextJoinIconIndex === this.props.rollerType.iconQueue.length  && (this.nextJoinIconIndex = 0)\r\n\t\t}\r\n\r\n\t\tthis.displayIconList.push(iconViewModel)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns \r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tpublic multiplier(callBack){ // 倍数相乘特效\r\n\t\tlet count = 0;\r\n\t\tconsole.log(\"this.multiplierIcon.length\",this.multiplierIcon.length);\r\n\t\t\r\n\t\tif (this.multiplierIcon.length > 0) {\r\n\t\t\t\r\n\t\t\tthis.multiplierIcon.forEach(item => {\r\n\t\t\t\titem.comp.playallPurpose(() => {\r\n\t\t\t\t\tcount++\r\n\t\t\t\t\tif(count >= this.multiplierIcon.length){\r\n\t\t\t\t\t\tcallBack()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tcallBack()\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\t\t}, [\"roundEnd\"])\r\n\t\t!this.timer_clear && (this.timer_clear = window.setInterval(() => {\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(iconMv => {\r\n\t\t\t\tif (iconMv.isUnMount) {\r\n\t\t\t\t\ticonMv = undefined\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t}, 200))\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.props.rollerType.rolling) {\r\n\t\t\tthis.displayIconList.filter(item => item.comp.node && item.comp.node.active).forEach((iconMv, i) => {\r\n\t\t\t\tconst _node = iconMv.comp.node\r\n\t\t\t\tconst { x, y, z } = _node.getPosition()\r\n\t\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t// console.log(this.props.rollerType.index, 'delete icon')\r\n\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -this.getRollerHeight(true) + (i - 0.5) * itemHeight, z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\t\t\t// 超出的要删除\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t\tif (!this.state.roundEnd && this.displayIconList.length - 1 === i) {\r\n\t\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t\t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y + this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t//恢复到默认位置并对齐，第一个元素是最上面那个\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -itemHeight * (i - 0.5), z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t\t// this.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n\r\n"]}