{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_MailBox.ts"],"names":["_decorator","instantiate","Label","Node","ScrollView","BaseComponent","initToggle","ModalBox","lang","ccclass","property","Hall_MailBox","propertyNode","props_props_btn_close","props_ToggleGroup_mail_left","props_spr_mail_null","props_Layout_mail_content","props_btn_mail_delete","props_Toggle_mail_item","props_mail_sum","props","mailList","events","onCloseHandler","onDeleteHandler","item","Promise","resolve","onCheckMail","start","initState","chooseMailItemIndex","bindEvent","on","EventType","TOUCH_END","Instance","show","content","write","k","HallModule","SureDeleteMail","placeStr","type","state","then","children","destroy","setState","string","node","EventHandler","useProps","key","value","forEach","itemNode","getChildByName","getComponent","title","createTime","active","status","addChild","length","toggleCallback","event","customEventData","chooseIndex","target","indexOf","bindUI","useState","cur","mailItem","sendName","newflag","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, ScrollBar, ScrollView } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { initToggle } from '../../utils/tool';\r\nimport ModalBox from '../../common/ModalBox';\r\nimport { lang } from '../index';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport type MailItemType = {\r\n\tcontent: string\r\n\tcreateTime: string\r\n\tsendName: string\r\n\tstatus: number\r\n\ttitle: string\r\n\tid: string\r\n}\r\n\r\nexport interface IState {\r\n\tchooseMailItemIndex: number\r\n}\r\n\r\nexport interface IProps {\r\n\tmailList: MailItemType[]\r\n}\r\nexport interface IEvent {\r\n\tonCloseHandler: () => void,\r\n\tonDeleteHandler: (item: MailItemType) => Promise<boolean>\r\n\tonCheckMail: (item: MailItemType) => Promise<boolean>\r\n}\r\n\r\n@ccclass('Hall_MailBox')\r\nexport class Hall_MailBox extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_props_btn_close: new Node(),\r\n\t\tprops_ToggleGroup_mail_left: new Node(),\r\n\t\tprops_spr_mail_null: new Node(),\r\n\t\t/**内容 */\r\n\t\tprops_Layout_mail_content: new Node(),\r\n\t\t/**删除 */\r\n\t\tprops_btn_mail_delete: new Node(),\r\n\t\tprops_Toggle_mail_item: new Node(),\r\n\t\tprops_mail_sum: new Label()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tmailList: []\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonCloseHandler: () => { },\r\n\t\tonDeleteHandler: (item: MailItemType) => new Promise((resolve) => resolve(false)),\r\n\t\tonCheckMail: (item: MailItemType) => new Promise((resolve) => resolve(false))\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tchooseMailItemIndex: -1\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_props_btn_close.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onCloseHandler()\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_mail_delete.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tModalBox.Instance().show({ content: lang.write(k => k.HallModule.SureDeleteMail, {}, { placeStr: \"您确定要删除此消息吗？\" }), type: \"Confirm\" }, () => {\r\n\t\t\t\tthis.events.onDeleteHandler(this.props.mailList[this.state.chooseMailItemIndex]).then(() => {\r\n\t\t\t\t\tthis.propertyNode.props_ToggleGroup_mail_left.children[this.state.chooseMailItemIndex].destroy()\r\n\t\t\t\t\tthis.setState({ chooseMailItemIndex: this.state.chooseMailItemIndex - 1 })\r\n\t\t\t\t\tthis.propertyNode.props_mail_sum.string = (+this.propertyNode.props_mail_sum.string - 1) + ''\r\n\t\t\t\t})\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t})\r\n\t\tinitToggle(this.propertyNode.props_ToggleGroup_mail_left, this.node, new Hall_MailBox.EventHandler(), \"Hall_MailBox\", \"toggleCallback\")\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\t// const template = instantiate(this.propertyNode.props_Toggle_mail_item)\r\n\t\t// this.propertyNode.props_ToggleGroup_mail_left.removeAllChildren()\r\n\t\tif (key === \"mailList\") {\r\n\t\t\tthis.props.mailList.forEach(item => {\r\n\t\t\t\tconst itemNode = instantiate(this.propertyNode.props_Toggle_mail_item)\r\n\t\t\t\titemNode.getChildByName(\"label_mail_sender\").getComponent(Label).string = item.title\r\n\t\t\t\titemNode.getChildByName(\"label_mail_time\").getComponent(Label).string = item.createTime\r\n\t\t\t\titemNode.getChildByName(\"spr_mail_new\").active = !item.status\r\n\t\t\t\tthis.propertyNode.props_ToggleGroup_mail_left.addChild(itemNode)\r\n\t\t\t\titemNode.active = true\r\n\t\t\t})\r\n\t\t\tif (this.props.mailList.length) {\r\n\t\t\t\tthis.setState({ chooseMailItemIndex: 0 })\r\n\t\t\t}\r\n\t\t\t// if (this.props.mailList.length) {\r\n\t\t\t// \tthis.propertyNode.props_ToggleGroup_mail_left.children[0].isChecked = true\r\n\t\t\t// }\r\n\t\t\tthis.propertyNode.props_mail_sum.string = this.props.mailList.length + ''\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleCallback(event: Event, customEventData: string) {\r\n\t\tconst chooseIndex = event.target['parent'].children.indexOf(event.target)\r\n\t\tthis.setState({\r\n\t\t\tchooseMailItemIndex: chooseIndex\r\n\t\t})\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\t// this.propertyNode.props_Toggle_mail_item.active = false\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.propertyNode.props_spr_mail_null.active = false\r\n\t\t\tthis.propertyNode.props_Layout_mail_content.active = false\r\n\t\t\tvalue.cur === -1 && (this.propertyNode.props_spr_mail_null.active = true)\r\n\t\t\tvalue.cur !== -1 && (this.propertyNode.props_Layout_mail_content.active = true)\r\n\r\n\t\t\tconst mailItem: MailItemType = this.props.mailList[value.cur]\r\n\t\t\tif (!mailItem) return\r\n\t\t\tthis.propertyNode.props_Layout_mail_content.getChildByName(\"label_mail_sender\").getComponent(Label).string = mailItem.sendName\r\n\t\t\tthis.propertyNode.props_Layout_mail_content.getChildByName(\"label_mail_time\").getComponent(Label).string = mailItem.createTime\r\n\t\t\tthis.propertyNode.props_Layout_mail_content.getChildByName(\"label_mail_title\").getComponent(Label).string = mailItem.title\r\n\t\t\tthis.propertyNode.props_Layout_mail_content.getChildByName(\"ScrollView_content\").getComponent(ScrollView)\r\n\t\t\t\t.content.getChildByName(\"item\").getComponent(Label).string = mailItem.content\r\n\t\t\tconst newflag = this.propertyNode.props_ToggleGroup_mail_left.children[value.cur].getChildByName(\"spr_mail_new\")\r\n\t\t\tif (newflag.active) {\r\n\t\t\t\tnewflag.active = false\r\n\t\t\t\tthis.events.onCheckMail(mailItem).then(() => { })\r\n\t\t\t}\r\n\t\t}, [\"chooseMailItemIndex\"])\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}