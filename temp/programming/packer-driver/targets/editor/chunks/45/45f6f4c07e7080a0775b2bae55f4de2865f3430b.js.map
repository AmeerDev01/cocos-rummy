{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_Turntable/TurntablePanel.ts"],"names":["_decorator","assetManager","Button","instantiate","Label","Node","Sprite","SpriteFrame","tween","Vec3","BaseComponent","global","lang","addToastAction","ToastType","SKT_MAG_TYPE","sktInstance","sktMsgListener","initToggle","ccclass","property","TypeOperation","TurntablePanel","turntableData","CarouselData","interval","timer","currentIndex","moveDistance","moveDuration","winningRecordData","meRecordData","count","propertyNode","props_btn_turntable_arow","props_btn_turntable_arow_disable","props_spr_truntable","props_btn_detail","props_tum_gift","props_label_times","props_label_remind","props_ScrollView_my","props_ScrollView_all","props_label_title","props_label_time","props","TurntableData","events","rotaryStarting","setReadStatus","value","start","updateLabel","initState","bindEvent","node","on","EventType","CLICK","TURNTABLE","HELP","add","TURNTABLETNOTIFICATION","data","initAll","filter","item","horseRaceLamp","initProps_label_remind","getChildByName","EventHandler","onDestroy","remove","useProps","key","turntable","turntablePrizeEntities","cur","turntableClaimRecordEntities","memberTurntableClaimRecordEntities","turntableDisable","getComponent","string","effectStart","effectEnd","forEach","j","I","loadTurntableImg","setPosition","children","k","i","addChild","setCount","initMy","bindUI","picture","loadRemote","err","asset","nativeUrl","spriteFrame","createWithImage","prizeValue","active","hallDispatch","content","write","HallModule","LoadFaild","placeStr","type","ERROR","update","deltaTime","length","memberName","prizeName","currentPos","getPosition","x","z","to","position","easing","call","toggleCallback","event","customEventData","target","name","view","destroyAllChildren","substring","startCountdown","unscheduleAllCallbacks","timeLabel","targetDate","Date","setDate","getDate","setHours","setMinutes","setSeconds","setMilliseconds","updateCountdownLabel","schedule","currentDate","times","getTime","h","parseInt","remainHours","m","remainMinutes","s","remainSeconds","remainTimeStr","sendSktMessage","TURNTABLEDATA"],"mappings":"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","sourcesContent":["import { _decorator, assetManager, Button, Component, find, ImageAsset, instantiate, Label, log, native, Node, ScrollView, Sprite, SpriteFrame, sys, systemEvent, Texture2D, Toggle, ToggleContainer, tween, UIOpacity, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { global, lang } from '../../index';\r\nimport { addToastAction, ToastType } from '../../store/actions/baseBoard';\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from '../../socketConnect';\r\nimport { initToggle } from '../../../utils/tool';\r\nconst { ccclass, property } = _decorator;\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n    TurntableData?: any,\r\n}\r\nexport enum TypeOperation {\r\n    HELP = 1,\r\n    TURNTABLE = 2\r\n}\r\nexport interface IEvent {\r\n    rotaryStarting?: (type, data?) => void,\r\n    setReadStatus?: (value: string) => void,\r\n}\r\n\r\n@ccclass('TurntablePanel')\r\nexport class TurntablePanel extends BaseComponent<IState, IProps, IEvent> {\r\n    private turntableData\r\n    CarouselData = [\r\n        {\r\n            \"createTime\": \"2023-12-23 21:13:44\",\r\n            \"horseRaceLamp\": 1,\r\n            \"id\": \"568\",\r\n            \"memberId\": 800611130,\r\n            \"memberName\": \"guest-SOzYWR\",\r\n            \"picture\": \"https://img.nuih.top/qy-picture-1703311584863.jpeg\",\r\n            \"prizeId\": 133,\r\n            \"prizeName\": \"1\",\r\n            \"prizeType\": 0,\r\n            \"prizeValue\": 50,\r\n            \"state\": 1,\r\n            \"turntableId\": 19,\r\n            \"updateBy\": \"\"\r\n        }\r\n    ]\r\n    interval = 3 // 每条信息显示的时间（秒）\r\n    timer = 0\r\n    currentIndex = 0\r\n    moveDistance: 20 // 文本向上移动的距离\r\n    moveDuration: 3 // 文本移动完成所需的时间（秒）\r\n    winningRecordData = []\r\n    meRecordData = []\r\n    count = 0\r\n    start() {\r\n        this.currentIndex = 0; // 当前显示的数据索引\r\n        this.timer = 0; // 计时器\r\n        this.updateLabel();\r\n    }\r\n\r\n    protected propertyNode = {\r\n        props_btn_turntable_arow: new Button(),\r\n        props_btn_turntable_arow_disable: new Node(),\r\n        props_spr_truntable: new Node(),\r\n        props_btn_detail: new Button(),\r\n        props_tum_gift: new Node(),\r\n        props_label_times: new Node(),\r\n        props_label_remind: new Node(),\r\n        props_ScrollView_my: new Node(),\r\n        props_ScrollView_all: new Node(),\r\n        props_label_title: new Node(),\r\n        props_label_time: new Node(),\r\n    }\r\n\r\n    public props: IProps = {\r\n        TurntableData: {},\r\n    }\r\n\r\n    public events: IEvent = {\r\n        rotaryStarting: () => { },\r\n        setReadStatus: (value: string) => { },\r\n    }\r\n\r\n    protected initState() {\r\n        return {\r\n\r\n        }\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n        this.propertyNode.props_btn_turntable_arow.node.on(Button.EventType.CLICK, () => {\r\n            if (this.count > 0) {\r\n                this.events.rotaryStarting(TypeOperation.TURNTABLE, this.turntableData)\r\n            }\r\n        })\r\n        this.propertyNode.props_btn_detail.node.on(Button.EventType.CLICK, () => {\r\n            this.events.rotaryStarting(TypeOperation.HELP)\r\n        })\r\n        sktMsgListener.add(SKT_MAG_TYPE.TURNTABLETNOTIFICATION, \"main\", (data) => {\r\n            this.winningRecordData = data\r\n            this.initAll()\r\n            this.CarouselData = data.filter(item => item.horseRaceLamp === 1);\r\n            this.currentIndex = 0\r\n            this.initProps_label_remind()\r\n        })\r\n        initToggle(this.node.getChildByName('note_toggleGroup'), this.node, new TurntablePanel.EventHandler(), \"TurntablePanel\", \"toggleCallback\")\r\n    }\r\n    onDestroy() {\r\n        sktMsgListener.remove(SKT_MAG_TYPE.TURNTABLETNOTIFICATION, \"main\",)\r\n    }\r\n    protected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n        if (key == 'TurntableData') {\r\n            let { turntable, turntablePrizeEntities, count } = value.cur\r\n            this.turntableData = value.cur\r\n            this.winningRecordData = value.cur.turntableClaimRecordEntities\r\n            this.meRecordData = value.cur.memberTurntableClaimRecordEntities\r\n            this.initAll()\r\n            if (count === 0) {\r\n                // this.propertyNode.props_btn_turntable_arow.getComponent(Sprite).grayscale = true\r\n                this.turntableDisable(true);\r\n            } else {\r\n                this.turntableDisable(false);\r\n            }\r\n            this.count = count\r\n            this.propertyNode.props_label_title.getComponent(Label).string = turntable.effectStart + ' - ' + turntable.effectEnd\r\n            this.propertyNode.props_label_times.getComponent(Label).string = count + ' kali'\r\n            turntablePrizeEntities.forEach((j, I) => {\r\n                let node = instantiate(this.propertyNode.props_tum_gift)\r\n                this.loadTurntableImg(j, node)\r\n                node.setPosition(0, 0)\r\n                this.propertyNode.props_spr_truntable.children.forEach((k, i) => {\r\n                    if (I === i) {\r\n                        k.addChild(node)\r\n                    }\r\n                })\r\n            })\r\n\r\n        }\r\n    }\r\n    setCount(data) {\r\n        this.turntableData.count = data.count\r\n        if (data.count === 0) {\r\n            this.count = data.count\r\n            // this.propertyNode.props_btn_turntable_arow.getComponent(Sprite).grayscale = true\r\n            this.turntableDisable(true);\r\n        } else {\r\n            this.turntableDisable(false);\r\n        }\r\n        this.meRecordData = data.memberTurntableClaimRecordEntities\r\n        this.propertyNode.props_label_times.getComponent(Label).string = data.count + ' kali'\r\n        this.initMy()\r\n    }\r\n    protected bindUI(): void {\r\n\r\n    }\r\n    private loadTurntableImg(item, node) {\r\n        item.picture && assetManager.loadRemote(item.picture, (err, asset: ImageAsset) => {\r\n            if (this.propertyNode && !err && (item.picture === asset.nativeUrl)) {\r\n                node.getComponent(Sprite).spriteFrame = SpriteFrame.createWithImage(asset)\r\n                node.getChildByName('props_gift_name').getComponent(Label).string = item.prizeValue + ''\r\n                node.active = true\r\n            }\r\n            if (err) {\r\n                global.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.LoadFaild, {}, { placeStr: \"加载资源失败\" }), type: ToastType.ERROR }))\r\n            }\r\n        })\r\n    }\r\n    update(deltaTime: number) {\r\n        this.timer += deltaTime;\r\n        if (this.timer >= this.interval) {\r\n            this.timer = 0; // 重置计时器\r\n            this.currentIndex = (this.currentIndex + 1) % this.CarouselData.length; // 更新索引\r\n            this.updateLabel(); // 更新 Label 显示的文本\r\n        }\r\n    }\r\n    updateLabel() {\r\n        if (this.CarouselData.length > 0) {\r\n            this.propertyNode.props_label_remind.getComponent(Label).string = `Selamat kepada ${this.CarouselData[this.currentIndex].memberName} yang telah memenangkan ${this.CarouselData[this.currentIndex].prizeName}.`\r\n            // 获取当前位置的 x 和 z 坐标，只改变 y 坐标\r\n            let currentPos = this.propertyNode.props_label_remind.getPosition();\r\n            this.propertyNode.props_label_remind.setPosition(new Vec3(currentPos.x, -20, currentPos.z));\r\n            // 使用 tween 实现移动动画\r\n            tween(this.propertyNode.props_label_remind)\r\n                .to(this.interval, { position: new Vec3(currentPos.x, 25, currentPos.z) }, { easing: 'cubicOut' })\r\n                .call(() => {\r\n                    this.initProps_label_remind()\r\n                })\r\n                .start();\r\n        }\r\n    }\r\n    initProps_label_remind() {\r\n        this.propertyNode.props_label_remind.setPosition(new Vec3(0, -20, 0));\r\n    }\r\n    toggleCallback(event: Event, customEventData: string) {\r\n        let node: any = event.target\r\n        if (node.name == 'props_Toggle1_all') {\r\n            this.initAll()\r\n        } else if (node.name == 'props_Toggle2_my') {\r\n            this.initMy()\r\n        }\r\n    }\r\n    initAll() {\r\n        let view = this.propertyNode.props_ScrollView_all.getChildByName('view')\r\n        let content = view.getChildByName('content')\r\n        let item = view.getChildByName('item')\r\n        content.destroyAllChildren()\r\n        this.winningRecordData.length > 0 && this.winningRecordData.forEach(i => {\r\n            let node = instantiate(item)\r\n            node.active = true\r\n            node.getChildByName('label_name_all').getComponent(Label).string = i.memberName.length >= 4 ? i.memberName.substring(0, 4) + '***' : i.memberName\r\n            node.getChildByName('label_gift_all').getComponent(Label).string = i.prizeName\r\n            content.addChild(node)\r\n        })\r\n    }\r\n    initMy() {\r\n        let view = this.propertyNode.props_ScrollView_my.getChildByName('view')\r\n        let content = view.getChildByName('content')\r\n        let item = view.getChildByName('item')\r\n        content.destroyAllChildren()\r\n        this.meRecordData.length > 0 && this.meRecordData.forEach(i => {\r\n            let node = instantiate(item)\r\n            node.getChildByName('props_label_name_my').getComponent(Label).string = i.memberName\r\n            node.getChildByName('props_label_gift_my').getComponent(Label).string = i.prizeName\r\n            node.active = true\r\n            content.addChild(node)\r\n        })\r\n    }\r\n    /**是否禁用倒计时 */\r\n    private turntableDisable(value: boolean) {\r\n        this.propertyNode.props_btn_turntable_arow_disable.active = value;\r\n        if (value) {\r\n            this.startCountdown(this.propertyNode.props_btn_turntable_arow_disable.getChildByName(\"label_time\").getComponent(Label));\r\n        } else {\r\n            this.unscheduleAllCallbacks();\r\n        }\r\n    }\r\n\r\n    private startCountdown(timeLabel: Label) {\r\n        const targetDate = new Date()\r\n        targetDate.setDate(targetDate.getDate() + 1);\r\n        targetDate.setHours(0);\r\n        targetDate.setMinutes(0);\r\n        targetDate.setSeconds(0);\r\n        targetDate.setMilliseconds(0);\r\n\r\n        this.updateCountdownLabel(timeLabel, targetDate);\r\n        this.schedule(() => {\r\n            this.updateCountdownLabel(timeLabel, targetDate);\r\n        }, 1)\r\n    }\r\n\r\n    private updateCountdownLabel(timeLabel: Label, targetDate: Date) {\r\n        const currentDate = new Date()\r\n        let times = (targetDate.getTime() - currentDate.getTime()) / 1000; // times是剩余时间总的秒数\r\n        let h = parseInt(times / 60 / 60 + ''); //时\r\n        const remainHours = h < 10 ? '0' + h : h;\r\n        let m = parseInt(times / 60 % 60 + ''); //分\r\n        const remainMinutes = m < 10 ? '0' + m : m;\r\n        let s = parseInt(times % 60 + ''); // 秒\r\n        const remainSeconds = s < 10 ? '0' + s : s;\r\n\r\n        const remainTimeStr = `${remainHours}:${remainMinutes}:${remainSeconds}`;\r\n        timeLabel.string = remainTimeStr;\r\n\r\n        if (h === 13 && m === 9 && s === 0) {\r\n            sktInstance.sendSktMessage(SKT_MAG_TYPE.TURNTABLEDATA)\r\n            this.turntableDisable(false);\r\n        }\r\n    }\r\n}\r\n\r\n"]}