{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/bandarQiuQiu/index.ts"],"names":["Prefab","assetManager","bundlePkgName","PrefabPathDefine","LoaderPanelViewModel","BandarQiuQiuFileMap","SubGameRunState","config","subGameList","dtConfig","socketConnect","GameBoardViewModel","AudioMgr","SoundPathDefine","UseSetOption","global","setSubGameRunState","sourceManageMap","bundleCommon","bundleBanDarQiuQiu","sourceManageSelector","bundleName","find","i","bundle","name","startUp","rootNode","loadBundle","err","commonBundle","load","LOADING_PANEL","progress","total","hallDispatch","LOADING","setSubGameGate","gameId","prefab","isAllowOpenSubGame","READY","loaderViewModel","mountView","appendTo","setProps","loadBarType","setEvent","onLoadDone","_sourceManageMap","bandarQiuQiu_Audio","gameConfig","item","comp","setTipContent","RUN","then","unMount","mainGameViewModel","getFile","MAIN_GAME","source","connect","play","MAIN_BG","Instance","option","music","catch","e","versionStr","md5","startLoad","playMainBg","playGame","playOneShot","START_STOP_BET","playBtnClick","BTN_CLICK","playChip","FLY_CHIP","playTimeout","TIME_OUT","playGetCoin","GET_COIN","playTurnCard","TURN_CARD","playDealCard","SEND_CARD","stopBet","STOP_BET","playMyWin","MY_WIN","playMyLose","MY_LOSE","playChooseChip","CHOOSE_CHIP","playPK","CARD_PK"],"mappings":"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","sourcesContent":["import { AssetManager, Node, Prefab, assetManager, find, instantiate, log } from \"cc\"\r\nimport bandarQiuQiuStore from './store';\r\nimport { bundlePkgName } from \"./sourceDefine\";\r\nimport { PrefabPathDefine } from \"./sourceDefine/prefabDefine\";\r\nimport LoaderPanelViewModel from \"../../common/viewModel/LoaderPanelViewModel\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport BandarQiuQiuFileMap from './sourceDefine';\r\nimport { SubGameRunState, config, subGameList } from \"../../hall/config\";\r\nimport dtConfig from \"./config\";\r\nimport socketConnect from \"./socketConnect\";\r\nimport GameBoardViewModel from \"./viewModel/BandarQiuQiuGameBoardViewModel\";\r\nimport { listenerFactoy } from \"../../common/listenerFactoy\";\r\nimport { AudioMgr } from \"../../utils/AudioMgr\";\r\nimport { SoundPathDefine } from \"./sourceDefine/soundDefine\";\r\nimport UseSetOption, { setActiveAudio } from \"../../utils/UseSetOption\";\r\nimport { global } from \"../../hall\";\r\nimport { setSubGameRunState } from \"../../hall/store/actions/baseBoard\";\r\n\r\nlet sourceManageMap: Array<SourceManage> = []\r\nexport let bundleCommon: AssetManager.Bundle = null\r\nexport let bundleBanDarQiuQiu: AssetManager.Bundle = null\r\nexport let mainGameViewModel: GameBoardViewModel\r\nexport let bandarQiuQiu_Audio: AudioMgr<SoundPathDefine>\r\nexport const sourceManageSelector = (bundleName: string = 'bandar-qiuqiu') => sourceManageMap.find(i => i.bundle.name === bundleName)\r\n\r\n\r\nexport const startUp = (rootNode: Node) => {\r\n\r\n  assetManager.loadBundle(\"common\", (err, commonBundle) => {\r\n    bundleCommon = commonBundle\r\n    assetManager.loadBundle(bundlePkgName, Prefab, (err, bundle) => {\r\n      bundleBanDarQiuQiu = bundle\r\n      bundleBanDarQiuQiu.load(PrefabPathDefine.LOADING_PANEL, Prefab,(progress, total) => {\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.LOADING))\r\n        global.setSubGameGate(dtConfig.gameId, (progress / total))\r\n      },  (err, prefab) => {\r\n        if (!global.isAllowOpenSubGame(dtConfig.gameId)) return\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.READY))\r\n        const loaderViewModel = new LoaderPanelViewModel().mountView(prefab).appendTo(rootNode).setProps({\r\n          loadBarType: 1\r\n        }).setEvent({\r\n          onLoadDone: (_sourceManageMap) => {\r\n            sourceManageMap = _sourceManageMap\r\n            bandarQiuQiu_Audio = new AudioMgr<SoundPathDefine>(sourceManageSelector(\"bandar-qiuqiu\"))\r\n            config.gameConfig.find(item => item.name === \"bandar-qiuqiu\")\r\n            loaderViewModel.comp.setTipContent(\"Game init...\")\r\n            global.hallDispatch(setSubGameRunState(SubGameRunState.RUN))\r\n            socketConnect().then(() => {\r\n              loaderViewModel.unMount().then(() => {\r\n                \r\n                mainGameViewModel = new GameBoardViewModel().mountView(sourceManageSelector(\"bandar-qiuqiu\").getFile(PrefabPathDefine.MAIN_GAME).source).appendTo(rootNode).connect()\r\n                bandarQiuQiu_Audio.play(SoundPathDefine.MAIN_BG, UseSetOption.Instance().option.music)\r\n              })\r\n            }).catch(e => loaderViewModel.comp.setTipContent(e || 'error'))\r\n          }\r\n        })\r\n        .setProps({\r\n          versionStr: `md5: ${subGameList.find(i => i.gameId === dtConfig.gameId).md5}`\r\n        })\r\n        loaderViewModel.comp.startLoad([bundle], [...BandarQiuQiuFileMap])\r\n\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 背景音乐\r\n */\r\nexport const playMainBg = () => {\r\n  bandarQiuQiu_Audio.play(SoundPathDefine.MAIN_BG, true);\r\n}\r\n/**\r\n* 游戏开始 停止\r\n*/\r\nexport const playGame = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.START_STOP_BET);\r\n}\r\n/**\r\n* 按钮单击音效\r\n*/\r\nexport const playBtnClick = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.BTN_CLICK);\r\n}\r\n\r\n/**\r\n* 下注飞筹码音效\r\n*/\r\nexport const playChip = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.FLY_CHIP);\r\n}\r\n\r\n/**\r\n* 3秒倒计时\r\n*/\r\nexport const playTimeout = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.TIME_OUT);\r\n}\r\n/**\r\n* 金币收集音效\r\n*/\r\nexport const playGetCoin = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.GET_COIN);\r\n}\r\n/**\r\n* 翻牌声\r\n*/\r\nexport const playTurnCard = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.TURN_CARD);\r\n}\r\n\r\n/**\r\n* 发牌声\r\n*/\r\nexport const playDealCard = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.SEND_CARD);\r\n}\r\n\r\n/**\r\n* 停止下注 打铃\r\n*/\r\nexport const stopBet = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.STOP_BET);\r\n}\r\n/**\r\n * 玩家赢\r\n */\r\nexport const playMyWin = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.MY_WIN);\r\n}\r\n\r\n/**\r\n * 玩家输\r\n */\r\nexport const playMyLose = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.MY_LOSE);\r\n}\r\n\r\n/**\r\n * 选择筹码\r\n */\r\nexport const playChooseChip = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.CHOOSE_CHIP);\r\n}\r\n\r\n/**\r\n * PK声\r\n */\r\nexport const playPK = () => {\r\n  bandarQiuQiu_Audio.playOneShot(SoundPathDefine.CARD_PK);\r\n}"]}