{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_ActivityPanel.ts"],"names":["_decorator","assetManager","instantiate","Label","Node","Sprite","SpriteFrame","sys","BaseComponent","initToggle","baseBoardView","global","sourceManageSeletor","subGameList","addToastAction","setLoadingAction","ToastType","lang","BuyType","TurntableViewModel","PrefabPathDefine","SKT_MAG_TYPE","sktInstance","sktMsgListener","ccclass","property","ActivityType","Hall_ActivityPanel","turntableViewModel","propertyNode","props_btn_tips_close","props_ToggleGroup","props_img_content","props_loading_img","props_content","props_Label_content","props_empty","props_empty_content","props_Toggle_template","props","activityList","events","onClosePanel","setReadStatus","value","deleteReadStatus","getItemUnreadStatus","start","initState","chooseActivityIndex","bindEvent","on","EventType","TOUCH_END","lastQeqPicUrl","useState","key","item","cur","gameId","TURNPLATE","active","comp","node","add","TURNTABLEDATA","data","mountView","getFile","HELL_ACTIVITY_TURNTABLEPANL","source","appendTo","setEvent","id","setToggleItemReadStatus","setProps","TurntableData","count","hallDispatch","content","write","k","HallModule","TurntableCue","placeStr","type","ERROR","sendSktMessage","string","pictureUrl","loadRemote","err","asset","nativeUrl","getComponent","spriteFrame","createWithImage","LoadFaild","length","detailUrl","state","openURL","mainPanelViewModel","gateViewModelList","openShop","TAS","openGiftBoxanel","openUpgradePanel","openSign","openVipMain","openPersonCenter","hallGameGate","find","i","gateViewModel","vm","gamesIds","indexOf","isShow","openGateGame","HallGameLoading","EventHandler","useProps","template","removeAllChildren","forEach","itemNode","name","getChildByName","addChild","setState","toggleCallback","event","customEventData","chooseIndex","target","children","isRead","v","bindUI","onDestroy","remove","undefined","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, assetManager, Component, ImageAsset, instantiate, Label, Node, Sprite, SpriteFrame, sys } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { initToggle } from '../../utils/tool';\r\nimport { baseBoardView, global, hallAudio, sourceManageSeletor } from '../index';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { HallGameGateType, subGameList } from '../config';\r\nimport { addToastAction, setLoadingAction, setSubGameInfoAction, ToastType } from '../store/actions/baseBoard';\r\nconst { ccclass, property } = _decorator;\r\nimport { lang } from '../index';\r\nimport { BuyType } from './Hall_ShopPanel';\r\nimport { log } from '../../common/fish/CalculteRule';\r\nimport TurntableViewModel from './Hall_Turntable/TurntableViewModel';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from '../socketConnect';\r\n\r\n/**活动类型 */\r\nexport enum ActivityType {\r\n\t/**转盘活动 */\r\n\tTURNPLATE = 998,\r\n}\r\n\r\nexport type ActivityItem = {\r\n\tid: string\r\n\tname: string\r\n\tcontent: string\r\n\tgameId: number\r\n\tdetailUrl: string\r\n\tpictureUrl: string\r\n\tautoPopUp: number\r\n}\r\nexport interface IState {\r\n\tchooseActivityIndex?: number\r\n}\r\n\r\nexport interface IProps {\r\n\tactivityList?: ActivityItem[],\r\n}\r\nexport interface IEvent {\r\n\tonClosePanel?: () => void,\r\n\tsetReadStatus?: (value: string) => void,\r\n\tdeleteReadStatus?: (value: string) => void,\r\n\tgetItemUnreadStatus?: (value: string) => boolean,\r\n}\r\n\r\n\r\n@ccclass('Hall_ActivityPanel')\r\nexport class Hall_ActivityPanel extends BaseComponent<IState, IProps, IEvent> {\r\n\tturntableViewModel\r\n\tstart() { }\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_tips_close: new Node(),\r\n\t\tprops_ToggleGroup: new Node(),\r\n\t\t/**主图 */\r\n\t\tprops_img_content: new Node(),\r\n\t\tprops_loading_img: new Node(),\r\n\t\tprops_content: new Node(),\r\n\t\tprops_Label_content: new Label(),\r\n\t\tprops_empty: new Label(),\r\n\t\tprops_empty_content: new Label(),\r\n\t\tprops_Toggle_template: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tactivityList: [],\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonClosePanel: () => { },\r\n\t\tsetReadStatus: (value: string) => { },\r\n\t\tdeleteReadStatus: (value: string) => { },\r\n\t\tgetItemUnreadStatus: (value: string) => { return false }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tchooseActivityIndex: -1\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_tips_close.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onClosePanel()\r\n\t\t})\r\n\t\tlet lastQeqPicUrl: string = \"\"\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tconst item = this.props.activityList[value.cur]\r\n\t\t\tif (item.gameId === ActivityType.TURNPLATE) { // 转盘逻辑\r\n\t\t\t\tthis.propertyNode.props_img_content.active = false\r\n\t\t\t\tif (this.turntableViewModel) {\r\n\t\t\t\t\tthis.turntableViewModel.comp.node.active = true\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsktMsgListener.add(SKT_MAG_TYPE.TURNTABLEDATA, \"main\", (data) => {\r\n\t\t\t\t\t\tif (data[0]) {\r\n\t\t\t\t\t\t\tif (this.node) {\r\n\t\t\t\t\t\t\t\tif (!this.turntableViewModel) {\r\n\t\t\t\t\t\t\t\t\tthis.turntableViewModel = new TurntableViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.HELL_ACTIVITY_TURNTABLEPANL).source).appendTo(this.node)\r\n\t\t\t\t\t\t\t\t\t\t.setEvent({\r\n\t\t\t\t\t\t\t\t\t\t\tsetReadStatus: (value: string) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.events.setReadStatus(item.id);\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setToggleItemReadStatus(item)\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.turntableViewModel.setProps({ TurntableData: data[0] })\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (data[0].count > 0) {\r\n\t\t\t\t\t\t\t\tthis.setToggleItemReadStatus(item, false)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.setToggleItemReadStatus(item)\r\n\t\t\t\t\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.TurntableCue, {}, { placeStr: \"对不起,该活动已结束!\" }), type: ToastType.ERROR }))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.TURNTABLEDATA)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.turntableViewModel && (this.turntableViewModel.comp.node.active = false)\r\n\t\t\t\tthis.propertyNode.props_loading_img.active = true\r\n\t\t\t\tif (item.content) {\r\n\t\t\t\t\tthis.propertyNode.props_content.active = true\r\n\t\t\t\t\tthis.propertyNode.props_Label_content.string = item.content\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.propertyNode.props_content.active = false\r\n\t\t\t\t}\r\n\t\t\t\tthis.propertyNode.props_img_content.active = false\r\n\t\t\t\tlastQeqPicUrl = item.pictureUrl\r\n\t\t\t\titem.pictureUrl && assetManager.loadRemote(item.pictureUrl, (err, asset: ImageAsset) => {\r\n\t\t\t\t\tthis.propertyNode && (this.propertyNode.props_loading_img.active = false)\r\n\t\t\t\t\tif (this.propertyNode && !err && (lastQeqPicUrl === asset.nativeUrl)) {\r\n\t\t\t\t\t\tthis.propertyNode.props_img_content.active = true\r\n\t\t\t\t\t\tthis.propertyNode.props_img_content.getComponent(Sprite).spriteFrame = SpriteFrame.createWithImage(asset)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.LoadFaild, {}, { placeStr: \"加载资源失败\" }), type: ToastType.ERROR }))\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tthis.setToggleItemReadStatus(item)\r\n\t\t\t}\r\n\t\t}, [\"chooseActivityIndex\"])\r\n\t\t//点击图片跳转\r\n\t\tthis.propertyNode.props_img_content.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tif (!this.props.activityList.length) return\r\n\t\t\tconst detailUrl = this.props.activityList[this.state.chooseActivityIndex].detailUrl\r\n\t\t\tconst gameId = this.props.activityList[this.state.chooseActivityIndex].gameId\r\n\t\t\tdetailUrl && sys.openURL(detailUrl)\r\n\t\t\t// detailUrl && ModalBox.Instance().show({ url: detailUrl })\r\n\r\n\t\t\tif (!baseBoardView.mainPanelViewModel.comp.gateViewModelList) {\r\n\t\t\t\t//可能在登录页打开活动页触发\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (gameId !== null && gameId !== -1) {\r\n\t\t\t\tif (gameId === 0) {\r\n\t\t\t\t\t//打开商城\r\n\t\t\t\t\tglobal.openShop()\r\n\t\t\t\t} else if (gameId === 990) {\r\n\t\t\t\t\t//商城礼包\r\n\t\t\t\t\tglobal.openShop(BuyType.TAS)\r\n\t\t\t\t} else if (gameId === 991) {\r\n\t\t\t\t\t//首冲礼包\r\n\t\t\t\t\tbaseBoardView.mainPanelViewModel.openGiftBoxanel(false)\r\n\t\t\t\t} else if (gameId === 992) {\r\n\t\t\t\t\t//绑定手机\r\n\t\t\t\t\tbaseBoardView.mainPanelViewModel.openUpgradePanel()\r\n\t\t\t\t} else if (gameId === 993) {\t// 每日签到\r\n\t\t\t\t\tglobal.openSign();\r\n\t\t\t\t} else if (gameId === 994) {\t// vip主界面\r\n\t\t\t\t\tglobal.openVipMain();\r\n\t\t\t\t} else if (gameId === 995) {\t// 个人中心\r\n\t\t\t\t\tglobal.openPersonCenter(1);\r\n\t\t\t\t} else if (gameId === 996) {  // 分佣\r\n\t\t\t\t\tglobal.openPersonCenter(4);\r\n\t\t\t\t} else if (gameId === 997) {  // 返佣\r\n\t\t\t\t\tglobal.openPersonCenter(6);\r\n\t\t\t\t} else if (gameId === ActivityType.TURNPLATE) {  // 返佣\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst hallGameGate: HallGameGateType = subGameList.find(i => i.gameId === this.props.activityList[this.state.chooseActivityIndex].gameId)\r\n\t\t\t\t\tif (hallGameGate) {\r\n\t\t\t\t\t\tconst gateViewModel = baseBoardView.mainPanelViewModel.comp.gateViewModelList.find(vm => vm.comp.props.gamesIds.indexOf(hallGameGate.gameId) !== -1)\r\n\t\t\t\t\t\tglobal.hallDispatch(setLoadingAction({ isShow: true }))\r\n\t\t\t\t\t\tgateViewModel.comp.openGateGame(hallGameGate.gameId)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.HallGameLoading, { id: this.props.activityList[this.state.chooseActivityIndex].gameId }, { placeStr: \"无效的gameId:${this.props.activityList[this.state.chooseActivityIndex}\" }), type: ToastType.ERROR }))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// this.props.activityList[this.state.chooseActivityIndex].detailUrl && sys.openURL(this.props.activityList[this.state.chooseActivityIndex].detailUrl)\r\n\t\t\t// if (this.props.activityList[this.state.chooseActivityIndex].gameId !== -1) {\r\n\t\t\t// \tif (this.state.chooseActivityIndex !== -1 && this.props.activityList[this.state.chooseActivityIndex].gameId !== 0) {\r\n\t\t\t// \t\tconst hallGameGate: HallGameGateType = subGameList.find(i => i.gameId === this.props.activityList[this.state.chooseActivityIndex].gameId)\r\n\t\t\t// \t\tif (hallGameGate) {\r\n\t\t\t// \t\t\tif (!baseBoardView.mainPanelViewModel.comp.gateViewModelList) {\r\n\t\t\t// \t\t\t\t//可能在登录页打开活动页触发\r\n\t\t\t// \t\t\t\treturn\r\n\t\t\t// \t\t\t}\r\n\t\t\t// \t\t\tconst gateViewModel = baseBoardView.mainPanelViewModel.comp.gateViewModelList.find(vm => vm.comp.props.gamesIds.indexOf(hallGameGate.gameId) !== -1)\r\n\t\t\t// \t\t\tglobal.hallDispatch(setLoadingAction(true))\r\n\t\t\t// \t\t\tgateViewModel.comp.openGateGame(hallGameGate.gameId)\r\n\t\t\t// \t\t} else {\r\n\t\t\t// \t\t\tglobal.hallDispatch(addToastAction({ content: lang.write(k => k.HallModule.HallGameLoading, { id: this.props.activityList[this.state.chooseActivityIndex].gameId }, { placeStr: \"无效的gameId:${this.props.activityList[this.state.chooseActivityIndex}\" }) }))\r\n\t\t\t// \t\t}\r\n\t\t\t// \t} else if (this.props.activityList[this.state.chooseActivityIndex].gameId === 0 && sys.localStorage.getItem('token')) {\r\n\t\t\t// \t\t// 打开商城\r\n\t\t\t// \t\tglobal.openShop()\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t})\r\n\t\tinitToggle(this.propertyNode.props_ToggleGroup, this.node, new Hall_ActivityPanel.EventHandler(), \"Hall_ActivityPanel\", \"toggleCallback\")\r\n\t}\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tconst template = instantiate(this.propertyNode.props_Toggle_template)\r\n\t\t// this.propertyNode.props_ToggleGroup.removeAllChildren()\r\n\t\tif (key === \"activityList\") {\r\n\t\t\tthis.props.activityList.length && (this.propertyNode.props_empty.node.active = false)\r\n\t\t\tthis.propertyNode.props_ToggleGroup.removeAllChildren()\r\n\t\t\tthis.props.activityList.forEach(item => {\r\n\t\t\t\tconst itemNode = instantiate(template)\r\n\t\t\t\titemNode.name = \"act_\" + item.id;\r\n\t\t\t\titemNode.getChildByName(\"Label_off\").getComponent(Label).string = item.name\r\n\t\t\t\titemNode.getChildByName(\"Checkmark\").getChildByName(\"Label_in\").getComponent(Label).string = item.name\r\n\t\t\t\titemNode.getChildByName(\"unread\").active = this.events.getItemUnreadStatus(item.id);\r\n\t\t\t\tthis.propertyNode.props_ToggleGroup.addChild(itemNode)\r\n\t\t\t\titemNode.active = true\r\n\r\n\t\t\t})\r\n\t\t\tif (this.props.activityList.length) {\r\n\t\t\t\tthis.setState({ chooseActivityIndex: 0 })\r\n\t\t\t\tthis.propertyNode.props_empty_content.node.active = false\r\n\t\t\t\t// this.propertyNode.props_content.active = true\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleCallback(event: Event, customEventData: string) {\r\n\t\tconst chooseIndex = event.target['parent'].children.indexOf(event.target)\r\n\t\tthis.setState({\r\n\t\t\tchooseActivityIndex: chooseIndex\r\n\t\t})\r\n\t}\r\n\r\n\tprivate setToggleItemReadStatus(item: ActivityItem, isRead: boolean = true) {\r\n\t\tif (isRead) {\r\n\t\t\tthis.events.setReadStatus(item.id + '');\r\n\t\t} else {\r\n\t\t\tthis.events.deleteReadStatus(item.id + '');\r\n\t\t}\r\n\t\tconst itemNode = this.propertyNode.props_ToggleGroup.children.find(v => v.name === \"act_\" + item.id)\r\n\t\titemNode && (itemNode.getChildByName(\"unread\").active = !isRead);\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tsktMsgListener.remove(SKT_MAG_TYPE.TURNTABLEDATA, \"main\");\r\n\t\tthis.turntableViewModel = undefined;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n"]}