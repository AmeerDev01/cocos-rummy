{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thorV2/components/ThorV2_Roller.ts"],"names":["_decorator","Node","sp","Tween","tween","UITransform","Vec3","BaseComponent","config","cacheData","playThorAnimation","GameModeType","GameType","IconId","mainViewModel","thorv2_Audio","SoundPathDefine","ccclass","property","TWEEN_ICON_TAG","SingleRollerStatus","ThorV2_Roller","lastIndex","showIconCount","normalRollOption","stopIconIndex","columnIndex","iconPool","iconRollerQueue","isRoll","iconArr","rollOverCallback","bigNode","rollerLaunchResult","sendBetTime","isSpeed","singleRollerStatus","CLEAN","cleanAllIconOverCallback","props_shandian_iconSk","waitPlayAnimationIcon","isWaitAddIcon","propertyNode","props_icon_list","props_big_icon","props_number","props_shandian_icon","props","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","positionId","gameModeType","events","onCheckNextLeftCount","start","initState","initSlot","setIconRollerQueue","Math","floor","random","length","initColumn","buyToWin","isMainGame","rateIconRollerQueue","iconCount","i","joinIcon","isSubGame1","SUBGAME1","getIntervalHeight","gameType","undefined","subGameRollOption","intervalHeight1","SUBGAME2","intervalHeight2","intervalHeight","iconId","iconConfig","icon","find","v","id","ODDS_ICON_GREEN","ODDS_ICON_RED","SCATTER","getIcon","position","getRollerPaddingBottom","getHeight","y","getIconContainerAnchorPos","lastNode","getPosition","getNode","setPosition","push","newIcon","setWidth","getSingleRollerWidth","geticonBirthPos","calIndexDiff","index1","index2","diff","bindEvent","setCompleteListener","node","active","clearTracks","useProps","key","value","isValid","changeRollerHeight","hideIconWin","resetFaceAnimationNodeOrOdds","destroy","removeAllChildren","startRoll","done","unscheduleAllCallbacks","hideScatterAnimation","clearAllIconHandle","stopRoll","isSpeedBorder","subLastJoinIconIndex","WAIT","fillIconData","addIconHandle","type","clearAllIcon","addIcon","rollOverHandle","clearAfterFillIconHandle","playOneShot","SINGLE_ICON_FALL","emptyStartIndex","getFirstEmptyIconIndex","notEmptyCount","element","addIconCount","addNewIcon","getOdds","index","rates","dl","si","otherGameAttributesVo","itemId","odds","speed","ADD","stopIndex","newValue","bindUI","getComponent","Skeleton","isWinIcon","wp","winningPosition","values","iconIndexs","getId","isWinWild","WILD","buildSkeleton","parentNode","pos","filter","forEach","clearIcon","indexs","roundIndex","timeScale","iconTimeScaleSpeed","iconTimeScaleCommon","count","playWin","playScatterAnimation","scatterIcons","isScatterIcon","time","scheduleOnce","getIconDropTime","iconDropTime","getIconPosByIndex","height","singleRollerHeight","halfHeight","paddingBottom","interval","iconListUI","anchorY","rollerHeight","rollerWidth","rollerWidth0","rollerWidth5","uiTransform","width","rollerPaddingBottom","isDelay","stopAllByTag","columnDelayTime","icons","dropIcon","startIndex","fillIndexs","fillIcons","j","executeOver","fillIndex","nextIndex","iconObj","isOddsIcon","oddsValue","setOddsIcon","WILD_SHOW","setIconIndex","deleteWaitPlayAnimationIcon","SCATTER_SHOW","playLabelRate","splice","dispatch","Date","now","orderIndex","curIndex","nextindex","rowDelayTime","delayTime","getIconHidePos","dropTime","playLightning","opts","tw","tag","delay","to","x","easing","call","restore","startPos","playAmount","amount","middleIndex","indexsTemp","map","leftIndex","rightIndex","getMiddleOrder","middleColumnIndex","columnCount","order","abs","isIconType","endPos","isLightningIcon","an","ODDS_ICON_BLUE","ODDS_ICON_PURPLE","lightningDetryShowTime","setPlayLightning","playLightningAnimation","topNode","comp","getTopNode","addChild","worldPos","toWorldSpaceAR","toNodeSpaceAR","setAnimation","parent","convertToNodeSpaceAR","convertToWorldSpaceAR","playOddsAnimation","totalCount","playOddsIcon","getOddsLabelNodes","labelNodes","playLabelAnimation","singleRollerWidth","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, ITweenOption, Node, sp, Tween, tween, UITransform, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport config from '../config';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { IconPool } from '../IconPool';\r\nimport { playThorAnimation } from '../store/actions/game';\r\nimport { GameModeType, GameType, GameTypeInfo, IconId, RollerLaunchResult } from '../type';\r\nimport { ThorV2Icon } from './ThorV2_Icon';\r\nimport { mainViewModel, thorv2_Audio } from '../index';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/** 选择的线id */\r\n\tpositionId: number,\r\n\tgameModeType: GameModeType,\r\n}\r\nexport interface IEvent {\r\n\tonCheckNextLeftCount: () => void\r\n}\r\n\r\nconst TWEEN_ICON_TAG = 1;\r\n\r\nenum SingleRollerStatus {\r\n\t/**清理 */\r\n\tCLEAN,\r\n\t/**等待 */\r\n\tWAIT,\r\n\t/**添加 */\r\n\tADD,\r\n\t/**开奖 */\r\n\tOPEN,\r\n}\r\n\r\n@ccclass('ThorV2_Roller')\r\nexport class ThorV2_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = config.normalRollOption.showIconCount;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = -1;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**是否正在滚动 */\r\n\tprivate isRoll = false;\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: ThorV2Icon[] = [];\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**大图标 */\r\n\tprivate bigNode: Node;\r\n\tprivate rollerLaunchResult: RollerLaunchResult;\r\n\tprivate sendBetTime = 0;\r\n\r\n\t/**是否加速 */\r\n\tprivate isSpeed = false;\r\n\tprivate singleRollerStatus: SingleRollerStatus = SingleRollerStatus.CLEAN;\r\n\r\n\tprivate cleanAllIconOverCallback;\r\n\tprivate props_shandian_iconSk: sp.Skeleton;\r\n\r\n\t/**待播放动画的图标 */\r\n\tprivate waitPlayAnimationIcon: number[] = [];\r\n\r\n\tprivate isWaitAddIcon = false;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t\tprops_big_icon: new Node(),\r\n\t\tprops_number: new Node(),\r\n\t\tprops_shandian_icon: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\tpositionId: 0,\r\n\t\tgameModeType: null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonCheckNextLeftCount: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, iconPool: IconPool) {\r\n\t\tthis.iconPool = iconPool;\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.setIconRollerQueue();\r\n\t\tthis.lastIndex = Math.floor(Math.random() * this.iconRollerQueue.length);\r\n\r\n\t\tthis.initColumn(this.showIconCount);\r\n\t}\r\n\r\n\tprivate setIconRollerQueue() {\r\n\t\tif (this.columnIndex === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameModeType === GameModeType.buyToWin && this.isMainGame()) {\r\n\t\t\tthis.iconRollerQueue = config.rateIconRollerQueue[this.columnIndex]\r\n\t\t} else {\r\n\t\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\tprivate isMainGame() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t}\r\n\r\n\tprivate getIntervalHeight(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight1\r\n\t\t} else if (gameType === GameType.SUBGAME2) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight2;\r\n\t\t}\r\n\t\treturn config.normalRollOption.intervalHeight;\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\t// 初始化时不加入倍率图标\r\n\t\tif ((iconConfig.id >= IconId.ODDS_ICON_GREEN && iconConfig.id <= IconId.ODDS_ICON_RED) || iconConfig.id === IconId.SCATTER) {\r\n\t\t\treturn this.joinIcon();\r\n\t\t}\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tconst position = new Vec3(0, this.getRollerPaddingBottom() + icon.getHeight() / 2);\r\n\t\tposition.y -= this.getIconContainerAnchorPos();\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.getIntervalHeight();\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\r\n\t\t// this.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**创建新的图标 */\r\n\tprivate newIcon() {\r\n\t\tthis.lastIndex = this.lastIndex + 1 >= this.iconRollerQueue.length ? 0 : ++this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\ticon.setWidth(this.getSingleRollerWidth());\r\n\t\tconst position = this.geticonBirthPos();\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\treturn icon\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.props_shandian_iconSk.setCompleteListener(() => {\r\n\t\t\tthis.props_shandian_iconSk.node.active = false;\r\n\t\t\tthis.props_shandian_iconSk.clearTracks();\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'gameTypeInfo') {\r\n\t\t\t\tthis.changeRollerHeight(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t} else if (key === 'gameModeType') {\r\n\t\t\t\tthis.setIconRollerQueue();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.resetFaceAnimationNodeOrOdds();\r\n\t\tthis.bigNode && this.bigNode.destroy();\r\n\t\tthis.bigNode = null;\r\n\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll(isSpeed, done) {\r\n\t\tthis.cleanAllIconOverCallback = done;\r\n\t\tthis.singleRollerStatus = SingleRollerStatus.CLEAN\r\n\r\n\t\tthis.setIconRollerQueue();\r\n\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.waitPlayAnimationIcon = [];\r\n\t\tthis.hideIconWin();\r\n\t\tthis.hideScatterAnimation();\r\n\t\tthis.stopIconIndex = -1;\r\n\t\tthis.isSpeed = isSpeed;\r\n\t\tthis.isRoll = true;\r\n\r\n\t\tthis.clearAllIconHandle(1);\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, isSpeedBorder: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\tthis.rollerLaunchResult = rollerLaunchResult;\r\n\t\tthis.sendBetTime = cacheData.sendBetTime;\r\n\t\tthis.subLastJoinIconIndex(stopIconIndex, 1);\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\r\n\t\t// console.log(\"roller stop time \" + this.sendBetTime, \"singleRollerStatus\", this.singleRollerStatus);\r\n\t\tif (this.singleRollerStatus === SingleRollerStatus.WAIT) {\r\n\t\t\tthis.fillIconData();\r\n\t\t\tthis.addIconHandle();\r\n\t\t} else {\r\n\t\t\tthis.isWaitAddIcon = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**清理所有图标处理 */\r\n\tprivate clearAllIconHandle(type) {\r\n\t\t// console.log(`clearAllIconHandle start columnIndex:${this.columnIndex} singleRollerStatus:${this.singleRollerStatus}`)\r\n\t\tthis.clearAllIcon(!this.isSpeed, () => {\r\n\t\t\t// console.log(`clearAllIconHandle  end columnIndex:${this.columnIndex} singleRollerStatus:${this.singleRollerStatus} type:${type}`)\r\n\t\t\tthis.singleRollerStatus = SingleRollerStatus.WAIT;\r\n\r\n\t\t\tthis.cleanAllIconOverCallback && this.cleanAllIconOverCallback()\r\n\t\t\tthis.cleanAllIconOverCallback = null;\r\n\t\t})\r\n\t}\r\n\r\n\tprivate addIconHandle() {\r\n\t\tthis.addIcon(() => {\r\n\t\t\tthis.rollOverHandle(this.rollerLaunchResult);\r\n\t\t})\r\n\t}\r\n\r\n\t/**消除后补充图标 */\r\n\tpublic clearAfterFillIconHandle(done) {\r\n\t\tthis.fillIconData();\r\n\r\n\t\tthis.addIcon(() => {\r\n\t\t\tdone && done();\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.SINGLE_ICON_FALL)\r\n\t\t});\r\n\t}\r\n\r\n\t/**填充图标数据，未掉落到插槽 */\r\n\tprivate fillIconData() {\r\n\t\tconst emptyStartIndex = this.getFirstEmptyIconIndex();\r\n\r\n\t\t// 计算从空图标位置之后有几个非空图标\r\n\t\tlet notEmptyCount = 0;\r\n\t\tfor (let i = emptyStartIndex + 1; i < this.iconArr.length; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element) {\r\n\t\t\t\tnotEmptyCount++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// console.log(`fillIconData columnIndex:${this.columnIndex}, emptyStartIndex:${emptyStartIndex}, notEmptyCount:${notEmptyCount}`)\r\n\r\n\t\tconst addIconCount = this.showIconCount - this.getFirstEmptyIconIndex()\r\n\t\tif (addIconCount > notEmptyCount) {\r\n\t\t\tfor (let i = 0; i < addIconCount - notEmptyCount; i++) {\r\n\t\t\t\tthis.addNewIcon();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getOdds(index: number, id: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (!rollerLaunchResult) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tconst rates = rollerLaunchResult.dl.si[0].otherGameAttributesVo.rates;\r\n\t\tfor (let i = 0; i < rates.length; i++) {\r\n\t\t\tconst v = rates[i];\r\n\t\t\tconst itemId = v[2];\r\n\t\t\tif (this.columnIndex === v[0] && itemId === id) {\r\n\t\t\t\tconst odds = v[3] + 'X';\r\n\t\t\t\treturn odds;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\t/**加速 */\r\n\tpublic speed() {\r\n\t\tif (this.isSpeed) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// console.log(`speed ===========================`)\r\n\t\tthis.isSpeed = true;\r\n\t\tif (this.singleRollerStatus === SingleRollerStatus.CLEAN) {\r\n\t\t\tthis.clearAllIconHandle(2);\r\n\t\t} else if (this.singleRollerStatus === SingleRollerStatus.ADD) {\r\n\t\t\tthis.addIconHandle();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate subLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tif (stopIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet newValue = stopIndex - value;\r\n\t\tif (newValue < 0) {\r\n\t\t\tnewValue = this.iconRollerQueue.length + newValue;\r\n\t\t}\r\n\t\tthis.lastIndex = newValue;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.props_shandian_iconSk = this.propertyNode.props_shandian_icon.getComponent(sp.Skeleton);\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tprivate isWinIcon(index: number, rollerLaunchResult: RollerLaunchResult, iconId: IconId = undefined) {\r\n\t\tconst wp = rollerLaunchResult.dl.si[0].winningPosition\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\tif (iconId) {\r\n\t\t\t\t\treturn this.iconArr[index].getId() === iconId;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否有中奖图标wild */\r\n\tpublic isWinWild() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (this.isWinIcon(i, this.rollerLaunchResult, IconId.WILD)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate buildSkeleton(parentNode: Node, pos: Vec3, iconCount: number) {\r\n\t\t// const fileName = iconCount === 2 ? PrefabPathDefine.TWO_ICON : PrefabPathDefine.THREE_ICON;\r\n\t\t// this.bigNode = instantiate(sourceManageSeletor().getFile(fileName).source);\r\n\t\t// this.bigNode.name = \"bigNode-\" + iconCount;\r\n\t\t// parentNode.addChild(this.bigNode);\r\n\t\t// this.bigNode.setWorldPosition(pos);\r\n\r\n\t\t// this.bigNode.setScale(new Vec3(1, this.getBigNodeScaleY(iconCount)))\r\n\t}\r\n\r\n\t/**还原倍率图标和scatter图标 */\r\n\tpublic resetFaceAnimationNodeOrOdds() {\r\n\t\tthis.iconArr.filter(v => v).forEach(v => v.resetFaceAnimationNodeOrOdds());\r\n\t}\r\n\r\n\tprivate hideScatterAnimation() {\r\n\t\t// this.iconArr.filter(v => v.getId() === IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**消除图标 */\r\n\tpublic clearIcon(indexs: number[], roundIndex: number, done) {\r\n\t\tconst timeScale = this.isSpeed ? config.iconTimeScaleSpeed : config.iconTimeScaleCommon;\r\n\t\tif (this.node.isValid) {\r\n\t\t\tlet count = 0;\r\n\t\t\tindexs.forEach(index => {\r\n\t\t\t\tconst icon = this.iconArr[index];\r\n\t\t\t\ticon.playWin(this.propertyNode.props_big_icon, roundIndex, timeScale, true, false, () => {\r\n\t\t\t\t\tthis.iconArr[index] = null;\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tif (count >= indexs.length) {\r\n\t\t\t\t\t\tdone && done();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放scatter的动画，然后进入小游戏弹窗 */\r\n\tpublic playScatterAnimation(done) {\r\n\t\tconst scatterIcons: ThorV2Icon[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst icon = this.iconArr[i];\r\n\t\t\tif (icon && icon.isScatterIcon()) {\r\n\t\t\t\tscatterIcons.push(icon);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (scatterIcons.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst timeScale = this.isSpeed ? config.iconTimeScaleSpeed : config.iconTimeScaleCommon;\r\n\t\tlet count = 0;\r\n\t\tscatterIcons.forEach(icon => {\r\n\t\t\ticon.playWin(this.propertyNode.props_big_icon, 0, timeScale, false, false, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= scatterIcons.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tprivate rollOverHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// console.log(\"roller over handle stop time \" + this.sendBetTime, this.columnIndex);\r\n\t\tthis.isRoll = false;\r\n\t\tthis.stopIconIndex = -1;\r\n\r\n\t\t// if (this.isSpeed) {\r\n\t\t// \tthorv2_Audio.playOneShot(SoundPathDefine.QUICK_STOP)\r\n\t\t// } else {\r\n\t\t// \tthorv2_Audio.playOneShot(SoundPathDefine.DROP_BOTTOM)\r\n\t\t// }\r\n\r\n\t\t// 滚动停止之后需要延迟的时间\r\n\t\tconst time = 0.05;\r\n\t\tthis.events.onCheckNextLeftCount();\r\n\t\t// const time = 0.05;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, time)\r\n\r\n\t}\r\n\r\n\tprivate getIconDropTime() {\r\n\t\treturn config.normalRollOption.iconDropTime;\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst halfHeight = height / 2;\r\n\t\tconst paddingBottom = this.getRollerPaddingBottom(gameType)\r\n\t\tlet y = 0;\r\n\t\tif (index === 0) {\r\n\t\t\t// 第一个图标的坐标位置 = 下边距 + icon高度的一半\r\n\t\t\ty = paddingBottom + halfHeight;\r\n\t\t} else {\r\n\t\t\t// 从第二开始的坐标 = 下边距 + icon高度的一半 + 图标间隔个数 + icon高度个数\r\n\t\t\tconst interval = this.getIntervalHeight(gameType) * index\r\n\t\t\ty = paddingBottom + halfHeight + interval + height * index;\r\n\t\t}\r\n\r\n\t\tif (index >= this.showIconCount) {\r\n\t\t\ty += 20;\r\n\t\t}\r\n\r\n\t\ty -= this.getIconContainerAnchorPos();\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得图标容器锚点的起始位置 */\r\n\tprivate getIconContainerAnchorPos() {\r\n\t\tconst iconListUI = this.propertyNode.props_icon_list.getComponent(UITransform)\r\n\t\treturn iconListUI.height * iconListUI.anchorY\r\n\t}\r\n\r\n\tpublic changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tlet rollerWidth = config.normalRollOption.rollerWidth;\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight;\r\n\t\t\trollerWidth = config.subGameRollOption.rollerWidth;\r\n\t\t}\r\n\r\n\t\tif (this.columnIndex === 0) {\r\n\t\t\trollerWidth = config.normalRollOption.rollerWidth0;\r\n\t\t} else if (this.columnIndex === 5) {\r\n\t\t\trollerWidth = config.normalRollOption.rollerWidth5;\r\n\t\t}\r\n\t\tconst uiTransform = this.propertyNode.props_icon_list.getComponent(UITransform);\r\n\t\tuiTransform.height = rollerHeight;\r\n\t\tuiTransform.width = rollerWidth;\r\n\t}\r\n\r\n\tprivate getRollerPaddingBottom(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.rollerPaddingBottom;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerPaddingBottom;\r\n\t}\r\n\r\n\t/**清空所有图标 */\r\n\tprivate clearAllIcon(isDelay: boolean, done) {\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tTween.stopAllByTag(TWEEN_ICON_TAG);\r\n\t\tconst columnDelayTime = isDelay ? this.columnIndex * 0.01 : 0;\r\n\t\tlet count = 0;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tconst icons = this.iconArr.filter(v => v);\r\n\t\t\tthis.iconArr.forEach((v, i) => {\r\n\t\t\t\tif (v) {\r\n\t\t\t\t\tthis.dropIcon(i, v, i, -1, () => {\r\n\t\t\t\t\t\tthis.iconArr[i] = null;\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\tif (count >= icons.length) {\r\n\t\t\t\t\t\t\tdone && done();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, isDelay)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}, columnDelayTime)\r\n\t}\r\n\r\n\tprivate addIcon(done) {\r\n\t\tconst isDelay = !this.isSpeed;\r\n\t\tlet startIndex = this.getFirstEmptyIconIndex();\r\n\t\tif (startIndex === -1) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tTween.stopAllByTag(TWEEN_ICON_TAG);\r\n\r\n\t\t// 需要填充的索引\r\n\t\tconst fillIndexs = [];\r\n\t\tconst fillIcons = [];\r\n\r\n\t\tfor (let i = startIndex; i < this.showIconCount; i++) {\r\n\t\t\tfillIndexs.push(i);\r\n\r\n\t\t\tfor (let j = startIndex + 1; j < this.iconArr.length; j++) {\r\n\t\t\t\tconst element = this.iconArr[j];\r\n\t\t\t\tif (element && !fillIcons.find(v => v.index === j)) {\r\n\t\t\t\t\tfillIcons.push({\r\n\t\t\t\t\t\ticon: element,\r\n\t\t\t\t\t\tindex: j\r\n\t\t\t\t\t})\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst time = isDelay ? this.columnIndex * 0.05 : 0;\r\n\t\tlet count = 0;\r\n\r\n\t\t/**所有动画播放结束之后的处理 */\r\n\t\tconst executeOver = () => {\r\n\t\t\tcount++;\r\n\t\t\tif (count >= fillIndexs.length) {\r\n\t\t\t\tdone && done();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tfillIndexs.forEach((fillIndex, i) => {\r\n\t\t\t\tconst nextIndex = fillIndex;\r\n\t\t\t\tconst { icon, index } = fillIcons[i];\r\n\r\n\t\t\t\tconst iconObj = icon as ThorV2Icon;\r\n\r\n\t\t\t\tif (iconObj.isOddsIcon()) {\r\n\t\t\t\t\tconst oddsValue = this.getOdds(nextIndex, iconObj.getId(), this.rollerLaunchResult);\r\n\t\t\t\t\tif (oddsValue) {\r\n\t\t\t\t\t\ticonObj.setOddsIcon(oddsValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.WILD_SHOW);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// console.log(`addIcon index:${index} nextIndex:${nextIndex}`);\r\n\t\t\t\tthis.dropIcon(i, iconObj, index, nextIndex, () => {\r\n\t\t\t\t\tthis.iconArr[index] = null;\r\n\t\t\t\t\tthis.iconArr[nextIndex] = iconObj;\r\n\t\t\t\t\ticonObj.setIconIndex(nextIndex);\r\n\t\t\t\t\tif (this.deleteWaitPlayAnimationIcon(iconObj.getId())) {\r\n\t\t\t\t\t\tif (iconObj.isScatterIcon()) {\r\n\t\t\t\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.SCATTER_SHOW)\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ticonObj.playWin(this.propertyNode.props_big_icon, 0, 1, false, false);\r\n\t\t\t\t\t\ticonObj.playLabelRate(this.propertyNode.props_number);\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\texecuteOver();\r\n\t\t\t\t\t\t}, 0.2)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\texecuteOver();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, isDelay);\r\n\t\t\t});\r\n\t\t}, time)\r\n\t}\r\n\r\n\tprivate deleteWaitPlayAnimationIcon(id: number) {\r\n\t\tfor (let i = 0; i < this.waitPlayAnimationIcon.length; i++) {\r\n\t\t\tconst element = this.waitPlayAnimationIcon[i];\r\n\t\t\tif (element === id) {\r\n\t\t\t\tthis.waitPlayAnimationIcon.splice(i, 1);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate addNewIcon() {\r\n\t\tlet index = -1;\r\n\t\tconst newIcon = this.newIcon();\r\n\t\tfor (let i = this.showIconCount; i < this.iconArr.length; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (!element) {\r\n\t\t\t\tthis.iconArr[i] = newIcon;\r\n\t\t\t\tindex = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (index === -1) {\r\n\t\t\tthis.iconArr.push(newIcon);\r\n\t\t\tindex = this.iconArr.length - 1;\r\n\t\t}\r\n\t\tnewIcon.setPosition(this.getIconPosByIndex(index));\r\n\t\tif (newIcon.isOddsIcon()) {\r\n\t\t\tthis.dispatch(playThorAnimation({\r\n\t\t\t\ttime: Date.now(),\r\n\t\t\t\ttimeScale: this.isSpeed ? config.iconTimeScaleSpeed : config.iconTimeScaleCommon\r\n\t\t\t}));\r\n\r\n\t\t\tthis.waitPlayAnimationIcon.push(newIcon.getId())\r\n\t\t} else if (newIcon.isScatterIcon()) {\r\n\t\t\tthis.waitPlayAnimationIcon.push(newIcon.getId())\r\n\t\t}\r\n\t\treturn { icon: newIcon, index };\r\n\t}\r\n\r\n\t/**获得第一个空图标位置 */\r\n\tprivate getFirstEmptyIconIndex() {\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tif (!this.iconArr[i]) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * 掉落图标\r\n\t * @param icon \r\n\t * @param curIndex 图标当前位置\r\n\t * @param nextindex -1表示直接隐藏图标\r\n\t * @param done \r\n\t * @param isDelay \r\n\t */\r\n\tprivate dropIcon(orderIndex: number, icon: ThorV2Icon, curIndex: number, nextindex: number, done, isDelay: boolean = false) {\r\n\t\tconst rowDelayTime = orderIndex * 0.02;\r\n\t\tconst delayTime = isDelay ? this.columnIndex * 0.1 + rowDelayTime : 0;\r\n\t\tconst pos = nextindex === -1 ? this.getIconHidePos(icon.getPosition()) : this.getIconPosByIndex(nextindex);\r\n\r\n\t\tconst dropTime = this.getIconDropTime()\r\n\t\tif (icon.isOddsIcon() && nextindex >= 0) {\r\n\t\t\tthis.playLightning(pos, icon, delayTime + dropTime);\r\n\t\t}\r\n\r\n\t\tlet opts: ITweenOption = undefined;\r\n\t\tif (nextindex >= 0) {\r\n\t\t\t// opts = {\r\n\t\t\t// \teasing: 'backOut',\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tconst tw = tween(icon.getNode()).tag(TWEEN_ICON_TAG).delay(delayTime).to(dropTime, { position: new Vec3(pos.x, pos.y) }, opts)\r\n\r\n\t\tif (nextindex >= 0) {\r\n\t\t\t// tw.to(0.08, { position: new Vec3(pos.x, pos.y + 8, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\t// tw.to(0.05, { position: new Vec3(pos.x, pos.y, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t\ttw.to(0.05, { position: new Vec3(pos.x, pos.y - 25, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\ttw.to(0.05, { position: new Vec3(pos.x, pos.y, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t}\r\n\r\n\t\ttw.call(() => {\r\n\t\t\tif (nextindex === -1) {\r\n\t\t\t\ticon.restore();\r\n\t\t\t}\r\n\t\t\tdone && done();\r\n\t\t\t// console.log(`dropIcon icon:${icon.getId()} curIndex:${curIndex} nextindex:${nextindex},pos:${pos}`);\r\n\t\t}).start();\r\n\t}\r\n\r\n\t/**出生位置 */\r\n\tprivate geticonBirthPos() {\r\n\t\tlet y = this.getIconContainerAnchorPos() + config.normalRollOption.singleRollerHeight;\r\n\t\tlet pos = new Vec3();\r\n\t\tpos.y += y;\r\n\t\treturn pos\r\n\t}\r\n\r\n\t/**所有图标隐藏的位置 */\r\n\tprivate getIconHidePos(startPos: Vec3) {\r\n\t\t// let y = this.getIconContainerAnchorPos() + config.normalRollOption.singleRollerHeight;\r\n\t\tconst iconListUI = this.propertyNode.props_icon_list.getComponent(UITransform)\r\n\t\tlet pos = new Vec3(startPos.x, startPos.y);\r\n\t\tpos.y -= iconListUI.height;\r\n\t\treturn pos\r\n\t}\r\n\r\n\t/**播放数字 */\r\n\tpublic playAmount(indexs: number[], amount: number) {\r\n\t\t// console.log(`playAmount columnIndex:${this.columnIndex}, indexs ${indexs} amount:${amount}`)\r\n\t\tlet startIndex = 0;\r\n\t\tconst middleIndex = Math.floor(this.showIconCount / 2);\r\n\r\n\t\tconst indexsTemp = indexs.map(v => v + '');\r\n\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst leftIndex = middleIndex - startIndex;\r\n\t\t\tconst rightIndex = middleIndex + startIndex;\r\n\t\t\tif (leftIndex < 0 || rightIndex >= this.showIconCount) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (indexsTemp.find(v => v === leftIndex + '')) {\r\n\t\t\t\tthis.iconArr[leftIndex].playAmount(this.propertyNode.props_number, amount);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (indexsTemp.find(v => v === rightIndex + '')) {\r\n\t\t\t\tthis.iconArr[rightIndex].playAmount(this.propertyNode.props_number, amount);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tstartIndex++;\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得中间位置排序 */\r\n\tpublic getMiddleOrder(indexs: number[]) {\r\n\t\tif (indexs.length === 0) {\r\n\t\t\treturn 99;\r\n\t\t}\r\n\t\tconst middleColumnIndex = config.columnCount % 2 === 0 ? (config.columnCount - 1) / 2 : config.columnCount / 2;\r\n\t\tlet order = Math.abs(middleColumnIndex - this.columnIndex) * 5;\r\n\r\n\t\tlet startIndex = 0;\r\n\t\tconst middleIndex = Math.floor(this.showIconCount / 2);\r\n\t\tconst indexsTemp = indexs.map(v => v + '');\r\n\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst leftIndex = middleIndex - startIndex;\r\n\t\t\tconst rightIndex = middleIndex + startIndex;\r\n\r\n\t\t\tif (indexsTemp.find(v => v === leftIndex + '')) {\r\n\t\t\t\torder += startIndex;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (indexsTemp.find(v => v === rightIndex + '')) {\r\n\t\t\t\torder += startIndex;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tstartIndex++;\r\n\t\t}\r\n\t\t// console.log(`playAmount columnIndex:${this.columnIndex}, indexs ${indexs} order:${order}, middleColumnIndex:${middleColumnIndex}`)\r\n\t\treturn order;\r\n\t}\r\n\r\n\tpublic isIconType(index: number, iconId: number) {\r\n\t\treturn this.iconArr[index].getId() === iconId;\r\n\t}\r\n\r\n\t/**播放闪电 */\r\n\tpublic playLightning(endPos: Vec3, icon: ThorV2Icon, time: number) {\r\n\t\tif (icon.isLightningIcon()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet an = \"sd_red\";\r\n\t\tif (icon.getId() === IconId.ODDS_ICON_BLUE) {\r\n\t\t\tan = 'sd_blue';\r\n\t\t} else if (icon.getId() === IconId.ODDS_ICON_GREEN) {\r\n\t\t\tan = 'sd_green';\r\n\t\t} else if (icon.getId() === IconId.ODDS_ICON_PURPLE) {\r\n\t\t\tan = 'sd_purple';\r\n\t\t} else if (icon.getId() === IconId.ODDS_ICON_RED) {\r\n\t\t\tan = 'sd_red';\r\n\t\t}\r\n\t\ttime += config.normalRollOption.lightningDetryShowTime;\r\n\r\n\t\ticon.setPlayLightning(true)\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\t// this.props_shandian_iconSk.node.active = true;\r\n\t\t\t// this.props_shandian_iconSk.node.setPosition(endPos);\r\n\t\t\t// this.props_shandian_iconSk.setAnimation(0, an, false);\r\n\r\n\t\t\tthis.playLightningAnimation(an, endPos);\r\n\t\t}, time)\r\n\t}\r\n\r\n\tprivate playLightningAnimation(an: string, endPos: Vec3) {\r\n\t\tconst topNode = mainViewModel.comp.getTopNode();\r\n\r\n\t\tthis.props_shandian_iconSk.node.active = true;\r\n\t\tthis.props_shandian_iconSk.node.removeAllChildren();\r\n\r\n\t\ttopNode.addChild(this.props_shandian_iconSk.node);\r\n\r\n\t\tconst worldPos = this.toWorldSpaceAR(this.propertyNode.props_icon_list, endPos);\r\n\t\tendPos = this.toNodeSpaceAR(topNode, worldPos);\r\n\r\n\t\tthis.props_shandian_iconSk.node.setPosition(endPos);\r\n\t\tthis.props_shandian_iconSk.setAnimation(0, an, false);\r\n\t}\r\n\r\n\r\n\tprivate toNodeSpaceAR(parent: Node, pos) {\r\n\t\treturn parent.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(pos.x, pos.y));\r\n\t}\r\n\tprivate toWorldSpaceAR(parent: Node, pos) {\r\n\t\treturn parent.getComponent(UITransform).convertToWorldSpaceAR(new Vec3(pos.x, pos.y));\r\n\t}\r\n\r\n\t/**播放倍率节点 */\r\n\tpublic playOddsAnimation(done) {\r\n\t\tlet totalCount = 0;\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tif (this.iconArr[i].isOddsIcon()) {\r\n\t\t\t\ttotalCount++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (totalCount === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet count = 0;\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element.isOddsIcon()) {\r\n\t\t\t\telement.playOddsIcon(this.propertyNode.props_big_icon, () => {\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tif (count >= totalCount) {\r\n\t\t\t\t\t\tdone && done();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得所有的倍率节点 */\r\n\tpublic getOddsLabelNodes() {\r\n\t\tconst labelNodes: ThorV2Icon[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tif (this.iconArr[i].isOddsIcon()) {\r\n\t\t\t\tlabelNodes.push(this.iconArr[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn labelNodes;\r\n\t}\r\n\r\n\tpublic playLabelAnimation(parentNode: Node, endPos: Vec3, done) {\r\n\t\tconst labelNodes = this.getOddsLabelNodes();\r\n\t\tif (labelNodes.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getSingleRollerWidth() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN ?\r\n\t\t\tconfig.normalRollOption.singleRollerWidth : config.subGameRollOption.singleRollerWidth;\r\n\t}\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tthis.isRoll = false;\r\n\t\tthis.isWaitAddIcon = false;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isWaitAddIcon && this.singleRollerStatus === SingleRollerStatus.WAIT) {\r\n\t\t\tthis.isWaitAddIcon = false;\r\n\t\t\tthis.fillIconData();\r\n\t\t\tthis.addIconHandle();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}