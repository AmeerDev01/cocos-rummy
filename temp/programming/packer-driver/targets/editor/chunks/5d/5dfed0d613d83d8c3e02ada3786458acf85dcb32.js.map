{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/bandar/components/Bandar_gameBoard.ts"],"names":["_decorator","Game","game","Node","BaseComponent","gameCacheData","GameStatus","setMyWinLose","playBtnClick","playMyLose","playMyWin","mainGameViewModel","SKT_MAG_TYPE","sktInstance","bankerCardViewModel","betAreaViewModel","loseViewModel","userCardViewModel","winViewModel","TaskScheduler","Task","setNewBetDataAction","setWinAreaAction","ccclass","property","Bandar_gameBoard","taskScheduler","isShowGame","propertyNode","props_bandar_ternd","props","countDown","usersInfo","myInfo","myWinLose","gameStatus","initGameStatus","events","openHistoryPanel","openWinPanel","openLosePanel","sendGameShowEvent","start","initState","bindEvent","on","EVENT_HIDE","EVENT_SHOW","isUnMount","node","EventType","TOUCH_END","sendSktMessage","HISTORY","roomId","useProps","key","value","cur","joinqQueue","done","window","setTimeout","comp","updateWinsAndLosses","closePopup","dispatch","clearAllBetAreaGold","betAreaInfo","clear","STOP_BET","createUserCard","createBankerCard","time","undefined","unMount","initUsers","forEach","item","i","index","destroyCallBack","destoryQueue","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator,Game,game,Node } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { initToggle } from '../../../utils/tool';\r\nimport { countdown } from '../../yxx/store/actions/gameFlow';\r\nimport { gameCacheData, GameStatus, HeadType, MemberInfoVo } from '../type';\r\nimport { setGameStatusAction, setMyWinLose, setUsersInfoAction } from '../store/actions/game';\r\nimport { playBtnClick, playMyLose, playMyWin, mainGameViewModel } from '../index';\r\nimport { SKT_MAG_TYPE, sktInstance } from '../socketConnect';\r\nimport { bankerCardViewModel, betAreaViewModel, loseViewModel, userCardViewModel, winViewModel } from '../viewModel/BandarGameBoardViewModel';\r\nimport TaskScheduler, { Task } from '../../../utils/TaskScheduler';\r\nimport { setNewBetDataAction } from '../store/actions/bet';\r\nimport { setWinAreaAction } from '../store/actions/pokerDetail';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tcountDown:number,\r\n\tusersInfo:MemberInfoVo[],\r\n\tmyInfo:HeadType,\r\n\tmyWinLose:number,\r\n\tgameStatus: GameStatus,\r\n\t// initGameType:GameStatus,\r\n\tinitGameStatus:GameStatus\r\n}\r\nexport interface IEvent {\r\n\topenHistoryPanel:() => void,\r\n\topenWinPanel:() => void,\r\n\topenLosePanel: () => void,\r\n\tsendGameShowEvent: () => void,\r\n\t\r\n}\r\n\r\n\r\n@ccclass('Bandar_gameBoard')\r\nexport class Bandar_gameBoard extends BaseComponent<IState, IProps, IEvent> {\r\n\t// private usersInfo:MemberInfoVo[]=gameCacheData.leftUsers.concat(gameCacheData.rightUsers)\r\n\tprivate taskScheduler=new TaskScheduler()\r\n\tpublic isShowGame:boolean=true;\r\n\tstart() {\r\n\t\t\r\n\t }\r\n\r\n\tprotected propertyNode = {\r\n\t\t/** 打开历史记录 */\r\n\t\tprops_bandar_ternd:new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tcountDown:0,\r\n\t\tusersInfo:[] ,\r\n\t\tmyInfo:null,\r\n\t\tmyWinLose:0,\r\n\t\tgameStatus: null,\r\n\t\tinitGameStatus:null,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\topenHistoryPanel: () => { },\r\n\t\topenWinPanel: () => { },\r\n\t\topenLosePanel: () => { },\r\n\t\tsendGameShowEvent: () => { },\r\n\r\n\t\t\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tgame.on(Game.EVENT_HIDE,()=>{//游戏切入后台\r\n          this.isShowGame=false\r\n        })\r\n        game.on(Game.EVENT_SHOW,()=>{//游戏进入\r\n\t\t\tthis.isShowGame = true;\r\n\t\t\tif (!mainGameViewModel.isUnMount) {\r\n\t\t\t\tif (this.node) {\r\n\t\t\t\t\tthis.events.sendGameShowEvent();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n        })\r\n\r\n\t  this.propertyNode.props_bandar_ternd.on(Node.EventType.TOUCH_END,()=>{\r\n\t\t playBtnClick();\r\n\t\t sktInstance.sendSktMessage(SKT_MAG_TYPE.HISTORY,gameCacheData.roomId)\r\n         this.events.openHistoryPanel()\r\n\t  })\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n       if(key===\"usersInfo\"){\r\n\r\n\t   }\r\n\t   if(key===\"myWinLose\"){\r\n\t\t\tif(value.cur===0){ return }\r\n\t\t\tthis.taskScheduler.joinqQueue(new Task((done)=>{\r\n\r\n\t\t\t\twindow.setTimeout(()=>{\r\n\t\t\t\t\tif(value.cur===1){\r\n\t\t\t\t\t\tplayMyWin()\r\n\t\t\t\t\t\tthis.events.openWinPanel()\r\n\t\t\t\t\t\tlet myInfo=this.props.myInfo\r\n\t\t\t\t\t\twinViewModel.comp.updateWinsAndLosses(myInfo)\r\n\t\t\t\t\t\t// console.log(\"this.props.myInfo\",this.props.myInfo);\r\n\t\t\t\t\t\tthis.closePopup()\r\n\t\t\t\t\t}else if(value.cur===2){\r\n\t\t\t\t\t\tplayMyLose()\r\n\t\t\t\t\t\tthis.events.openLosePanel()\r\n\t\t\t\t\t\tlet myInfo=this.props.myInfo\r\n\t\t\t\t\t\tloseViewModel.comp.updateWinsAndLosses(myInfo)\r\n\t\t\t\t\t\t// console.log(\"this.props.myInfo\",this.props.myInfo);\r\n\t\t\t\t\t\tthis.closePopup()\r\n\t\t\t\t\t}\r\n\t\t\t\t},2000)\r\n\t\t\t\twindow.setTimeout(()=>done(),1000)\r\n\t\t\t}),false).joinqQueue(new Task((done)=>{\r\n\t\t\t\tthis.dispatch(setMyWinLose(0))\r\n\t\t\t\twindow.setTimeout(()=>done(),1000)\r\n\t\t\t}),false)\r\n\t\t\t\r\n\t   }\r\n       \r\n\t\tif (key === \"initGameStatus\") {\r\n\t\t\t// console.log(\"initGameStatus\",value.cur);\r\n\t\t\t\r\n\t\t\tthis.dispatch(setNewBetDataAction(null));\r\n\t\t\tthis.dispatch(setWinAreaAction(null));\r\n            betAreaViewModel.comp.clearAllBetAreaGold();\r\n\t\t\tbetAreaViewModel.comp.betAreaInfo.clear();\r\n\t\t\tif (value.cur === GameStatus.STOP_BET) {\r\n\t\t\t\tuserCardViewModel.comp.createUserCard();\r\n\t\t\t\tbankerCardViewModel.comp.createBankerCard();\r\n\t\t    }\r\n\t   }\r\n\t}\r\n\r\n /**自动关闭输赢结算弹窗*/\r\n protected closePopup(){\r\n    if(!mainGameViewModel.isUnMount){\r\n      //五秒后自动关闭结算弹框\r\n    //   let time:number=this.initSeconds*1000\r\n\tlet time:number=3*1000\r\n      window.setTimeout(()=>{\r\n          // this.init()\r\n          if(winViewModel!=undefined){\r\n            if(!winViewModel.isUnMount){\r\n                winViewModel.unMount()\r\n            }\r\n          }\r\n          if(loseViewModel!=undefined){\r\n            if(!loseViewModel.isUnMount){\r\n              loseViewModel.unMount()\r\n            }\r\n          }\r\n      },time) \r\n\t  betAreaViewModel.comp.clearAllBetAreaGold()\r\n    }                \r\n  }  \r\n\r\n    /**\r\n\t * 初始化上榜用户的数据\r\n\t */\r\n\tpublic initUsers(usersInfo:MemberInfoVo[]){\r\n       usersInfo.forEach((item,i)=>{\r\n\t\t  item.index=i\r\n\t   })\r\n\r\n\t}\r\n\tprotected destroyCallBack(): void {\r\n\t\tthis.taskScheduler.destoryQueue();\r\n\t}\r\n\r\n\r\n\tprotected bindUI(): void {\r\n\t   \r\n\t\t\t\t\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}