{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/utils/skills/SkillItemLine.ts"],"names":["SkillItemLine","UITransform","Vec2","Vec3","createAnimationNode","toNodeSpaceAR","atan","Math","sqrt","pow","pi","PI","lineZOrder","constructor","sourceManage","info","textureConfig","rootNode","uiRoot","init","runLine","srcConfig","src_id","parent","getComponent","setAnchorPoint","setSiblingIndex","children","length","setPosAndRotate","getSideByPos","pos1","pos2","side","sp","x","y","getAngleByPos","angle","k","setPosition","size","pos_dis","width","setScale","destroy"],"mappings":"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","sourcesContent":["import { Node, Sprite, UITransform, Vec2, Vec3 } from \"cc\"\r\nimport { addAnimation, createAnimationNode, toNodeSpaceAR } from \"../../FishTool\"\r\nimport SourceManage from \"../../../../base/SourceManage\"\r\n\r\n\r\n/**\r\n连线技能项\r\n */\r\nlet atan = Math.atan\r\nlet sqrt = Math.sqrt\r\nlet pow = Math.pow\r\nlet pi = Math.PI\r\n\r\nlet lineZOrder = 750000\r\n\r\nexport class SkillItemLine {\r\n  private uiRoot: Node;\r\n  private sourceManage: SourceManage;\r\n  private rootNode: Node\r\n\r\n  constructor(sourceManage: SourceManage, info, textureConfig, rootNode: Node) {\r\n    this.sourceManage = sourceManage;\r\n    this.rootNode = rootNode;\r\n    this.init(info, textureConfig)\r\n  }\r\n\r\n  public init(info, textureConfig) {\r\n    this.runLine(info, textureConfig)\r\n  }\r\n\r\n  public runLine(info, textureConfig) {\r\n    let srcConfig = textureConfig[info.src_id]\r\n\r\n    if (srcConfig) {\r\n      this.uiRoot = createAnimationNode(this.sourceManage, info.parent, srcConfig, true, true)\r\n      this.uiRoot.getComponent(UITransform).setAnchorPoint(new Vec2(0, 0.5))\r\n      this.uiRoot.setSiblingIndex(this.uiRoot.parent.children.length);\r\n      this.setPosAndRotate(info)\r\n    }\r\n  }\r\n\r\n\r\n  public getSideByPos(pos1: Vec3, pos2: Vec3) {\r\n    let side = 0\r\n\r\n    // let sp = { x = pos2.x - pos1.x, y = pos2.y - pos1.y, }\r\n    let sp = new Vec3(pos2.x - pos1.x, pos2.y - pos1.y);\r\n\r\n    if (sp.x >= 0 && sp.y >= 0) {\r\n      side = 1\r\n    } else if (sp.x >= 0 && sp.y <= 0) {\r\n      side = 4\r\n    } else if (sp.x <= 0 && sp.y >= 0) {\r\n      side = 2\r\n    } else if (sp.x <= 0 && sp.y <= 0) {\r\n      side = 3\r\n    }\r\n\r\n    return side\r\n  }\r\n\r\n  public getAngleByPos(pos1: Vec3, pos2: Vec3) {\r\n    let angle = 0\r\n    let side = this.getSideByPos(pos1, pos2)\r\n\r\n    if (pos1.x == pos2.x) {\r\n      if (side == 1) {\r\n        angle = 90\r\n      } else if (side == 4) {\r\n        angle = 270\r\n      } else if (side == 2) {\r\n        angle = 90\r\n      } else if (side == 3) {\r\n        angle = 270\r\n      }\r\n    } else {\r\n      let k = (pos1.y - pos2.y) / (pos1.x - pos2.x)\r\n      angle = atan(k) * 180 / pi\r\n\r\n      if (side == 1 && angle <= 0) {\r\n        angle = -angle\r\n      } else if (side == 2 && angle < 0) {\r\n        angle = 180 + angle\r\n      } else if (side == 3 && angle > 0) {\r\n        angle = 180 + angle\r\n      } else if (side == 3 && angle <= 0) {\r\n        angle = 180 - angle\r\n      } else if (side == 4 && angle <= 0) {\r\n        angle = 2 * 180 + angle\r\n      }\r\n    }\r\n\r\n    return angle\r\n  }\r\n\r\n  public setPosAndRotate(info) {\r\n    // this.uiRoot.setWorldPosition(new Vec3(info.pos1.x, info.pos1.y))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, info.pos1))\r\n\r\n    let size = this.uiRoot.getComponent(UITransform)\r\n    // 计算两点间的距离\r\n    let pos_dis = sqrt(pow(info.pos1.x - info.pos2.x, 2) + pow(info.pos1.y - info.pos2.y, 2))\r\n    if (pos_dis > size.width) {\r\n      this.uiRoot.setScale(new Vec3(pos_dis / size.width, 1))\r\n    }\r\n\r\n    // 计算连线的角度，也就是两点间的夹角\r\n    let angle = this.getAngleByPos(info.pos1, info.pos2)\r\n    // this.uiRoot.angle = 360 - angle;\r\n    this.uiRoot.angle = angle;\r\n  }\r\n\r\n  public destroy() {\r\n    this.uiRoot.destroy();\r\n    this.sourceManage = null;\r\n  }\r\n}\r\n\r\n\r\n"]}