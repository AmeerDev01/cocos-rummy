{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenixV2/components/PhoenixV2_Roller.ts"],"names":["_decorator","Node","tween","UITransform","Vec3","BaseComponent","config","calBetAmount","GameType","getColumnLockIconArr","IconId","mainViewModel","phoenixV2_Audio","getNodeByNameDeep","SoundPathDefine","cacheData","ccclass","property","PhoenixV2_Roller","lastIndex","showIconCount","normalRollOption","stopIconIndex","columnIndex","iconPool","iconRollerQueue","isRoll","iconArr","rollOverCallback","isSpeedBorder","props_column_effect_node","iconAnimationNode","props_lock_icon_list","speddBorderNode","isMergeIcon","lockIcons","singleIconRollerViewModels","rollerCount","bigNode","rollerLaunchResult","sendBetTime","propertyNode","props_icon_list","props_big_icon","props","gameTypeInfo","lastGameType","NONE","viewGameType","currGameType","leftCount","positionId","chooseSmallGame","events","start","initState","setColumnEffectNode","getChildByName","comp","getBorderNode","initSlot","Math","floor","random","length","initColumn","isSubGame2","addLockIcon","replaceSingleRollerIcon","iconCount","i","joinIcon","SUBGAME2","isSubGame1","SUBGAME1","addIconIndex","index","value","newValue","isSubGame1SpecialIcon","id","BEETLE","WILD","getIntervalHeight","gameType","undefined","subGameRollOption","intervalHeight1","intervalHeight2","intervalHeight","iconId","iconConfig","icon","find","v","getIcon","MAIN","changeIcon","position","getRollerPaddingBottom","getHeight","y","getIconContainerAnchorPos","lastNode","getPosition","getNode","setPosition","push","setBeetleAmount","getId","diff","calIndexDiff","lockIconDatas","getFixedChessboardIcon","betAmount","amount","setAmount","lockIconData","formatAmountWithLetter","si","dl","nextGameType","fixedChessboardIcon","index1","index2","bindEvent","useProps","key","node","isValid","changeRollerHeight","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","unscheduleAllCallbacks","hideScatterAnimation","stopRoll","setSpeedBorderStatus","stopSingleRollerIcon","addLastJoinIconIndex","stopIndex","getStopIconIndex","totalCount","bindUI","getRollSpeed","expectRollerSpeed","rollerSpeed","mergeIcon","parentNode","getAlikeIconCount","pos","isWinIcon","worldPosition","clone","add","wp","winningPosition","values","iconIndexs","show","active","setWorldPosition","x","playOneShot","FAST_ROLLER","scaleX","expectBorderScaleX","scaleY","expectBorderScaleY","setScale","count","filter","SCATTER","hideWin","pauseWinIcon","pauseWin","playWinIcon","playWin","playYuanBaoWinIcon","scheduleOnce","playOneScatterAnimation","element","playScatterAnimation","freeGame","isLoop","Object","keys","playScatterWin","playOneYuanBaoAnimation","isWin","yinBiNode","rollOverHandle","lockIconCount","SHELL_END","time","playCount","lockValues","phoenixV2Icon","iconv","getIconIndex","replaceIcon","restore","removeSingleRollerIcon","playBeetleAnimation","getSlotIndex","unMount","splice","removeLockIcon","destory","getIconPosByIndex","height","singleRollerHeight","halfHeight","paddingBottom","interval","iconListUI","getComponent","anchorY","rollerHeight","rollerHeight2","rollerHeight1","resetIconPos","lock","buildSingleRollerIcon","replaceMultiRollerIcon","firstIcon","getFirstIcon","removeFromParent","addChild","rollerPaddingBottom","multiIconRoller","frist","iconHideY","shift","endIcon","to","call","isMultiRoll","getBeetleAmountNode","nodes","amountNode","getAmountNode","getWildLiZiNode","amountNodes","isWinIconPhoenix","amount2DNode","getParticle2DNode","result","isYuanBaoWinIcon","otherGameAttributesVo","yuanBaoPosition","getYuanBaoYinBiNode","yinBINode","getYinBiNode","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Game, instantiate, Node, sp, tween, UITransform, Vec2, Vec3, view } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { PhoenixV2Icon } from './PhoenixV2_Icon';\r\nimport { calBetAmount, DialogType, GameType, GameTypeInfo, getColumnLockIconArr, IconId, LockIcon, RollerInfo, RollerLaunchResult, RollerStatus, SmallGame } from '../type';\r\nimport { mainViewModel, phoenixV2_Audio, sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { PhoenixV2_SingleIconRoller } from './PhoenixV2_SingleIconRoller';\r\nimport PhoenixV2SingleIconRollerViewModel from '../viewModel/PhoenixV2SingleIconRollerViewModel';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport SkeletonAnimationPlayer from '../../../utils/SkeletonPlay';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/** 选择的线id */\r\n\tpositionId: number,\r\n\t/**小游戏选择后的信息 */\r\n\tchooseSmallGame:SmallGame\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('PhoenixV2_Roller')\r\nexport class PhoenixV2_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = config.normalRollOption.showIconCount;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**是否正在滚动 */\r\n\tprivate isRoll = false;\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: PhoenixV2Icon[] = [];\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**是否快速边框（期待scatter中奖边框） */\r\n\tprivate isSpeedBorder;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\t/**锁定图标节点 */\r\n\tprivate props_lock_icon_list: Node;\r\n\t/**快速滚动层节点 */\r\n\tprivate speddBorderNode: Node;\r\n\t/**是否合并图标了 */\r\n\tprivate isMergeIcon = false;\r\n\r\n\t/**锁定图标列表 */\r\n\tprivate lockIcons: PhoenixV2Icon[] = [];\r\n\t/**单个图标的滚动 */\r\n\tprivate singleIconRollerViewModels: PhoenixV2SingleIconRollerViewModel[] = [];\r\n\r\n\t/**滚动次数 */\r\n\tprivate rollerCount = -1;\r\n\r\n\t/**大图标 */\r\n\tprivate bigNode: Node;\r\n\tprivate rollerLaunchResult: RollerLaunchResult;\r\n\tprivate sendBetTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t\tprops_big_icon: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.NONE,\r\n\t\t\tviewGameType: GameType.NONE,\r\n\t\t\tcurrGameType: GameType.NONE,\r\n\t\t\tleftCount: 0,\r\n\t\t},\r\n\t\tpositionId: 0,\r\n\t\tchooseSmallGame:null\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t\t// this.speddBorderNode = this.props_column_effect_node.getChildByName(\"props_speed_border\")\r\n\t\tthis.speddBorderNode = mainViewModel.comp.getBorderNode();\r\n\t\tthis.props_lock_icon_list = getNodeByNameDeep(\"props_lock_icon_list\", this.props_column_effect_node);\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, iconPool: IconPool) {\r\n\t\tthis.iconPool = iconPool;\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.lastIndex = Math.floor(Math.random() * this.iconRollerQueue.length);\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.addLockIcon()\r\n\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\t// if (this.props.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n\t\t\t// \tthis.props.chooseSmallGame.id = 1;\r\n\t\t\t// }\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\t/**是否小游戏2的特殊图标 */\r\n\tprivate isSubGame1SpecialIcon(id: number) {\r\n\t\treturn id === IconId.BEETLE || id === IconId.WILD;\r\n\t}\r\n\r\n\tprivate getIntervalHeight(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight1\r\n\t\t} else if (gameType === GameType.SUBGAME2) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight2;\r\n\t\t}\r\n\t\treturn config.normalRollOption.intervalHeight;\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\t\t// 在子游戏1中，初始化不显示甲壳虫和太阳神\r\n\t\tif (this.isSubGame2() && this.isSubGame1SpecialIcon(iconConfig.id)) {\r\n\t\t\tthis.joinIcon();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tif (iconConfig.id === IconId.WILD && this.props.gameTypeInfo.viewGameType !== GameType.MAIN) {\r\n\t\t\ticon.changeIcon(this.props.chooseSmallGame.id);\r\n\t\t} else if(iconConfig.id === IconId.WILD && this.props.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n\t\t\ticon.changeIcon(0);\r\n\t\t}\r\n\t\tconst position = new Vec3(0, this.getRollerPaddingBottom() + icon.getHeight() / 2);\r\n\t\tposition.y -= this.getIconContainerAnchorPos();\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.getIntervalHeight();\r\n\t\t}\r\n\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * 设置甲壳虫上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: PhoenixV2Icon) {\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff >= 3) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// console.log(`setBeetleAmount--- diff:${diff},stopIconIndex:${this.stopIconIndex},lastIndex:${this.lastIndex},columnIndex:${this.columnIndex}`);\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\t// 没有锁定图标就随机一个金额\r\n\t\t\tconst betAmount = calBetAmount(this.props.positionId)\r\n\t\t\tlet amount = Math.floor(Math.random() * betAmount)\r\n\t\t\tamount = amount <= 0 ? amount = 1 : amount\r\n\t\t\ticon.setAmount(amount)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst index = diff === 2 ? 0 : diff === 0 ? 2 : 1;\r\n\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === index)\r\n\t\tif (lockIconData) {\r\n\t\t\tconst amount = lockIconData.amount >= 10000 ? lockIconData.amount.formatAmountWithLetter() : lockIconData.amount;\r\n\t\t\ticon.setAmount(amount)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getFixedChessboardIcon() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tconst si = this.rollerLaunchResult.dl.si[0]\r\n\t\t\tif (si.nextGameType === GameType.SUBGAME2 || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t\t// return si.fixedChessboardIcon;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\treturn cacheData.fixedChessboardIcon;\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'gameTypeInfo') {\r\n\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.singleIconRollerViewModels.length === 0) {\r\n\t\t\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t\t\t}\r\n\t\t\t\tthis.changeRollerHeight(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.bigNode && this.bigNode.destroy();\r\n\t\tthis.bigNode = null;\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.hideIconWin();\r\n\t\tthis.hideScatterAnimation();\r\n\t\tthis.rollerCount = -1;\r\n\t\tthis.isMergeIcon = false;\r\n\t\tthis.isSpeedBorder = false;\r\n\t\tthis.isRoll = true;\r\n\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.startRoll());\r\n\t\t}\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, isSpeedBorder: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.isSpeedBorder = isSpeedBorder;\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\tthis.rollerLaunchResult = rollerLaunchResult;\r\n\t\tthis.sendBetTime = cacheData.sendBetTime;\r\n\t\t// console.log(\"roller stop time \" + this.sendBetTime);\r\n\t\t// let value = isSpeedBorder ? 15 : this.columnIndex + 1\r\n\t\t\r\n\t\tthis.rollerCount = 0;\r\n\r\n\t\tif (!this.isSubGame2()) {\r\n\t\t\tisSpeedBorder && this.setSpeedBorderStatus(true);\r\n\t\t\t// let value = isSpeedBorder ? 30 : 3;\r\n\t\t\t// this.addLastJoinIconIndex(this.stopIconIndex, 30);\r\n\t\t} else {\r\n\t\t\tthis.stopSingleRollerIcon(rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tif (stopIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet newValue = stopIndex + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\tthis.lastIndex = newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex}`);\r\n\t\tlet totalCount = 1 * (this.columnIndex + 1);\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\ttotalCount = 30;\r\n\t\t}\r\n\t\tif (this.rollerCount <= totalCount) {\r\n\t\t\tif (this.rollerCount === totalCount) {\r\n\t\t\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex},\tstopIconIndex:${this.stopIconIndex}`);\r\n\t\t\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3)\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.isSpeedBorder) {\r\n\t\t\treturn config.normalRollOption.expectRollerSpeed;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tprivate mergeIcon(parentNode: Node, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet iconCount = this.getAlikeIconCount();\r\n\t\tlet pos: Vec3;\r\n\t\tif (iconCount === this.showIconCount) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (!this.isWinIcon(i, rollerLaunchResult)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 3个图标取中间的图标的坐标\r\n\t\t\tpos = this.iconArr[1].getNode().worldPosition;\r\n\t\t} else if (iconCount === this.showIconCount - 1) {\r\n\t\t\t// 找出两个相邻的图标\r\n\t\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\t\tif (this.iconArr[i].getId() === this.iconArr[i + 1].getId() && this.isWinIcon(i, rollerLaunchResult) && this.isWinIcon(i + 1, rollerLaunchResult)) {\r\n\t\t\t\t\tpos = this.iconArr[i].getNode().worldPosition.clone().add(new Vec3(0, this.iconArr[i].getHeight() / 2 + this.getIntervalHeight()));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tprivate isWinIcon(index: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst wp = rollerLaunchResult && rollerLaunchResult.dl.si[0].winningPosition\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate setSpeedBorderStatus(show: boolean) {\r\n\t\tthis.speddBorderNode.active = show;\r\n\t\tif (show) {\r\n\t\t\tthis.speddBorderNode.setWorldPosition(new Vec3(this.node.worldPosition.x , this.node.worldPosition.y));\r\n\t\t\tphoenixV2_Audio.playOneShot(SoundPathDefine.FAST_ROLLER)\r\n\r\n\t\t\tlet scaleX = config.normalRollOption.expectBorderScaleX;\r\n\t\t\tlet scaleY = config.normalRollOption.expectBorderScaleY;\r\n\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1) {\r\n\t\t\t\tscaleX = config.subGameRollOption.expectBorderScaleX;\r\n\t\t\t\tscaleY = config.subGameRollOption.expectBorderScaleY;\r\n\t\t\t}\r\n\t\t\tthis.speddBorderNode.setScale(new Vec3(scaleX, scaleY, 1));\r\n\t\t}\r\n\t}\r\n\t/**获得相同图标个数 */\r\n\tprivate getAlikeIconCount() {\r\n\t\tlet count = 1;\r\n\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\tif (this.iconArr[i].getId() === IconId.WILD && this.iconArr[i].getId() === this.iconArr[i + 1].getId()) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**暂停赢的图标 */\r\n\tpublic pauseWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.pauseWin());\r\n\t}\r\n\r\n\tprivate hideScatterAnimation() {\r\n\t\tthis.iconArr.filter(v => v.getId() === IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tif (this.isRoll) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// this.scheduleOnce(() => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tconst icon = this.iconArr[index];\r\n\t\t\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\t\t\tif (icon.getId() !== IconId.WILD || !this.isMergeIcon) {\r\n\t\t\t\t\ticon.playWin(this.propertyNode.props_big_icon)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t// }, 0.2)\r\n\t}\r\n\r\n\t\r\n\t/**播放中奖图标动画 */\r\n\tpublic playYuanBaoWinIcon(index) {\r\n\t\tif (this.isRoll) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tconst icon = this.iconArr[index];\r\n\t\t\t\t// 如果是元宝第1列 第5列中奖\r\n\t\t\t\tif (icon.getId() === IconId.BEETLE) {\r\n\t\t\t\t\ticon.playYuanBaoWinIcon(this.propertyNode.props_big_icon,true)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 0.2)\r\n\t}\r\n\t// /**播放甲壳虫动画 */\r\n\t// public playBeetleAnimation(done) {\r\n\t// \tlet count = 0;\r\n\t// \tconst beetleArr = this.iconArr.filter((v, index) => v.getId() === IconId.BEETLE && index < this.showIconCount)\r\n\t// \tif (beetleArr.length === 0) {\r\n\t// \t\tdone && done();\r\n\t// \t\treturn;\r\n\t// \t}\r\n\t// \tbeetleArr.forEach(v => {\r\n\t// \t\tv.playBeetleAnimation(() => {\r\n\t// \t\t\tcount++;\r\n\t// \t\t\tif (count >= beetleArr.length) {\r\n\t// \t\t\t\tdone && done();\r\n\t// \t\t\t}\r\n\t// \t\t})\r\n\t// \t})\r\n\t// }\r\n\r\n\t/**播放一次scatter动画 */\r\n\tprivate playOneScatterAnimation() {\r\n\t\t// 小游戏2不播放\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\t// const freeGame = cacheData.rollerLaunchResult && cacheData.rollerLaunchResult.dl.si[0].freeGame;\r\n\t\t\t// const isLoop = Object.keys(freeGame).length > 0 ? true : false;\t\r\n\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\tphoenixV2_Audio.playOneShot(SoundPathDefine.SCATTER)\r\n\t\t\t\telement.playWin(this.propertyNode.props_big_icon, false, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放scatter动画 进入小游戏 */\r\n\tpublic playScatterAnimation() {\r\n\t\t// this.hideIconWin();\r\n\t\tconst freeGame = cacheData.rollerLaunchResult && cacheData.rollerLaunchResult.dl.si[0].freeGame;\r\n\t\tconst isLoop = Object.keys(freeGame).length > 0 ? true : false;\t\r\n\t\tif (isLoop) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tconst element = this.iconArr[i];\r\n\t\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\t\telement.playScatterWin(this.propertyNode.props_big_icon, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放一次元宝动画 */\r\n\tprivate playOneYuanBaoAnimation(isWin: boolean = false) {\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element.getId() === IconId.BEETLE) {\r\n\t\t\t\telement.yinBiNode.active = false;\r\n\t\t\t\telement.playYuanBaoWinIcon(this.propertyNode.props_big_icon,isWin);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// console.log(\"roller over handle stop time \" + this.sendBetTime);\r\n\t\tthis.isRoll = false;\r\n\t\tthis.stopIconIndex = -1;\r\n\r\n\t\tthis.isSpeedBorder && this.setSpeedBorderStatus(false);\r\n\r\n\t\tif (this.columnIndex === 0 || this.columnIndex === 4) {\r\n\t\t\tthis.playOneYuanBaoAnimation(false)\r\n\t\t}\r\n\r\n\t\tthis.playOneScatterAnimation();\r\n\t\tconst lockIconCount = this.addLockIcon();\r\n\t\tphoenixV2_Audio.playOneShot(SoundPathDefine.SHELL_END)\r\n\t\t\r\n\t\t// 有播放甲壳虫动画，晚一点结束\r\n\t\tconst time = lockIconCount > 0 && this.isSubGame2() ? 4 : 0.05;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, time)\r\n\r\n\t}\r\n\r\n\t/**添加锁定图标 */\r\n\tprivate addLockIcon() {\r\n\t\tlet playCount = 0;\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tlockValues.forEach(v => {\r\n\t\t\tlet phoenixV2Icon = this.lockIcons.find(iconv => iconv.getIconIndex() === v.index)\r\n\t\t\tif (!phoenixV2Icon) {\r\n\t\t\t\tconst iconConfig = config.icon.find(icon => icon.id === v.iconId)\r\n\t\t\t\tphoenixV2Icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, v.index);\r\n\t\t\t\tphoenixV2Icon.setAmount(v.amount);\r\n\r\n\t\t\t\tconst replaceIcon = this.iconArr[v.index];\r\n\t\t\t\tphoenixV2Icon.setPosition(replaceIcon.getPosition())\r\n\t\t\t\treplaceIcon.restore();\r\n\r\n\t\t\t\tthis.iconArr[v.index] = phoenixV2Icon;\r\n\t\t\t\tthis.lockIcons.push(phoenixV2Icon)\r\n\r\n\t\t\t\tthis.removeSingleRollerIcon(v.index);\r\n\r\n\t\t\t\tphoenixV2Icon.playBeetleAnimation(() => {\r\n\t\t\t\t\tphoenixV2Icon.hideWin();\r\n\t\t\t\t})\r\n\t\t\t\tplayCount++;\r\n\t\t\t\t// console.log(`addlockicon columnIndex ${this.columnIndex} index ${v.index} amount ${v.amount}, this.lockIcons.length ${this.lockIcons.length}`);\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn playCount;\r\n\t}\r\n\r\n\tprivate removeSingleRollerIcon(index: number) {\r\n\t\tfor (let i = 0; i < this.singleIconRollerViewModels.length; i++) {\r\n\t\t\tconst element = this.singleIconRollerViewModels[i];\r\n\t\t\tif (element.comp.getSlotIndex() === index) {\r\n\t\t\t\telement.unMount();\r\n\t\t\t\tthis.singleIconRollerViewModels.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**删除锁定图标 */\r\n\tpublic removeLockIcon() {\r\n\t\tthis.lockIcons.forEach(v => v.destory());\r\n\t\tthis.lockIcons = [];\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst halfHeight = height / 2;\r\n\t\tconst paddingBottom = this.getRollerPaddingBottom(gameType)\r\n\t\tlet y = 0;\r\n\t\tif (index === 0) {\r\n\t\t\t// 第一个图标的坐标位置 = 下边距 + icon高度的一半\r\n\t\t\ty = paddingBottom + halfHeight;\r\n\t\t} else {\r\n\t\t\t// 从第二开始的坐标 = 下边距 + icon高度的一半 + 图标间隔个数 + icon高度个数\r\n\t\t\tconst interval = this.getIntervalHeight(gameType) * index\r\n\t\t\ty = paddingBottom + halfHeight + interval + height * index;\r\n\t\t}\r\n\t\ty -= this.getIconContainerAnchorPos();\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得图标容器锚点的起始位置 */\r\n\tprivate getIconContainerAnchorPos() {\r\n\t\tconst iconListUI = this.propertyNode.props_icon_list.getComponent(UITransform)\r\n\t\treturn iconListUI.height * iconListUI.anchorY\r\n\t}\r\n\r\n\tpublic changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tif (gameType === GameType.SUBGAME2) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight2;\r\n\t\t} else if (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight1;\r\n\t\t}\r\n\t\tthis.propertyNode.props_icon_list.getComponent(UITransform).height = rollerHeight;\r\n\t}\r\n\r\n\t/**重置图标位置 */\r\n\tpublic resetIconPos(gameType: GameType) {\r\n\t\tthis.changeRollerHeight(gameType);\r\n\t\tif (gameType !== GameType.SUBGAME2) {\r\n\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\tconst pos = this.getIconPosByIndex(i, gameType);\r\n\t\t\t\ticon.setPosition(pos);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换单个滚动图标 */\r\n\tpublic replaceSingleRollerIcon() {\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\tconst v = this.iconArr[i];\r\n\t\t\t// 替换不是甲壳虫和太阳神图标\r\n\t\t\t// if (!this.isSubGame2SpecialIcon(v.getId())) {\r\n\t\t\tif (!lockValues.find(lock => lock.index === i)) {\r\n\t\t\t\tthis.buildSingleRollerIcon(i, v.getPosition(), v);\r\n\t\t\t\tv.getNode().active = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换多个滚动图标 */\r\n\tpublic replaceMultiRollerIcon() {\r\n\t\tthis.singleIconRollerViewModels.forEach(v => {\r\n\t\t\tconst firstIcon = v.comp.getFirstIcon();\r\n\t\t\tfirstIcon.getNode().removeFromParent();\r\n\r\n\t\t\tconst index = v.comp.getSlotIndex();\r\n\t\t\tthis.propertyNode.props_icon_list.addChild(firstIcon.getNode());\r\n\t\t\tfirstIcon.setPosition(this.getIconPosByIndex(index))\r\n\t\t\tthis.iconArr[index] = firstIcon;\r\n\r\n\t\t\tv.unMount();\r\n\t\t})\r\n\r\n\t\tthis.lockIcons = [];\r\n\t\tthis.singleIconRollerViewModels = [];\r\n\t}\r\n\r\n\t/**构建单个图标滚动 */\r\n\tprivate buildSingleRollerIcon(index: number, pos: Vec3, icon: PhoenixV2Icon) {\r\n\t\t// const viewModel = new PhoenixV2SingleIconRollerViewModel()\r\n\t\t// \t.mountView(sourceManageSeletor().getFile(PrefabPathDefine.SINGLE_ICON_ROLLER).source)\r\n\t\t// \t.appendTo(this.propertyNode.props_icon_list);\r\n\t\t// viewModel.viewNode.getComponent(UITransform).width = config.subGameRollOption.singleIconMaskWidth;\r\n\t\t// viewModel.viewNode.getComponent(UITransform).height = config.subGameRollOption.singleIconMaskHeight;\r\n\t\t// this.singleIconRollerViewModels.push(viewModel);\r\n\t\t// viewModel.viewNode.setPosition(pos);\r\n\r\n\t\t// viewModel.comp.initSlot(this.columnIndex, index, icon.getIconIndex(), this.iconPool);\r\n\t}\r\n\r\n\tprivate getRollerPaddingBottom(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.rollerPaddingBottom;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerPaddingBottom;\r\n\t}\r\n\r\n\t/**多图标滚动 */\r\n\tprivate multiIconRoller() {\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - this.getRollSpeed()));\r\n\t\t})\r\n\r\n\t\tconst frist = this.iconArr[0];\r\n\t\t// 图标隐藏的Y坐标 = 图标一半高度 + 滚轴下内边距 + 容器锚点的高度\r\n\t\tlet iconHideY = -(frist.getHeight() / 2 + this.getRollerPaddingBottom())\r\n\t\ticonHideY -= this.getIconContainerAnchorPos()\r\n\t\tif (frist.getPosition().y <= iconHideY) {\r\n\t\t\t// console.log(`columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex}, rollerCount:${this.rollerCount}`);\r\n\t\t\tif (this.rollerCount >= 0) {\r\n\t\t\t\tthis.rollerCount++;\r\n\t\t\t}\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[2]\r\n\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\t// console.log(`xxxxxxxxxxx-----columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex},endIcon.getIconIndex():${endIcon.getIconIndex()},this.getStopIconIndex():${this.getStopIconIndex()}`);\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\r\n\t\t\t\t// 结束之后计算每个图标的最终位置，\r\n\t\t\t\tlet count = 0;\r\n\t\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\t\ttween(icon.getNode()).to(0.1, { position: this.getIconPosByIndex(i) }).call(() => {\r\n\t\t\t\t\t\tcount++;\r\n\t\t\t\t\t\tif (count >= this.iconArr.length) {\r\n\t\t\t\t\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).start();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isMultiRoll() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**停止单个图标的滚动 */\r\n\tprivate stopSingleRollerIcon(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 0;\r\n\t\tif (this.singleIconRollerViewModels.length === 0) {\r\n\t\t\tthis.isRoll = false;\r\n\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t} else {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.stopRoll(this.stopIconIndex, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.singleIconRollerViewModels.length) {\r\n\t\t\t\t\tthis.isRoll = false;\r\n\t\t\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t}, rollerLaunchResult));\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得甲壳虫上面的数字节点 */\r\n\tpublic getBeetleAmountNode() {\r\n\t\tconst nodes: Node[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (this.isSubGame1SpecialIcon(element.getId())) {\r\n\t\t\t\tconst amountNode = element.getAmountNode();\r\n\t\t\t\tamountNode && nodes.push(amountNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tpublic getWildLiZiNode() {\r\n\t\tconst amountNodes: Node[] = [];\r\n\t\tconst nodes: Node[] = [];\r\n\t\t// console.log(\" this.iconArr111\", this.iconArr);\r\n\t\t// console.log(\"this.columnIndex111\",this.columnIndex);\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\t\r\n\t\t\tconst isWinIcon = this.isWinIconPhoenix(cacheData.rollerLaunchResult,i);\r\n\t\t\t// console.log(\"amount111 isWinIcon\",isWinIcon);\r\n\t\t\tif (isWinIcon && element.getId() === IconId.WILD) {\r\n\t\t\t\t\r\n\t\t\t\tconst amount = element.getAmountNode();\r\n\t\t\t\tconst amount2DNode = element.getParticle2DNode();\r\n\t\t\t\tif (amount) {\r\n\t\t\t\t\tamountNodes.push(amount)\r\n\t\t\t\t\tnodes.push(amount2DNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// console.log(\"amountNodes------->:\",amountNodes);\r\n\t\t\r\n\t\treturn {amountNodes,nodes};\r\n\t}\r\n\r\n\t// /**是否wild中奖图标 */\r\n\tpublic isWinIconPhoenix(rollerLaunchResult:RollerLaunchResult,index:number) {\r\n\t\tconst wp = rollerLaunchResult && rollerLaunchResult.dl.si[0].winningPosition\r\n\t\t// console.log(\"phoenixCount111\",rollerLaunchResult.dl.si[0].otherGameAttributesVo.phoenixCount);\r\n\t\t\r\n\t\tconst result: number[][] = []\r\n\t\t// let iconIndexs;\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index && this.iconArr[index].getId() === IconId.WILD) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// for (const key in wp) {\r\n\t\t// \tresult.push(...wp[key])\r\n\t\t// }\r\n\t\t// console.log(\"result111\",result);\r\n\t\t\r\n\t\t// iconIndexs = result.find(v => v[0] === this.columnIndex)\r\n\t\t// // for (let i = 0; i < this.showIconCount; i++) {\r\n\t\t// \tif (iconIndexs && iconIndexs[1] === index && this.iconArr[index].getId() === IconId.WILD) {\r\n\t\t// \t\t// console.log(\"iconIndexs111\",iconIndexs);\r\n\t\t// \t\treturn true;\r\n\t\t// \t}\r\n\t\t// // }\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否元宝中奖图标 */\r\n\tpublic isYuanBaoWinIcon(rollerLaunchResult: RollerLaunchResult) {\r\n\t\t\r\n\t\tconst wp = rollerLaunchResult && rollerLaunchResult.dl.si[0].otherGameAttributesVo.yuanBaoPosition\r\n\t\tconst values = wp\r\n\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tif (iconIndexs && iconIndexs[1] === i) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t/**获得元宝上面的银币节点 */\r\n\tpublic getYuanBaoYinBiNode() {\r\n\t\tconst nodes: Node[] = [];\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element.getId() === IconId.BEETLE) {\r\n\t\t\t\tconst yinBINode = element.getYinBiNode();\r\n\t\t\t\t// console.log(\"yinBINode\",yinBINode);\r\n\t\t\t\t// console.log(\"yinBINode\", yinBINode.active);\r\n\t\t\t\t// console.log(\"yinBINode isYuanBaoWinIcon\",this.isWinIconPhoenix(cacheData.rollerLaunchResult));\r\n\t\t\t\tconst isYuanBaoWinIcon = this.isYuanBaoWinIcon(cacheData.rollerLaunchResult);\r\n\t\t\t\tyinBINode && isYuanBaoWinIcon && nodes.push(yinBINode);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nodes;\r\n\t}\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tthis.isRoll = false;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll && this.iconArr.length > 0) {\r\n\t\t\tif (this.isMultiRoll()) {\r\n\t\t\t\tthis.multiIconRoller();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}