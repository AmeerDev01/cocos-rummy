{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealth/Slot/Command/BgCommand.ts"],"names":["BgCommand","DialogType","BgMediatorConst","SubGameType","config","getBgProxy","getSocketProxy","BaseCommand","AudioManager","SceneBgMusic","UseSetOption","BgCommandConst","listExecute","type","INIT_MAIN_PANEL","handler","notification","AUTH","sendAnth","GAME_TYPE_CHANGE","fbp","nextGame","getIsChangeGameRunning","gameTypePre","getLastGame","gameTypeNew","sendNotification","START_FLY_BG","done","setDisable","window","setTimeout","INITSCORE","state","MAIN","SUB_GAME2","SUB_GAME1","setIsChangeNextGameType","getInstance","playMusic","mainBg","UPDATE_BTN_LABEL","frequency","UPDATE_GAME_STATUS","gameBg","getTransferGameInfo","getNumberOfRounds","gameBgT","UPDATE_BET_AMOUNT","order","getBody","updateBetAmount","AUTO_LAUNCH","checkAutoLaunch","sendLaunch","getNextGame","subtractAutoLaunchTimes","SHOW_DIALOG_WIN","dialogType","amount","keepTime","_amount","getCurrentScore","_keepTime","magnification","getMagnification","win","winning","find","item","minRate","maxRate","BIG_WIN","name","MEGA_WIN","SUPER_WIN","JACKPOT","str","getShiftAmount","baseBetAmount","value","Instance","setGameOption","betTarget","lineCount","linesQueue","length","execute"],"mappings":"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","sourcesContent":["import Facade from \"../../Framework/care/Facade\"\r\nimport { INotification } from \"../../Framework/interfaces/INotification\"\r\nimport { DialogType } from \"../Component/GodWealth_DialogWin\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SubGameType } from \"../Proxy/SocketProxy\";\r\nimport config from \"../GodWealth_config\";\r\nimport { getBgProxy, getSocketProxy } from \"../GodWealth_utils\";\r\nimport { BaseCommand, IListExecute } from './BaseCommand'\r\nimport {AudioManager, SceneBgMusic, SoundList} from \"../Managr/AudioManager\";\r\nimport UseSetOption from \"db://assets/script/utils/UseSetOption\";\r\nexport enum BgCommandConst {\r\n\tAUTH = \"authentication\",\r\n\t/**切换游戏界面 */\r\n\tGAME_TYPE_CHANGE = \"gameTypeChange\",\r\n\t/**检查自动启动启动，如果是就进行下一局 */\r\n\tAUTO_LAUNCH = \"autoLaunch\"\r\n}\r\n\r\n// const listNotificationConst: Array<IlistNotificationer<FruitsSlotCommand>> = [\r\n// \t{\r\n// \t\ttype: MainSlotViewType.INIT_MAIN_PANEL,\r\n// \t\thandler(notification: INotification) {\r\n\r\n// \t\t\treturn false\r\n// \t\t}\r\n// \t}\r\n// ]\r\n\r\nexport class BgCommand extends BaseCommand {\r\n\tprotected listExecute: Array<IListExecute<BgCommand>> = [\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.INIT_MAIN_PANEL,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\t// this.updateBetAmount(\"curr\")\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tgetSocketProxy().sendAnth()\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.GAME_TYPE_CHANGE,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\tconst nextGame = fbp.getIsChangeGameRunning()\r\n\t\t\t\tif (nextGame !== -1) {\r\n\t\t\t\t\t// //开始切换屏幕\r\n\t\t\t\t\t// this.sendNotification(CommandDefine.BG, { gameTypePre: fbp.getLastGame(), gameTypeNew: nextGame }, FruitsBgCommandConst.GAME_TYPE_CHANGE)\r\n\t\t\t\t\t// const { gameTypePre, gameTypeNew } = notification.getBody()\r\n\t\t\t\t\tconst gameTypePre = fbp.getLastGame()\r\n\t\t\t\t\tconst gameTypeNew = nextGame\r\n\t\t\t\t\tthis.sendNotification(BgMediatorConst.START_FLY_BG, {\r\n\t\t\t\t\t\tdone: () => {\r\n\t\t\t\t\t\t\tfbp.setDisable(false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t// 先卸载之前的游戏，由于是渐出，所以给一个时间\r\n                        this.sendNotification(BgMediatorConst.INITSCORE,{state:true})\r\n                        if (gameTypePre === SubGameType.MAIN || gameTypePre === SubGameType.SUB_GAME2) {\r\n\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, {}, RollerMediatorConst.UNINSTALL_ROLLER_PANEL)\r\n\t\t\t\t\t\t} else if (gameTypePre === SubGameType.SUB_GAME1) {\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\tif (gameTypeNew === SubGameType.MAIN) {\r\n\t\t\t\t\t\t\t\tgetBgProxy().setIsChangeNextGameType(gameTypePre, 0)\r\n                                AudioManager.getInstance().playMusic(SceneBgMusic.mainBg,true)\r\n                                this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:0})\r\n                               this.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n\t\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, { gameType: 0 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME1) {\r\n                                AudioManager.getInstance().playMusic(SceneBgMusic.gameBg,true)\r\n                                this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:getSocketProxy().getTransferGameInfo().getNumberOfRounds()})\r\n                                // this.sendNotification(CommandDefine.ROLLER, { gameType: 1 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME2) {\r\n\t\t\t\t\t\t\t\t//大滑槽\r\n                                this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:getSocketProxy().getTransferGameInfo().getNumberOfRounds()})\r\n                                AudioManager.getInstance().playMusic(SceneBgMusic.gameBgT,true)\r\n\t\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, { gameType: 2 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 300)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfbp.setDisable(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// {\r\n\t\t// \ttype: BgMediatorConst.UPDATE_NUMBER,\r\n\t\t// \thandler(notification: INotification) {\r\n\t\t// \t\tconst betAmount = this.getSocketProxy().getRepository().userServerData\r\n\t\t// \t\treturn {\r\n\t\t// \t\t\tbetAmount: betAmount,\r\n\t\t// \t\t\tscore: 0\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// },\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.UPDATE_BET_AMOUNT,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { order } = notification.getBody()\r\n\t\t\t\treturn this.updateBetAmount(order)\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTO_LAUNCH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tif (getBgProxy().checkAutoLaunch()) {\r\n\t\t\t\t\tgetSocketProxy().sendLaunch()\r\n\t\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\t\tif (fbp.getNextGame() === SubGameType.MAIN) {\r\n\t\t\t\t\t\tgetBgProxy().subtractAutoLaunchTimes()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.SHOW_DIALOG_WIN,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { dialogType, amount, keepTime, order, done } = notification.getBody()\r\n\t\t\t\tconst _amount = amount || getSocketProxy().getTransferGameInfo().getCurrentScore(order)\r\n\t\t\t\tconst _keepTime = keepTime || 3000\r\n\t\t\t\t//获取奖励类型\r\n\t\t\t\tconst magnification = getSocketProxy().getTransferGameInfo().getMagnification()\r\n\t\t\t\tconst win = config.winning.find(item => item.minRate <= magnification && magnification <= item.maxRate)\r\n\t\t\t\tif (win && !dialogType) {\r\n\t\t\t\t\tlet dialogType: DialogType = DialogType.BIG_WIN;\r\n\t\t\t\t\tswitch (win.name) {\r\n\t\t\t\t\t\tcase \"bigwin\": dialogType = DialogType.BIG_WIN; break;\r\n\t\t\t\t\t\tcase \"megawin\": dialogType = DialogType.MEGA_WIN; break;\r\n\t\t\t\t\t\tcase \"superwin\": dialogType = DialogType.SUPER_WIN; break;\r\n\t\t\t\t\t\tcase \"jackpot\": dialogType = DialogType.JACKPOT; break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t} else if (dialogType) {\r\n\t\t\t\t\t//如果dialogType被强制赋值，那么就会强制显示\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t}else {\r\n                    done()\r\n                }\r\n\t\t\t}\r\n\t\t}\r\n\t]\r\n\tprivate updateBetAmount(order: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n        let  str=getSocketProxy().getShiftAmount(order)\r\n        const baseBetAmount = str.value\r\n        UseSetOption.Instance().setGameOption(\"godWealth\", { betTarget:str})\r\n        const lineCount = config.linesQueue.length\r\n        return { baseBetAmount, lineCount }\r\n\t}\r\n\tpublic execute(notification: INotification): void {\r\n\t\tsuper.execute(notification)\r\n\t}\r\n}\r\n"]}