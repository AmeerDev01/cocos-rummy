{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_ChooseBank.ts"],"names":["_decorator","assetManager","Button","instantiate","Label","Node","Sprite","SpriteFrame","BaseComponent","SKT_MAG_TYPE","sktInstance","sktMsgListener","setLoadingAction","global","hallAudio","initToggle","SoundPathDefine","ccclass","property","Hall_ChooseBank","propertyNode","props_btn_spr_choose_close","props_btn_sure","props_Toggle_template","props_toggleGroup_bank","props","onlyDisplayArr","events","onClosePanel","onOrder","rechargeChannelId","start","initState","dataList","chooseItemIndex","bindEvent","node","on","EventType","TOUCH_END","state","length","id","add","GET_WITH_DRAW_CHANNEL","data","setState","filter","i","indexOf","hallDispatch","isShow","sendSktMessage","isLoading","useProps","key","value","bindUI","useState","forEach","item","index","getChildByName","getComponent","string","name","loadRemote","iconMax","err","asset","spriteFrame","createWithImage","active","addChild","EventHandler","channelToggleCallback","event","customEventData","playOneShot","BTU_CLICK","chooseIndex","target","children","onDestroy","removeById","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, assetManager, Button, Component, ImageAsset, instantiate, Label, Node, Sprite, SpriteFrame } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from '../socketConnect';\r\nimport { setLoadingAction } from '../store/actions/baseBoard';\r\nimport { ChannelItemType } from './Hall_ShopPanel';\r\nimport { global, hallAudio } from '../index';\r\nimport { initToggle } from '../../utils/tool';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\tdataList: ChannelItemType[],\r\n\tchooseItemIndex: number\r\n}\r\n\r\nexport interface IProps {\r\n\t/**如果存在值，就只显示这里id存在的项目 */\r\n\tonlyDisplayArr: Array<string>\r\n}\r\nexport interface IEvent {\r\n\tonClosePanel: () => void\r\n\tonOrder: (rechargeChannelId: string) => void\r\n}\r\n\r\n@ccclass('Hall_ChooseBank')\r\nexport class Hall_ChooseBank extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_spr_choose_close: new Button(),\r\n\t\tprops_btn_sure: new Button(),\r\n\t\tprops_Toggle_template: new Node(),\r\n\t\tprops_toggleGroup_bank: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tonlyDisplayArr: []\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonClosePanel: () => { },\r\n\t\tonOrder: (rechargeChannelId: string) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tdataList: [],\r\n\t\t\tchooseItemIndex: 0\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_spr_choose_close.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onClosePanel()\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_sure.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tif (this.state.dataList.length && this.state.dataList[this.state.chooseItemIndex]) {\r\n\t\t\t\tthis.events.onOrder(this.state.dataList[this.state.chooseItemIndex].id)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tsktMsgListener.add(SKT_MAG_TYPE.GET_WITH_DRAW_CHANNEL, 'chooseBank', (data: ChannelItemType[]) => {\r\n\t\t\tif (this.props.onlyDisplayArr.length) {\r\n\t\t\t\tthis.setState({ dataList: data.filter(i => this.props.onlyDisplayArr.indexOf(i.id) !== -1) })\r\n\t\t\t} else {\r\n\t\t\t\tthis.setState({ dataList: data })\r\n\t\t\t}\r\n\t\t\tglobal.hallDispatch(setLoadingAction({ isShow: false }))\r\n\t\t})\r\n\t\tsktInstance.sendSktMessage(SKT_MAG_TYPE.GET_WITH_DRAW_CHANNEL, {}, { isLoading: true })\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) { }\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.state.dataList.forEach((item, index) => {\r\n\t\t\t\tconst node = instantiate(this.propertyNode.props_Toggle_template)\r\n\t\t\t\tnode.getChildByName(\"spr_bankName\").getComponent(Label).string = item.name\r\n\t\t\t\tassetManager.loadRemote(item.iconMax, (err, asset: ImageAsset) => {\r\n\t\t\t\t\tif (this.propertyNode && !err) {\r\n\t\t\t\t\t\tnode.getChildByName(\"spr_bankIcon\").getComponent(Sprite).spriteFrame = SpriteFrame.createWithImage(asset)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tnode.active = true\r\n\t\t\t\tthis.propertyNode.props_toggleGroup_bank.addChild(node)\r\n\t\t\t})\r\n\t\t}, [\"dataList\"])\r\n\t\tinitToggle(this.propertyNode.props_toggleGroup_bank, this.node, new Hall_ChooseBank.EventHandler(), \"Hall_ChooseBank\", \"channelToggleCallback\")\r\n\t}\r\n\tprivate channelToggleCallback(event: Event, customEventData: string) {\r\n\t\thallAudio.playOneShot(SoundPathDefine.BTU_CLICK)\r\n\t\tconst chooseIndex = event.target['parent'].children.indexOf(event.target)\r\n\t\tthis.setState({\r\n\t\t\tchooseItemIndex: chooseIndex\r\n\t\t})\r\n\t}\r\n\tprotected onDestroy() {\r\n\t\tsktMsgListener.removeById(\"chooseBank\")\r\n\t}\r\n\tupdate(deltaTime: number) { }\r\n}\r\n\r\n"]}