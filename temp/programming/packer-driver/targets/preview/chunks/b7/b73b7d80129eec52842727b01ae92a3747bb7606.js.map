{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dfdc/viewModel/FooterViewModel.ts"],"names":["UIOpacity","sys","Animation","ViewModel","StoreInject","getStore","AutoLauncherViewModel","playFastRoller","sourceManageSeletor","PrefabPathDefine","EffectType","BaseViewModel","SKT_MAG_TYPE","sktInstance","beginRollAction","setRollSpeed","dataTransfer","DataKeyType","AutoLauncherType","GameType","changeAutoLauncherType","changeProfit","setAutoLaunchedTimes","setFreeGameRate","setShowAuthLaunch","setSortStop","setWaiting","global","lang","addToastAction","FooterViewModel","constructor","autoLauncherPanel","helpPanelPanel","positionId","betAmount","gameType","viewGameType","freeGamePositionId","begin","mountView","getFile","AUTO_LAUNCHER","source","appendTo","comp","getAutoLauncherBaseNBoard","connect","viewNode","getComponent","opacity","setEvent","openAutoLauncher","dispatch","getPropertyNode","props_down_chooseBg","play","closeAutoLauncher","isClear","NONE","openHelpPanel","RULE","parent","effectType","EFFECT1","isModal","closeHandler","unMount","changeBetAmount","value","manualBetHandler","changeSpeedUpSwitch","isChecked","unMountCallBack","isConnect","props","balance","hallDispatch","content","write","k","palyingModule","RechangeGlod","placeStr","openShop","GAME_TYPE","MAIN","SUBGAME1","sendSktMessage","LAUNCHER_BET","tableId","JSON","parse","localStorage","getItem","inject","autoLauncherType","getState","game","state","currGameType","isRollEnd","roller","roundAllEnd","profit","subGameTimes","remainSubGameTimes","isShowAutoLaunch","autoLaunchedTimes","isJumpStop","stopMode","isSortStop"],"mappings":"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","sourcesContent":["import { Node, UIOpacity, sys, Animation } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { BlessedWealthy_footer, IProps, IEvent } from \"../components/BlessedWealthy_footer\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { getStore } from \"../store\"\r\nimport AutoLauncherViewModel from \"./AutoLauncherViewModel\"\r\nimport { blessedWealthy_Audio, playFastRoller, sourceManageSeletor } from \"../index\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport BaseViewModel from \"../../../common/viewModel/BaseViewModel\"\r\nimport { BlessedWealthy_helpPanel, IProps as FIProps, IState as FIState, IEvent as FIEvent } from \"../components/BlessedWealthy_helpPanel\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { beginRollAction, setRollSpeed } from \"../store/actions/roller\"\r\nimport dataTransfer, { DataKeyType } from \"../dataTransfer\"\r\nimport { AutoLauncherType, GameType, SMALLGAME } from \"../type\"\r\nimport { changeAutoLauncherType, changeProfit, setAutoLaunchedTimes, setFreeGameRate, setShowAuthLaunch, setSortStop, setStopMode, setWaiting } from \"../store/actions/game\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\n\r\n@StoreInject(getStore())\r\nclass FooterViewModel extends ViewModel<BlessedWealthy_footer, IProps, IEvent> {\r\n  constructor() {\r\n    super('BlessedWealthy_footer')\r\n  }\r\n  public autoLauncherPanel: AutoLauncherViewModel\r\n  public helpPanelPanel: BaseViewModel<BlessedWealthy_helpPanel, FIState, FIProps, FIEvent>\r\n  private positionId: number = 0\r\n  private betAmount: number = 0\r\n  private gameType: GameType;\r\n  private viewGameType: GameType;\r\n  private freeGamePositionId: SMALLGAME;\r\n\r\n  protected begin() {\r\n    this.autoLauncherPanel = new AutoLauncherViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.AUTO_LAUNCHER).source).appendTo(this.comp.getAutoLauncherBaseNBoard()).connect()\r\n    this.autoLauncherPanel.viewNode.getComponent(UIOpacity).opacity = 0\r\n    this.setEvent({\r\n      openAutoLauncher: () => {\r\n        if (this.viewGameType === 1) return;//小游戏不能打开自动下注\r\n        this.dispatch(setShowAuthLaunch(true));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_up')\r\n      },\r\n      closeAutoLauncher: (isClear) => {\r\n        this.dispatch(setShowAuthLaunch(false));\r\n        isClear && this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE));\r\n        isClear && this.dispatch(setAutoLaunchedTimes(0));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_down')\r\n        // isClear && this.dispatch(setRollSpeed(1))\r\n      },\r\n      openHelpPanel: () => {\r\n        this.helpPanelPanel = new BaseViewModel<BlessedWealthy_helpPanel, FIState, FIProps, FIEvent>(\"BlessedWealthy_helpPanel\").mountView(sourceManageSeletor().getFile(PrefabPathDefine.RULE).source)\r\n          .appendTo(this.viewNode.parent, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n            closeHandler: () => {\r\n              this.helpPanelPanel.unMount(EffectType.EFFECT1)\r\n            }\r\n          })\r\n      },\r\n      changeBetAmount: (betAmount: number, positionId: number, value: number) => {\r\n        this.positionId = positionId\r\n        this.betAmount = betAmount\r\n      },\r\n      manualBetHandler: () => {\r\n        this.manualBetHandler()\r\n      },\r\n      changeSpeedUpSwitch: (isChecked) => {\r\n        // this.dispatch(setStopMode(isChecked ? 'jump' : 'index'))\r\n        this.dispatch(setSortStop(!isChecked))\r\n        // debugger\r\n        this.dispatch(setRollSpeed(isChecked ? 1.3 : 1))\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n    this.dispatch(setAutoLaunchedTimes(0))\r\n  }\r\n\r\n  public manualBetHandler() {\r\n    if (!sktInstance || (sktInstance && !sktInstance.isConnect)) return\r\n    if (this.comp.props.balance < this.betAmount) {\r\n      global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.RechangeGlod, {}, { placeStr: \"对不起，您的金币不足，请充值!\" }) }))\r\n      global.openShop()\r\n      this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n      this.dispatch(setAutoLaunchedTimes(0))\r\n      return\r\n    }\r\n    //先转起来\r\n    this.dispatch(beginRollAction(-1));\r\n    //如果主游戏，清理奖池\r\n    if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.MAIN) {\r\n      this.dispatch(changeProfit(0))\r\n    }\r\n    //如果是小游戏，清除气泡倍率值\r\n    if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.SUBGAME1) {\r\n      this.dispatch(setFreeGameRate(0));\r\n    }\r\n    //发送下注\r\n    if (this.gameType === GameType.MAIN) {//主游戏\r\n      sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCHER_BET, {\r\n        positionId: this.positionId,\r\n        tableId: JSON.parse(sys.localStorage.getItem('dfdc')).tableId\r\n      })\r\n    } else if (this.gameType === GameType.SUBGAME1) {//小游戏\r\n      sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCHER_BET, {\r\n        positionId: this.positionId,\r\n        freeGamePositionId:this.freeGamePositionId,\r\n        tableId: JSON.parse(sys.localStorage.getItem('dfdc')).tableId\r\n      })\r\n    }\r\n    this.dispatch(setWaiting(false))\r\n    playFastRoller()\r\n  }\r\n  public connect() {\r\n    this.inject({\r\n      autoLauncherType: getStore().getState().game.autoLauncherType\r\n\r\n    }, (state: StateType) => {\r\n      this.gameType = state.game.currGameType;\r\n      this.freeGamePositionId = state.game.freeGamePositionId;\r\n      this.viewGameType = state.game.viewGameType;\r\n      return {\r\n        isRollEnd: state.roller.roundAllEnd,\r\n        profit: state.game.profit,\r\n        subGameTimes: state.game.subGameTimes,\r\n        remainSubGameTimes: state.game.remainSubGameTimes,\r\n        currGameType: state.game.currGameType,\r\n        viewGameType: state.game.viewGameType,\r\n        isShowAutoLaunch: state.game.isShowAutoLaunch,\r\n        autoLauncherType: state.game.autoLauncherType,\r\n        autoLaunchedTimes: state.game.autoLaunchedTimes,\r\n        balance: state.game.balance,\r\n        isJumpStop: state.game.stopMode === \"jump\" ? true : false,\r\n        isSortStop: state.game.isSortStop,\r\n        freeGamePositionId:state.game.freeGamePositionId,\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default FooterViewModel"]}