{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/PersonCenterViewModel.ts"],"names":["PersonCenterViewModel","ViewModel","SKT_MAG_TYPE","sktInstance","sktMsgListener","baseBoardView","lang","addToastAction","Throttler","constructor","memberInfoMedifyDone","begin","sendSktMessage","MEMBER_INFO","isLoading","add","MODIFY_MEMBER_INFO","data","dispatch","content","write","k","PersonCenterModule","PersonCenterEdit","placeStr","setEvent","memberInfoDone","gender","nickName","avatarIndex","done","isDebouncerAsync","PersonCenterSumbit","then","isPass","mainPanelViewModel","isTouristPass","unMountCallBack","removeById","connect","storeState","store","getState","inject","memberInfo","tourist","state","isShowWebView","baseBoard","isLoadRecommendData"],"mappings":";;;qLASMA,qB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARCC,MAAAA,S;;AAGEC,MAAAA,Y,iBAAAA,Y;AAAcC,MAAAA,W,iBAAAA,W;AAAaC,MAAAA,c,iBAAAA,c;;AAC3BC,MAAAA,a,iBAAAA,a;AAAeC,MAAAA,I,iBAAAA,I;;AACfC,MAAAA,c,iBAAAA,c;;AACFC,MAAAA,S;;;;;;;;;AAEDR,MAAAA,qB,GAAN,MAAMA,qBAAN;AAAA;AAAA,kCAAgF;AAC9ES,QAAAA,WAAW,GAAG;AACZ,gBAAM,kBAAN;AADY,eAGNC,oBAHM;AAEb;;AAESC,QAAAA,KAAK,GAAG;AAChB;AAAA;AAAA,0CAAYC,cAAZ,CAA2B;AAAA;AAAA,4CAAaC,WAAxC,EAAqD,EAArD,EAAyD;AAAEC,YAAAA,SAAS,EAAE;AAAb,WAAzD;AACA;AAAA;AAAA,gDAAeC,GAAf,CAAmB;AAAA;AAAA,4CAAaC,kBAAhC,EAAoD,QAApD,EAA+DC,IAAD,IAAU;AACtE,iBAAKP,oBAAL,IAA6B,KAAKA,oBAAL,EAA7B;AACA,iBAAKQ,QAAL,CAAc;AAAA;AAAA,kDAAe;AAAEC,cAAAA,OAAO,EAAE;AAAA;AAAA,gCAAKC,KAAL,CAAWC,CAAC,IAAIA,CAAC,CAACC,kBAAF,CAAqBC,gBAArC,EAAuD,EAAvD,EAA2D;AAAEC,gBAAAA,QAAQ,EAAE;AAAZ,eAA3D;AAAX,aAAf,CAAd;AACA;AAAA;AAAA,4CAAYZ,cAAZ,CAA2B;AAAA;AAAA,8CAAaC,WAAxC,EAAqD,EAArD,EAAyD;AAAEC,cAAAA,SAAS,EAAE;AAAb,aAAzD;AACD,WAJD,EAFgB,CAOhB;AACA;AACA;;AACA,eAAKW,QAAL,CAAc;AACZC,YAAAA,cAAc,EAAE,CAACC,MAAD,EAASC,QAAT,EAAmBC,WAAnB,EAAgCC,IAAhC,KAAyC;AACvD;AAAA;AAAA,0CAAUC,gBAAV,CAA2B;AAAA;AAAA,gDAAaf,kBAAxC,EAA4D,IAA5D,EAAkE,IAAlE,EAAwE,MAAM;AAC5E,qBAAKE,QAAL,CAAc;AAAA;AAAA,sDAAe;AAAEC,kBAAAA,OAAO,EAAE;AAAA;AAAA,oCAAKC,KAAL,CAAWC,CAAC,IAAIA,CAAC,CAACC,kBAAF,CAAqBU,kBAArC,EAAyD,EAAzD,EAA6D;AAAER,oBAAAA,QAAQ,EAAE;AAAZ,mBAA7D;AAAX,iBAAf,CAAd;AACD,eAFD,EAEGS,IAFH,CAESC,MAAD,IAAY;AAClB,oBAAI,CAAC;AAAA;AAAA,oDAAcC,kBAAd,CAAiCC,aAAjC,EAAL,EAAuD;AACvD,qBAAK1B,oBAAL,GAA4BoB,IAA5B;AACA;AAAA;AAAA,gDAAYlB,cAAZ,CAA2B;AAAA;AAAA,kDAAaI,kBAAxC,EAA4D;AAC1DW,kBAAAA,MAD0D;AAClDC,kBAAAA,QADkD;AACxCC,kBAAAA;AADwC,iBAA5D,EAEG;AAAEf,kBAAAA,SAAS,EAAE;AAAb,iBAFH;AAGD,eARD;AASD;AAXW,WAAd;AAaD;;AAESuB,QAAAA,eAAe,GAAS;AAChC;AAAA;AAAA,gDAAeC,UAAf,CAA0B,QAA1B;AACD;;AAEMC,QAAAA,OAAO,GAAG;AACf,cAAMC,UAAU,GAAG,KAAKC,KAAL,CAAWC,QAAX,EAAnB;AACA,eAAKC,MAAL,CAAY;AACVC,YAAAA,UAAU,EAAEJ,UAAU,CAACI,UADb;AAEVC,YAAAA,OAAO,EAAEL,UAAU,CAACI,UAAX,CAAsBC;AAFrB,WAAZ,EAGIC,KAAD,IAAsB;AACvB,mBAAO;AACLF,cAAAA,UAAU,EAAEE,KAAK,CAACF,UADb;AAELG,cAAAA,aAAa,EAAED,KAAK,CAACE,SAAN,CAAgBD,aAF1B;AAGLE,cAAAA,mBAAmB,EAAEH,KAAK,CAACE,SAAN,CAAgBC,mBAHhC;AAILJ,cAAAA,OAAO,EAAEC,KAAK,CAACF,UAAN,CAAiBC;AAJrB,aAAP;AAMD,WAVD;AAWA,iBAAO,IAAP;AACD;;AAhD6E,O;;yBAmDjE7C,qB","sourcesContent":["import { Node } from \"cc\"\r\nimport ViewModel from \"../../base/ViewModel\"\r\nimport { Hall_PcMainPanel, IProps, IEvent } from \"../components/Hall_PcMainPanel\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { baseBoardView, lang } from \"../index\"\r\nimport { addToastAction } from \"../store/actions/baseBoard\"\r\nimport Throttler from \"../../utils/Throttler\"\r\n\r\nclass PersonCenterViewModel extends ViewModel<Hall_PcMainPanel, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_PcMainPanel')\r\n  }\r\n  private memberInfoMedifyDone: () => void\r\n  protected begin() {\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.MEMBER_INFO, {}, { isLoading: true })\r\n    sktMsgListener.add(SKT_MAG_TYPE.MODIFY_MEMBER_INFO, \"member\", (data) => {\r\n      this.memberInfoMedifyDone && this.memberInfoMedifyDone()\r\n      this.dispatch(addToastAction({ content: lang.write(k => k.PersonCenterModule.PersonCenterEdit, {}, { placeStr: \"玩家资料编辑成功\" }) }))\r\n      sktInstance.sendSktMessage(SKT_MAG_TYPE.MEMBER_INFO, {}, { isLoading: true })\r\n    })\r\n    // sktMsgListener.add(SKT_MAG_TYPE.CONVERSION, 'member', () => {\r\n    //   this.dispatch(addToastAction({ content: lang.write(k => k.BaseBoardModule.OPERATE_DONE, {}, { placeStr: \"操作成功\" }) }))\r\n    // })\r\n    this.setEvent({\r\n      memberInfoDone: (gender, nickName, avatarIndex, done) => {\r\n        Throttler.isDebouncerAsync(SKT_MAG_TYPE.MODIFY_MEMBER_INFO, 1000, true, () => {\r\n          this.dispatch(addToastAction({ content: lang.write(k => k.PersonCenterModule.PersonCenterSumbit, {}, { placeStr: \"操作过于频繁，请稍等~\" }) }))\r\n        }).then((isPass) => {\r\n          if (!baseBoardView.mainPanelViewModel.isTouristPass()) return\r\n          this.memberInfoMedifyDone = done\r\n          sktInstance.sendSktMessage(SKT_MAG_TYPE.MODIFY_MEMBER_INFO, {\r\n            gender, nickName, avatarIndex\r\n          }, { isLoading: true })\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    sktMsgListener.removeById(\"member\")\r\n  }\r\n\r\n  public connect() {\r\n    const storeState = this.store.getState() as StateType;\r\n    this.inject({\r\n      memberInfo: storeState.memberInfo,\r\n      tourist: storeState.memberInfo.tourist\r\n    }, (state: StateType) => {\r\n      return {\r\n        memberInfo: state.memberInfo,\r\n        isShowWebView: state.baseBoard.isShowWebView,\r\n        isLoadRecommendData: state.baseBoard.isLoadRecommendData,\r\n        tourist: state.memberInfo.tourist\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default PersonCenterViewModel\r\n\r\n\r\n\r\n"]}