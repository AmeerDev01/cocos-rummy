{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thor/components/Thor_Roller.ts"],"names":["_decorator","Mask","Node","sp","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","RollerIconViewModel","sourceManageSeletor","thor_Audio","PrefabPathDefine","config","endRollingAction","SkeletonAnimationPlayer","dataTransfer","DataKeyType","SoundPathDefine","ccclass","property","Thor_Roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","coordList","rollerHeight","rollConfig","normalRollOption","timeCounter","scrollInterval","renderState","destructionIsComplete","multiple","itemHeight","winningData","multiplierIcon","propertyNode","props_roller","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","time","isHasten","events","rollStart","rollEnd","rollerIndex","setRoleAttack","isState","effectEnd","isplayIcon","start","initState","roundEnd","bindEvent","useProps","key","value","pre","initRoller","rolling","cur","setState","effectLength","length","effectCount","itemEffectEnd","reScroll","playOneShot","SCATTERT_RIGGER","filter","i","isUnMount","isReScroll","item","indexOf","setProps","scheduleOnce","WIN1","unMount","then","l","sparkling","callback","count","forEach","comp","playAni","multiplier","callBack","playallPurpose","getDestroyed","state","children","renderIcons","index","x","y","getPosition","yp","getRollerHeight","to","position","easing","call","SINGLE_ICON_FALL","creator","iconViewModel","joinIcon","insideCount","active","node","iconData","iconQueue","getComponent","height","intervalHeight","direction","DOWN","py","iconId","push","getChildByName","setPosition","Skeleton","TheNameOfTheAnimation","playAnimation","DROP_DOWN","maxCount","j","LargeRoller","largeRollOption","width","left","intervalWidth","right","rateItem","RATES","find","mountView","getFile","ICON","source","appendTo","speed","cache","bindUI","useState","enabled","window","setInterval","iconMv","undefined","isResetConditionMet","nodeHeight","scrollElement","_node","z","dispatch","destroyAllChildren","timer","stopIconIndex","clearInterval","update","deltaTime","getRoundEnd","onDestroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAyCC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AACnFC,MAAAA,a,iBAAAA,a;;AACsBC,MAAAA,a,iBAAAA,a;AAAeC,MAAAA,c,iBAAAA,c;;AACvCC,MAAAA,mB;;AACEC,MAAAA,mB,iBAAAA,mB;AAAqBC,MAAAA,U,iBAAAA,U;;AACrBC,MAAAA,gB,iBAAAA,gB;;AACFC,MAAAA,M;;AACEC,MAAAA,gB,iBAAAA,gB;;AACFC,MAAAA,uB;;AACAC,MAAAA,Y;AAAgBC,MAAAA,W,kBAAAA,W;;AAGdC,MAAAA,e,kBAAAA,e;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBtB,U;;6BAyBjBuB,W,WADZF,OAAO,CAAC,aAAD,C,gBAAR,MACaE,WADb;AAAA;AAAA,0CACuE;AAAA;AAAA;;AAEtE;AAFsE,eAG/DC,eAH+D,GAGtB,EAHsB;;AAKtE;AALsE,eAM9DC,iBAN8D,GAMlC,CANkC;;AAOtE;AAPsE,eAQ9DC,mBAR8D,GAQhC,CARgC;;AAStE;AATsE,eAU9DC,YAV8D,GAUvC,CAVuC;AAAA,eAW9DC,uBAX8D;AAAA,eAY9DC,WAZ8D;AAAA,eAa9DC,SAb8D,GAa1C,CAb0C;AAAA,eAc9DC,SAd8D,GAcnC,EAdmC;AAAA,eAe9DC,YAf8D;AAAA,eAgB9DC,UAhB8D,GAgBjC;AAAA;AAAA,gCAAOC,gBAhB0B;AAAA,eAiB9DC,WAjB8D,GAiBhD,CAjBgD;AAAA,eAkB9DC,cAlB8D,GAkBrC,GAlBqC;AAkBhC;AAlBgC,eAmB9DC,WAnB8D,GAmBhD,KAnBgD;AAoBtE;AACA;AArBsE,eAsBtEC,qBAtBsE,GAsB9C,KAtB8C;AAsBxC;AAtBwC,eAuBtEC,QAvBsE,GAuB3D,CAvB2D;AAuBzD;AAvByD,eAwB9DC,UAxB8D,GAwBjD,CAxBiD;AAAA,eAyB9DC,WAzB8D,GAyBlD,EAzBkD;AAAA,eA0B9DC,cA1B8D,GA0B/C,EA1B+C;AAAA,eA2B5DC,YA3B4D,GA2B7C;AACxBC,YAAAA,YAAY,EAAE,IAAI1C,IAAJ,EADU,CAExB;;AAFwB,WA3B6C;AAAA,eAgC/D2C,KAhC+D,GAgC/C;AACtBC,YAAAA,UAAU,EAAE,IADU;AAEtBC,YAAAA,cAAc,EAAE;AACfC,cAAAA,UAAU,EAAE;AAAA;AAAA,oDAAeC,IADZ;AAEfC,cAAAA,aAAa,EAAE,EAFA;AAGfC,cAAAA,IAAI,EAAE;AAHS,aAFM;AAOtBC,YAAAA,QAAQ,EAAE;AAPY,WAhC+C;AAAA,eA0C/DC,MA1C+D,GA0C9C;AACvBC,YAAAA,SAAS,EAAE,MAAM,CAAG,CADG;AAEvBC,YAAAA,OAAO,EAAGC,WAAD,IAAyB,CAAG,CAFd;AAGvBC,YAAAA,aAAa,EAAGC,OAAD,IAAa,CAAG,CAHR;AAIvBC,YAAAA,SAAS,EAAE,MAAM,CAAG,CAJG;AAKvBC,YAAAA,UAAU,EAAC,MAAI,CAAE;AALM,WA1C8C;AAAA;;AACtEC,QAAAA,KAAK,GAAG,CAAG;;AAiDDC,QAAAA,SAAS,GAAG;AACrB,iBAAO;AACNC,YAAAA,QAAQ,EAAE;AADJ,WAAP;AAGA;;AAESC,QAAAA,SAAS,GAAS,CAE3B;;AAESC,QAAAA,QAAQ,CAACC,GAAD,EAAoBC,KAApB,EAAmD;AAAA;;AACpE,cAAGD,GAAG,KAAK,UAAX,EAAsB;AACrB,iBAAK9B,cAAL,GAAoB,CAAC,KAAKS,KAAL,CAAWO,QAAZ,GAAqB,GAArB,GAAyB,GAA7C;AACA;;AACD,cAAIc,GAAG,KAAK,YAAZ,EAA0B;AACzB,gBAAI,CAACC,KAAK,CAACC,GAAX,EAAgB;AACf;AACA,mBAAKC,UAAL;AACA,aAHD,MAGO;AACN,mBAAKhC,WAAL,GAAmB,IAAnB;;AACA,kBAAI8B,KAAK,CAACC,GAAN,CAAUE,OAAV,KAAsB,KAAtB,IAA+BH,KAAK,CAACI,GAAN,CAAUD,OAAV,KAAsB,IAAzD,EAA+D;AAC9D,qBAAKE,QAAL,CAAc;AAAET,kBAAAA,QAAQ,EAAE;AAAZ,iBAAd;AACA,qBAAKtB,WAAL,GAAiB,EAAjB;AACA,qBAAKC,cAAL,GAAoB,EAApB;AACS,qBAAKW,MAAL,CAAYI,aAAZ,CAA0B,IAA1B;AACT,qBAAKlB,QAAL,GAAgB,CAAhB;AACA,qBAAKc,MAAL,CAAYC,SAAZ;AACA;AACD;AACD;;AACD,cAAIY,GAAG,KAAK,gBAAZ,EAA8B;AAC7B,gBAAMO,YAAY,GAAG,KAAK5B,KAAL,CAAWE,cAAX,CAA0BG,aAA1B,CAAwCwB,MAA7D;AACA,gBAAIC,WAAW,GAAG,CAAlB;;AACA,gBAAMC,aAAa,GAAG,MAAM;AAC3BD,cAAAA,WAAW;;AACX,kBAAIA,WAAW,IAAIF,YAAnB,EAAiC;AAChC;AACe,qBAAKI,QAAL,CAAc,IAAd,EAFiB,CAEG;;AACpB;AAAA;AAAA,8CAAWC,WAAX,CAAuB;AAAA;AAAA,wDAAgBC,eAAvC;AACf;AACD,aAPD,CAH6B,CAW7B;;;AACA,iBAAKzC,qBAAL,GAA6B,KAA7B;AACA,iBAAKd,eAAL,GAAuB,KAAKA,eAAL,CAAqBwD,MAArB,CAA4BC,CAAC,IAAI,CAACA,CAAC,CAACC,SAApC,CAAvB;AACA,gBAAIC,UAAU,GAAG,KAAjB,CAd6B,CAe7B;;AAf6B,yCAgBgC;AAC5D;;AACA;AACA,kBAAMC,IAAI,GAAG,KAAI,CAAC5D,eAAL,CAAqByD,CAArB,CAAb,CAH4D,CAI5D;AACA;;AACA,kBAAI,KAAI,CAACpC,KAAL,CAAWE,cAAX,CAA0BG,aAA1B,CAAwCmC,OAAxC,CAAgDJ,CAAhD,MAAuD,CAAC,CAA5D,EAA+D;AAC9DE,gBAAAA,UAAU,GAAG,IAAb;AACAC,gBAAAA,IAAI,CAACE,QAAL,CAAc;AAAEtC,kBAAAA,UAAU,EAAE,KAAI,CAACH,KAAL,CAAWE,cAAX,CAA0BC;AAAxC,iBAAd;;AACA,gBAAA,KAAI,CAACuC,YAAL,CAAkB,MAAM;AACvB;AAAA;AAAA,gDAAWT,WAAX,CAAuB;AAAA;AAAA,0DAAgBU,IAAvC;AACAJ,kBAAAA,IAAI,CAACK,OAAL,GAAeC,IAAf,CAAoB,MAAM;AACzBd,oBAAAA,aAAa;AACb,mBAFD;AAGA,iBALD,EAKG,CALH;AAMA,eATD,MASO;AACNQ,gBAAAA,IAAI,CAACE,QAAL,CAAc;AAAEtC,kBAAAA,UAAU,EAAE;AAAA;AAAA,wDAAeC;AAA7B,iBAAd;AACA;AACD,aAlC4B;;AAgB7B,iBAAK,IAAIgC,CAAC,GAAG,CAAR,EAAWU,CAAC,GAAG,KAAKnE,eAAL,CAAqBkD,MAAzC,EAAiDO,CAAC,GAAGU,CAArD,EAAwDV,CAAC,EAAzD;AAAA;AAAA;;AAmBA,iBAAK3C,qBAAL,GAA6B,IAA7B;AACA;AACD;;AACDsD,QAAAA,SAAS,CAACC,QAAD,EAAU;AAClB,cAAIC,KAAK,GAAC,CAAV;;AACA,cAAG,KAAKrD,WAAL,CAAiBiC,MAAjB,GAAwB,CAA3B,EAA6B;AAC5B,iBAAKjC,WAAL,CAAiBiC,MAAjB,GAAwB,CAAxB,IAA2B,KAAKjC,WAAL,CAAiBsD,OAAjB,CAAyB,CAACX,IAAD,EAAMH,CAAN,KAAU;AAC7DG,cAAAA,IAAI,CAACY,IAAL,CAAUC,OAAV,CAAkB,IAAlB,EAAuB,MAAI;AAC1BH,gBAAAA,KAAK;;AACL,oBAAGA,KAAK,IAAE,KAAKrD,WAAL,CAAiBiC,MAA3B,EAAkC;AACjCmB,kBAAAA,QAAQ;AACR;AACD,eALD;AAMA,aAP0B,CAA3B;AAQA,WATD,MASK;AACJA,YAAAA,QAAQ;AACR;AAED;;AACDK,QAAAA,UAAU,CAACC,QAAD,EAAU;AAAE;AACrB,cAAIL,KAAK,GAAC,CAAV;;AACA,cAAG,KAAKpD,cAAL,CAAoBgC,MAApB,GAA2B,CAA9B,EAAgC;AAC/B,iBAAKhC,cAAL,CAAoBqD,OAApB,CAA4BX,IAAI,IAAE;AACjCA,cAAAA,IAAI,CAACY,IAAL,CAAUI,cAAV,CAAyB,MAAI;AAC5BN,gBAAAA,KAAK;;AACL,oBAAGA,KAAK,IAAE,KAAKrD,WAAL,CAAiBiC,MAA3B,EAAkC;AACjCyB,kBAAAA,QAAQ;AACR;AACD,eALD;AAMA,aAPD;AAQA,WATD,MASK;AACJA,YAAAA,QAAQ;AACR;AACD;;AACME,QAAAA,YAAY,GAAG;AACrB,iBAAO,KAAK/D,qBAAZ;AACA;;AACOuC,QAAAA,QAAQ,CAACyB,KAAD,EAAS;AAAE;AAC1B,cAAI5B,MAAM,GAAG,KAAK/B,YAAL,CAAkBC,YAAlB,CAA+B2D,QAA/B,CAAwC7B,MAArD;;AAEA,cAAIA,MAAM,KAAK,CAAf,EAAkB;AACjB;AACA,WAFD,MAEO,IAAIA,MAAM,KAAK,CAAf,EAAkB;AACxB,iBAAK8B,WAAL,CAAiB9B,MAAjB,EAAyB4B,KAAzB;AACA,WAFM,MAGF;AACJ,iBAAK3D,YAAL,CAAkBC,YAAlB,CAA+B2D,QAA/B,CAAwCR,OAAxC,CAAgD,CAACX,IAAD,EAAOqB,KAAP,KAAiB;AAChE,kBAAI;AAAEC,gBAAAA,CAAF;AAAKC,gBAAAA;AAAL,kBAAWvB,IAAI,CAACwB,WAAL,EAAf;AACA,kBAAIC,EAAE,GAAG,CAAC,KAAKC,eAAL,EAAD,GAA0BL,KAAK,GAAG,KAAKjE,UAAvC,GAAqD,KAAKA,UAAL,GAAkB,CAAhF;AACApC,cAAAA,KAAK,CAACgF,IAAD,CAAL,CACE2B,EADF,CACK,KAAK3E,cADV,EAC0B;AAAE4E,gBAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAASoG,CAAT,EAAYG,EAAZ,EAAgB,CAAhB;AAAZ,eAD1B,EAC4D;AAAEI,gBAAAA,MAAM,EAAE;AAAV,eAD5D,EACmF;AADnF,eAEEC,IAFF,CAEO,MAAM;AACX;AACA,oBAAIT,KAAK,KAAK/B,MAAM,GAAG,CAAvB,EAA0B;AACzB,uBAAK8B,WAAL,CAAiB9B,MAAjB,EAAyB4B,KAAzB;AACA;AACD,eAPF,EAQEY,IARF,CAQO,MAAM;AACX,oBAAIP,CAAC,KAAKE,EAAV,EAAc;AACbzG,kBAAAA,KAAK,CAACgF,IAAD,CAAL,CAAY2B,EAAZ,CAAe,IAAf,EAAqB;AAAEC,oBAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAASoG,CAAT,EAAYG,EAAE,GAAG,CAAjB,EAAoB,CAApB;AAAZ,mBAArB,EAA2D;AAAEI,oBAAAA,MAAM,EAAE;AAAV,mBAA3D,EAAkF;AACjF;AACA;AAFD,mBAGEF,EAHF,CAGK,IAHL,EAGW;AAAEC,oBAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAASoG,CAAT,EAAYG,EAAZ,EAAgB,CAAhB;AAAZ,mBAHX,EAG6C;AAAEI,oBAAAA,MAAM,EAAE;AAAV,mBAH7C,EAGmE;AAHnE,mBAIEpD,KAJF;AAKA;;AACa;AAAA;AAAA,8CAAWiB,WAAX,CAAuB;AAAA;AAAA,wDAAgBqC,gBAAvC,EAAwD,CAAxD,EAA2D,KAA3D;AACd,eAjBF,EAkBEtD,KAlBF;AAmBA,aAtBD;AAuBA;AACD;;AACOuD,QAAAA,OAAO,GAAG;AACjB,cAAMC,aAAa,GAAG,KAAKC,QAAL,EAAtB;AACA,cAAMC,WAAW,GAAG,KAAK5E,YAAL,CAAkBC,YAAlB,CAA+B2D,QAA/B,CAAwCvB,MAAxC,CAA+CC,CAAC,IAAIA,CAAC,CAACuC,MAAtD,EAA8D9C,MAA9D,GAAuE,CAA3F;AACA,cAAMsC,QAAQ,GAAGK,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBb,WAAxB,EAAjB;AACA,cAAMc,QAAQ,GAAG,KAAK7E,KAAL,CAAWC,UAAX,CAAsB6E,SAAtB,CAAgC,KAAKlG,iBAArC,CAAjB;AACA,cAAMe,UAAU,GAAG6E,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBG,YAAxB,CAAqCvH,WAArC,EAAkDwH,MAAlD,GAA2DH,QAAQ,CAACI,cAAT,GAA0B,CAAxG;AACA,eAAKtF,UAAL,GAAkBA,UAAlB;;AACA,cAAI,KAAKK,KAAL,CAAWC,UAAX,CAAsBiF,SAAtB,KAAoC;AAAA;AAAA,8CAAcC,IAAtD,EAA4D;AAC3D,gBAAIC,EAAE,GAAG,CAAC,KAAKnB,eAAL,EAAD,GAA2BtE,UAAU,GAAG,CAAxC,GAA8C+E,WAAW,GAAG/E,UAArE;AACApC,YAAAA,KAAK,CAACiH,aAAa,CAACrB,IAAd,CAAmByB,IAApB,CAAL,CACEV,EADF,CACK,KAAK3E,cADV,EAC0B;AAAE4E,cAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqBuB,EAArB,EAAyB,CAAzB;AAAZ,aAD1B,EACqE;AAAEhB,cAAAA,MAAM,EAAE;AAAV,aADrE,EAC4F;AAD5F,aAEEC,IAFF,CAEO,MAAM;AACX;AACA,kBAAGG,aAAa,CAACa,MAAd,IAAwB,EAA3B,EAA8B;AAC7B,qBAAKzF,WAAL,CAAiB0F,IAAjB,CAAsBd,aAAtB,EAD6B,CAE7B;AACA;;AACD,kBAAIA,aAAa,CAACa,MAAd,GAAuB,EAA3B,EAA+B;AAAE;AAChC,qBAAKxF,cAAL,CAAoByF,IAApB,CAAyBd,aAAzB;AACA,qBAAKI,IAAL,CAAUW,cAAV,CAAyB,eAAzB,EAA0CC,WAA1C,CAAsD,IAAI/H,IAAJ,CAAS,CAAT,EAAY,CAAC,GAAD,GAAQiH,WAAW,GAAG/E,UAAtB,GAAoCA,UAAU,GAAG,CAA7D,EAAgE,CAAhE,CAAtD;AACA,qBAAKiF,IAAL,CAAUW,cAAV,CAAyB,eAAzB,EAA0CZ,MAA1C,GAAmD,IAAnD;AACA;AAAA;AAAA,wEAA4B,KAAKC,IAAL,CAAUW,cAAV,CAAyB,eAAzB,EAA0CR,YAA1C,CAAuDzH,EAAE,CAACmI,QAA1D,CAA5B,EAAiGjB,aAAa,CAACkB,qBAA/G,EAAsI,KAAtI,EAA6I,MAAM;AAClJ,uBAAKd,IAAL,CAAUW,cAAV,CAAyB,eAAzB,EAA0CZ,MAA1C,GAAmD,KAAnD,CADkJ,CAElJ;AACA;AACA;AACA;AACA;AACA;AACA,iBARD,EAQGgB,aARH;AASA;AACD,aAtBF,EAuBEzB,EAvBF,CAuBK,IAvBL,EAuBW;AAAEC,cAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqBuB,EAAE,GAAG,CAA1B,EAA6B,CAA7B;AAAZ,aAvBX,EAuB0D;AAAEhB,cAAAA,MAAM,EAAE;AAAV,aAvB1D,EAuBiF;AAvBjF,aAwBEF,EAxBF,CAwBK,IAxBL,EAwBW;AAAEC,cAAAA,QAAQ,EAAE,IAAI1G,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqBuB,EAArB,EAAyB,CAAzB;AAAZ,aAxBX,EAwBsD;AAAEhB,cAAAA,MAAM,EAAE;AAAV,aAxBtD,EAwB4E;AAxB5E,aAyBEpD,KAzBF;AA0BA,WA5BD,MA4BO;AACNwD,YAAAA,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBY,WAAxB,CAAoC,IAAI/H,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqB,EAAEa,WAAW,GAAG/E,UAAhB,IAA+BA,UAAU,GAAG,CAAjE,EAAqE,CAArE,CAApC;AACA;;AACD,eAAKT,SAAL,CAAeoG,IAAf,CAAoBd,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBT,QAAxB,CAAiCL,CAArD;AACA,iBAAOU,aAAP;AACA;;AACDb,QAAAA,WAAW,CAACvB,CAAD,EAAKqB,KAAL,EAAa;AACvB;AACA;AAAA;AAAA,wCAAWxB,WAAX,CAAuB;AAAA;AAAA,kDAAgB2D,SAAvC,EAAkD,CAAlD,EAAqD,KAArD;AACA,cAAI3C,KAAK,GAAGb,CAAC,IAAI,CAAjB;AACA,cAAMyD,QAAQ,GAAG,CAAjB;;AACA,eAAK,IAAIC,CAAC,GAAG7C,KAAb,EAAoB6C,CAAC,GAAGD,QAAxB,EAAkCC,CAAC,EAAnC,EAAuC;AACtC,gBAAI,KAAK9F,KAAL,CAAWC,UAAX,CAAsBiF,SAAtB,KAAoC;AAAA;AAAA,gDAAcC,IAAtD,EAA4D;AAC3D,mBAAKzC,YAAL,CAAkB,MAAM;AACvB,qBAAK3D,uBAAL,GAA+B,KAAKwF,OAAL,EAA/B;AACA,eAFD,EAEGuB,CAAC,GAAG,IAFP;AAGA,aAJD,MAIO;AACN,oBADM,CACC;AACP;AACD;AACD;AAED;;;AACQtE,QAAAA,UAAU,GAAG;AACpB;AACA;AACA;AACA,eAAKpC,UAAL,GAAkB,KAAKY,KAAL,CAAWC,UAAX,CAAsB8F,WAAtB,GAAoC;AAAA;AAAA,gCAAOC,eAA3C,GAA6D;AAAA;AAAA,gCAAO3G,gBAAtF;AACA,eAAKS,YAAL,CAAkBC,YAAlB,CAA+BgF,YAA/B,CAA4CvH,WAA5C,EAAyDyI,KAAzD,GAAiE,KAAKjG,KAAL,CAAWC,UAAX,CAAsBgG,KAAvF;AACA,eAAKnG,YAAL,CAAkBC,YAAlB,CAA+BgF,YAA/B,CAA4CrH,MAA5C,EAAoDwI,IAApD,GAA2D,KAAKlG,KAAL,CAAWC,UAAX,CAAsBkG,aAAjF;AACA,eAAKrG,YAAL,CAAkBC,YAAlB,CAA+BgF,YAA/B,CAA4CrH,MAA5C,EAAoD0I,KAApD,GAA4D,KAAKpG,KAAL,CAAWC,UAAX,CAAsBkG,aAAlF;AACA,eAAKvB,IAAL,CAAUG,YAAV,CAAuBvH,WAAvB,EAAoCyI,KAApC,GAA4C,KAAKjG,KAAL,CAAWC,UAAX,CAAsBgG,KAAtB,GAA8B,KAAKjG,KAAL,CAAWC,UAAX,CAAsBkG,aAAtB,GAAsC,CAAhH;AACA,eAAKpH,uBAAL,GAA+B,KAAKwF,OAAL,EAA/B;AACA,eAAKZ,WAAL;AACA;AAED;;;AACQc,QAAAA,QAAQ,GAAG;AAClB;AACA;AACA,cAAMI,QAAQ,GAAG,KAAK7E,KAAL,CAAWC,UAAX,CAAsB6E,SAAtB,CAAgC,KAAKlG,iBAArC,CAAjB,CAHkB,CAIlB;;AACA,cAAIiG,QAAQ,CAACQ,MAAT,GAAkB,EAAtB,EAA0B;AACzB,gBAAMgB,QAAQ,GAAG;AAAA;AAAA,8CAAa;AAAA;AAAA,4CAAYC,KAAzB,EAAgCC,IAAhC,CAAqChE,IAAI,IAAIA,IAAI,CAAC,CAAD,CAAJ,KAAYsC,QAAQ,CAACQ,MAArB,IAA+B,KAAKrF,KAAL,CAAWC,UAAX,CAAsB2D,KAAtB,KAAgCrB,IAAI,CAAC,CAAD,CAAhH,CAAjB;;AACA,gBAAI8D,QAAJ,EAAc;AACbxB,cAAAA,QAAQ,CAACnF,QAAT,GAAoB2G,QAAQ,CAAC,CAAD,CAA5B;AACA,mBAAK3G,QAAL,IAAiB2G,QAAQ,CAAC,CAAD,CAAzB;AACA;AACD;;AACD,cAAM7B,aAAkB,GAAG;AAAA;AAAA,4DAA0BgC,SAA1B,CAAoC;AAAA;AAAA,4DAAsBC,OAAtB,CAA8B;AAAA;AAAA,oDAAiBC,IAA/C,EAAqDC,MAAzF,EAAiGC,QAAjG,CAA0G,KAAK9G,YAAL,CAAkBC,YAA5H,EAA0I0C,QAA1I,CAAmJ;AAAEoC,YAAAA;AAAF,WAAnJ,CAA3B;AACA,cAAMV,QAAQ,GAAGK,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBb,WAAxB,EAAjB,CAbkB,CAclB;;AACA,cAAMpE,UAAU,GAAG6E,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBG,YAAxB,CAAqCvH,WAArC,EAAkDwH,MAAlD,GAA2DH,QAAQ,CAACI,cAAT,GAA0B,CAAxG;;AACA,cAAI,KAAKjF,KAAL,CAAWC,UAAX,CAAsBiF,SAAtB,KAAoC;AAAA;AAAA,8CAAcC,IAAtD,EAA4D;AAC3DX,YAAAA,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBY,WAAxB,CAAoC,IAAI/H,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqB,KAAK5E,SAAL,GAAiBU,UAAjB,GAA8B,KAAKK,KAAL,CAAWC,UAAX,CAAsB4G,KAAzE,EAAgF,CAAhF,CAApC;AACA,iBAAKjI,iBAAL;AACA,iBAAKA,iBAAL,KAA2B,KAAKoB,KAAL,CAAWC,UAAX,CAAsB6E,SAAtB,CAAgCjD,MAA3D,KAAsE,KAAKjD,iBAAL,GAAyB,CAA/F;AACA,iBAAKE,YAAL,GAAoB0F,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBT,QAAxB,CAAiCL,CAArD;AACA,WALD,MAKO;AACNU,YAAAA,aAAa,CAACrB,IAAd,CAAmByB,IAAnB,CAAwBY,WAAxB,CAAoC,IAAI/H,IAAJ,CAAS0G,QAAQ,CAACN,CAAlB,EAAqB,KAAK5E,SAAL,GAAiBU,UAAjB,GAA8B,KAAKK,KAAL,CAAWC,UAAX,CAAsB4G,KAAzE,EAAgF,CAAhF,CAApC;AACA,iBAAKjI,iBAAL;AACA,iBAAKA,iBAAL,KAA2B,CAAC,CAA5B,KAAkC,KAAKA,iBAAL,GAAyB,KAAKoB,KAAL,CAAWC,UAAX,CAAsB6E,SAAtB,CAAgCjD,MAAhC,GAAyC,CAApG;AACA;;AACD2C,UAAAA,aAAa,CAACa,MAAd,GAAuBR,QAAQ,CAACQ,MAAhC;;AACA,cAAIR,QAAQ,CAACQ,MAAT,GAAkB,EAAtB,EAA0B;AACzB,iBAAK7E,MAAL,CAAYI,aAAZ,CAA0B,KAA1B;;AACA,oBAAQiE,QAAQ,CAACQ,MAAjB;AACC,mBAAK,EAAL;AACCb,gBAAAA,aAAa,CAACkB,qBAAd,GAAsC,UAAtC;AACA;;AACD,mBAAK,EAAL;AACClB,gBAAAA,aAAa,CAACkB,qBAAd,GAAsC,SAAtC;AACA;;AACD,mBAAK,EAAL;AACClB,gBAAAA,aAAa,CAACkB,qBAAd,GAAsC,WAAtC;AACA;;AACD,mBAAK,EAAL;AACClB,gBAAAA,aAAa,CAACkB,qBAAd,GAAsC,QAAtC;AACA;AAZF;AAcA;;AACD,eAAK/G,eAAL,CAAqB2G,IAArB,CAA0Bd,aAA1B;AACA,iBAAOA,aAAP;AACA;AAED;AACD;AACA;AACA;AACA;;;AACSP,QAAAA,eAAe,CAAC6C,KAAD,EAAyB;AAAA,cAAxBA,KAAwB;AAAxBA,YAAAA,KAAwB,GAAP,KAAO;AAAA;;AAC/C,cAAI,CAACA,KAAL,EAAY;AACX,iBAAK3H,YAAL,GAAoB,KAAKW,YAAL,CAAkBC,YAAlB,CAA+BgF,YAA/B,CAA4CvH,WAA5C,EAAyDwH,MAA7E;AACA;;AACD,iBAAO,KAAK7F,YAAZ;AACA;;AAES4H,QAAAA,MAAM,GAAS;AACxB,eAAK5H,YAAL,GAAoB,KAAK8E,eAAL,EAApB;AACA,eAAK+C,QAAL,CAAc,CAAC3F,GAAD,EAAMC,KAAN,KAAgB;AAC7B,iBAAKsD,IAAL,CAAUG,YAAV,CAAuB3H,IAAvB,EAA6B6J,OAA7B,GAAuC,CAAC3F,KAAK,CAACI,GAA9C;AACA,WAFD,EAEG,CAAC,UAAD,CAFH;AAGA,WAAC,KAAK1C,WAAN,KAAsB,KAAKA,WAAL,GAAmBkI,MAAM,CAACC,WAAP,CAAmB,MAAM;AACjE,iBAAKxI,eAAL,GAAuB,KAAKA,eAAL,CAAqBwD,MAArB,CAA4BiF,MAAM,IAAI;AAC5D,kBAAIA,MAAM,CAAC/E,SAAX,EAAsB;AACrB+E,gBAAAA,MAAM,GAAGC,SAAT;AACA,uBAAO,KAAP;AACA;;AACD,qBAAO,IAAP;AACA,aANsB,CAAvB;AAOA,WARwC,EAQtC,GARsC,CAAzC;AASA;;AACDC,QAAAA,mBAAmB,CAAC1D,KAAD,EAAQgB,IAAR,EAAczF,YAAd,EAA4B;AAC9C,cAAMoI,UAAU,GAAG3C,IAAI,CAACG,YAAL,CAAkBvH,WAAlB,EAA+BwH,MAAlD;AACA,iBAAO,KAAK1F,WAAL,IAAoB,CAApB,IAAyBsE,KAAK,KAAK,KAAKjF,eAAL,CAAqBkD,MAArB,GAA8B,CAAjE,IACH+C,IAAI,CAACb,WAAL,GAAmBD,CAAnB,IAAwB,EAAE3E,YAAY,GAAGoI,UAAU,GAAG,CAA9B,CAD5B;AAEA;;AAEOC,QAAAA,aAAa,GAAG;AACvB,cAAMrI,YAAY,GAAG,KAAK8E,eAAL,CAAqB,IAArB,CAArB;AACA,eAAKtF,eAAL,CAAqBwD,MAArB,CAA4BI,IAAI,IAAIA,IAAI,CAACY,IAAL,CAAUyB,IAAV,IAAkBrC,IAAI,CAACY,IAAL,CAAUyB,IAAV,CAAeD,MAArE,EAA6EzB,OAA7E,CAAqF,CAACkE,MAAD,EAAShF,CAAT,KAAe;AACnG,gBAAMqF,KAAK,GAAGL,MAAM,CAACjE,IAAP,CAAYyB,IAA1B;;AACA,gBAAM;AAAEf,cAAAA,CAAF;AAAKC,cAAAA,CAAL;AAAQ4D,cAAAA;AAAR,gBAAcD,KAAK,CAAC1D,WAAN,EAApB;;AACA,gBAAI,KAAK/D,KAAL,CAAWC,UAAX,CAAsBiF,SAAtB,KAAoC;AAAA;AAAA,gDAAcC,IAAtD,EAA4D;AAC3DsC,cAAAA,KAAK,CAACjC,WAAN,CAAkB,IAAI/H,IAAJ,CAASoG,CAAT,EAAYC,CAAC,GAAG,KAAK9D,KAAL,CAAWC,UAAX,CAAsB4G,KAAtC,EAA6Ca,CAA7C,CAAlB;;AACA,kBAAI,KAAKJ,mBAAL,CAAyBlF,CAAzB,EAA4BqF,KAA5B,EAAmCtI,YAAnC,CAAJ,EAAsD;AACrD,qBAAKG,WAAL,GAAmB,CAAnB;AACA,qBAAKqC,QAAL,CAAc;AAAET,kBAAAA,QAAQ,EAAE;AAAZ,iBAAd,EAFqD,CAGrD;;AACA,qBAAKyG,QAAL,CAAc;AAAA;AAAA,0DAAiB,KAAK3H,KAAL,CAAWC,UAAX,CAAsB2D,KAAvC,EAA8C,KAA9C,CAAd;AACA,qBAAK9D,YAAL,CAAkBC,YAAlB,CAA+B6H,kBAA/B,GALqD,CAKD;;AACpD,oBAAIC,KAAK,GAAGV,WAAW,CAAC,MAAM;AAC7B,sBAAI,CAAC,KAAKnH,KAAV,EAAiB;AAChB;AACA;;AACD,sBAAI,KAAKA,KAAL,CAAWC,UAAX,CAAsB6H,aAAtB,IAAuC,KAAK9H,KAAL,CAAWC,UAAX,CAAsB6H,aAAtB,IAAuC,CAAC,CAAnF,EAAsF;AAAE;AACvFC,oBAAAA,aAAa,CAACF,KAAD,CAAb;AACA,yBAAKjJ,iBAAL,GAAyB,KAAKoB,KAAL,CAAWC,UAAX,CAAsB6H,aAAtB,GAAsC,CAA/D;AACA,yBAAKnE,WAAL,CAAiB,KAAK7D,YAAL,CAAkBC,YAAlB,CAA+B2D,QAA/B,CAAwC7B,MAAzD;AACA,yBAAKa,YAAL,CAAkB,MAAM;AACvB,0BAAI,KAAK1C,KAAL,CAAWC,UAAX,CAAsB2D,KAAtB,KAAgC,CAAhC,IAAqC,KAAKpE,WAA9C,EAA2D;AAAE;AAC5D,6BAAKA,WAAL,GAAmB,KAAnB;AACA,6BAAKgB,MAAL,CAAYE,OAAZ,CAAoB,KAAKV,KAAL,CAAWC,UAAX,CAAsB2D,KAA1C;AACA;AACD,qBALD,EAKG,GALH;AAMA;AACD,iBAfsB,EAepB,GAfoB,CAAvB;AAgBA;AACD;AACD,WA7BD;AA8BA;;AACDoE,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACzB,cAAI,KAAKjI,KAAL,CAAWC,UAAX,CAAsBwB,OAA1B,EAAmC;AAClC,iBAAKnC,WAAL,IAAoB,IAApB;;AACA,gBAAI,KAAKA,WAAL,IAAoB,KAAKC,cAAL,GAAsB,KAAKS,KAAL,CAAWC,UAAX,CAAsB2D,KAApE,EAA2E;AAC1E,mBAAK4D,aAAL;AACA;AACD;AACD;;AACMU,QAAAA,WAAW,GAAG;AACpB,iBAAO,KAAKzE,KAAL,CAAWvC,QAAlB;AACA;;AACDiH,QAAAA,SAAS,GAAG;AACXjB,UAAAA,MAAM,CAACa,aAAP,CAAqB,KAAK/I,WAA1B;AACA;;AAjYqE,O","sourcesContent":["import { _decorator, Component, instantiate, log, Mask, Node, sp, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { sourceManageSeletor, thor_Audio, winShowViewModel } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction } from '../store/actions/roller';\r\nimport SkeletonAnimationPlayer from '../SkeletonPlay';\r\nimport dataTransfer, { DataKeyType } from '../dataTransfer';\r\nimport { getNodePositionInCanvas } from '../../../utils/tool';\r\nimport { changeMultipleTotal } from '../store/actions/game';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[],\r\n\t\ttime: number\r\n\t}\r\n\tisHasten: boolean\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n\tsetRoleAttack?: (isState: boolean) => void\r\n\teffectEnd?: () => void\r\n\tisplayIcon?:()=>void\r\n}\r\n\r\n@ccclass('Thor_Roller')\r\nexport class Thor_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\tprivate coordList: Array<number> = []\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\tprivate timeCounter = 0\r\n\tprivate scrollInterval: number = 0.3; // 滚动间隔，可以根据需求调整\r\n\tprivate renderState = false;\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tdestructionIsComplete = false // 图标销毁情况\r\n\tmultiple = 0 //倍数\r\n\tprivate itemHeight = 0\r\n\tprivate winningData=[]\r\n\tprivate multiplierIcon=[]\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\t//props_daqipao: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: [],\r\n\t\t\ttime: 0\r\n\t\t},\r\n\t\tisHasten: false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\trollEnd: (rollerIndex: number) => { },\r\n\t\tsetRoleAttack: (isState) => { },\r\n\t\teffectEnd: () => { },\r\n\t\tisplayIcon:()=>{}\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif(key === 'isHasten'){\r\n\t\t\tthis.scrollInterval=!this.props.isHasten?0.1:0.3\r\n\t\t}\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\t//this.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\tthis.renderState = true\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\tthis.winningData=[]\r\n\t\t\t\t\tthis.multiplierIcon=[]\r\n\t\t            this.events.setRoleAttack(true)\r\n\t\t\t\t\tthis.multiple = 0\r\n\t\t\t\t\tthis.events.rollStart()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\tconst effectLength = this.props.iconEffectData.iconEffectArr.length\r\n\t\t\tlet effectCount = 0;\r\n\t\t\tconst itemEffectEnd = () => {\r\n\t\t\t\teffectCount++;\r\n\t\t\t\tif (effectCount >= effectLength) {\r\n\t\t\t\t\t// this.events.effectEnd();\r\n                    this.reScroll(true) // 重新滚动\r\n                    thor_Audio.playOneShot(SoundPathDefine.SCATTERT_RIGGER)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.destructionIsComplete = false\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tlet isReScroll = false\r\n\t\t\t//console.log(this.props.iconEffectData);\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t// const index = this.props.rollerType.direction === DirectionType.DOWN ? i : (this.displayIconList.length - 1 - i)\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst item = this.displayIconList[i]\r\n\t\t\t\t// console.log('clear --------- ' , this.props.rollerType.index, JSON.stringify(item.comp.props.iconData), i,\r\n\t\t\t\t// \tJSON.stringify(this.props.iconEffectData.iconEffectArr), this.props.iconEffectData.iconEffectArr.indexOf(i));\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(i) !== -1) {\r\n\t\t\t\t\tisReScroll = true;\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\tthor_Audio.playOneShot(SoundPathDefine.WIN1)\r\n\t\t\t\t\t\titem.unMount().then(() => {\r\n\t\t\t\t\t\t\titemEffectEnd();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 1)\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.destructionIsComplete = true\r\n\t\t}\r\n\t}\r\n\tsparkling(callback){\r\n\t\tlet count=0\r\n\t\tif(this.winningData.length>0){\r\n\t\t\tthis.winningData.length>0&&this.winningData.forEach((item,i)=>{\r\n\t\t\t\titem.comp.playAni(true,()=>{\r\n\t\t\t\t\tcount++\r\n\t\t\t\t\tif(count>=this.winningData.length){\r\n\t\t\t\t\t\tcallback()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tcallback()\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tmultiplier(callBack){ // 倍数相乘特效\r\n\t\tlet count=0\r\n\t\tif(this.multiplierIcon.length>0){\r\n\t\t\tthis.multiplierIcon.forEach(item=>{\r\n\t\t\t\titem.comp.playallPurpose(()=>{\r\n\t\t\t\t\tcount++\r\n\t\t\t\t\tif(count>=this.winningData.length){\r\n\t\t\t\t\t\tcallBack()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tcallBack()\r\n\t\t}\r\n\t}\r\n\tpublic getDestroyed() {\r\n\t\treturn this.destructionIsComplete\r\n\t}\r\n\tprivate reScroll(state?) { // 重新滚动\r\n\t\tlet length = this.propertyNode.props_roller.children.length\r\n\t\t\r\n\t\tif (length === 5) {\r\n\t\t\treturn;\r\n\t\t} else if (length === 0) {\r\n\t\t\tthis.renderIcons(length, state)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.propertyNode.props_roller.children.forEach((item, index) => {\r\n\t\t\t\tlet { x, y } = item.getPosition()\r\n\t\t\t\tlet yp = -this.getRollerHeight() + index * this.itemHeight + (this.itemHeight / 2)\r\n\t\t\t\ttween(item)\r\n\t\t\t\t\t.to(this.scrollInterval, { position: new Vec3(x, yp, 1) }, { easing: 'cubicIn' }) // 使用 to 缓动到新位置\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\t// 在动画完成后执行操作\r\n\t\t\t\t\t\tif (index === length - 1) {\r\n\t\t\t\t\t\t\tthis.renderIcons(length, state)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\tif (y !== yp) {\r\n\t\t\t\t\t\t\ttween(item).to(0.08, { position: new Vec3(x, yp + 8, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\t\t\t\t\t\t// .to(0.05, { position: new Vec3(x, yp - 6, 1) }, { easing: 'sineIn' }) // 回弹向下\r\n\t\t\t\t\t\t\t\t// .to(0.05, { position: new Vec3(x, yp + 3, 1) }, { easing: 'sineOut' }) // 再次回弹向上\r\n\t\t\t\t\t\t\t\t.to(0.05, { position: new Vec3(x, yp, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t\t\t\t\t\t\t.start()\r\n\t\t\t\t\t\t}\r\n\t                  \tthor_Audio.playOneShot(SoundPathDefine.SINGLE_ICON_FALL,1, false)\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tprivate creator() {\r\n\t\tconst iconViewModel = this.joinIcon()\r\n\t\tconst insideCount = this.propertyNode.props_roller.children.filter(i => i.active).length - 1\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tthis.itemHeight = itemHeight\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\tlet py = -this.getRollerHeight() + (itemHeight / 2) + (insideCount * itemHeight)\r\n\t\t\ttween(iconViewModel.comp.node)\r\n\t\t\t\t.to(this.scrollInterval, { position: new Vec3(position.x, py, 1) }, { easing: 'cubicIn' }) // 使用 to 缓动到新位置\r\n\t\t\t\t.call(() => {\r\n\t\t\t\t\t// 在动画完成后执行操作\r\n\t\t\t\t\tif(iconViewModel.iconId == 10){\r\n\t\t\t\t\t\tthis.winningData.push(iconViewModel)\r\n\t\t\t\t\t\t// iconViewModel.comp.playAni(true)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iconViewModel.iconId > 10) { //倍数图标\r\n\t\t\t\t\t\tthis.multiplierIcon.push(iconViewModel)\r\n\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').setPosition(new Vec3(0, -300 + (insideCount * itemHeight) + itemHeight / 2, 1))\r\n\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').active = true\r\n\t\t\t\t\t\tnew SkeletonAnimationPlayer(this.node.getChildByName('shandian_icon').getComponent(sp.Skeleton), iconViewModel.TheNameOfTheAnimation, false, () => {\r\n\t\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').active = false\r\n\t\t\t\t\t\t\t// let props_label_rate_num=iconViewModel.comp.node.getChildByName('props_label_rate_num')\r\n\t\t\t\t\t\t\t// let node = instantiate(props_label_rate_num)\r\n\t\t\t\t\t\t\t// const beginPosition = getNodePositionInCanvas(node)\r\n\t\t\t\t\t\t\t// let parentNode = winShowViewModel.comp.getPropertyNode().props_label_gold as Node\r\n\t\t\t\t\t\t\t// const targetPosition = getNodePositionInCanvas(parentNode)\r\n\t\t\t\t\t\t\t// node.setPosition(new Vec3(targetPosition))\r\n\t\t\t\t\t\t}).playAnimation();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.to(0.08, { position: new Vec3(position.x, py + 8, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\t\t.to(0.05, { position: new Vec3(position.x, py, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t\t\t.start();\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -(insideCount * itemHeight) - (itemHeight / 2), 1))\r\n\t\t}\r\n\t\tthis.coordList.push(iconViewModel.comp.node.position.y)\r\n\t\treturn iconViewModel\r\n\t}\r\n\trenderIcons(i?, state?) {\r\n\t\t// console.log('renderIcons -- index: ', this.props.rollerType.index, 'count: ', i ,'stopIconIndex: ', this.props.rollerType.stopIconIndex)\r\n\t\tthor_Audio.playOneShot(SoundPathDefine.DROP_DOWN, 1, false)\r\n\t\tlet count = i || 0;\r\n\t\tconst maxCount = 5;\r\n\t\tfor (let j = count; j < maxCount; j++) {\r\n\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.lastInsertIconViewModel = this.creator();\r\n\t\t\t\t}, j * 0.05)\r\n\t\t\t} else {\r\n\t\t\t\tbreak; // 如果方向不是 DOWN，跳出循环\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**初始化 */\r\n\tprivate initRoller() {\r\n\t\t//取队列最后n个图标\r\n\t\t// const iconQueue = [...this.props.iconQueue]\r\n\t\t// const iconQueue = clone(this.props.iconQueue)\r\n\t\tthis.rollConfig = this.props.rollerType.LargeRoller ? config.largeRollOption : config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\tthis.renderIcons()\r\n\t}\r\n\r\n\t/**添加图标 */\r\n\tprivate joinIcon() {\r\n\t\t//滑槽中的图表数\r\n\t\t//下一个要加入的图标\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\t// console.log('下一关图标',this.nextJoinIconIndex,iconData.iconId,'队列',this.props.rollerType.index);\r\n\t\tif (iconData.iconId > 10) {\r\n\t\t\tconst rateItem = dataTransfer(DataKeyType.RATES).find(item => item[2] === iconData.iconId && this.props.rollerType.index === item[0]);\r\n\t\t\tif (rateItem) {\r\n\t\t\t\ticonData.multiple = rateItem[3];\r\n\t\t\t\tthis.multiple += rateItem[3];\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst iconViewModel: any = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source).appendTo(this.propertyNode.props_roller).setProps({ iconData })\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\t//icon的高度加上上下纵向高度\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY + itemHeight - this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex++\r\n\t\t\tthis.nextJoinIconIndex === this.props.rollerType.iconQueue.length && (this.nextJoinIconIndex = 0)\r\n\t\t\tthis.compensation = iconViewModel.comp.node.position.y\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY - itemHeight + this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex--\r\n\t\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t}\r\n\t\ticonViewModel.iconId = iconData.iconId\r\n\t\tif (iconData.iconId > 10) {\r\n\t\t\tthis.events.setRoleAttack(false)\r\n\t\t\tswitch (iconData.iconId) {\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_green\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 12:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_blue\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_purple\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 14:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_red\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.displayIconList.push(iconViewModel)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns\r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\t\t}, [\"roundEnd\"])\r\n\t\t!this.timer_clear && (this.timer_clear = window.setInterval(() => {\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(iconMv => {\r\n\t\t\t\tif (iconMv.isUnMount) {\r\n\t\t\t\t\ticonMv = undefined\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t}, 200))\r\n\t}\r\n\tisResetConditionMet(index, node, rollerHeight) { \r\n\t\tconst nodeHeight = node.getComponent(UITransform).height;\r\n\t\treturn this.timeCounter != 0 && index === this.displayIconList.length - 1 && \r\n\t\t\t   node.getPosition().y <= -(rollerHeight + nodeHeight * 5);\r\n\t}\r\n\r\n\tprivate scrollElement() {\r\n\t\tconst rollerHeight = this.getRollerHeight(true);\r\n\t\tthis.displayIconList.filter(item => item.comp.node && item.comp.node.active).forEach((iconMv, i) => {\r\n\t\t\tconst _node = iconMv.comp.node\r\n\t\t\tconst { x, y, z } = _node.getPosition()\r\n\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\t_node.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t\tif (this.isResetConditionMet(i, _node, rollerHeight)) {\r\n\t\t\t\t\tthis.timeCounter = 0\r\n\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t// thor_Audio.playOneShot(SoundPathDefine.DROP_DOWN)\r\n\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\tthis.propertyNode.props_roller.destroyAllChildren()\t// 超过底部卸载所以node\r\n\t\t\t\t\tlet timer = setInterval(() => {\r\n\t\t\t\t\t\tif (!this.props) {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex && this.props.rollerType.stopIconIndex != -1) { // 接口返回停止下标才开始掉落\r\n\t\t\t\t\t\t\tclearInterval(timer)\r\n\t\t\t\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.stopIconIndex - 1\r\n\t\t\t\t\t\t\tthis.renderIcons(this.propertyNode.props_roller.children.length)\r\n\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\tif (this.props.rollerType.index === 5 && this.renderState) { //避免触发多次\r\n\t\t\t\t\t\t\t\t\tthis.renderState = false\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 0.5)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 100)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.props.rollerType.rolling) {\r\n\t\t\tthis.timeCounter += 0.05\r\n\t\t\tif (this.timeCounter >= this.scrollInterval * this.props.rollerType.index) {\r\n\t\t\t\tthis.scrollElement();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n\r\n"]}