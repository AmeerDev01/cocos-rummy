{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egypt/Slot/Component/Egypt_Roller.ts"],"names":["_decorator","Node","UITransform","Size","Prefab","instantiate","Vec3","tween","Mask","BaseComponent","AudioManager","SoundList","ccclass","property","Egypt_Roller","rollerDataRep","isRoll","rollerData","rollerIndex","endFlag","initStartIndex","lastJoinIconIndex","stopHandler","isSpeed","start","bindUI","getRollProxy","getRepository","rootUi","root","getComponent","anchorY","rollerUi","RollerLayOut","data","length","setContentSize","intervalWidth","rollerWidth","intervalHeight","rollerheight","portraitNum","setPosition","position","x","i","icon","y","addChild","index","setFace","bindEvent","bindRollerData","startRoll","stopIndex","joinIcon","setStopIndex","children","forEach","setEffect","node","enabled","stopRoll","cbFn","addLastJoinIconIndex","showResult","setSiblingIndex","stopCallBack","getInstance","playSound","theRollerStops","destroy","addDockIcon","targetArr","removeAllDockIcon","item","icon2","hiddenAmounts","RollerLayOut2","e","console","error","removeAllChildren","togglesThePopUpLayerState","state","active","setIconEffect","mode","target","allState","comp","some","iconId","iconIndex","rollWithCell","to","rollSpeed","window","setTimeout","deviation","Math","abs","_lastJoinIconIndex","count","easing","call","lastChild","value","newValue","update","deltaTime","lateUpdate"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label, UITransform, Size, Prefab, instantiate, Vec3, Layout, tween, log, Mask } from 'cc';\r\nimport BaseComponent from './BaseComponent';\r\nimport { SlotRepository, RollerType } from '../Repositories/SlotRepository';\r\nimport { Egypt_Icon } from './Egypt_Icon';\r\nimport { SlotProxy } from '../Proxy/SlotProxy';\r\nimport config from '../config'\r\nimport { AudioManager, SoundList } from '../Managr/AudioManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 动画停止回调\r\n */\r\ntype StopHandlerType = (rollerIndex: number, rollerData: RollerType) => void\r\n\r\n@ccclass('Egypt_Roller')\r\nexport class Egypt_Roller extends BaseComponent {\r\n\t@property(Node)\r\n\tRollerLayOut: Node = null\r\n\r\n\t@property(Prefab)\r\n\ticon: Prefab = null\r\n\r\n\t@property(Prefab)\r\n\ticon2: Prefab = null\r\n\r\n    @property(Node)\r\n    RollerLayOut2: Node = null\r\n\tprivate rollerDataRep: SlotRepository\r\n\tprivate isRoll = false\r\n\tprivate rollerData: RollerType\r\n\t/**第几条滑槽，序号 */\r\n\tprivate rollerIndex: number\r\n\t/**此值存在，即要检测停止了 */\r\n\tprivate endFlag: boolean = true\r\n\t/**初始化时，图标开始的排列序号 */\r\n\tprivate initStartIndex = 0\r\n\t/**下一个要加入的图标 */\r\n\tprivate lastJoinIconIndex = 0\r\n\t// private target: number = -1\r\n\t/**动态效果停止后的动态回调函数 */\r\n\tprivate stopHandler: StopHandlerType\r\n\r\n\tprivate isSpeed = false;\r\n\r\n\tstart() { }\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerDataRep = this.getRollProxy().getRepository();\r\n\t\t// const layout = this.RollerLayOut.getComponent(Layout)\r\n\t\t// layout.spacingY = this.rollerData.roller.intervalHeight\r\n\t\t// 配置滑槽宽高度(也就是蒙板宽高)\r\n\t\tconst rootUi = this.root.getComponent(UITransform) as UITransform\r\n\t\trootUi.anchorY = 1\r\n\t\tconst rollerUi = this.RollerLayOut.getComponent(UITransform) as UITransform\r\n\t\t// rootUi.anchorX = 0\r\n\t\trollerUi.anchorY = 1\r\n\t\t// rollerUi.anchorX = 0\r\n\t\tthis.lastJoinIconIndex = this.initStartIndex - 1\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// 设置蒙版组件高度\r\n\t\trootUi.setContentSize(new Size(this.rollerData.intervalWidth + this.rollerData.rollerWidth,\r\n\t\t\t((this.rollerData.intervalHeight + this.rollerData.rollerheight) * this.rollerData.portraitNum) + this.rollerData.intervalHeight))\r\n\t\t//设置滑道高度，多一个高度\r\n\t\trollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n\t\t\t(this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum + 1)))\r\n\t\t// 滑道网上顶一个单位（但是上沿有遮挡，再降30）\r\n\t\tthis.RollerLayOut.setPosition(this.RollerLayOut.position.x, (this.rollerData.intervalHeight + this.rollerData.rollerheight) - this.rollerData.intervalHeight)\r\n\t\t// 初始化即将开始的图标\r\n\t\tfor (let i = 0; i < this.rollerData.portraitNum; i++) {\r\n\t\t\tconst icon = instantiate(this.icon)\r\n\t\t\ticon.setPosition(new Vec3(0, icon.position.y - (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (i + 1)))\r\n\t\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t\tconst index = this.initStartIndex + i;\r\n\t\t\t(<Egypt_Icon>icon.getComponent(\"Egypt_Icon\")).setFace(this.rollerData.data[index])\r\n\r\n\t\t}\r\n\t\t// this.bubble.active = this.rollerData.isBigIcon\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\t/**指定滑槽数据 */\r\n\tpublic bindRollerData(rollerIndex: number, data: RollerType) {\r\n\t\tthis.rollerData = data\r\n\t\tthis.rollerIndex = rollerIndex\r\n\t}\r\n\t/**\r\n\t * 开始滚动\r\n\t * @param stopIndex 设定要停止的序号（从1开始的）\r\n\t */\r\n\tpublic startRoll(stopIndex: number, isSpeed: boolean = false) {\r\n\t\tthis.isSpeed = isSpeed;\r\n\t\t// 往上移动一个网格，以便放上下一个要显示的icon\r\n\t\tthis.joinIcon();\r\n\t\t// console.log(this.rollerIndex, stopIndex);\r\n\t\t(this.getRollProxy() as SlotProxy).setStopIndex(this.rollerIndex, stopIndex)\r\n\t\tthis.isRoll = true\r\n\t\tthis.endFlag = false\r\n\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t(<Egypt_Icon>icon.getComponent(\"Egypt_Icon\")).setEffect(0)\r\n\t\t})\r\n\t\tthis.node.getComponent(Mask).enabled = true\r\n\t\t// this.rollWithCell('down')\r\n\t\t// console.log(this.getRollProxy().getRepository())\r\n\t}\r\n\t// 停止滚动\r\n\tpublic stopRoll(cbFn: StopHandlerType) {\r\n\t\tthis.endFlag = true\r\n\t\tthis.stopHandler = cbFn\r\n\t\tthis.addLastJoinIconIndex(this.rollerData.showResult.stopIndex, 3);\r\n\t\t// (this.getRollProxy() as FruitsSlotProxy).setStopIndex(this.rollerIndex)\r\n\t}\r\n\tprivate joinIcon() {\r\n\t\t// this.lastJoinIconIndex === this.rollerData.data.length && (this.lastJoinIconIndex = 0)\r\n\t\t// console.log(this.lastJoinIconIndex)\r\n\t\tconst icon = instantiate(this.icon)\r\n\t\ticon.setPosition(icon.position.x, 0)\r\n\t\tthis.RollerLayOut.addChild(icon);\r\n\t\t(<Egypt_Icon>icon.getComponent(\"Egypt_Icon\")).setFace(this.rollerData.data[this.lastJoinIconIndex])\r\n\t\ticon.setSiblingIndex(0)\r\n\t\tthis.lastJoinIconIndex--\r\n\t\tthis.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n\t\t// this.RollerLayOut.removeChild(this.RollerLayOut.children[this.RollerLayOut.children.length - 1])\r\n\t\t// this.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n\tprivate stopCallBack() {\r\n\t\tthis.node.getComponent(Mask).enabled = false\r\n\t\tthis.stopHandler && this.stopHandler(this.rollerIndex, this.rollerData)\r\n\t\t// this.RollerLayOut.children.forEach(icon => {\r\n\t\t// \tconst comp = (<Icon>icon.getComponent(\"Icon\"))\r\n\t\t// \tif (comp.iconId === this.target) {\r\n\t\t// \t\tcomp.setEffect('animation')\r\n\t\t// \t}\r\n\t\t// })\r\n\t\tAudioManager.getInstance().playSound(SoundList.theRollerStops)\r\n\t\tthis.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n\t}\r\n    /**\r\n     * 添加停靠图标\r\n     * @param index 停靠的序号，从下到上\r\n     */\r\n    public addDockIcon(targetArr: number[]) {\r\n         this.removeAllDockIcon()\r\n        targetArr.forEach((item, index) => {\r\n            try {\r\n                const icon = instantiate(this.icon2);\r\n                 (<Egypt_Icon>icon.getComponent(\"Egypt_Icon\")).hiddenAmounts(item[2])\r\n                if(item[0]===0){\r\n                    item[0]=2\r\n                }else if(item[0]===2){\r\n                    item[0]=0\r\n                }\r\n                icon.setPosition(new Vec3(0, -item[0] * this.rollerData.rollerheight))\r\n                this.RollerLayOut2.addChild(icon);\r\n            }catch (e) {\r\n                console.error(this.RollerLayOut.children[this.rollerData.portraitNum - 1 - item[0]])\r\n            }\r\n        })\r\n    }\r\n    public removeAllDockIcon() {\r\n\t\tthis.RollerLayOut2.removeAllChildren()   \r\n    }\r\n    //隐藏显示弹出层2\r\n    public togglesThePopUpLayerState(state:boolean=false){\r\n        this.RollerLayOut2.active=state\r\n\t\tthis.RollerLayOut2.removeAllChildren()\r\n    }\r\n\t/**\r\n\t * 设置当前滑槽的闪动图标()\r\n\t * @param mode 传入的是光标id，还是左边序列号\r\n\t * @param target 光标位置或者y轴坐标序列\r\n\t */\r\n\tpublic setIconEffect(mode: 'index' | 'coord', target: number[],allState:boolean=false) {\r\n\t\tif (mode === 'index') {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\tconst comp = (<Egypt_Icon>icon.getComponent(\"Egypt_Icon\"))\r\n\t\t\t\tif (target.some(i => i === comp.iconId)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcomp.setEffect(0)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tlet iconIndex = this.rollerData.portraitNum\r\n\t\t\tthis.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t\ticonIndex--\r\n\t\t\t\tconst comp = (<Egypt_Icon>icon.getComponent(\"Egypt_Icon\"))\r\n\t\t\t\tif (target.some(i => i === iconIndex)) {\r\n\t\t\t\t\tcomp.setEffect(1)\r\n\t\t\t\t} else {\r\n                    if(allState){\r\n                        comp.setEffect(0)\r\n                    }\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\r\n\t\t\t//向上数第几个光标闪动\r\n\t\t\t// for (let i = 2; i >= 0; i--) {\r\n\t\t\t// \tconst comp = (<Icon>this.RollerLayOut.children[i].getComponent(\"Icon\"))\r\n\t\t\t// \tif (!comp) continue\r\n\t\t\t// \tif (i === target) {\r\n\t\t\t// \t\tcomp.setEffect(1)\r\n\t\t\t// \t} else {\r\n\t\t\t// \t\tcomp.setEffect()\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\t\t\tthis.RollerLayOut.children.forEach((icon, index) => {\r\n\t\t\t\tconst comp = (<Egypt_Icon>icon.getComponent(\"Egypt_Icon\"))\r\n\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**滚动一个格子 */\r\n\tprivate rollWithCell(position: 'up' | 'down') {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t// icon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t\ttween(icon).to(this.rollerData.rollSpeed / 1000, { position: new Vec3(icon.position.x, icon.position.y - ((this.rollerData.intervalHeight + this.rollerData.rollerheight))) }).start()\r\n\t\t\t})\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\t\t// if (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation = Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\t\t\t\ttween().target(icon).to(this.rollerData.rollSpeed / 1000 + 0.3, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.rollWithCell(position)\r\n\t\t\t\t}\r\n\t\t\t}, this.rollerData.rollSpeed)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\t\tlet newValue = stopIndex + value;\r\n\t\t\tif (newValue >= this.rollerData.data.length) {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue - this.rollerData.data.length;\r\n\t\t\t} else {\r\n\t\t\t\t\tthis.lastJoinIconIndex = newValue;\r\n\t\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.RollerLayOut.children.forEach(icon => {\r\n\t\t\t\ticon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n\t\t\t})\r\n\t\t\tif (this.RollerLayOut.children.length) {\r\n\t\t\t\tif (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n\t\t\t\t\tconst deviation =0//Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n\t\t\t\t\tthis.joinIcon()\r\n\r\n\t\t\t\t\t// 这里要注意\r\n\t\t\t\t\tlet _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n\t\t\t\t\tif (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n\t\t\t\t\t\t_lastJoinIconIndex = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n\t\t\t\t\t\tthis.isRoll = false\r\n\t\t\t\t\t\tlet count = 0\r\n\t\t\t\t\t\tthis.RollerLayOut.children.forEach((icon,index) => {\r\n\t\t\t\t\t\t\ttween().target(icon).to(0.5, {\r\n\t\t\t\t\t\t\t\tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight)+ index * 25)\r\n\t\t\t\t\t\t\t}, {\r\n\t\t\t\t\t\t\t\teasing: \"backOut\"//\"elasticOut\"\r\n\t\t\t\t\t\t\t}).call(() => {\r\n\t\t\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\t\t\tif (count === this.RollerLayOut.children.length) {\r\n\t\t\t\t\t\t\t\t\tthis.stopCallBack()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t\t\tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t\t\t\tlastChild.destroy()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlateUpdate() {\r\n\t\t// if (this.RollerLayOut.children.length) {\r\n\t\t// \tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n\t\t// \tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n\t\t// \t\tlastChild.destroy()\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n}\r\n\r\n"]}