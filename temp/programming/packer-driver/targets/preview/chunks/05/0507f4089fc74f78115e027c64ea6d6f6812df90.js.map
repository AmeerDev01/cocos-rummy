{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fruit777/viewModel/FooterViewModel.ts"],"names":["UIOpacity","sys","Animation","ViewModel","StoreInject","getStore","AutoLauncherViewModel","fruit777_Audio","sourceManageSeletor","PrefabPathDefine","EffectType","BaseViewModel","SKT_MAG_TYPE","sktInstance","beginRollAction","setRollSpeed","dataTransfer","DataKeyType","AutoLauncherType","GameType","changeAutoLauncherType","changeProfit","setAutoLaunchedTimes","setShowAuthLaunch","setSortStop","setWaiting","SoundPathDefine","global","FooterViewModel","constructor","autoLauncherPanel","helpPanelPanel","positionId","betAmount","begin","mountView","getFile","AUTO_LAUNCHER","source","appendTo","comp","getAutoLauncherBaseNBoard","connect","viewNode","getComponent","opacity","setEvent","openAutoLauncher","dispatch","getPropertyNode","props_down_chooseBg","play","closeAutoLauncher","isClear","NONE","openHelpPanel","INTRODUCE","parent","effectType","EFFECT1","isModal","closeHandler","unMount","changeBetAmount","value","manualBetHandler","changeSpeedUpSwitch","isChecked","unMountCallBack","isConnect","props","balance","openShop","GAME_TYPE","MAIN","sendSktMessage","LAUNCHER_BET","tableId","JSON","parse","localStorage","getItem","isReSend","playOneShot","ROLLER_BEGIN2","inject","autoLauncherType","getState","game","state","isRollEnd","roller","roundAllEnd","profit","subGameTimes","remainSubGameTimes","currGameType","viewGameType","isShowAutoLaunch","autoLaunchedTimes","isJumpStop","stopMode","isSortStop"],"mappings":"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","sourcesContent":["import { Node, UIOpacity, sys, Animation } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport { Fruit777_Footer, IProps, IEvent } from \"../components/Fruit777_Footer\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { getStore } from \"../store\"\r\nimport AutoLauncherViewModel from \"./AutoLauncherViewModel\"\r\nimport { fruit777_Audio, gameBoardViewModel, sourceManageSeletor } from \"../index\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport BaseViewModel from \"../../../common/viewModel/BaseViewModel\"\r\nimport { Fruit777_HelpPanel, IProps as FIProps, IState as FIState, IEvent as FIEvent } from \"../components/Fruit777_HelpPanel\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { beginRollAction, setRollSpeed, setStopRollAction } from \"../store/actions/roller\"\r\nimport dataTransfer, { DataKeyType } from \"../dataTransfer\"\r\nimport { AutoLauncherType, GameType } from \"../type\"\r\nimport { changeAutoLauncherType, changeProfit, setAutoLaunchedTimes, setShowAuthLaunch, setSortStop, setStopMode, setWaiting } from \"../store/actions/game\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport config from \"../config\"\r\nimport RollerPanelViewModel from \"./RollerPanelViewModel\"\r\nimport { ToastType, addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\n\r\n@StoreInject(getStore())\r\nclass FooterViewModel extends ViewModel<Fruit777_Footer, IProps, IEvent> {\r\n  constructor() {\r\n    super('Fruit777_Footer')\r\n  }\r\n  public autoLauncherPanel: AutoLauncherViewModel\r\n  public helpPanelPanel: BaseViewModel<Fruit777_HelpPanel, FIState, FIProps, FIEvent>\r\n  private positionId: number = 0\r\n  private betAmount: number = 0\r\n\r\n  protected begin() {\r\n    this.autoLauncherPanel = new AutoLauncherViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.AUTO_LAUNCHER).source).appendTo(this.comp.getAutoLauncherBaseNBoard()).connect()\r\n    this.autoLauncherPanel.viewNode.getComponent(UIOpacity).opacity = 0\r\n    this.setEvent({\r\n      openAutoLauncher: () => {\r\n        this.dispatch(setShowAuthLaunch(true));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_up')\r\n      },\r\n      closeAutoLauncher: (isClear) => {\r\n        this.dispatch(setShowAuthLaunch(false))\r\n        isClear && this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n        isClear && this.dispatch(setAutoLaunchedTimes(0));\r\n        (this.comp.getPropertyNode().props_down_chooseBg as Node).getComponent(Animation).play('animation_autoLauncher_down')\r\n        // isClear && this.dispatch(setRollSpeed(1))\r\n      },\r\n      openHelpPanel: () => {\r\n        this.helpPanelPanel = new BaseViewModel<Fruit777_HelpPanel, FIState, FIProps, FIEvent>(\"Fruit777_HelpPanel\").mountView(sourceManageSeletor().getFile(PrefabPathDefine.INTRODUCE).source)\r\n          .appendTo(this.viewNode.parent, { effectType: EffectType.EFFECT1, isModal: true }).setEvent({\r\n            closeHandler: () => {\r\n              this.helpPanelPanel.unMount(EffectType.EFFECT1)\r\n            }\r\n          })\r\n      },\r\n      changeBetAmount: (betAmount: number, positionId: number, value: number) => {\r\n        this.positionId = positionId\r\n        this.betAmount = betAmount\r\n      },\r\n      manualBetHandler: () => {\r\n        this.manualBetHandler()\r\n      },\r\n      changeSpeedUpSwitch: (isChecked) => {\r\n        // this.dispatch(setStopMode(isChecked ? 'jump' : 'index'))\r\n        this.dispatch(setSortStop(!isChecked))\r\n        this.dispatch(setRollSpeed(isChecked ? 1.3 : 1))\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n    this.dispatch(setAutoLaunchedTimes(0))\r\n    this.dispatch(setSortStop(true))\r\n    this.dispatch(setRollSpeed(1))\r\n  }\r\n\r\n  public manualBetHandler() {\r\n    if (!sktInstance || (sktInstance && !sktInstance.isConnect)) {\r\n      return\r\n    }\r\n    if (this.comp.props && this.comp.props.balance < this.betAmount) {\r\n      global.openShop()\r\n      this.dispatch(changeAutoLauncherType(AutoLauncherType.NONE))\r\n      this.dispatch(setAutoLaunchedTimes(0))\r\n      return\r\n    }\r\n    //先转起来\r\n    this.dispatch(beginRollAction(-1))\r\n    //如果主游戏，清理奖池\r\n    dataTransfer(DataKeyType.GAME_TYPE) === GameType.MAIN && this.dispatch(changeProfit(0))\r\n    //发送下注\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCHER_BET, {\r\n      positionId: this.positionId,\r\n      tableId: JSON.parse(sys.localStorage.getItem('fruit777')).tableId\r\n    }, { isReSend: true })\r\n    this.dispatch(setWaiting(false))\r\n    fruit777_Audio.playOneShot(SoundPathDefine.ROLLER_BEGIN2)\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({\r\n      autoLauncherType: getStore().getState().game.autoLauncherType\r\n    }, (state: StateType) => {\r\n      return {\r\n        isRollEnd: state.roller.roundAllEnd,\r\n        profit: state.game.profit,\r\n        subGameTimes: state.game.subGameTimes,\r\n        remainSubGameTimes: state.game.remainSubGameTimes,\r\n        currGameType: state.game.currGameType,\r\n        viewGameType: state.game.viewGameType,\r\n        isShowAutoLaunch: state.game.isShowAutoLaunch,\r\n        autoLauncherType: state.game.autoLauncherType,\r\n        autoLaunchedTimes: state.game.autoLaunchedTimes,\r\n        balance: state.game.balance,\r\n        isJumpStop: state.game.stopMode === \"jump\" ? true : false,\r\n        isSortStop: state.game.isSortStop\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default FooterViewModel"]}