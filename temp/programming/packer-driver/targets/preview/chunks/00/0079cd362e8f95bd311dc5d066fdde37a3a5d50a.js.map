{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfcV2/components/GxfcV2_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Node","tween","UITransform","Vec3","BaseComponent","IconPool","config","GxfcV2RollerViewModel","DialogType","GameType","getBigWinConfig","IconId","isAuto","isSubGameToSubGame","RollerStatus","updateRollerStatus","cacheData","changeGame","updateGold","updateSubGameAnimationPlayInfo","updateWinloss","GxfcV2_Audio","mainViewModel","sourceManageSeletor","PrefabPathDefine","SoundPathDefine","ccclass","property","GxfcV2_RollerPanel","rollerViewModelArr","iconPool","icon","isManualStop","inStop","isWaitEnding","sendBetTime","winWildIcon","propertyNode","props_column_list","props_roller_column","props_column_effect","props","rollerStatus","END","isSpeed","autoLauncherInfo","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","winloss","events","start","initState","initRoller","i","columnCount","column","roller","mountViewNode","appendTo","connect","push","comp","setColumnEffectNode","setEvent","onCheckNextLeftCount","checkNextLeftCount","initSlot","forEach","v","index","startRoll","console","log","isMainGame","dispatch","unscheduleAllCallbacks","isChangeSmall","endRoll","rollTime","getIsSpeed","scheduleOnce","rollerLaunchResult","ColumnIndex","dl","si","freeWildRollerId","length","stopWildRoll","rollEndHandle","bind","joinJinWildIcon","node","isValid","stopRollAll","RUNNING","ENDING","stopRoll","magnification","bigWinConfig","isSubGameLastPoint","isMain","auto","winLine","playJinFaAnimation","isSubGame1","startPlayWinIcon","normalRollOption","winIconFlickerTime","playBigWinHandle","playWinAudio","nextLeftCount","isSubGame2","undefined","isAllEqual","arr","some","value","roundTw","tw","isChangeGame","SUBGAME2","bl","freeGameAmount","isEnterSubGame2","showDialogWin","dialogType","name","params","updateRollerStatusEnd","SUBGAME1","playOneShot","ling","changeGameHandle","done","wildRollerId","count","playJinFaWild","includes","playParticle2D","startPos","endPos","parentNode","particleNode","getFile","Particle2D","source","setPosition","addChild","to","subGameRollOption","beetleFlyTime","position","removeSelf","isSubGame","changeToSubGame","changeToMainGame","viewGameCountOver","changeSubGameToSubGame","playScatterAnimation","FREE_GAME_ENTRY","freeCount","gameType","param","play","Small_end","FREE_GAME_SETTLEMENT","changeRollerHeight","callBack","time","isEnd","rollerComp","stopIconIndex","rollerId","scatterCount","getScatterCount","nextColmunIsBorder","isSpeedBorder","endColumnIndex","scatter","iconIndex","queue","iconRollerQueue","showIconCount","SCATTER","linePlayTime","wp","lines","key","executeWinIcon","stopWinIcon","lineNumber","winIconArr","concat","pauseWinIcon","columnIndex","wildList","getWildListNode","active","isRoll","playWinIcon","w","getChildByName","bindEvent","useProps","cur","columnListLayout","getComponent","rollerWindowX","rollerWindowY","spacingX","columnInterval","replaceMultiRollerIcon","rollerHeight","rollerHeight2","rollerHeight1","height","resetIconPos","isWinWild","element","bindUI","removeAllChildren","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Layout, Node, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport GxfcV2RollerViewModel from '../viewModel/GxfcV2RollerViewModel';\r\nimport { AutoLauncherInfo, DialogType, GameType, GameTypeInfo, getBigWinConfig, IconId, isAuto, isSubGameToSubGame, RollerLaunchResult, RollerStatus } from '../type';\r\nimport { updateRollerStatus } from '../store/actions/roller';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { changeGame, updateGold, updateSubGameAnimationPlayInfo, updateWinloss } from '../store/actions/game';\r\nimport { GxfcV2_Audio, mainViewModel, sourceManageSeletor } from '../index';\r\nimport game from '../store/reducer/game';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { GxfcV2Icon } from './GxfcV2_Icon';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\t/**滚动状态 */\r\n\trollerStatus: RollerStatus,\r\n\t/**是否加速 */\r\n\tisSpeed: boolean,\r\n\t/** 自动运行信息 */\r\n\tautoLauncherInfo: AutoLauncherInfo,\r\n\t/**游戏类型信息 */\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/**总输赢 */\r\n\twinloss: number,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('GxfcV2_RollerPanel')\r\nexport class GxfcV2_RollerPanel extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tpublic rollerViewModelArr: GxfcV2RollerViewModel[] = [];\r\n\tprivate iconPool: IconPool = new IconPool(config.icon);\r\n\tprivate isManualStop: boolean = false;\r\n\tprivate inStop = false;\r\n\r\n\tprivate isWaitEnding = false;\r\n\r\n\tprivate sendBetTime = 0;\r\n\r\n\t/**小游戏里定格的金wild图标 */\r\n\tpublic winWildIcon = [];\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_column_list: new Node(),\r\n\t\tprops_roller_column: new Node(),\r\n\t\tprops_column_effect: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t/**滚动状态 */\r\n\t\trollerStatus: RollerStatus.END,\r\n\t\tisSpeed: false,\r\n\t\tautoLauncherInfo: null,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\twinloss: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprivate initRoller() {\r\n\t\tfor (let i = 0; i < config.columnCount; i++) {\r\n\t\t\tconst column = instantiate(this.propertyNode.props_roller_column);\r\n\t\t\tconst roller = new GxfcV2RollerViewModel().mountViewNode(column).appendTo(this.propertyNode.props_column_list).connect();\r\n\t\t\tthis.rollerViewModelArr.push(roller);\r\n\t\t\troller.comp.setColumnEffectNode(this.propertyNode.props_column_effect);\r\n\t\t\troller.setEvent({\r\n\t\t\t\tonCheckNextLeftCount: () => {\r\n\t\t\t\t\tthis.checkNextLeftCount()\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initSlot() {\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.initSlot(index, this.iconPool);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate startRoll() {\r\n\t\tlet sendBetTime = cacheData.sendBetTime;\r\n\t\tthis.sendBetTime = sendBetTime;\r\n\t\tthis.isManualStop = false;\r\n\t\tconsole.log(\"start roll time \" + sendBetTime)\r\n\t\tconst isMainGame = this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t\tif (isMainGame) {\r\n\t\t\tthis.dispatch(updateWinloss(0))\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.startRoll()\r\n\t\t});\r\n\r\n\t\tmainViewModel.comp.isChangeSmall = false;\r\n\r\n\t\tthis.endRoll(sendBetTime);\r\n\t}\r\n\r\n\tprivate endRoll(sendBetTime: number) {\r\n\t\t// 前期滚动的事件\r\n\t\tconst rollTime = this.getIsSpeed() ? 0.1 : 1;\r\n\t\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\t// console.log(\"endRoll scheduleOnce \" + sendBetTime + \" currentTime \" + new Date().getTime());\r\n\t\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\t\tthis.isWaitEnding = true;\r\n\t\t\t} else {\r\n\t\t\t\tconst ColumnIndex = cacheData.rollerLaunchResult.dl.si[0].freeWildRollerId\r\n\t\t\t\tif (ColumnIndex && ColumnIndex.length > 0) {\r\n\t\t\t\t\tfor (let i = 0; i < ColumnIndex.length; i++) {\r\n\t\t\t\t\t\tthis.stopWildRoll(ColumnIndex[i],this.rollEndHandle.bind(this, cacheData.rollerLaunchResult), cacheData.rollerLaunchResult)\r\n\t\t\t\t\t\tthis.rollerViewModelArr[ColumnIndex[i]].comp.joinJinWildIcon(ColumnIndex[i],cacheData.rollerLaunchResult)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.node.isValid && this.stopRollAll(false, sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t\t}\r\n\t\t}, rollTime)\r\n\t}\r\n\r\n\tprivate stopRollAll(isManualStop: boolean = false, sendBetTime: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.inStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.inStop = true;\r\n\t\tthis.isManualStop = isManualStop;\r\n\r\n\t\tif (RollerStatus.RUNNING === this.props.rollerStatus) {\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.ENDING))\r\n\t\t}\r\n\r\n\t\tconsole.log(\"rollerpanel stop roll time \" + sendBetTime);\r\n\t\tthis.stopRoll(0, this.rollEndHandle.bind(this, rollerLaunchResult), rollerLaunchResult);\r\n\t}\r\n\r\n\t/**\r\n\t * 动画滚动结束处理\r\n\t */\r\n\tprivate rollEndHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst magnification = rollerLaunchResult.dl.si[0].magnification;\r\n\t\tconst bigWinConfig = getBigWinConfig(magnification)\r\n\t\t// 是否小游戏最后一局\r\n\t\tconst isSubGameLastPoint = !this.isMain() && this.props.gameTypeInfo.leftCount <= 1;\r\n\r\n\t\tthis.inStop = false;\r\n\t\tconst auto = isAuto(this.props.autoLauncherInfo, this.props.gameTypeInfo);\r\n\t\tlet winLine\r\n\t\t// 最开始就看是否需要延展金wild同列图标，播放动画\r\n\t\tthis.playJinFaAnimation(rollerLaunchResult, () => {\r\n\t\t\t//然后再播放中奖线路\r\n\t\t\tif (this.isSubGame1()) {\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\twinLine = this.startPlayWinIcon(config.normalRollOption.winIconFlickerTime, () => {\r\n\t\t\t\t\t}, rollerLaunchResult);\r\n\t\t\t\t},1)\r\n\t\t\t} else {\r\n\t\t\t\twinLine = this.startPlayWinIcon(config.normalRollOption.winIconFlickerTime, () => {\r\n\t\t\t\t}, rollerLaunchResult);\r\n\t\t\t}\r\n\t\t\tif (winLine === 0) {\r\n\t\t\t\tthis.playBigWinHandle(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t} else {\r\n\t\t\t\tthis.playWinAudio();\r\n\t\t\t\t// 中奖之后延迟一点结束\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.playBigWinHandle(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t}, 1)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (!bigWinConfig) {\r\n\t\t\tthis.updateWinloss(rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate checkNextLeftCount() {\r\n\t\tconst nextLeftCount = this.props.gameTypeInfo.nextLeftCount;\r\n\t\t// 在转动结束之后如果发现下一局的剩余局数有值，就变更一次\r\n\t\tif (this.isSubGame2() && nextLeftCount >= 0) {\r\n\t\t\tthis.dispatch(changeGame({\r\n\t\t\t\t...this.props.gameTypeInfo,\r\n\t\t\t\tleftCount: nextLeftCount,\r\n\t\t\t\tnextLeftCount: undefined\r\n\t\t\t}))\r\n\t\t}\r\n\t}\r\n\r\n\t/**数组中的值是否全部相等[10,10,10] */\r\n\tprivate isAllEqual(arr) {\r\n\t\tif (arr.length > 0) {\r\n\t\t\treturn !arr.some(function (value, index) {\r\n\t\t\t\treturn value !== arr[0];\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\treturn true\r\n\t\t}\r\n\t}\r\n\r\n\tprivate playWinAudio() {\r\n\t\t// if (this.isWinWild()) {\r\n\t\t// \tGxfcV2_Audio.playOneShot(SoundPathDefine.wild)\r\n\t\t// } else {\r\n\t\t// \tGxfcV2_Audio.playOneShot(SoundPathDefine.haveCoin)\r\n\t\t// }\r\n\t}\r\n\r\n\tprivate updateWinloss(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\tconst magnification = rollerLaunchResult.dl.si[0].magnification;\r\n\t\tconst bigWinConfig = getBigWinConfig(magnification)\r\n\t\t// 本局输赢\r\n\t\tconst roundTw = si.tw\r\n\t\tif (this.isMain()) {\r\n\t\t\tif (roundTw <= 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// 在切到小游戏2时，输赢金额不更新，因为中奖的金额在加到小游戏里\r\n\t\t\tif (!this.isChangeGame() || this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\t\tthis.dispatch(updateWinloss(roundTw))\r\n\t\t\t\t// 小游戏要在结算时更新余额\r\n\t\t\t\tthis.dispatch(updateGold(si.bl))\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 小游戏1在游戏中余额之后在切换到主游戏时才加上去\r\n\t\t\tif (this.isSubGame1()) {\r\n\t\t\t\tif (bigWinConfig) {\r\n\t\t\t\t\tthis.dispatch(updateWinloss(si.freeGameAmount))\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\tthis.dispatch(updateWinloss(si.freeGameAmount))\r\n\t\t\t\t\t},1)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.isChangeGame()) {\r\n\t\t\t\tthis.dispatch(updateGold(si.bl))\r\n\t\t\t\tthis.dispatch(updateWinloss(si.freeGameAmount))\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放大奖处理 */\r\n\tprivate playBigWinHandle(bigWinConfig, auto: boolean, isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 是否进入小游戏2\r\n\t\t// let isEnterSubGame2 = this.props.gameTypeInfo.viewGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.currGameType === GameType.SUBGAME2;\r\n\t\tlet isEnterSubGame2 = false;\r\n\t\t// 进入小游戏2时不播放大奖\r\n\t\tif (!isEnterSubGame2 && bigWinConfig) {\r\n\t\t\t// 延迟一点点播放大奖\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t!this.isSubGame2() && this.updateWinloss(rollerLaunchResult);\r\n\t\t\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\t\t\tlet winloss = si.tw;\r\n\t\t\t\twinloss = winloss === 0 ? si.freeGameAmount : winloss;\r\n\t\t\t\tconst isChangeGame = this.isChangeGame();\r\n\t\t\t\tif (isChangeGame && si.freeGameAmount > 0) {\r\n\t\t\t\t\twinloss = si.freeGameAmount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 中大奖提示框\r\n\t\t\t\tthis.node.isValid && mainViewModel.showDialogWin({\r\n\t\t\t\t\tdialogType: bigWinConfig.name,\r\n\t\t\t\t\tparams: [winloss],\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t})\r\n\t\t\t}, 0.8)\r\n\t\t} else {\r\n\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 更新结束滚动状态\r\n\t * @param bigWinConfig 大奖配置\r\n\t * @param auto \r\n\t * @param isSubGameLastPoint 是否小游戏最后一局\r\n\t */\r\n\tprivate updateRollerStatusEnd(bigWinConfig, auto: boolean, isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst isChangeGame = this.isChangeGame();\r\n\t\tif (isChangeGame) {\r\n\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME1) {\r\n\t\t\t\tGxfcV2_Audio.playOneShot(SoundPathDefine.ling, 1, false)\r\n\t\t\t}\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.changeGameHandle(isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t},1)\r\n\t\t} else {\r\n\t\t\tif (auto) {\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t\t},1)\r\n\t\t\t} else {\r\n\t\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放金发动画，把与金发同一列的所有图标替换为金发 */\r\n\tprivate playJinFaAnimation(rollerLaunchResult: RollerLaunchResult,done) {\r\n\t\tconst wildRollerId = rollerLaunchResult.dl.si[0].wildRollerId\r\n\t\tconst freeWildRollerId: any = rollerLaunchResult.dl.si[0].freeWildRollerId\r\n\t\tlet count: number = 0;\r\n\t\tif (wildRollerId && wildRollerId.length > 0) {\r\n\t\t\tfor (let i = 0; i < wildRollerId.length; i++) {\r\n\t\t\t\tcount++\r\n\t\t\t\tif (!freeWildRollerId) {\r\n\t\t\t\t\tthis.rollerViewModelArr[wildRollerId[i]].comp.playJinFaWild(rollerLaunchResult, wildRollerId[i], done)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!freeWildRollerId.includes(wildRollerId[i])) {\r\n\t\t\t\t\t\tthis.rollerViewModelArr[wildRollerId[i]].comp.playJinFaWild(rollerLaunchResult, wildRollerId[i], done)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (count === wildRollerId.length) {\r\n\t\t\t\t\t\t\tdone && done()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdone && done()\r\n\t\t}\r\n\t}\r\n\r\n\tprivate playParticle2D(startPos: Vec3, endPos: Vec3, parentNode: Node) {\r\n\t\tconst particleNode = instantiate(sourceManageSeletor().getFile(PrefabPathDefine.Particle2D).source) as Node\r\n\t\tparticleNode.setPosition(startPos);\r\n\t\tparentNode.addChild(particleNode);\r\n\t\ttween(particleNode).to(config.subGameRollOption.beetleFlyTime, { position: endPos }).removeSelf().start();\r\n\t}\r\n\r\n\tprivate changeGameHandle(isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.updateWinloss(rollerLaunchResult);\r\n\t\tif (this.isSubGame(this.props.gameTypeInfo.currGameType)) {\r\n\t\t\tthis.changeToSubGame(this.props.gameTypeInfo.currGameType, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t} else if (this.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n\t\t\tthis.changeToMainGame(this.props.gameTypeInfo.viewGameType, rollerLaunchResult)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 切换到小游戏处理\r\n\t * @param currGameType 当前游戏\r\n\t * @param viewGameCountOver 当前小游戏次数是否结束\r\n\t * @param nextGameType 下一个游戏\r\n\t */\r\n\tprivate changeToSubGame(currGameType: GameType, viewGameCountOver: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (viewGameCountOver) {\r\n\t\t\tthis.changeSubGameToSubGame(currGameType, rollerLaunchResult);\r\n\t\t} else {\r\n\t\t\tthis.rollerViewModelArr.forEach((v, index) => { \r\n\t\t\t\tv.comp.playScatterAnimation()\r\n\t\t\t})\r\n\t\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\t\tdialogType: DialogType.FREE_GAME_ENTRY,\r\n\t\t\t\t\tparams: [rollerLaunchResult.dl.si[0].freeCount],\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// this.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\t\tgameType: currGameType,\r\n\t\t\t\t\t\tparam: 0 //开门类型\r\n\t\t\t\t\t}))\r\n\t\t\t\t})\r\n\t\t\t},2)\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**切换到主游戏的处理 */\r\n\tprivate changeToMainGame(gameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.isSubGame(gameType)) {\r\n\t\t\t// 弹出结算面板\r\n\t\t\tGxfcV2_Audio.play(SoundPathDefine.Small_end, true)\r\n\r\n\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\t\tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t\t}, () => {\r\n\t\t\t\t// 在切换回主游戏时，改变滚轴的高度\r\n\t\t\t\t// 这里要注意：小游戏退回到大厅有一个放大缩小的过程，如果把 changeRollerHeight 放到放大后执行，获取的坐标是不准确的\r\n\t\t\t\tthis.changeRollerHeight(GameType.MAIN);\r\n\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\tgameType: gameType,\r\n\t\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t\t}))\r\n\t\t\t\t// this.changeRollerHeight(GameType.MAIN);\r\n\r\n\t\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\t\tthis.changeGame(GameType.MAIN);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**切换小游戏到小游戏，弹出结算面板 */\r\n\tprivate changeSubGameToSubGame(gameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 弹出结算面板\r\n\t\tmainViewModel.showDialogWin({\r\n\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t}, () => {\r\n\t\t\t// 播放切换游戏动画\r\n\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\tgameType: gameType,\r\n\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t}))\r\n\t\t\t// 只有在切回到小游戏1时，才改变滚轴的高度\r\n\t\t\tgameType === GameType.SUBGAME1 && this.changeRollerHeight(gameType);\r\n\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\tthis.changeGame(gameType);\r\n\t\t})\r\n\t}\r\n\r\n\t/**是否准备切换游戏 */\r\n\tprivate isChangeGame() {\r\n\t\tif (!this.props.gameTypeInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isSubGameToSubGame(this.props.gameTypeInfo.viewGameType, this.props.gameTypeInfo.currGameType)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this.props.gameTypeInfo.viewGameType !== this.props.gameTypeInfo.currGameType;\r\n\t}\r\n\r\n\tprivate isMain() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t}\r\n\r\n\tprivate isSubGame(gameType: GameType) {\r\n\t\treturn gameType === GameType.SUBGAME1 || gameType === GameType.SUBGAME2\r\n\t}\r\n\r\n\tprivate getIsSpeed() {\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.isManualStop) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this.props.isSpeed;\r\n\t}\r\n\r\n\tprivate stopRoll(i: number, callBack: (rollerLaunchResult: RollerLaunchResult) => void, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = this.getIsSpeed() ? 0 : 0.2;\r\n\t\tconst isEnd = i >= this.rollerViewModelArr.length - 1;\r\n\t\tconst rollerComp = this.rollerViewModelArr[i];\r\n\t\t// const stopIconIndex = Math.floor(Math.random() * config.iconRollerQueue[i].length);\r\n\t\t// 获得停下来的数据\r\n\t\tconst stopIconIndex = rollerLaunchResult.dl.si[0].rollerId[i];\r\n\r\n\t\tconst scatterCount = this.getScatterCount(i, rollerLaunchResult);\r\n\t\t// 下一个列是否有边框\r\n\t\tconst nextColmunIsBorder = this.getScatterCount(i + 1, rollerLaunchResult) >= 2;\r\n\r\n\t\t// console.log(\"scatterCount\", scatterCount, i, stopIconIndex);\r\n\t\t// 是否快速边框，前面出现2个以上的scatter，这个参数才为true\r\n\t\tconst isSpeedBorder = scatterCount >= 2;\r\n\t\trollerComp.comp.stopRoll(stopIconIndex, () => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tif (isEnd) {\r\n\t\t\t\t\tcallBack(rollerLaunchResult)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnextColmunIsBorder && this.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, isSpeedBorder, rollerLaunchResult)\r\n\t\t// 小游戏2滚轴一起停\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tif (!isEnd) {\r\n\t\t\t\tthis.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// console.log(\"stoproll time \", i, time)\r\n\t\t\t!nextColmunIsBorder && this.scheduleOnce(() => {\r\n\t\t\t\tif (this.node.isValid) {\r\n\t\t\t\t\tif (!isEnd) {\r\n\t\t\t\t\t\tthis.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, time)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate stopWildRoll(i: number, callBack: (rollerLaunchResult: RollerLaunchResult) => void, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// // 这里调停止滚动的速度\r\n\t\t// const time = this.getIsSpeed() ? 0 : 0.2;\r\n\t\t// // const isEnd = i >= this.rollerViewModelArr.length - 1;\r\n\t\tconst rollerComp = this.rollerViewModelArr[i];\r\n\t\t// // 获得停下来的数据\r\n\t\tconst stopIconIndex = rollerLaunchResult.dl.si[0].rollerId[i];\r\n\r\n\t\t// const scatterCount = this.getScatterCount(i, rollerLaunchResult);\r\n\t\t// // 下一个列是否有边框\r\n\t\t// const nextColmunIsBorder = this.getScatterCount(i + 1, rollerLaunchResult) >= 2;\r\n\r\n\t\t// console.log(\"scatterCount\", scatterCount, i, stopIconIndex);\r\n\t\t// 是否快速边框，前面出现2个以上的scatter，这个参数才为true\r\n\t\t// const isSpeedBorder = scatterCount >= 2;\r\n\t\trollerComp.comp.stopRoll(stopIconIndex, () => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\t// if (!isEnd) {\r\n\t\t\t\t\tcallBack(rollerLaunchResult)\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t}, false, rollerLaunchResult)\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**获得前面几列的scatter个数 */\r\n\tprivate getScatterCount(endColumnIndex: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 前两列不计算数量或者小游戏2也不计算\r\n\t\tif (endColumnIndex < 2 || this.isSubGame2()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tendColumnIndex = endColumnIndex >= this.rollerViewModelArr.length ? this.rollerViewModelArr.length : endColumnIndex;\r\n\t\tconst rollerId = rollerLaunchResult.dl.si[0].rollerId;\r\n\t\tlet scatter = 0;\r\n\t\tfor (let i = 0; i < endColumnIndex; i++) {\r\n\t\t\tlet iconIndex = rollerId[i] as number;\r\n\t\t\tconst queue = config.iconRollerQueue[i]\r\n\t\t\tfor (let i = 0; i < config.normalRollOption.showIconCount; i++) {\r\n\t\t\t\tif (queue[iconIndex] === IconId.SCATTER) {\r\n\t\t\t\t\tscatter++;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (++iconIndex >= queue.length) {\r\n\t\t\t\t\ticonIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scatter;\r\n\t}\r\n\r\n\t/**\r\n\t * 显示中奖图标\r\n\t * @param linePlayTime \r\n\t * @param done 所有线路播放完之后执行\r\n\t */\r\n\tprivate startPlayWinIcon(linePlayTime: number, done, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet winLine = 0;\r\n\t\tif (rollerLaunchResult) {\r\n\t\t\tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t\t\tconst lines: any[] = [];\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\tlines.push(key);\r\n\t\t\t}\r\n\r\n\t\t\twinLine = lines.length;\r\n\r\n\t\t\tif (lines.length > 0) {\r\n\t\t\t\tthis.executeWinIcon(-1, lines, wp, linePlayTime, done);\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn winLine;\r\n\t}\r\n\r\n\t/**\r\n\t * 播放赢的图标\r\n\t * @param index 线的索引\r\n\t * @param lines 中奖线的数组\r\n\t * @param wp 中间对象\r\n\t * @param linePlayTime 播放一条线的时间\r\n\t * @param done\r\n\t * @returns \r\n\t */\r\n\tprivate executeWinIcon(index: number, lines: any[], wp, linePlayTime: number, done) {\r\n\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//小游戏切换到主游戏后不再播放中奖线路\r\n\t\tif (mainViewModel.comp.isChangeSmall && this.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n\t\t\tthis.unscheduleAllCallbacks()\r\n\t\t\tthis.rollerViewModelArr.forEach(v => v.comp.stopWinIcon())\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (index >= lines.length) {\r\n\t\t\tindex = -1;\r\n\t\t\tdone && done();\r\n\t\t}\r\n\t\tconst lineNumber = lines[index];\r\n\t\tlet winIconArr = [];\r\n\t\t// console.log(\"index\",index);\r\n\t\tif (index === -1) {\r\n\t\t\tlinePlayTime = 2;\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\twinIconArr = winIconArr.concat(wp[key])\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twinIconArr = winIconArr.concat(wp[lineNumber])\r\n\t\t\t// 一条线中了几个图标就播放多少秒\r\n\t\t\tlinePlayTime = winIconArr.length;\r\n\t\t}\r\n\t\tthis.rollerViewModelArr.forEach(v => v.comp.pauseWinIcon())\r\n\t\twinIconArr.forEach(v => {\r\n\t\t\tconst columnIndex = v[0];\r\n\t\t\tconst iconIndex = v[1];\r\n\t\t\tconst wildList = this.rollerViewModelArr[columnIndex].comp.getWildListNode().active;\r\n\t\t\tconst wildRollerId :any= cacheData.rollerLaunchResult.dl.si[0].freeWildRollerId;\r\n\t\t\t\r\n\t\t\tif (wildRollerId && wildRollerId.includes(columnIndex)) {\r\n\t\t\t\tthis.rollerViewModelArr[columnIndex].comp.stopWinIcon();\r\n\t\t\t} else {\r\n\t\t\t\tif (this.isSubGame1() && wildRollerId) {\r\n\t\t\t\t\tthis.rollerViewModelArr[columnIndex].comp.isRoll = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.rollerViewModelArr[columnIndex].comp.playWinIcon(iconIndex);\r\n\t\t\t}\r\n\t\t\t// if (this.isSubGame1() && wildList) {\r\n\t\t\t// \tthis.rollerViewModelArr[columnIndex].comp.stopWinIcon();\r\n\t\t\t// } else {\r\n\t\t\t// \t this.rollerViewModelArr[columnIndex].comp.playWinIcon(iconIndex);\r\n\t\t\t// }\r\n\t\t})\r\n\t\tif (this.isSubGame1()) {\r\n\t\t\tconst wildRollerId = cacheData.rollerLaunchResult.dl.si[0].freeWildRollerId;\r\n\t\t\tif (wildRollerId && wildRollerId.length > 0) {\r\n\t\t\t\tfor (let i = 0; i < wildRollerId.length; i++) {\r\n\t\t\t\t\tconst columnIndex = wildRollerId[i];\r\n\t\t\t\t\tconst winWildIcon = this.rollerViewModelArr[columnIndex].comp.winWildIcon\r\n\t\t\t\t\tfor (let w = 0; w < winWildIcon.length; w++){\r\n\t\t\t\t\t\t// winWildIcon[w].wildIcon.getChildByName(\"face-animation\").active = true;\r\n\t\t\t\t\t\t// winWildIcon[w].wildIcon.getChildByName(\"focusBorder\").active = true;\r\n\t\t\t\t\t\twinWildIcon[w].getChildByName(\"face-animation\").active = true;\r\n\t\t\t\t\t\twinWildIcon[w].getChildByName(\"focusBorder\").active = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.isSubGame1()) {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.executeWinIcon(-1, lines, wp, linePlayTime, done);\r\n\t\t\t}, linePlayTime);\r\n\t\t} else {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.executeWinIcon(++index, lines, wp, linePlayTime, done);\r\n\t\t\t}, linePlayTime);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'rollerStatus') {\r\n\t\t\t\tif (RollerStatus.RUNNING === value.cur) {\r\n\t\t\t\t\tthis.startRoll();\r\n\t\t\t\t} else if (RollerStatus.ENDING === value.cur) {\r\n\t\t\t\t\tthis.stopRollAll(true, this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'gameTypeInfo') {\r\n\t\t\t\tthis.changeGame(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changeGame(gameType: GameType) {\r\n\t\tconst columnListLayout = this.propertyNode.props_column_list.getComponent(Layout);\r\n\t\tconst isSubGame2 = gameType === GameType.SUBGAME2;\r\n\t\tconst isSubGame1 = gameType === GameType.SUBGAME1;\r\n\t\tconst isMain = gameType === GameType.MAIN;\r\n\t\tif (isMain || isSubGame2) {\r\n\t\t\tthis.node.position = new Vec3(config.normalRollOption.rollerWindowX, config.normalRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.normalRollOption.columnInterval;\r\n\t\t} else {\r\n\t\t\tthis.node.position = new Vec3(config.subGameRollOption.rollerWindowX, config.subGameRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.subGameRollOption.columnInterval;\r\n\r\n\t\t\tthis.changeRollerHeight(gameType);\r\n\t\t}\r\n\r\n\t\tif (isMain || isSubGame1) {\r\n\t\t\tthis.rollerViewModelArr.forEach(v => v.comp.replaceMultiRollerIcon());\r\n\t\t}\r\n\t}\r\n\r\n\t/**改变滚轴的高度 */\r\n\tprivate changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tif (gameType === GameType.SUBGAME2) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight2;\r\n\t\t} else if (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight1;\r\n\t\t}\r\n\t\tthis.node.getComponent(UITransform).height = rollerHeight;\r\n\r\n\t\tthis.rollerViewModelArr.forEach(v => v.comp.resetIconPos(gameType));\r\n\t}\r\n\r\n\tpublic isWinWild() {\r\n\t\tfor (let i = 0; i < this.rollerViewModelArr.length; i++) {\r\n\t\t\tconst element = this.rollerViewModelArr[i];\r\n\t\t\tif (element.comp.isWinWild()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_column_list.removeAllChildren();\r\n\r\n\t\tthis.initRoller();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isWaitEnding && cacheData.rollerLaunchResult) {\r\n\t\t\tthis.isWaitEnding = false;\r\n\t\t\tthis.node.isValid && this.stopRollAll(false, this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}