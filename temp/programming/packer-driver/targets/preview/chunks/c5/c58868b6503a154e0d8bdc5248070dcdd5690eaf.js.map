{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_Withdraw/Hall_WithdrawTip.ts"],"names":["_decorator","assetManager","Label","Node","Sprite","SpriteFrame","BaseComponent","maskBankCardNumber","config","Guide","TaskScheduler","Task","ccclass","property","Hall_WithdrawTip","taskScheduler","propertyNode","props_spr_tip_bg1","props_btn_tip_close","props_icon_reken","props_Label_accountNumber","props_Label_jumlah","props_btn_tip_tentukan","props_Label_biaya","props_layout_confirm","props_layout_tentukan","props","iconName","accountNumber","withdrawAmount","accountName","withdrawalPremium","logUrl","events","onClosehandler","doneHandler","start","initState","bindEvent","on","EventType","TOUCH_END","useProps","key","value","loadRemote","err","asset","getComponent","spriteFrame","createWithImage","scheduleOnce","string","cur","formatAmountWithCommas","beginGuide","bindUI","fristLogin","main","guide_1","guide_2","joinqQueue","done","begin","bindDone","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, assetManager, Component, ImageAsset, Label, Node, Sprite, SpriteFrame } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { bundleHall } from '../../index';\r\nimport { maskBankCardNumber } from '../../../utils/tool';\r\nimport { config } from '../../config';\r\nimport Guide from '../../../utils/Guide';\r\nimport TaskScheduler, { Task } from '../../../utils/TaskScheduler';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\t/**图标 */\r\n\ticonName: string,\r\n\t/**账户卡号 */\r\n\taccountNumber: string,\r\n\t/**提现金额 */\r\n\twithdrawAmount: number,\r\n\t/**账户名 */\r\n\taccountName: string,\r\n\t/**提现手续费比例 */\r\n\twithdrawalPremium: number,\r\n\t/**图片链接 */\r\n\tlogUrl: string\r\n}\r\nexport interface IEvent {\r\n\tonClosehandler: () => void\r\n\tdoneHandler: (accountNumber: string, withdrawAmount: number) => void\r\n}\r\n\r\n@ccclass('Hall_WithdrawTip')\r\nexport class Hall_WithdrawTip extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate taskScheduler: TaskScheduler = new TaskScheduler()\r\n\tprotected propertyNode: { [key: string]: Node } = {\r\n\t\t/**信息背景框 */\r\n\t\tprops_spr_tip_bg1: new Node(),\r\n\t\tprops_btn_tip_close: new Node(),\r\n\t\t/**图标 */\r\n\t\tprops_icon_reken: new Node(),\r\n\t\t/**卡号 */\r\n\t\tprops_Label_accountNumber: new Node(),\r\n\t\t/**提现金额 */\r\n\t\tprops_Label_jumlah: new Node(),\r\n\t\t/**确认按钮 */\r\n\t\tprops_btn_tip_tentukan: new Node(),\r\n\t\t/**名字 */\r\n\t\tprops_Label_biaya: new Node(),\r\n\t\t/**引导节点1 */\r\n\t\tprops_layout_confirm: new Node(),\r\n\t\t/**引导节点2 */\r\n\t\tprops_layout_tentukan: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t/**图标 */\r\n\t\ticonName: \"\",\r\n\t\t/**账户卡号 */\r\n\t\taccountNumber: \"\",\r\n\t\t/**提现金额 */\r\n\t\twithdrawAmount: 0,\r\n\t\t/**账户名 */\r\n\t\taccountName: \"\",\r\n\t\t/**提现手续费比例 */\r\n\t\twithdrawalPremium: 0,\r\n\t\tlogUrl: \"\"\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonClosehandler: () => { },\r\n\t\tdoneHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_tip_close.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.onClosehandler()\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"iconName\") {\r\n\t\t\t// bundleHall.load(`withdrawal/resource/icon_withdrawal_${value.cur.toLocaleLowerCase()}/spriteFrame`, SpriteFrame, (err, sp) => {\r\n\t\t\t// \t!err && (this.propertyNode.props_icon_reken.getComponent(Sprite).spriteFrame = sp)\r\n\t\t\t// })\r\n\r\n\t\t}\r\n\t\tif (key === \"logUrl\") {\r\n\t\t\tthis.props.logUrl && assetManager.loadRemote(this.props.logUrl, (err, asset: ImageAsset) => {\r\n\t\t\t\tif (this.propertyNode && !err) {\r\n\t\t\t\t\tthis.propertyNode.props_icon_reken.getComponent(Sprite).spriteFrame = SpriteFrame.createWithImage(asset)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (key === \"withdrawAmount\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.propertyNode.props_Label_jumlah.getComponent(Label).string = (value.cur * (1 - this.props.withdrawalPremium)).formatAmountWithCommas()\r\n\t\t\t\tthis.beginGuide()\r\n\t\t\t}, 0.05)\r\n\t\t}\r\n\t\tkey === \"accountNumber\" && (this.propertyNode.props_Label_accountNumber.getComponent(Label).string = maskBankCardNumber(value.cur, 3))\r\n\t\tkey === \"accountName\" && (this.propertyNode.props_Label_biaya.getComponent(Label).string = value.cur)\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_btn_tip_tentukan.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.doneHandler(this.props.accountNumber, this.props.withdrawAmount)\r\n\t\t})\r\n\t}\r\n\r\n\tpublic beginGuide() {\r\n\t\tif (config.fristLogin.main && !config.fristLogin['hasShow_4']) {\r\n\t\t\t//标明这里已经显示了\r\n\t\t\tconfig.fristLogin['hasShow_4'] = true\r\n\t\t\tconst guide_1 = new Guide(this.propertyNode.props_spr_tip_bg1, this.propertyNode.props_layout_confirm)\r\n\t\t\tconst guide_2 = new Guide(this.propertyNode.props_btn_tip_tentukan, this.propertyNode.props_layout_tentukan)\r\n\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\tguide_1.begin().bindDone(() => done())\r\n\t\t\t})).joinqQueue(new Task((done) => {\r\n\t\t\t\tguide_2.begin().bindDone(() => done())\r\n\t\t\t}))\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}