{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealth/Slot/Component/GodWealth_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Prefab","tween","UIOpacity","Vec3","GodWealth_BaseComponent","AudioManager","SoundList","getSpeedTime","ccclass","property","GodWealth_RollerPanel","rollerList","isSpeed","startAllRoll","stopIndexArr","getInstance","playSound","rollerFast","forEach","roller","i","getComponent","startRoll","togglesALLLayer","state","togglesThePopUpLayerState","stopAllRoll","isManualStop","callBack","stopRoll","time","isEnd","length","rollerComp","rollerIndex","rollerData","node","isValid","scheduleOnce","iconFlicker","mode","targetArr","allstate","cb","setIconEffect","setTimeout","clearStatus","iconDock","removeAllDockIcon","addDockIcon","uninstall","done","ui","parent","target","to","opacity","call","destroy","start","update","deltaTime","bindUI","getRollProxy","getRepository","layout","index","rollerNode","bindRollerData","setPosition","position","y","root","addChild","push","getParent","setScale","setSiblingIndex","bindEvent"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Layout, Node, Prefab, tween, UIOpacity, Vec3 } from 'cc';\r\nimport GodWealth_BaseComponent from './GodWealth_BaseComponent';\r\nimport { GodWealth_Roller } from './GodWealth_Roller';\r\nimport { RollerType } from '../Repositories/SlotRepository';\r\nimport { AudioManager, SoundList } from \"../Managr/AudioManager\";\r\nimport { getSpeedTime } from '../../../../utils/SlotSpeedConfig';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GodWealth_RollerPanel')\r\nexport class GodWealth_RollerPanel extends GodWealth_BaseComponent {\r\n    @property(Prefab)\r\n    roller: Prefab = null\r\n\r\n    public rollerList: Array<Node> = []\r\n    private isSpeed;\r\n\r\n    /**所有的滑槽都开始转动，传入停止信号发出后要停止的序列号(从1开始) */\r\n    public startAllRoll(stopIndexArr: number[], isSpeed: boolean = false) {\r\n        this.isSpeed = isSpeed;\r\n        AudioManager.getInstance().playSound(SoundList.rollerFast);\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).startRoll(stopIndexArr[i], isSpeed)\r\n        })\r\n    }\r\n\r\n    public togglesALLLayer(state: boolean) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).togglesThePopUpLayerState(state)\r\n        })\r\n    }\r\n\r\n    /**发出停止的信号（启动的时候已经传入了停止位置，不是马上停止，转到位置才停，这里需要传入闪动的图标队列） */\r\n    public stopAllRoll(isManualStop: boolean, callBack: () => void) {\r\n\t\tif(isManualStop){\r\n\t\t\tthis.isSpeed = true;\r\n\t\t}\r\n        this.stopRoll(0, callBack);\r\n    }\r\n\r\n    private stopRoll(i: number, callBack: () => void) {\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = getSpeedTime(this.isSpeed)\r\n        const isEnd = i >= this.rollerList.length - 1;\r\n        const rollerComp = this.rollerList[i].getComponent(\"GodWealth_Roller\") as GodWealth_Roller;\r\n        rollerComp.stopRoll((rollerIndex: number, rollerData: RollerType) => {\r\n            if (this.node.isValid) {\r\n                if (isEnd) {\r\n                    callBack()\r\n                }\r\n            }\r\n        })\r\n        this.scheduleOnce(() => {\r\n            if (this.node.isValid) {\r\n                if (!isEnd) {\r\n                    this.stopRoll(i + 1, callBack)\r\n                }\r\n            }\r\n        }, time)\r\n    }\r\n\r\n    /**图标闪动 */\r\n    public iconFlicker(mode: 'index' | 'coord', targetArr: number[][], allstate: boolean = false, cb?) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).setIconEffect(mode, [], true)\r\n            if (targetArr[i].length && allstate) {\r\n                (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).setIconEffect(mode, targetArr[i]);\r\n                setTimeout(() => {\r\n                    this.clearStatus()\r\n                    cb()\r\n                }, 1000)\r\n            } else if (targetArr[i].length) {\r\n                (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).setIconEffect(mode, targetArr[i], true);\r\n            }\r\n        })\r\n    }\r\n    public clearStatus() {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).setIconEffect('coord', [], true)\r\n        })\r\n    }\r\n    /**图标定住 */\r\n    public iconDock(mode: 'index' | 'coord', targetArr: number[][][]) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).removeAllDockIcon()\r\n            targetArr[i][1].length && (<GodWealth_Roller>roller.getComponent(\"GodWealth_Roller\")).addDockIcon(targetArr[i][1])\r\n        })\r\n    }\r\n\r\n    /**卸载面板(淡出) */\r\n    public uninstall(done?: () => void) {\r\n        const ui = this.node.parent.getComponent(UIOpacity)\r\n        tween().target(ui).to(0.5, { opacity: 0 }).call(() => {\r\n            // this.node.parent.removeAllChildren()\r\n            this.node.parent.destroy()\r\n            done && done()\r\n        }).start()\r\n\r\n        // tween().target(icon).to(0.5, {\r\n        // \tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n        // }, {\r\n        // \teasing: \"backOut\"//\"elasticOut\"\r\n        // }).call(() => {\r\n        // \tcount++\r\n        // \tif (count === this.RollerLayOut.children.length) {\r\n        // \t\tthis.stopCallBack()\r\n        // \t}\r\n        // }).start()\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    protected bindUI(): void {\r\n        const rollerData = this.getRollProxy().getRepository()\r\n        const layout = this.node.getComponent(Layout)\r\n        // layout.spacingX = 35\r\n\r\n        rollerData.rollerList.forEach((roller, index) => {\r\n            const rollerNode = instantiate(this.roller);\r\n            (rollerNode.getComponent(\"GodWealth_Roller\") as GodWealth_Roller).bindRollerData(index, roller)\r\n            rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n            this.root.addChild(rollerNode)\r\n            this.rollerList.push(rollerNode)\r\n        })\r\n\r\n\r\n        // const rollerNode = instantiate(this.roller);\r\n        // (rollerNode.getComponent(\"Roller\") as Roller).bindRollerData(0, rollerData.rollerList.data[0])\r\n        // rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n        // this.root.addChild(rollerNode)\r\n        // this.rollerList.push(rollerNode)\r\n\r\n        this.node.getParent().setScale(0.95, 0.95)\r\n        this.node.getParent().setSiblingIndex(100)\r\n\r\n        const ui = this.node.parent.getComponent(UIOpacity)\r\n        ui.opacity = 0;\r\n        tween().target(ui).to(0.5, { opacity: 255 }).call(() => {\r\n        }).start()\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}