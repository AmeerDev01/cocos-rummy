{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/login_v2/LoginDialogV2ViewModel.ts"],"names":["LoginDialogV2ViewModel","sys","ViewModel","ApiUrl","addToastAction","fetcher","lang","deviceInfo","getPackageName","loginEvents","constructor","begin","setProps","setEvent","loginHandler","loginName","password","done","send","LOGIN_PWD","type","memberName","macCode","getUniqueId","pkgCode","then","data","values","split","token","length","localStorage","setItem","comp","events","loginDoneHandler","catch","e","console","log","sendSmsHandler","phoneNumber","dispatch","content","write","k","BindPhoneModule","BindPhoneSend","placeStr","connect","initProps","inject","state"],"mappings":";;;+KAWMA,sB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAXSC,MAAAA,G,OAAAA,G;;AACRC,MAAAA,S;;AAGEC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,c,iBAAAA,c;;AACeC,MAAAA,O,iBAAAA,O;;AACfC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,c,iBAAAA,c;AAAgBC,MAAAA,W,iBAAAA,W;;;;;;;;;AAEnBT,MAAAA,sB,GAAN,MAAMA,sBAAN;AAAA;AAAA,kCAAmF;AACjFU,QAAAA,WAAW,GAAG;AACZ,gBAAM,oBAAN;AACD;;AACSC,QAAAA,KAAK,GAAG;AAChB,eAAKC,QAAL,CAAc,EAAd;AAEA,eAAKC,QAAL,CAAc;AACZC,YAAAA,YAAY,EAAE,CAACC,SAAD,EAAYC,QAAZ,EAAqBC,IAArB,KAA8B;AAC1C;AAAA;AAAA,sCAAQC,IAAR,CAAa;AAAA;AAAA,oCAAOC,SAApB,EAA+B;AAC7BC,gBAAAA,IAAI,EAAE,CADuB;AAE7BC,gBAAAA,UAAU,EAAEN,SAFiB;AAENC,gBAAAA,QAFM;AAG7BM,gBAAAA,OAAO,EAAE;AAAA;AAAA,8CAAWC,WAAX,EAHoB;AAI7BC,gBAAAA,OAAO,EAAE;AAAA;AAAA;AAJoB,eAA/B,EAKGC,IALH,CAKSC,IAAD,IAAU;AAChB,oBAAMC,MAAM,GAAGD,IAAI,CAACE,KAAL,CAAW,GAAX,CAAf;AACA,oBAAIC,KAAK,GAAGF,MAAM,CAACG,MAAP,KAAkB,CAAlB,GAAsBJ,IAAtB,GAA6BC,MAAM,CAAC,CAAD,CAA/C,CAFgB,CAGhB;;AACA1B,gBAAAA,GAAG,CAAC8B,YAAJ,CAAiBC,OAAjB,CAAyB,OAAzB,EAAkCH,KAAlC;AACA,qBAAKI,IAAL,CAAUC,MAAV,CAAiBC,gBAAjB;AACAlB,gBAAAA,IAAI,IAAIA,IAAI,CAAC,IAAD,CAAZ,CANgB,CAQhB;;AACA;AAAA;AAAA,gDAAYF,SAAZ;AACD,eAfD,EAeGqB,KAfH,CAeUC,CAAD,IAAO;AACdpB,gBAAAA,IAAI,IAAIA,IAAI,CAAC,KAAD,CAAZ;AACAqB,gBAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD,eAlBD;AAmBD,aArBW;AAsBZG,YAAAA,cAAc,EAAGC,WAAD,IAAyB;AACvC,mBAAKC,QAAL,CAAc;AAAA;AAAA,oDAAe;AAAEC,gBAAAA,OAAO,EAAE;AAAA;AAAA,kCAAKC,KAAL,CAAWC,CAAC,IAAIA,CAAC,CAACC,eAAF,CAAkBC,aAAlC,EAAiD,EAAjD,EAAqD;AAAEC,kBAAAA,QAAQ,EAAE;AAAZ,iBAArD;AAAX,eAAf,CAAd,EADuC,CAEvC;AACA;AACA;AACA;AACA;AACA;AACD;AA9BW,WAAd;AAgCD;;AACMC,QAAAA,OAAO,CAACC,SAAD,EAAkC;AAAA,cAAjCA,SAAiC;AAAjCA,YAAAA,SAAiC,GAAJ,EAAI;AAAA;;AAC9C,eAAKC,MAAL,CAAYD,SAAZ,EAAwBE,KAAD,IAAsB;AAC3C,mBAAO,EAAP;AACD,WAFD;AAGA,iBAAO,IAAP;AACD;;AA7CgF,O;;yBAgDpEpD,sB","sourcesContent":["import { Node, sys } from \"cc\"\r\nimport ViewModel from \"../../../base/ViewModel\"\r\nimport { StateType } from \"../../store/reducer\"\r\nimport { Hall_LoginDialogV2, IProps, LoginType, IEvent } from \"../../components/login_v2/Hall_LoginDialogV2\"\r\nimport { ApiUrl } from \"../../apiUrl\"\r\nimport { addToastAction } from \"../../store/actions/baseBoard\"\r\nimport { baseBoardView, fetcher, sourceManageSeletor } from \"../../index\"\r\nimport { lang } from \"../../index\"\r\nimport { deviceInfo } from \"../../config\"\r\nimport { getPackageName, loginEvents } from \"../../../common/bridge\"\r\n\r\nclass LoginDialogV2ViewModel extends ViewModel<Hall_LoginDialogV2, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_LoginDialogV2')\r\n  }\r\n  protected begin() {\r\n    this.setProps({})\r\n\r\n    this.setEvent({\r\n      loginHandler: (loginName, password,done) => {\r\n        fetcher.send(ApiUrl.LOGIN_PWD, {\r\n          type: 4,\r\n          memberName: loginName, password,\r\n          macCode: deviceInfo.getUniqueId(),\r\n          pkgCode: getPackageName()\r\n        }).then((data) => {\r\n          const values = data.split(\",\")\r\n          let token = values.length === 1 ? data : values[0];\r\n          //登录成功\r\n          sys.localStorage.setItem('token', token)\r\n          this.comp.events.loginDoneHandler()\r\n          done && done(true)\r\n\r\n          //登录成功发送事件\r\n          loginEvents(loginName);\r\n        }).catch((e) => {\r\n          done && done(false)\r\n          console.log(e)\r\n        })\r\n      },\r\n      sendSmsHandler: (phoneNumber: string) => {\r\n        this.dispatch(addToastAction({ content: lang.write(k => k.BindPhoneModule.BindPhoneSend, {}, { placeStr: \"验证信息已经发送，请注意查收\" }) }))\r\n        // Fetcher.Instance<Fetcher<ApiUrl>>().send(ApiUrl.SEND_SMS, { phone: phoneNumber }).then((rsp) => {\r\n        //   this.dispatch(addToastAction({ content: `验证信息已经发送，请注意查收` }))\r\n        //   this.setProps({ smsCode: rsp })\r\n        // }).catch((e) => {\r\n        //   console.log(e)\r\n        // })\r\n      }\r\n    })\r\n  }\r\n  public connect(initProps: Partial<IProps> = {}) {\r\n    this.inject(initProps, (state: StateType) => {\r\n      return {}\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default LoginDialogV2ViewModel"]}