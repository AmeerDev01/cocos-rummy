{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealthV2/components/GodWealthV2_SingleIconRoller.ts"],"names":["_decorator","Node","Vec3","BaseComponent","config","GameType","getColumnLockIconArr","IconId","cacheData","ccclass","property","GodWealthV2_SingleIconRoller","lastIndex","showIconCount","stopIconIndex","columnIndex","slotIndex","iconPool","iconRollerQueue","iconArr","intervalHeight","normalRollOption","rollOverCallback","props_column_effect_node","iconAnimationNode","isRoll","rollCount","rollerSpeed","subGameRollOption","propertyNode","props_icon_list","props","gameTypeInfo","lastGameType","MAIN","viewGameType","currGameType","leftCount","events","start","initState","setColumnEffectNode","getChildByName","initSlot","addIconIndex","initColumn","getSlotIndex","iconCount","i","joinIcon","length","iconId","iconConfig","icon","find","v","id","getIcon","position","lastNode","y","getPosition","getHeight","getNode","setPosition","push","amountNode","active","setBeetleAmount","getId","BEETLE","SUBGAME2","diff","calIndexDiff","lockIconDatas","fixedChessboardIcon","lockIconData","index","setAmount","amount","index1","index2","bindEvent","useProps","key","value","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","stopRoll","addLastJoinIconIndex","stopIndex","newValue","getStopIconIndex","bindUI","getRollSpeed","hideWin","playWinIcon","WILD","playWin","rollOverHandle","endIcon","scheduleOnce","node","isValid","getIconPosByIndex","height","singleRollerHeight","interval","getFirstIcon","shift","rollerIcon","speed","x","frist","hideY","restore","getIconIndex","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Mask, Node, sp, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { GodWealthV2Icon } from './GodWealthV2_Icon';\r\nimport { GameType, GameTypeInfo, getColumnLockIconArr, IconId,  RollerInfo, RollerStatus } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('GodWealthV2_SingleIconRoller')\r\nexport class GodWealthV2_SingleIconRoller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = 1;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**插槽索引 */\r\n\tprivate slotIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: GodWealthV2Icon[] = [];\r\n\t/**图标间隔 */\r\n\tprivate intervalHeight = config.normalRollOption.intervalHeight;\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\r\n\tprivate isRoll = false;\r\n\tprivate rollCount = 0;\r\n\tprivate rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0,\r\n\t\t},\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, slotIndex: number, lastIndex: number, iconPool: IconPool) {\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.slotIndex = slotIndex;\r\n\t\tthis.lastIndex = this.addIconIndex(lastIndex, 1);\r\n\t\tthis.iconPool = iconPool;\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\t}\r\n\r\n\tpublic getSlotIndex() {\r\n\t\treturn this.slotIndex;\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tconst position = new Vec3(0, 0);\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.intervalHeight;\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\t\tif (iconConfig.id === 12) {\r\n\t\t\ticon.amountNode.active = true;\r\n\t\t}\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置宝盒上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: GodWealthV2Icon) {\r\n\t\t\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff > 1) {\r\n\t\t// if (diff >= 0) {\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n        \r\n\t\tconst lockIconDatas = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\t\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === this.slotIndex)\r\n\t\tif (lockIconData) {\r\n\t\t\ticon.setAmount(lockIconData.amount)\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.isRoll = true;\r\n\t\tthis.rollCount = 0;\r\n\t\tthis.rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function) {\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\r\n\t\tconst diff = this.slotIndex === 2 ? 0 : this.slotIndex === 0 ? 2 : 1;\r\n\t\tthis.stopIconIndex = this.addIconIndex(this.stopIconIndex, diff);\r\n\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3);\r\n\r\n\t\t// console.log(`stopRoll--- columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},stopIconIndex:${this.stopIconIndex}, lastIndex:${this.lastIndex}`)\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tthis.lastIndex = this.addIconIndex(stopIndex, value);\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.rollCount <= 30 || this.stopIconIndex === -1) {\r\n\t\t\t// this.rollCount >= 60 && this.addLastJoinIconIndex(this.stopIconIndex, 1)\r\n\t\t\treturn this.rollerSpeed;\r\n\t\t}\r\n\t\tlet rollerSpeed = this.rollerSpeed;\r\n\t\tif (this.rollCount % 5 === 0) {\r\n\t\t\trollerSpeed -= 5;\r\n\t\t\trollerSpeed = rollerSpeed <= 0 ? 1 : rollerSpeed;\r\n\t\t\tthis.rollerSpeed = rollerSpeed;\r\n\t\t}\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},rollCount:${this.rollCount},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},rollerSpeed:${rollerSpeed}`);\r\n\r\n\t\treturn rollerSpeed;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tconst icon = this.iconArr[index];\r\n\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\tif (icon.getId() !== IconId.WILD) {\r\n\t\t\ticon.playWin(this.iconAnimationNode)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(endIcon: GodWealthV2Icon) {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node && this.node.isValid && this.rollOverCallback();\r\n\t\t}, 0.05)\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number) {\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst interval = this.intervalHeight * (index + 1)\r\n\t\tconst y = interval + height / 2 + height * index;\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得第一个图标 */\r\n\tpublic getFirstIcon() {\r\n\t\treturn this.iconArr.shift();\r\n\t}\r\n\r\n\tpublic rollerIcon() {\r\n\t\tthis.rollCount++;\r\n\t\tconst speed = this.getRollSpeed();\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - speed));\r\n\t\t})\r\n\t\tconst frist = this.iconArr[0];\r\n\t\tconst hideY = -(frist.getHeight() + this.intervalHeight)\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},y:${frist.getPosition().y},hideY:${hideY}`);\r\n\t\tif (frist.getPosition().y <= hideY) {\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[0]\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\t\t\t\tthis.rollOverHandle(endIcon);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprotected onDestroy(): void {\r\n\t\tthis.iconArr.forEach(v => v.restore());\r\n\t\tthis.iconArr = [];\r\n\t\tthis.iconRollerQueue = null;\r\n\t\tthis.props_column_effect_node = null;\r\n\t\tthis.iconAnimationNode = null;\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.rollerIcon();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}