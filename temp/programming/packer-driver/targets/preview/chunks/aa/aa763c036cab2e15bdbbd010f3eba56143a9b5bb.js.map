{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egyptV2/components/EgyptV2_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Node","tween","UITransform","Vec3","BaseComponent","IconPool","config","EgyptV2RollerViewModel","DialogType","GameType","getBigWinConfig","IconId","isAuto","isSubGameToSubGame","RollerStatus","updateRollerStatus","cacheData","changeGame","updateGold","updateSubGameAnimationPlayInfo","updateWinloss","egyptv2_Audio","mainViewModel","sourceManageSeletor","PrefabPathDefine","SoundPathDefine","ccclass","property","EgyptV2_RollerPanel","rollerViewModelArr","iconPool","icon","isManualStop","inStop","isWaitEnding","sendBetTime","propertyNode","props_column_list","props_roller_column","props_column_effect","props","rollerStatus","END","isSpeed","autoLauncherInfo","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","winloss","events","start","initState","initRoller","i","columnCount","column","roller","mountViewNode","appendTo","connect","push","comp","setColumnEffectNode","setEvent","onCheckNextLeftCount","checkNextLeftCount","initSlot","forEach","v","index","startRoll","console","log","isMainGame","dispatch","unscheduleAllCallbacks","endRoll","rollTime","getIsSpeed","scheduleOnce","rollerLaunchResult","node","isValid","stopRollAll","RUNNING","ENDING","stopRoll","rollEndHandle","bind","magnification","dl","si","bigWinConfig","isSubGameLastPoint","isMain","auto","winLine","startPlayWinIcon","normalRollOption","winIconFlickerTime","playBeeteFlyAmountToSunGod","playBigWinHandle","playWinAudio","nextLeftCount","isSubGame2","undefined","isWinWild","playOneShot","wild","haveCoin","roundTw","tw","isChangeGame","SUBGAME2","bl","isSubGame1","freeGameAmount","isEnterSubGame2","showDialogWin","dialogType","name","params","updateRollerStatusEnd","ling","playBeetleAnimation","playBeeteFlyAmount","changeGameHandle","SUBGAME1","count","length","done","nodes","concat","getBeetleNode","endPos","parent","getComponent","convertToNodeSpaceAR","getGoodLuckPos","startPos","getAmountNode","getWorldPosition","cloneNode","addChild","setPosition","to","subGameRollOption","beetleFlyTime","position","call","destroy","playParticle2D","sunGodIcons","getWinSunGodIconNode","eachSunGodIcon","sunGodIcon","sort","a","b","getIconIndex","getNode","worldPosition","playAmountToSunGodCourse","element","getSunGodIconNode","sunGoldIcon","egyptV2Icon","sunGodNum","setAmount","getAmount","parentNode","particleNode","getFile","Particle2D","source","removeSelf","isSubGame","changeToSubGame","changeToMainGame","viewGameCountOver","changeSubGameToSubGame","FREE_GAME_ENTRY","freeCount","gameType","param","FREE_GAME_SETTLEMENT","changeRollerHeight","callBack","time","isEnd","rollerComp","stopIconIndex","rollerId","scatterCount","getScatterCount","nextColmunIsBorder","isSpeedBorder","endColumnIndex","scatter","iconIndex","queue","iconRollerQueue","showIconCount","SCATTER","linePlayTime","wp","lines","key","executeWinIcon","lineNumber","winIconArr","pauseWinIcon","columnIndex","playWinIcon","bindEvent","useProps","value","cur","columnListLayout","rollerWindowX","rollerWindowY","spacingX","columnInterval","replaceMultiRollerIcon","rollerHeight","rollerHeight2","rollerHeight1","height","resetIconPos","bindUI","removeAllChildren","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Layout, Node, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport EgyptV2RollerViewModel from '../viewModel/EgyptV2RollerViewModel';\r\nimport { AutoLauncherInfo, DialogType, GameType, GameTypeInfo, getBigWinConfig, IconId, isAuto, isSubGameToSubGame, RollerLaunchResult, RollerStatus } from '../type';\r\nimport { updateRollerStatus } from '../store/actions/roller';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { changeGame, updateGold, updateSubGameAnimationPlayInfo, updateWinloss } from '../store/actions/game';\r\nimport { egyptv2_Audio, mainViewModel, sourceManageSeletor } from '../index';\r\nimport game from '../store/reducer/game';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { EgyptV2Icon } from './EgyptV2_Icon';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\t/**滚动状态 */\r\n\trollerStatus: RollerStatus,\r\n\t/**是否加速 */\r\n\tisSpeed: boolean,\r\n\t/** 自动运行信息 */\r\n\tautoLauncherInfo: AutoLauncherInfo,\r\n\t/**游戏类型信息 */\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/**总输赢 */\r\n\twinloss: number,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('EgyptV2_RollerPanel')\r\nexport class EgyptV2_RollerPanel extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate rollerViewModelArr: EgyptV2RollerViewModel[] = [];\r\n\tprivate iconPool: IconPool = new IconPool(config.icon);\r\n\tprivate isManualStop: boolean = false;\r\n\tprivate inStop = false;\r\n\r\n\tprivate isWaitEnding = false;\r\n\r\n\tprivate sendBetTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_column_list: new Node(),\r\n\t\tprops_roller_column: new Node(),\r\n\t\tprops_column_effect: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t/**滚动状态 */\r\n\t\trollerStatus: RollerStatus.END,\r\n\t\tisSpeed: false,\r\n\t\tautoLauncherInfo: null,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\twinloss: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprivate initRoller() {\r\n\t\tfor (let i = 0; i < config.columnCount; i++) {\r\n\t\t\tconst column = instantiate(this.propertyNode.props_roller_column);\r\n\t\t\tconst roller = new EgyptV2RollerViewModel().mountViewNode(column).appendTo(this.propertyNode.props_column_list).connect();\r\n\t\t\tthis.rollerViewModelArr.push(roller);\r\n\t\t\troller.comp.setColumnEffectNode(this.propertyNode.props_column_effect);\r\n\t\t\troller.setEvent({\r\n\t\t\t\tonCheckNextLeftCount: () => {\r\n\t\t\t\t\tthis.checkNextLeftCount()\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initSlot() {\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.initSlot(index, this.iconPool);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate startRoll() {\r\n\t\tlet sendBetTime = cacheData.sendBetTime;\r\n\t\tthis.sendBetTime = sendBetTime;\r\n\t\tthis.isManualStop = false;\r\n\t\tconsole.log(\"start roll time \" + sendBetTime)\r\n\t\tconst isMainGame = this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t\tif (isMainGame) {\r\n\t\t\tthis.dispatch(updateWinloss(0))\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.startRoll()\r\n\t\t});\r\n\r\n\t\tthis.endRoll(sendBetTime);\r\n\t}\r\n\r\n\tprivate endRoll(sendBetTime: number) {\r\n\t\t// 前期滚动的事件\r\n\t\tconst rollTime = this.getIsSpeed() ? 0.1 : 1;\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\t// console.log(\"endRoll scheduleOnce \" + sendBetTime + \" currentTime \" + new Date().getTime());\r\n\t\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\t\tthis.isWaitEnding = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis.node.isValid && this.stopRollAll(false, sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t\t}\r\n\t\t}, rollTime)\r\n\t}\r\n\r\n\tprivate stopRollAll(isManualStop: boolean = false, sendBetTime: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.inStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.inStop = true;\r\n\t\tthis.isManualStop = isManualStop;\r\n\r\n\t\tif (RollerStatus.RUNNING === this.props.rollerStatus) {\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.ENDING))\r\n\t\t}\r\n\r\n\t\tconsole.log(\"rollerpanel stop roll time \" + sendBetTime);\r\n\t\tthis.stopRoll(0, this.rollEndHandle.bind(this, rollerLaunchResult), rollerLaunchResult);\r\n\t}\r\n\r\n\t/**\r\n\t * 动画滚动结束处理\r\n\t */\r\n\tprivate rollEndHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst magnification = rollerLaunchResult.dl.si[0].magnification;\r\n\t\tconst bigWinConfig = getBigWinConfig(magnification)\r\n\t\t// 是否小游戏最后一局\r\n\t\tconst isSubGameLastPoint = !this.isMain() && this.props.gameTypeInfo.leftCount <= 1;\r\n\r\n\t\tthis.inStop = false;\r\n\t\tconst auto = isAuto(this.props.autoLauncherInfo, this.props.gameTypeInfo);\r\n\t\tconst winLine = this.startPlayWinIcon(config.normalRollOption.winIconFlickerTime, () => {\r\n\t\t}, rollerLaunchResult);\r\n\r\n\t\t// 最开始就看是否有太阳神图标\r\n\t\tthis.playBeeteFlyAmountToSunGod(() => {\r\n\t\t\tif (winLine === 0) {\r\n\t\t\t\tthis.playBigWinHandle(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t} else {\r\n\t\t\t\tthis.playWinAudio();\r\n\t\t\t\t// 中奖之后延迟一点结束\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.playBigWinHandle(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t}, 1)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (!bigWinConfig) {\r\n\t\t\tthis.updateWinloss(rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate checkNextLeftCount() {\r\n\t\tconst nextLeftCount = this.props.gameTypeInfo.nextLeftCount;\r\n\t\t// 在转动结束之后如果发现下一局的剩余局数有值，就变更一次\r\n\t\tif (this.isSubGame2() && nextLeftCount >= 0) {\r\n\t\t\tthis.dispatch(changeGame({\r\n\t\t\t\t...this.props.gameTypeInfo,\r\n\t\t\t\tleftCount: nextLeftCount,\r\n\t\t\t\tnextLeftCount: undefined\r\n\t\t\t}))\r\n\t\t}\r\n\t}\r\n\r\n\tprivate playWinAudio() {\r\n\t\tif (this.isWinWild()) {\r\n\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.wild)\r\n\t\t} else {\r\n\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.haveCoin)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateWinloss(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\t// 本局输赢\r\n\t\tconst roundTw = si.tw\r\n\t\tif (this.isMain()) {\r\n\t\t\tif (roundTw <= 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// 在切到小游戏2时，输赢金额不更新，因为中奖的金额在加到小游戏里\r\n\t\t\tif (!this.isChangeGame() || this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2) {\r\n\t\t\t\tthis.dispatch(updateWinloss(roundTw))\r\n\t\t\t\t// 小游戏要在结算时更新余额\r\n\t\t\t\tthis.dispatch(updateGold(si.bl))\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 小游戏1在游戏中余额之后在切换到主游戏时才加上去\r\n\t\t\tif (this.isSubGame1()) {\r\n\t\t\t\tthis.dispatch(updateWinloss(si.freeGameAmount))\r\n\t\t\t}\r\n\r\n\t\t\tif (this.isChangeGame()) {\r\n\t\t\t\tthis.dispatch(updateGold(si.bl))\r\n\t\t\t\tthis.dispatch(updateWinloss(si.freeGameAmount))\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放大奖处理 */\r\n\tprivate playBigWinHandle(bigWinConfig, auto: boolean, isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\r\n\t\t// 是否进入小游戏2\r\n\t\t// let isEnterSubGame2 = this.props.gameTypeInfo.viewGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.currGameType === GameType.SUBGAME2;\r\n\t\tlet isEnterSubGame2 = false;\r\n\t\t// 进入小游戏2时不播放大奖\r\n\t\tif (!isEnterSubGame2 && bigWinConfig) {\r\n\t\t\t// 延迟一点点播放大奖\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t!this.isSubGame2() && this.updateWinloss(rollerLaunchResult);\r\n\t\t\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\t\t\tlet winloss = si.tw;\r\n\t\t\t\twinloss = winloss === 0 ? si.freeGameAmount : winloss;\r\n\t\t\t\tconst isChangeGame = this.isChangeGame();\r\n\t\t\t\tif (isChangeGame && si.freeGameAmount > 0) {\r\n\t\t\t\t\twinloss = si.freeGameAmount;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 中大奖提示框\r\n\t\t\t\tthis.node.isValid && mainViewModel.showDialogWin({\r\n\t\t\t\t\tdialogType: bigWinConfig.name,\r\n\t\t\t\t\tparams: [winloss],\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t})\r\n\t\t\t}, 0.8)\r\n\t\t} else {\r\n\t\t\tthis.updateRollerStatusEnd(bigWinConfig, auto, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 更新结束滚动状态\r\n\t * @param bigWinConfig 大奖配置\r\n\t * @param auto \r\n\t * @param isSubGameLastPoint 是否小游戏最后一局\r\n\t */\r\n\tprivate updateRollerStatusEnd(bigWinConfig, auto: boolean, isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst isChangeGame = this.isChangeGame();\r\n\t\tif (isChangeGame) {\r\n\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME2) {\r\n\t\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.ling, 1, false)\r\n\t\t\t\tthis.playBeetleAnimation(isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t\t\tthis.playBeeteFlyAmount(() => {\r\n\t\t\t\t\t\tthis.updateWinloss(rollerLaunchResult);\r\n\t\t\t\t\t\t// 飞完之后间隔1秒再继续\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t\t\t}, 1)\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.props.gameTypeInfo.currGameType === GameType.SUBGAME1) {\r\n\t\t\t\t\t\tegyptv2_Audio.playOneShot(SoundPathDefine.ling, 1, false)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放甲壳虫动画，播放完成之后进去切换游戏 */\r\n\tprivate playBeetleAnimation(isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 0;\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tv.comp.playBeetleAnimation(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.rollerViewModelArr.length) {\r\n\t\t\t\t\tthis.changeGameHandle(isSubGameLastPoint, rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**播放甲壳虫的飞数字动画 */\r\n\tprivate playBeeteFlyAmount(done) {\r\n\t\tlet nodes: EgyptV2Icon[] = [];\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tnodes = nodes.concat(v.comp.getBeetleNode(true));\r\n\t\t})\r\n\r\n\t\tconst endPos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(mainViewModel.getGoodLuckPos());\r\n\r\n\t\tlet count = 0;\r\n\t\tnodes.forEach(v => {\r\n\t\t\tconst startPos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(v.getAmountNode().getWorldPosition());\r\n\t\t\tconst cloneNode = instantiate(v.getAmountNode())\r\n\t\t\tthis.node.parent.addChild(cloneNode);\r\n\t\t\tcloneNode.setPosition(startPos)\r\n\t\t\ttween(cloneNode).to(config.subGameRollOption.beetleFlyTime, { position: endPos }).call(() => {\r\n\t\t\t\tcloneNode.destroy();\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= nodes.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t}).start()\r\n\t\t\tthis.playParticle2D(startPos, endPos, this.node.parent);\r\n\t\t})\r\n\t}\r\n\r\n\t/**飞数字到太阳神图标上 */\r\n\tprivate playBeeteFlyAmountToSunGod(done) {\r\n\t\tif (!this.isSubGame2()) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet sunGodIcons: EgyptV2Icon[] = this.getWinSunGodIconNode();\r\n\t\tif (sunGodIcons.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.eachSunGodIcon(0, sunGodIcons, done);\r\n\t}\r\n\r\n\t/**遍历太阳神图标 */\r\n\tprivate eachSunGodIcon(index: number, sunGodIcons: EgyptV2Icon[], done) {\r\n\t\tconst sunGodIcon = sunGodIcons[index];\r\n\r\n\t\tlet nodes: EgyptV2Icon[] = [];\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tnodes = nodes.concat(v.comp.getBeetleNode(true));\r\n\t\t})\r\n\r\n\t\t// 按照行的顺序排序，从上往下\r\n\t\tnodes.sort((a, b) => b.getIconIndex() - a.getIconIndex());\r\n\r\n\t\tconst endPos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(sunGodIcon.getNode().worldPosition);\r\n\t\tthis.playAmountToSunGodCourse(nodes, sunGodIcon, 0, config.subGameRollOption.beetleFlyTime, endPos, () => {\r\n\t\t\tindex++;\r\n\t\t\tif (index >= sunGodIcons.length) {\r\n\t\t\t\tdone && done();\r\n\t\t\t} else {\r\n\t\t\t\tthis.eachSunGodIcon(index, sunGodIcons, done);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 获得中奖的太阳神图标\r\n\t * @returns \r\n\t */\r\n\tprivate getWinSunGodIconNode() {\r\n\t\tconst sunGodIcons: EgyptV2Icon[] = [];\r\n\t\tfor (let i = 0; i < this.rollerViewModelArr.length; i++) {\r\n\t\t\tconst element = this.rollerViewModelArr[i];\r\n\t\t\tif (element.comp.getSunGodIconNode()) {\r\n\t\t\t\tsunGodIcons.push(element.comp.getSunGodIconNode());\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sunGodIcons;\r\n\t}\r\n\r\n\t/**飞向太阳神图标的过程处理 */\r\n\tprivate playAmountToSunGodCourse(nodes: EgyptV2Icon[], sunGoldIcon: EgyptV2Icon, index: number, beetleFlyTime: number, endPos: Vec3, done) {\r\n\t\tconst egyptV2Icon = nodes[index];\r\n\t\tconst startPos = this.node.parent.getComponent(UITransform).convertToNodeSpaceAR(egyptV2Icon.getAmountNode().getWorldPosition());\r\n\t\tconst cloneNode = instantiate(egyptV2Icon.getAmountNode())\r\n\r\n\t\tthis.node.parent.addChild(cloneNode);\r\n\t\tcloneNode.setPosition(startPos)\r\n\t\t// 播放音效\r\n\t\tegyptv2_Audio.playOneShot(SoundPathDefine.sunGodNum)\r\n\t\ttween(cloneNode).to(beetleFlyTime, { position: endPos }).call(() => {\r\n\t\t\tcloneNode.destroy();\r\n\t\t\tsunGoldIcon.setAmount(sunGoldIcon.getAmount() + egyptV2Icon.getAmount());\r\n\t\t\tindex++;\r\n\t\t\tif (index >= nodes.length) {\r\n\t\t\t\tdone && done();\r\n\t\t\t} else {\r\n\t\t\t\tthis.playAmountToSunGodCourse(nodes, sunGoldIcon, index, beetleFlyTime, endPos, done);\r\n\t\t\t}\r\n\t\t}).start()\r\n\t\tthis.playParticle2D(startPos, endPos, this.node.parent);\r\n\t}\r\n\r\n\tprivate playParticle2D(startPos: Vec3, endPos: Vec3, parentNode: Node) {\r\n\t\tconst particleNode = instantiate(sourceManageSeletor().getFile(PrefabPathDefine.Particle2D).source) as Node\r\n\t\tparticleNode.setPosition(startPos);\r\n\t\tparentNode.addChild(particleNode);\r\n\t\ttween(particleNode).to(config.subGameRollOption.beetleFlyTime, { position: endPos }).removeSelf().start();\r\n\t}\r\n\r\n\tprivate changeGameHandle(isSubGameLastPoint: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.updateWinloss(rollerLaunchResult);\r\n\t\tif (this.isSubGame(this.props.gameTypeInfo.currGameType)) {\r\n\t\t\tthis.changeToSubGame(this.props.gameTypeInfo.currGameType, isSubGameLastPoint, rollerLaunchResult);\r\n\t\t} else if (this.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n\t\t\tthis.changeToMainGame(this.props.gameTypeInfo.viewGameType, rollerLaunchResult)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 切换到小游戏处理\r\n\t * @param currGameType 当前游戏\r\n\t * @param viewGameCountOver 当前小游戏次数是否结束\r\n\t * @param nextGameType 下一个游戏\r\n\t */\r\n\tprivate changeToSubGame(currGameType: GameType, viewGameCountOver: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (viewGameCountOver) {\r\n\t\t\tthis.changeSubGameToSubGame(currGameType, rollerLaunchResult);\r\n\t\t} else {\r\n\t\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\tdialogType: DialogType.FREE_GAME_ENTRY,\r\n\t\t\t\tparams: [rollerLaunchResult.dl.si[0].freeCount],\r\n\t\t\t}, () => {\r\n\t\t\t\t// this.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\tgameType: currGameType,\r\n\t\t\t\t\tparam: 0 //开门类型\r\n\t\t\t\t}))\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**切换到主游戏的处理 */\r\n\tprivate changeToMainGame(gameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.isSubGame(gameType)) {\r\n\t\t\t// 弹出结算面板\r\n\t\t\tmainViewModel.showDialogWin({\r\n\t\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\t\tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t\t}, () => {\r\n\t\t\t\t// 在切换回主游戏时，改变滚轴的高度\r\n\t\t\t\t// 这里要注意：小游戏退回到大厅有一个放大缩小的过程，如果把 changeRollerHeight 放到放大后执行，获取的坐标是不准确的\r\n\t\t\t\tthis.changeRollerHeight(GameType.MAIN);\r\n\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\tgameType: gameType,\r\n\t\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t\t}))\r\n\t\t\t\t// this.changeRollerHeight(GameType.MAIN);\r\n\r\n\t\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\t\tthis.changeGame(GameType.MAIN);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\t/**切换小游戏到小游戏，弹出结算面板 */\r\n\tprivate changeSubGameToSubGame(gameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 弹出结算面板\r\n\t\tmainViewModel.showDialogWin({\r\n\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t}, () => {\r\n\t\t\t// 播放切换游戏动画\r\n\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\tgameType: gameType,\r\n\t\t\t\tparam: 1 // 关门动画\r\n\t\t\t}))\r\n\t\t\t// 只有在切回到小游戏1时，才改变滚轴的高度\r\n\t\t\tgameType === GameType.SUBGAME1 && this.changeRollerHeight(gameType);\r\n\t\t\t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t\tthis.changeGame(gameType);\r\n\t\t})\r\n\t}\r\n\r\n\t/**是否准备切换游戏 */\r\n\tprivate isChangeGame() {\r\n\t\tif (!this.props.gameTypeInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (isSubGameToSubGame(this.props.gameTypeInfo.viewGameType, this.props.gameTypeInfo.currGameType)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn this.props.gameTypeInfo.viewGameType !== this.props.gameTypeInfo.currGameType;\r\n\t}\r\n\r\n\tprivate isMain() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t}\r\n\r\n\tprivate isSubGame(gameType: GameType) {\r\n\t\treturn gameType === GameType.SUBGAME1 || gameType === GameType.SUBGAME2\r\n\t}\r\n\r\n\tprivate getIsSpeed() {\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.isManualStop) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn this.props.isSpeed;\r\n\t}\r\n\r\n\tprivate stopRoll(i: number, callBack: (rollerLaunchResult: RollerLaunchResult) => void, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = this.getIsSpeed() ? 0 : 0.2;\r\n\t\tconst isEnd = i >= this.rollerViewModelArr.length - 1;\r\n\t\tconst rollerComp = this.rollerViewModelArr[i];\r\n\t\t// const stopIconIndex = Math.floor(Math.random() * config.iconRollerQueue[i].length);\r\n\t\t// 获得停下来的数据\r\n\t\tconst stopIconIndex = rollerLaunchResult.dl.si[0].rollerId[i];\r\n\r\n\t\tconst scatterCount = this.getScatterCount(i, rollerLaunchResult);\r\n\t\t// 下一个列是否有边框\r\n\t\tconst nextColmunIsBorder = this.getScatterCount(i + 1, rollerLaunchResult) >= 2;\r\n\r\n\t\t// console.log(\"scatterCount\", scatterCount, i, stopIconIndex);\r\n\t\t// 是否快速边框，前面出现2个以上的scatter，这个参数才为true\r\n\t\tconst isSpeedBorder = scatterCount >= 2;\r\n\t\trollerComp.comp.stopRoll(stopIconIndex, () => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tif (isEnd) {\r\n\t\t\t\t\tcallBack(rollerLaunchResult)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnextColmunIsBorder && this.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, isSpeedBorder, rollerLaunchResult)\r\n\t\t// 小游戏2滚轴一起停\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tif (!isEnd) {\r\n\t\t\t\tthis.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// console.log(\"stoproll time \", i, time)\r\n\t\t\t!nextColmunIsBorder && this.scheduleOnce(() => {\r\n\t\t\t\tif (this.node.isValid) {\r\n\t\t\t\t\tif (!isEnd) {\r\n\t\t\t\t\t\tthis.stopRoll(i + 1, callBack, rollerLaunchResult)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, time)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**获得前面几列的scatter个数 */\r\n\tprivate getScatterCount(endColumnIndex: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 前两列不计算数量或者小游戏2也不计算\r\n\t\tif (endColumnIndex < 2 || this.isSubGame2()) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tendColumnIndex = endColumnIndex >= this.rollerViewModelArr.length ? this.rollerViewModelArr.length : endColumnIndex;\r\n\t\tconst rollerId = rollerLaunchResult.dl.si[0].rollerId;\r\n\t\tlet scatter = 0;\r\n\t\tfor (let i = 0; i < endColumnIndex; i++) {\r\n\t\t\tlet iconIndex = rollerId[i] as number;\r\n\t\t\tconst queue = config.iconRollerQueue[i]\r\n\t\t\tfor (let i = 0; i < config.normalRollOption.showIconCount; i++) {\r\n\t\t\t\tif (queue[iconIndex] === IconId.SCATTER) {\r\n\t\t\t\t\tscatter++;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (++iconIndex >= queue.length) {\r\n\t\t\t\t\ticonIndex = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn scatter;\r\n\t}\r\n\r\n\t/**\r\n\t * 显示中奖图标\r\n\t * @param linePlayTime \r\n\t * @param done 所有线路播放完之后执行\r\n\t */\r\n\tprivate startPlayWinIcon(linePlayTime: number, done, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet winLine = 0;\r\n\t\tif (rollerLaunchResult) {\r\n\t\t\tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t\t\tconst lines: any[] = [];\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\tlines.push(key);\r\n\t\t\t}\r\n\r\n\t\t\twinLine = lines.length;\r\n\r\n\t\t\tif (lines.length > 0) {\r\n\t\t\t\tthis.executeWinIcon(-1, lines, wp, linePlayTime, done);\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn winLine;\r\n\t}\r\n\r\n\t/**\r\n\t * 播放赢的图标\r\n\t * @param index 线的索引\r\n\t * @param lines 中奖线的数组\r\n\t * @param wp 中间对象\r\n\t * @param linePlayTime 播放一条线的时间\r\n\t * @param done\r\n\t * @returns \r\n\t */\r\n\tprivate executeWinIcon(index: number, lines: any[], wp, linePlayTime: number, done) {\r\n\t\tif (!cacheData.rollerLaunchResult) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (index >= lines.length) {\r\n\t\t\tindex = -1;\r\n\t\t\tdone && done();\r\n\t\t}\r\n\t\tconst lineNumber = lines[index];\r\n\t\tlet winIconArr = [];\r\n\t\tif (index === -1) {\r\n\t\t\tlinePlayTime = 2;\r\n\t\t\tfor (const key in wp) {\r\n\t\t\t\twinIconArr = winIconArr.concat(wp[key])\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twinIconArr = winIconArr.concat(wp[lineNumber])\r\n\t\t\t// 一条线中了几个图标就播放多少秒\r\n\t\t\tlinePlayTime = winIconArr.length;\r\n\t\t}\r\n\t\tthis.rollerViewModelArr.forEach(v => v.comp.pauseWinIcon())\r\n\t\twinIconArr.forEach(v => {\r\n\t\t\tconst columnIndex = v[0];\r\n\t\t\tconst iconIndex = v[1];\r\n\t\t\tthis.rollerViewModelArr[columnIndex].comp.playWinIcon(iconIndex);\r\n\t\t})\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.executeWinIcon(++index, lines, wp, linePlayTime, done);\r\n\t\t}, linePlayTime);\r\n\t}\r\n\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'rollerStatus') {\r\n\t\t\t\tif (RollerStatus.RUNNING === value.cur) {\r\n\t\t\t\t\tthis.startRoll();\r\n\t\t\t\t} else if (RollerStatus.ENDING === value.cur) {\r\n\t\t\t\t\tthis.stopRollAll(true, this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'gameTypeInfo') {\r\n\t\t\t\tthis.changeGame(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changeGame(gameType: GameType) {\r\n\t\tconst columnListLayout = this.propertyNode.props_column_list.getComponent(Layout);\r\n\t\tconst isSubGame2 = gameType === GameType.SUBGAME2;\r\n\t\tconst isSubGame1 = gameType === GameType.SUBGAME1;\r\n\t\tconst isMain = gameType === GameType.MAIN;\r\n\t\tif (isMain || isSubGame2) {\r\n\t\t\tthis.node.position = new Vec3(config.normalRollOption.rollerWindowX, config.normalRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.normalRollOption.columnInterval;\r\n\t\t} else {\r\n\t\t\tthis.node.position = new Vec3(config.subGameRollOption.rollerWindowX, config.subGameRollOption.rollerWindowY);\r\n\t\t\tcolumnListLayout.spacingX = config.subGameRollOption.columnInterval;\r\n\r\n\t\t\tthis.changeRollerHeight(gameType);\r\n\t\t}\r\n\r\n\t\tif (isMain || isSubGame1) {\r\n\t\t\tthis.rollerViewModelArr.forEach(v => v.comp.replaceMultiRollerIcon());\r\n\t\t}\r\n\t}\r\n\r\n\t/**改变滚轴的高度 */\r\n\tprivate changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tif (gameType === GameType.SUBGAME2) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight2;\r\n\t\t} else if (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight1;\r\n\t\t}\r\n\t\tthis.node.getComponent(UITransform).height = rollerHeight;\r\n\r\n\t\tthis.rollerViewModelArr.forEach(v => v.comp.resetIconPos(gameType));\r\n\t}\r\n\r\n\tpublic isWinWild() {\r\n\t\tfor (let i = 0; i < this.rollerViewModelArr.length; i++) {\r\n\t\t\tconst element = this.rollerViewModelArr[i];\r\n\t\t\tif (element.comp.isWinWild()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.propertyNode.props_column_list.removeAllChildren();\r\n\r\n\t\tthis.initRoller();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isWaitEnding && cacheData.rollerLaunchResult) {\r\n\t\t\tthis.isWaitEnding = false;\r\n\t\t\tthis.node.isValid && this.stopRollAll(false, this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}