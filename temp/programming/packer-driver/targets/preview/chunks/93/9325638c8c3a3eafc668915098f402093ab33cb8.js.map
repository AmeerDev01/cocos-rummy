{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/Crash/game/Crash_Main_UI.ts"],"names":["_decorator","AudioSource","Crash_NetMsgDispatcher","ProtocolCode","establishAConnection","Crash_ViewBase","Crash_DataManager","Crash_Persian_puritan","Crash_Game_contentLayer","Crash_RecordListLayer","AudioManager","SceneBgMusic","WsManager","Crash_GameManager","ccclass","property","Crash_Main_UI","gameTypeStop1","gameTypeStop2","timeAccumulator","start","getInstance","regCallBack","RES_ROOM_RETURN","sendChatRsp","url","window","location","href","tokenRegex","match","token","data","localStorage","getItem","setParams","send","audio","node","addComponent","setAudioSource","playMusic","mainBg","update","deltaTime","crashStageVo","getCrashStageVo","gameType","_nodes","active","getComponent","init","seconds","updateTheMusicStatus","bl","args","rea","param","setCrashStageVo","getUserInfo","setUserInfo","myInfo","setOddsList","oddsList","setRoomInfoVos","roomInfoVos","setTableId","roomId","components","length","setIsLogin","onDestroy","removeAllProtocolByObj"],"mappings":"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","sourcesContent":["import { _decorator, AudioSource, Node} from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nimport Crash_NetMsgDispatcher from \"../net/Crash_NetMsgDispatcher\";\r\nimport { ProtocolCode } from '../net/protocol/ProtocolDef';\r\nimport {establishAConnection} from '../net/protocol/WsProtocol';\r\nimport {Crash_ViewBase} from \"../BaseView/Crash_ViewBase\" ;\r\nimport {Crash_DataManager} from \"../manager/Crash_DataManager\";\r\nimport {Crash_Persian_puritan} from \"./Crash_Persian_puritan\";\r\nimport {Crash_Game_contentLayer} from \"./Crash_Game_contentLayer\";\r\nimport {Crash_RecordListLayer} from \"./Crash_RecordListLayer\";\r\nimport {AudioManager, SceneBgMusic} from \"../manager/AudioManager\";\r\nimport WsManager from \"../net/Crash_WsManager\";\r\nimport Crash_GameManager from '../manager/Crash_GameManager';\r\n@ccclass('Main_UI')\r\nexport class Crash_Main_UI extends Crash_ViewBase {\r\n    gameTypeStop1=true\r\n    gameTypeStop2=true\r\n    timeAccumulator=0\r\n    start() {\r\n        Crash_NetMsgDispatcher.getInstance().regCallBack(ProtocolCode.RES_ROOM_RETURN, this, this.sendChatRsp);\r\n        let url = window.location.href;\r\n        let tokenRegex = /token=([^&]+)/;\r\n        let match = url.match(tokenRegex);\r\n        let token = match && match[1];\r\n        let data={\r\n            \"token\":localStorage.getItem('token') || token\r\n        }\r\n        new establishAConnection().setParams(data.token).send(data);\r\n        let audio: any = this.node.addComponent(AudioSource);\r\n        AudioManager.getInstance().setAudioSource(audio);\r\n        AudioManager.getInstance().playMusic(SceneBgMusic.mainBg, true);\r\n    }\r\n    update(deltaTime: number) {\r\n        let crashStageVo=Crash_DataManager.getInstance().getCrashStageVo()\r\n        if(!crashStageVo)return;\r\n        if(crashStageVo.gameType===1){\r\n            this._nodes['persiapan_putaran'].active=true\r\n            this._nodes['game_content'].active=false\r\n            if(this.gameTypeStop1){\r\n                this._nodes['persiapan_putaran'].getComponent(Crash_Persian_puritan).init(crashStageVo.seconds);\r\n                // let persiapanPutaran= this._nodes['persiapan_putaran'].getComponent(Crash_Persian_puritan)\r\n                // if(persiapanPutaran.getStateMachine()){\r\n                //     this._nodes['persiapan_putaran'].getComponent(Crash_Persian_puritan).init(crashStageVo.seconds);\r\n                // }\r\n                this.gameTypeStop1=false\r\n                this.gameTypeStop2=true\r\n                return;\r\n            }\r\n        }\r\n        else if(crashStageVo.gameType===2) {\r\n            this.gameTypeStop1=true\r\n            this._nodes['persiapan_putaran'].active=false\r\n            this._nodes['game_content'].active=true\r\n            if(this.gameTypeStop2){\r\n                this._nodes['game_content'].getComponent(Crash_Game_contentLayer).init()\r\n                this.gameTypeStop2=false\r\n            }\r\n        }\r\n        else if(crashStageVo.gameType===3) {\r\n            //this._nodes['persiapan_putaran'].active=false\r\n            this.gameTypeStop1=true\r\n        }\r\n        // 同步音效设置\r\n        this.timeAccumulator += deltaTime;\r\n        if (this.timeAccumulator >= 3) {\r\n            this.timeAccumulator = 0;\r\n            AudioManager.getInstance().updateTheMusicStatus()\r\n        }\r\n        WsManager.getInstance().update(deltaTime);\r\n    }\r\n    // 进入房间\r\n    sendChatRsp(bl, data, args){\r\n        if(bl){\r\n            let rea=data.data\r\n            let param={\r\n                gameType:1,seconds:rea.seconds\r\n            }\r\n            Crash_DataManager.getInstance().setCrashStageVo(param)\r\n            Crash_DataManager.getInstance().getUserInfo().setUserInfo(rea.myInfo)\r\n            Crash_DataManager.getInstance().getUserInfo().setOddsList(rea.oddsList)\r\n            Crash_DataManager.getInstance().getUserInfo().setRoomInfoVos(rea.roomInfoVos)\r\n            Crash_DataManager.getInstance().getUserInfo().setTableId(rea.roomId)\r\n            const node = this._nodes['recordList'] as Node;\r\n            if(node && node.components && node.components.length){\r\n                node.getComponent(Crash_RecordListLayer).init()\r\n            }\r\n\r\n            Crash_GameManager.getInstance().setIsLogin(true);\r\n        }\r\n    }\r\n    protected onDestroy() {\r\n        super.onDestroy();\r\n        Crash_NetMsgDispatcher.getInstance().removeAllProtocolByObj(this);\r\n    }\r\n}\r\n\r\n\r\n"]}