{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thorV2/components/ThorV2_Header.ts"],"names":["_decorator","Animation","director","Label","Node","BaseComponent","global","StepNumber","SoundPathDefine","thorv2_Audio","config","ccclass","property","ThorV2_Header","init","isShowMenu","canvasNode","propertyNode","props_btn_up_home","props_btn_up_addGold","props_btn_up_set","props_Moeny_Label","props_btn_up_menu","props_menu_panel","props_spr_menu_bg","props_btn_vip","props_btn_info","props_layout_glod","props","gold","events","quitGame","onOpenRule","start","initState","bindEvent","on","EventType","TOUCH_END","playOneShot","BUTTONCLICK","hideMenu","openPersonCenter","openShop","openVipMain","showMenu","e","preventSwallow","TOUCH_START","TOUCH_MOVE","TOUCH_CANCEL","useProps","key","value","console","log","JSON","stringify","node","isValid","string","goldFormat","cur","updateGold","Math","floor","formatAmountWithLetter","formatAmountWithCommas","diff","pre","done","undefined","stepNumber","num","setFlyNode","parent","set","normalRollOption","numberRollerTime","active","removeFromParent","addChild","an","getComponent","stop","play","scheduleOnce","bindUI","getScene","getChildByName","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Animation, director, EventTouch, find, Label, Node } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { global } from '../../../hall';\r\nimport { BuyType } from '../../../hall/components/Hall_ShopPanel';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { thorv2_Audio } from '../index';\r\nimport { updateRollerStatus } from '../store/actions/roller';\r\nimport { RollerStatus } from '../type';\r\nimport config from '../config';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgold: number,\r\n}\r\nexport interface IEvent {\r\n\tquitGame: () => void,\r\n\tonOpenRule: () => void,\r\n}\r\n\r\n@ccclass('ThorV2_Header')\r\nexport class ThorV2_Header extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate init = true;\r\n\r\n\tprivate isShowMenu = false;\r\n\r\n\tprivate canvasNode: Node;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_up_home: new Node(),\r\n\t\tprops_btn_up_addGold: new Node(),\r\n\t\t// props_beli: new Node(),\r\n\t\t// props_SPECIAL: new Node(),\r\n\t\tprops_btn_up_set: new Node(),\r\n\t\tprops_Moeny_Label: new Label(),\r\n\t\t// props_number2: new Node(),\r\n\t\tprops_btn_up_menu: new Node(),\r\n\t\tprops_menu_panel: new Node(),\r\n\t\tprops_spr_menu_bg: new Node(),\r\n\r\n\t\tprops_btn_vip: new Node(),\r\n\t\tprops_btn_info: new Node(),\r\n\t\tprops_layout_glod: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgold: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tquitGame: () => { },\r\n\t\tonOpenRule: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_up_home.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tthis.hideMenu();\r\n\t\t\tthis.events.quitGame();\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_up_set.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tglobal.openPersonCenter(2)\r\n\t\t\tthis.hideMenu();\r\n\t\t})\r\n\t\t// this.propertyNode.props_beli.on(Node.EventType.TOUCH_END, () => {\r\n\t\t// thorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t// \tglobal.openShop()\r\n\t\t// })\r\n\t\t// this.propertyNode.props_SPECIAL.on(Node.EventType.TOUCH_END, () => {\r\n\t\t// thorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t// \tglobal.openShop(BuyType.TAS)\r\n\t\t// })\r\n\t\tthis.propertyNode.props_btn_up_addGold.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tglobal.openShop()\r\n\t\t})\r\n\t\tthis.propertyNode.props_layout_glod.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tglobal.openShop()\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_vip.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tglobal.openVipMain();\r\n\t\t\tthis.hideMenu();\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_info.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tthis.events.onOpenRule();\r\n\t\t\tthis.hideMenu();\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_up_menu.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\tif (!this.isShowMenu) {\r\n\t\t\t\tthis.showMenu();\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.propertyNode.props_menu_panel.on(Node.EventType.TOUCH_END, (e: EventTouch) => {\r\n\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.BUTTONCLICK)\r\n\t\t\te.preventSwallow = true;\r\n\t\t\tthis.hideMenu();\r\n\t\t})\r\n\t\tthis.propertyNode.props_menu_panel.on(Node.EventType.TOUCH_START, (e: EventTouch) => {\r\n\t\t\te.preventSwallow = true;\r\n\t\t})\r\n\t\tthis.propertyNode.props_menu_panel.on(Node.EventType.TOUCH_MOVE, (e: EventTouch) => {\r\n\t\t\te.preventSwallow = true;\r\n\t\t})\r\n\t\tthis.propertyNode.props_menu_panel.on(Node.EventType.TOUCH_CANCEL, (e: EventTouch) => {\r\n\t\t\te.preventSwallow = true;\r\n\t\t})\r\n\t}\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tconsole.log(`useProps: ${key} ${JSON.stringify(value)}`);\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'gold') {\r\n\t\t\t\tif (this.init) {\r\n\t\t\t\t\tthis.propertyNode.props_Moeny_Label.string = this.goldFormat(value.cur);\r\n\t\t\t\t\tthis.init = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.updateGold(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate goldFormat(gold: number) {\r\n\t\tgold = Math.floor(gold);\r\n\t\treturn gold >= 1000000 ? gold.formatAmountWithLetter() : gold.formatAmountWithCommas();\r\n\t}\r\n\r\n\tprivate updateGold(value: { pre: any, cur: any }) {\r\n\t\tconst diff = value.cur - value.pre;\r\n\t\tlet done = undefined;\r\n\t\tif (diff > 0) {\r\n\t\t\t// done = () => {\r\n\t\t\t// \tthis.dispatch(updateRollerStatus(RollerStatus.END))\r\n\t\t\t// }\r\n\t\t}\r\n\r\n\t\tconst stepNumber = new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\tif (this.node && this.node.isValid) {\r\n\t\t\t\tthis.propertyNode.props_Moeny_Label.string = this.goldFormat(num);\r\n\t\t\t}\r\n\t\t}, done);\r\n\t\tif (diff !== 0) {\r\n\t\t\tstepNumber.setFlyNode(this.propertyNode.props_Moeny_Label.node.parent, this.propertyNode.props_Moeny_Label.node, 20)\r\n\t\t}\r\n\t\tstepNumber.set(config.normalRollOption.numberRollerTime).start();\r\n\t}\r\n\r\n\tprivate showMenu() {\r\n\t\tthis.isShowMenu = true;\r\n\t\tthis.propertyNode.props_menu_panel.active = true;\r\n\t\tthis.propertyNode.props_menu_panel.removeFromParent();\r\n\t\tthis.canvasNode.addChild(this.propertyNode.props_menu_panel)\r\n\t\tconst an = this.propertyNode.props_spr_menu_bg.getComponent(Animation);\r\n\t\tan.stop();\r\n\t\tan.play();\r\n\t}\r\n\r\n\tprivate hideMenu() {\r\n\t\tthis.propertyNode.props_menu_panel.active = false;\r\n\t\tthis.propertyNode.props_menu_panel.removeFromParent();\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.isShowMenu = false;\r\n\t\t}, 0.2)\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.canvasNode = director.getScene().getChildByName('Canvas');\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}