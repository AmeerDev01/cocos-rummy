{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/fish/Fish.ts"],"names":["Fish","Color","Graphics","Label","Node","Sprite","Vec3","instantiate","misc","tween","ActionCurve","ActionEffectPlayer","createAnimationNode","createParticleSystemNode","createSpriteNode","g_ByRandomSelectID","getAnimation","toNodeSpaceAR","sin","Math","cos","sqrt","pow","deg","degreesToRadians","pia","pi","PI","fishZOrder","isDrawBondingBox","isDrawCurve","useTestLabel","constructor","objID","fishID","curveID","isSkew","runSeconds","startPos","isReserve","angle","userInfo","sceneID","textureConfig","fishConfigs","bondingBoxConfig","curveConfig","actionConfig","commonConfig","sourceManage","parantNode","batteryManager","fishGoldManager","fishLabelFntManager","skillPlayer","musicEffectPlayer","scaleRatio","rootNode","skillConfig","objectID","runedSeconds","bbConfig","cvConfig","curveObject","curveDrawObj","currentAngle","fishLevel","fishScore","skewMod","isUseChangeBGM","aliveList","deathList","curRlineObjList","curLineObjList","goldEndPos","currentPos","uiRoot","fishConfig","draw","tesLabelObj","init","multiplyScalar","bbx_id","ratio","i","data","length","cveinfo","x1","x2","fparam","r","a","b","c","k","addCurve","setActionReserve","setActionRotation","setSiblingIndex","addChild","createFishItem","alive","death","drawFishCurve","addGraphics","insertChild","label","addComponent","setPosition","string","fontSize","deadEffEndCall","info","spos","number","end_pos","x","y","beishu","max_rate","play","forEach","v","destroy","clear","addOtherTime","dt","update","getBackgroundSceneManager","getSceneState","getCurrentSceneId","cut_scene_fish_vx","res","getPosAndAngleByTime","setFishPosAndAngle","skewFish","graphics","getComponent","key","circle","stroke","node","lineWidth","strokeColor","WHITE","isShotFish","cirLst","ranti","m","n","newA","newB","dist","getCurrentBBX","bbx","isPointInFish","pos","fishDead","showAliveSpr","showDeadSpr","parent","children","runDeadEff","fishOut","isOutofTime","isCurveEnd","fishStart","runStartEff","getObjectId","getDataId","id","setUserInfo","getUserInfo","getCurrentPosAndAngle","getCurrentAngle","setGoldMoveEndPos","setScoreVal","val","getScoreVal","getBeishu","getLockLevel","lock_level","getCurrentPos","addLineRelObj","obj","push","getLineRelObjLst","addCurrentLineObj","setFishLevel","level","getFishLevel","getFishConfigId","getFishSceneId","showFishEff","spr","color","window","setTimeout","isValid","setUseChangeBgm","buse","getParent","lst","busepit","len","view_inf","src_cfg","src_id","item","loop","act_id","stype","sspos","ani_key","file","pit_obj","bshow","active","tmpCurveObj","drawDt","epos","getPosAndSlopeByTime","moveTo","lineTo","getActionWay","filter","scale","getScale","setScale","srcConfig","mus_lst","skl_id_lst","tc","pobj","fntID","btObj","getBatteryByPlayerId","player_id","fnt","getDEfntConfig","isMyBattery","dead_act_id","delay","call","start"],"mappings":"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","sourcesContent":["import { Color, Graphics, Label, Node, Sprite, UITransform, Vec3, instantiate, misc, tween } from \"cc\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport { ActionCurve } from \"./ActionCurve\";\r\nimport { ActionEffectPlayer } from \"./ActionEffectPlayer\";\r\nimport { createAnimationNode, createParticleSystemNode, createSpriteNode, g_ByRandomSelectID, getAnimation, toNodeSpaceAR } from \"./FishTool\";\r\nimport { BatteryManager } from \"./BatteryManager\";\r\nimport { Battery } from \"./Battery\";\r\nimport { FishGoldManager } from \"./FishGoldManager\";\r\nimport { FishLabelFntManager } from \"./FishLabelFntManager\";\r\nimport { SkillPlayer } from \"./SkillPlayer\";\r\nimport { SkillItemLine } from \"./utils/skills/SkillItemLine\";\r\nimport { MusicEffectPlayer } from \"./MusicEffectPlayer\";\r\nimport { CURVE_TYPE } from \"./CalculteRule\";\r\n\r\nconst sin = Math.sin\r\nconst cos = Math.cos\r\nconst sqrt = Math.sqrt\r\nconst pow = Math.pow\r\nconst deg = misc.degreesToRadians\r\n\r\nconst pia = 180\r\nconst pi = Math.PI\r\n\r\ntype FishItem = {\r\n  loop: number,\r\n  act_id: number,\r\n  src_id: number,\r\n  stype: number,\r\n  sspos: any,\r\n  ani_key: string,\r\n  spr: Node\r\n}\r\n\r\nconst fishZOrder = 20000;\r\n/**是否绘制出包围盒 */\r\nconst isDrawBondingBox = false;\r\n/**是否绘制路径 */\r\nconst isDrawCurve = false;\r\n/**测试坐标 */\r\nconst useTestLabel = false;\r\n\r\nexport class Fish {\r\n\r\n  private commonConfig;\r\n  private actionConfig;\r\n  private skillConfig;\r\n\r\n  private objectID;\r\n  private isSkew;\r\n  private runedSeconds: number;\r\n  private userInfo;\r\n  private sceneID;\r\n  private bbConfig;\r\n  private cvConfig;\r\n  private curveObject: ActionCurve;\r\n  private curveDrawObj: Node;\r\n  private currentAngle;\r\n  private fishLevel;\r\n  private fishScore;\r\n  private skewMod;\r\n  private isUseChangeBGM;\r\n  public aliveList: FishItem[];\r\n  private deathList: FishItem[];\r\n  private curRlineObjList;\r\n  private curLineObjList: SkillItemLine[];\r\n  private goldEndPos: Vec3;\r\n  private currentPos: Vec3;\r\n  public uiRoot: Node;\r\n  private textureConfig = [];\r\n  private fishConfigs;\r\n  private fishConfig;\r\n  private bondingBoxConfig = [];\r\n  private curveConfig = [];\r\n  private parantNode: Node;\r\n  /**包围盒节点 */\r\n  private draw: Node;\r\n  /**label坐标节点 */\r\n  private tesLabelObj: Node;\r\n  private sourceManage: SourceManage;\r\n  private batteryManager: BatteryManager\r\n  private fishGoldManager: FishGoldManager;\r\n  private fishLabelFntManager: FishLabelFntManager;\r\n  private skillPlayer: SkillPlayer;\r\n  private musicEffectPlayer: MusicEffectPlayer;\r\n  /**缩放比例 */\r\n  private scaleRatio: number = 1;\r\n  private rootNode: Node;\r\n\r\n  constructor(objID, fishID, curveID, isSkew, runSeconds, startPos: Vec3, isReserve, angle, userInfo, sceneID, textureConfig,\r\n    fishConfigs, bondingBoxConfig, curveConfig, actionConfig, commonConfig, sourceManage: SourceManage, parantNode: Node, batteryManager: BatteryManager,\r\n    fishGoldManager: FishGoldManager, fishLabelFntManager: FishLabelFntManager, skillPlayer: SkillPlayer, musicEffectPlayer: MusicEffectPlayer,\r\n    scaleRatio: number, rootNode: Node) {\r\n    this.textureConfig = textureConfig;\r\n    this.fishConfigs = fishConfigs;\r\n    this.bondingBoxConfig = bondingBoxConfig;\r\n    this.curveConfig = curveConfig;\r\n    this.sourceManage = sourceManage;\r\n    this.parantNode = parantNode;\r\n    this.actionConfig = actionConfig;\r\n    this.commonConfig = commonConfig;\r\n    this.batteryManager = batteryManager;\r\n    this.fishGoldManager = fishGoldManager;\r\n    this.fishLabelFntManager = fishLabelFntManager;\r\n    this.skillPlayer = skillPlayer;\r\n    this.musicEffectPlayer = musicEffectPlayer;\r\n    this.scaleRatio = scaleRatio;\r\n    this.rootNode = rootNode;\r\n    this.init(objID, fishID, curveID, isSkew, runSeconds, startPos, isReserve, angle, userInfo, sceneID)\r\n  }\r\n\r\n  private init(objID, fishID, curveID, isSkew, runSeconds, startPos: Vec3, isReserve, angle, userInfo, sceneID) {\r\n    startPos = startPos.multiplyScalar(this.scaleRatio);\r\n    this.objectID = objID\r\n    this.isSkew = isSkew\r\n    this.runedSeconds = runSeconds //鱼运动时间\r\n    this.userInfo = userInfo //用户数据\r\n    this.sceneID = sceneID //场景ID\r\n    this.fishConfig = this.fishConfigs[fishID]\r\n    this.bbConfig = this.bondingBoxConfig[this.fishConfig.bbx_id]\r\n    this.cvConfig = this.curveConfig[curveID]\r\n\r\n    //print(\"birth fish ========== \"  +  this.fishConfig.desc  +  \" id =========== \"  +  this.fishConfig.id)\r\n\r\n    // 创建路径计算对象\r\n    this.curveObject = new ActionCurve(startPos, this.cvConfig.ratio)\r\n    for (let i = 0; i < this.cvConfig.data.length; i++) {\r\n      const cveinfo = instantiate(this.cvConfig.data[i])\r\n      // if (cveinfo.type !== CURVE_TYPE.pbl && cveinfo.type !== CURVE_TYPE.ccve) {\r\n      cveinfo.x1 *= this.scaleRatio;\r\n      cveinfo.x2 *= this.scaleRatio;\r\n      // }\r\n      cveinfo.fparam.r *= this.scaleRatio;\r\n      cveinfo.fparam.a *= this.scaleRatio;\r\n      cveinfo.fparam.b *= this.scaleRatio;\r\n      cveinfo.fparam.c *= this.scaleRatio;\r\n      cveinfo.fparam.k *= this.scaleRatio;\r\n      this.curveObject.addCurve(cveinfo)\r\n    }\r\n    this.curveObject.setActionReserve(isReserve)\r\n    angle = angle > 0 ? angle : this.cvConfig.angle;\r\n    this.curveObject.setActionRotation(angle)\r\n\r\n    // member\r\n    this.currentAngle = 0 //当前偏转角度\r\n    this.fishLevel = 0 //鱼等级\r\n    this.fishScore = 0 //鱼分数\r\n    this.skewMod = 1 //翻转值\r\n    this.isUseChangeBGM = false //是否改变背景音\r\n    this.aliveList = [] //出生特效列表\r\n    this.deathList = [] //死亡特效列表\r\n    this.curRlineObjList = [] //当前关联鱼对象列表\r\n    this.curLineObjList = [] //连接线对象\r\n    this.goldEndPos = new Vec3() //金币飞往的最后位置\r\n    this.currentPos = new Vec3() //当前运动到的点\r\n\r\n    // ui\r\n    this.uiRoot = new Node();\r\n    this.uiRoot.setSiblingIndex(fishZOrder)\r\n    this.parantNode.addChild(this.uiRoot)\r\n    this.createFishItem(this.fishConfig.alive, this.aliveList, true)\r\n    this.createFishItem(this.fishConfig.death, this.deathList, false)\r\n    // this.showAliveSpr(false)\r\n    // this.showDeadSpr(false)\r\n\r\n    if (isDrawCurve) {\r\n      this.drawFishCurve(startPos)\r\n    }\r\n\r\n    if (isDrawBondingBox) {\r\n      this.draw = new Node();\r\n      this.addGraphics(this.draw);\r\n      this.uiRoot.insertChild(this.draw, 1000)\r\n    }\r\n\r\n    if (useTestLabel) {\r\n      this.tesLabelObj = new Node();\r\n      const label = this.tesLabelObj.addComponent(Label);\r\n      this.tesLabelObj.setPosition(0, 0)\r\n      this.uiRoot.addChild(this.tesLabelObj)\r\n      label.string = \"test\";\r\n      label.fontSize = 40;\r\n    }\r\n  }\r\n\r\n  public deadEffEndCall() {\r\n    let info = {\r\n      spos: this.currentPos,\r\n      angle: this.currentAngle,\r\n      number: this.fishScore,\r\n      end_pos: new Vec3(this.goldEndPos.x, this.goldEndPos.y),\r\n      beishu: this.fishConfig.max_rate,\r\n    }\r\n    this.fishGoldManager.play(info)\r\n\r\n    this.curLineObjList.forEach(v => v.destroy())\r\n\r\n    if (isDrawCurve) {\r\n      this.curveDrawObj.destroy()\r\n    }\r\n    this.uiRoot.destroy();\r\n    this.clear();\r\n  }\r\n\r\n  private clear() {\r\n    this.textureConfig = null;\r\n    this.fishConfigs = null;\r\n    this.bondingBoxConfig = null;\r\n    this.curveConfig = null;\r\n    this.sourceManage = null;\r\n    this.parantNode = null;\r\n    this.actionConfig = null;\r\n    this.batteryManager = null;\r\n    this.fishGoldManager = null;\r\n    this.fishLabelFntManager = null;\r\n    this.skillPlayer = null;\r\n    this.musicEffectPlayer = null;\r\n  }\r\n\r\n  public addOtherTime(dt) {\r\n    this.runedSeconds = this.runedSeconds + dt\r\n  }\r\n\r\n  public update(dt) {\r\n    if (this.batteryManager.getBackgroundSceneManager().getSceneState() === 2\r\n      && this.sceneID !== this.batteryManager.getBackgroundSceneManager().getCurrentSceneId() && this.sceneID !== -1) {\r\n      dt = dt * this.commonConfig.cut_scene_fish_vx\r\n    }\r\n\r\n    this.runedSeconds = this.runedSeconds + dt\r\n    const res = this.curveObject.getPosAndAngleByTime(this.runedSeconds);\r\n    this.currentPos = res[0]\r\n    this.currentAngle = res[1];\r\n    this.setFishPosAndAngle()\r\n    this.skewFish()\r\n\r\n    if (isDrawBondingBox) {\r\n      const graphics = this.draw.getComponent(Graphics);\r\n      graphics.clear();\r\n      for (const key in this.bbConfig.data) {\r\n        const v = this.bbConfig.data[key];\r\n        if (!v) continue;\r\n        graphics.circle(v.a, v.b, v.r);\r\n        graphics.stroke();\r\n\r\n        // graphics.circle(v.a, v.b, 5);\r\n        // graphics.stroke();\r\n      }\r\n\r\n      // graphics.circle(0, 0, 5);\r\n      // graphics.stroke();\r\n    }\r\n  }\r\n\r\n  private addGraphics(node: Node) {\r\n    let graphics = node.getComponent(Graphics);\r\n    if (!graphics) {\r\n      graphics = node.addComponent(Graphics);\r\n    }\r\n    // 设置线条宽度和颜色\r\n    graphics.lineWidth = 2;\r\n    graphics.strokeColor = Color.WHITE;\r\n    return graphics\r\n  }\r\n\r\n  public isShotFish(cirLst) {\r\n    // let ranti = (this.currentAngle / pia) * pi\r\n    // 这里 360 - this.currentAngle，是在碰撞检测的时候有时候距离有点远\r\n    let ranti = deg(360 - this.currentAngle);\r\n    if (this.currentPos) {\r\n      for (let i = 0; i < cirLst.length; i++) {\r\n        const v = cirLst[i];\r\n        for (const m in this.bbConfig.data) {\r\n          const n = this.bbConfig.data[m];\r\n          let newA = (n.a * cos(ranti) + this.skewMod * n.b * sin(ranti)) * this.scaleRatio\r\n          let newB = (this.skewMod * n.b * cos(ranti) - n.a * sin(ranti)) * this.scaleRatio\r\n          let dist = sqrt(pow(newA + this.currentPos.x - v.a, 2) + pow(newB + this.currentPos.y - v.b, 2))\r\n          if (v.r + n.r > dist) {\r\n            return true\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  public getCurrentBBX() {\r\n    let bbx = instantiate(this.bbConfig.data)\r\n    // let ranti = (this.currentAngle / pia) * pi\r\n    // 这里 360 - this.currentAngle，是在碰撞检测的时候有时候距离有点远\r\n    let ranti = deg(360 - this.currentAngle);\r\n\r\n    for (const k in this.bbConfig.data) {\r\n      const v = this.bbConfig.data[k];\r\n      bbx[k].a = (v.a * cos(ranti) + this.skewMod * v.b * sin(ranti)) * this.scaleRatio + this.currentPos.x\r\n      bbx[k].b = (this.skewMod * v.b * cos(ranti) - v.a * sin(ranti)) * this.scaleRatio + this.currentPos.y\r\n      // 把鱼的包围盒坐标转换为世界坐标\r\n      // const world = this.convertToWorldSpaceAR(new Vec3(bbx[k].a, bbx[k].b))\r\n      // bbx[k].a = world.x\r\n      // bbx[k].b = world.y\r\n    }\r\n    // console.log(' currentPos : ', this.currentPos, ' currentAngle : ', this.currentAngle, \" bbx : \", JSON.stringify(bbx));\r\n    return bbx\r\n  }\r\n\r\n  public isPointInFish(pos) {\r\n    if (this.currentPos) {\r\n      // let ranti = (this.currentAngle / pia) * pi\r\n      // 这里 360 - this.currentAngle，是在碰撞检测的时候有时候距离有点远\r\n      let ranti = deg(360 - this.currentAngle);\r\n      for (const m in this.bbConfig.data) {\r\n        const n = this.bbConfig.data[m];\r\n        let newA = (n.a * cos(ranti) + this.skewMod * n.b * sin(ranti)) * this.scaleRatio\r\n        let newB = (this.skewMod * n.b * cos(ranti) - n.a * sin(ranti)) * this.scaleRatio\r\n        let dist = sqrt(pow(newA + this.currentPos.x - pos.x, 2) + pow(newB + this.currentPos.y - pos.y, 2))\r\n        if (n.r > dist) {\r\n          return true\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public fishDead() {\r\n    this.showAliveSpr(false)\r\n    this.showDeadSpr(true)\r\n    this.uiRoot.setSiblingIndex(this.uiRoot.parent.children.length);\r\n    this.runDeadEff()\r\n  }\r\n\r\n  public fishOut() {\r\n    if (isDrawCurve) {\r\n      this.curveDrawObj.destroy()\r\n    }\r\n    if (this.isUseChangeBGM) {\r\n      // BackgroundSceneManager.resumeBkMus()\r\n    }\r\n    this.uiRoot.destroy()\r\n  }\r\n\r\n  public isOutofTime() {\r\n    return this.curveObject.isCurveEnd()\r\n  }\r\n\r\n  public fishStart() {\r\n    this.showAliveSpr(true)\r\n    this.showDeadSpr(false)\r\n    this.runStartEff()\r\n\r\n\r\n    const res = this.curveObject.getPosAndAngleByTime(0.00001);\r\n    this.currentPos = res[0]\r\n    this.currentAngle = res[1];\r\n    this.setFishPosAndAngle()\r\n  }\r\n\r\n  public getObjectId() {\r\n    return this.objectID\r\n  }\r\n\r\n  public getDataId() {\r\n    return this.fishConfig.id\r\n  }\r\n\r\n  public setUserInfo(info) {\r\n    this.userInfo = info\r\n  }\r\n\r\n  public getUserInfo() {\r\n    return this.userInfo\r\n  }\r\n\r\n  public getCurrentPosAndAngle() {\r\n    return [this.currentPos, this.currentAngle]\r\n  }\r\n\r\n  public getCurrentAngle() {\r\n    return this.currentAngle\r\n  }\r\n\r\n  public setGoldMoveEndPos(pos) {\r\n    this.goldEndPos = pos\r\n  }\r\n\r\n  public setScoreVal(val) {\r\n    this.fishScore = val\r\n  }\r\n\r\n  public getScoreVal() {\r\n    return this.fishScore\r\n  }\r\n\r\n  public getBeishu() {\r\n    return this.fishConfig.max_rate\r\n  }\r\n\r\n  public getLockLevel() {\r\n    return this.fishConfig.lock_level\r\n  }\r\n\r\n  public getCurrentPos() {\r\n    return this.currentPos\r\n  }\r\n\r\n  public addLineRelObj(obj) {\r\n    this.curRlineObjList.push(obj)\r\n  }\r\n\r\n  public getLineRelObjLst() {\r\n    return this.curRlineObjList\r\n  }\r\n\r\n  public addCurrentLineObj(obj) {\r\n    this.curLineObjList.push(obj)\r\n  }\r\n\r\n  public setFishLevel(level) {\r\n    this.fishLevel = level\r\n  }\r\n\r\n  public getFishLevel() {\r\n    return this.fishLevel\r\n  }\r\n\r\n  public getFishConfigId() {\r\n    return this.fishConfig.id\r\n  }\r\n\r\n  public getFishSceneId() {\r\n    return this.sceneID\r\n  }\r\n\r\n  public showFishEff() {\r\n    for (let k = 0; k < this.aliveList.length; k++) {\r\n      const v = this.aliveList[k];\r\n      v.spr.getComponent(Sprite).color = new Color(255, 0, 0);\r\n      window.setTimeout(() => {\r\n        v.spr.isValid && (v.spr.getComponent(Sprite).color = new Color(255, 255, 255));\r\n      }, 100)\r\n    }\r\n  }\r\n\r\n  public setUseChangeBgm(buse) {\r\n    this.isUseChangeBGM = buse\r\n  }\r\n\r\n  public getParent() {\r\n    return this.uiRoot.getParent()\r\n  }\r\n\r\n  private createFishItem(data, lst, busepit) {\r\n    let len = data.view_inf.length - 1\r\n    for (let i = 0; i <= len; i++) {\r\n      let src_cfg = this.textureConfig[data.view_inf[i].src_id]\r\n      if (!src_cfg) {\r\n        debugger\r\n      }\r\n      let item: FishItem = {\r\n        loop: data.view_inf[i].loop,\r\n        act_id: data.view_inf[i].act_id,\r\n        src_id: data.view_inf[i].src_id,\r\n        stype: src_cfg.stype,\r\n        sspos: data.view_inf[i].pos,\r\n        ani_key: src_cfg.key,\r\n        spr: new Node()\r\n      }\r\n\r\n      if (src_cfg.stype === 1) { //序列帧\r\n        item.spr = createAnimationNode(this.sourceManage, this.uiRoot, src_cfg, false, item.loop === -1)\r\n        item.spr.setPosition(data.view_inf[i].pos.x, data.view_inf[i].pos.y)\r\n      } else if (src_cfg.stype === 2) {//图片\r\n        item.spr = createSpriteNode(this.sourceManage, this.uiRoot, src_cfg.file);\r\n        item.spr.setPosition(data.view_inf[i].pos.x, data.view_inf[i].pos.y)\r\n      } else if (src_cfg.stype === 3) {//粒子\r\n        if (busepit) {\r\n          let pit_obj = createParticleSystemNode(this.sourceManage, this.uiRoot, src_cfg);\r\n          pit_obj.setPosition(data.view_inf[i].pos.x, data.view_inf[i].pos.y)\r\n        }\r\n      }\r\n      lst.push(item)\r\n    }\r\n  }\r\n\r\n  private showAliveSpr(bshow) {\r\n    this.aliveList.forEach(v => v && v.spr && (v.spr.active = bshow));\r\n  }\r\n  private showDeadSpr(bshow) {\r\n    this.deathList.forEach(v => v && v.spr && (v.spr.active = bshow));\r\n  }\r\n\r\n  private drawFishCurve(startPos) {\r\n    let tmpCurveObj = instantiate(this.curveObject)\r\n    this.curveDrawObj = new Node();\r\n    const graphics = this.addGraphics(this.curveDrawObj)\r\n    this.parantNode.insertChild(this.curveDrawObj, 100000000)\r\n\r\n    // let spos = instantiate(startPos);\r\n    let spos = toNodeSpaceAR(this.rootNode, startPos);\r\n    let drawDt = 0\r\n    while (!tmpCurveObj.isCurveEnd()) {\r\n      let epos = tmpCurveObj.getPosAndSlopeByTime(drawDt)[0]\r\n      // console.log(epos.x, epos.y);\r\n      epos = toNodeSpaceAR(this.rootNode, epos);\r\n      graphics.moveTo(spos.x, spos.y);\r\n      graphics.lineTo(epos.x, epos.y);\r\n      graphics.stroke();\r\n      // spos = instantiate(epos)\r\n      spos = instantiate(epos)\r\n      drawDt = drawDt + 0.1\r\n    }\r\n  }\r\n  private setFishPosAndAngle() {\r\n    if (useTestLabel) {\r\n      this.tesLabelObj.getComponent(Label).string = `${this.currentPos.x}, ${this.currentPos.y}`\r\n    }\r\n\r\n    // this.uiRoot.setWorldPosition(new Vec3(this.currentPos.x, this.currentPos.y))\r\n    this.uiRoot.setPosition(toNodeSpaceAR(this.rootNode, new Vec3(this.currentPos.x, this.currentPos.y)))\r\n    this.uiRoot.angle = this.currentAngle;\r\n\r\n    // console.log(this.currentPos.x, this.currentPos.y,  this.uiRoot.position.x, this.uiRoot.position.y);\r\n  }\r\n\r\n  private skewFish() {\r\n\r\n    if (this.isSkew === true && this.curveObject.getActionWay() === 1) {\r\n      this.aliveList.filter(v => v && v.spr && v.stype === 1).forEach(v => {\r\n        const scale = v.spr.getScale();\r\n        v.spr.setScale(scale.x, scale.y > 0 ? -scale.y : scale.y)\r\n      })\r\n      this.draw && this.draw.setScale(1, -1)\r\n      // v.spr.setRotationSkewX(180)\r\n      this.skewMod = -1\r\n    } else if (this.isSkew === false && this.curveObject.getActionWay() === -1) {\r\n      this.aliveList.filter(v => v && v.spr && v.stype === 1).forEach(v => {\r\n        const scale = v.spr.getScale();\r\n        v.spr.setScale(scale.x, scale.y > 0 ? -scale.y : scale.y)\r\n      })\r\n      this.draw && this.draw.setScale(1, -1)\r\n      // v.spr.setRotationSkewX(180)\r\n      this.skewMod = -1\r\n    }\r\n  }\r\n\r\n  public runStartEff() {\r\n    for (let k = 0; k < this.aliveList.length; k++) {\r\n      const v = this.aliveList[k];\r\n      if (v.stype === 1) {\r\n        getAnimation(v.spr).play();\r\n      } else if (v.stype === 2) {\r\n        //todo\r\n      } else if (v.stype === 3) {\r\n        //todo\r\n        let srcConfig = this.textureConfig[v.src_id]\r\n        let pit_obj = createParticleSystemNode(this.sourceManage, this.uiRoot, srcConfig);\r\n        pit_obj.setPosition(v.sspos.x, v.sspos.y)\r\n\r\n        // let piObj = createParticleSystemNode(this.sourceManage, this.uiRoot, srcConfig);\r\n        // piObj.setPosition(v.sspos.x, v.sspos.y)\r\n      }\r\n\r\n      if (v.spr) {\r\n        ActionEffectPlayer.play(v.spr, () => {\r\n\r\n        }, this.actionConfig[v.act_id])\r\n      }\r\n    }\r\n\r\n    this.musicEffectPlayer.play(g_ByRandomSelectID(this.fishConfig.alive.mus_lst))\r\n    for (let i = 0; i <= this.fishConfig.alive.skl_id_lst.length; i++) {\r\n      this.skillPlayer.play(this, this.fishConfig.alive.skl_id_lst[i])\r\n    }\r\n  }\r\n  public runDeadEff() {\r\n    this.deathList.forEach(v => {\r\n      if (v.stype === 1) {\r\n        getAnimation(v.spr).play();\r\n      } else if (v.stype === 2) {\r\n        //todo\r\n      } else if (v.stype === 3) {\r\n        //todo\r\n        let tc = this.textureConfig[v.src_id]\r\n        let pobj = createParticleSystemNode(this.sourceManage, this.uiRoot, tc);\r\n        pobj.setPosition(v.sspos.x, v.sspos.y)\r\n      }\r\n\r\n      ActionEffectPlayer.play(v.spr, null, this.actionConfig[v.act_id], this)\r\n    })\r\n\r\n    let fntID = 1\r\n    let btObj: Battery = this.batteryManager.getBatteryByPlayerId(this.userInfo.player_id)\r\n    if (btObj) {\r\n      let fnt = btObj.getDEfntConfig()\r\n      if (fnt) {\r\n        fntID = btObj.isMyBattery() === true ? fnt[0] : fnt[1];\r\n      }\r\n    }\r\n\r\n    this.fishLabelFntManager.play(this.currentPos, this.fishScore, fntID, this.fishConfig.max_rate)\r\n    this.musicEffectPlayer.play(g_ByRandomSelectID(this.fishConfig.death.mus_lst))\r\n    for (let i = 0; i < this.fishConfig.death.skl_id_lst.length; i++) {\r\n      this.skillPlayer.play(this, this.fishConfig.death.skl_id_lst[i])\r\n    }\r\n\r\n    if (this.fishConfig.death.dead_act_id) {\r\n      ActionEffectPlayer.play(this.uiRoot, () => {\r\n        this.deadEffEndCall()\r\n      }, this.actionConfig[this.fishConfig.death.dead_act_id], null)\r\n    } else {\r\n      tween(this.uiRoot).delay(0.2).call(() => {\r\n        this.uiRoot.isValid && this.deadEffEndCall();\r\n      }).start();\r\n    }\r\n  }\r\n}\r\n\r\n"]}