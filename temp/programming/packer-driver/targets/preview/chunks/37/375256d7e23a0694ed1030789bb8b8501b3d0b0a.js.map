{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/common/components/Common_HotUpdate.ts"],"names":["_decorator","Asset","Component","director","game","Label","native","Node","ProgressBar","screen","sys","Hot","HotOptions","App","GameConfig","config","initConfig","lang","NATIVE","BridgeCode","getAppVersionName","getPackageName","hideNativeSplash","installApk","getRedirectUrl","LanguageItemType","ApiUrl","ccclass","property","Common_HotUpdate","displayName","type","versionInfo","local","server","start","window","onLoad","isMobile","requestFullScreen","use","isDev","ZH","IDA","bridge","onNative","arg0","arg1","APP_VERSION","appLocalVersion","initGame","then","_config","hotUpdateUrl","handleManifestFile","getPackageInfo","content","abState","loadScene","isApkUpdate","appOnlineVersion","initConfirm","write","k","UpdateModule","version","placeStr","upgradeDesc","openURL","shareUrl","forceUpgrade","end","init","catch","e","InitGameModule","GameBoardInitAndGotoUrl","restart","update","deltaTime","enterGame","updateProgress","progress","setTimeout","Instance","okFn","cancle","updateConfirm","active","getChildByName","getComponent","string","once","EventType","TOUCH_END","hotInstance","logLabel","options","OnVersionInfo","data","versionLabel","VersionLabel","localVersion","serverVersion","storagePath","fileUtils","getWritablePath","removeDirectory","console","log","OnUpdateProgress","event","bytes","getDownloadedBytes","getTotalBytes","files","getDownloadedFiles","getTotalFiles","file","getPercentByFile","toFixed","byte","getPercent","msg","getMessage","parseFloat","tipsLabel","UpdateProgress","time","OnNeedToUpdate","hotUpdate","OnNoNeedToUpdate","DetectCompleted","DetectComplete","OnUpdateSucceed","OnUpdateFailed","UpdateFail","RestartProgram","isNative","isCheckHotUpdate","ClientCheck","CheckUpdatedPkg","manifest","checkUpdate","newRemotUr","updateManifestFile","fileName","fileExist","isFileExist","filestring_version","getStringFromFile","obj","JSON","parse","packageUrl","remoteManifestUrl","remoteVersionUrl","afterVersionString","stringify","res","writeStringToFile","downloadApkHandle","appDumpUrl","filePath","downloader","Downloader","onError","task","errorCode","errorCodeInternal","errorStr","onProgress","bytesReceived","totalBytesReceived","totalBytesExpected","bKReceived","totalReceived","strProgress","onSuccess","url","createDownloadTask","Promise","reslove","reject","packageName","undefined","httpBaseUrl","CHANNEL_PACKAGE","fetch","response","status","text"],"mappings":"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","sourcesContent":["import { _decorator, Asset, assetManager, Component, director, dynamicAtlasManager, game, Label, log, macro, native, Node, ProgressBar, screen, sys, view } from 'cc';\r\nimport Hot, { HotOptions } from '../../utils/HotUpdate';\r\nimport App from '../../App';\r\nimport { GameConfig } from '../../config/GameConfig';\r\nimport { config, initConfig } from '../../hall/config';\r\nimport { fetcher, lang } from '../../hall';\r\nimport { NATIVE } from 'cc/env';\r\nimport { BridgeCode, nativeDownloadApk, getAppVersionName, getPackageName, hideNativeSplash, installApk, getRedirectUrl } from '../bridge';\r\nimport { LanguageItemType } from '../../language/languagePkg';\r\nimport { ApiUrl } from '../../hall/apiUrl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// macro.CLEANUP_IMAGE_CACHE = false;\r\n// dynamicAtlasManager.enabled = true;\r\n@ccclass('Common_HotUpdate')\r\nexport class Common_HotUpdate extends Component {\r\n\t@property(ProgressBar)\r\n\tupdateProgress: ProgressBar = null\r\n\r\n\t@property({ displayName: 'project.manifest', type: Asset })\r\n\tmanifest: Asset = null;\r\n\r\n\t@property(Label)\r\n\tversionLabel: Label = null\r\n\r\n\t@property(Label)\r\n\ttipsLabel: Label = null\r\n\r\n\t@property(Label)\r\n\tlogLabel: Label = null\r\n\r\n\t@property(Node)\r\n\tupdateConfirm: Node = null\r\n\r\n\t@property(Label)\r\n\tupdateContent: Label = null\r\n\tprivate versionInfo = {\r\n\t\tlocal: \"\",\r\n\t\tserver: \"\"\r\n\t}\r\n\tstart() {\r\n\t\twindow['pageDone'] && window['pageDone']()\r\n\t}\r\n\tprotected onLoad(): void {\r\n\t\t!NATIVE && sys.isMobile &&  screen.requestFullScreen();\r\n\t\t// console.log('getPackageName ====', getPackageName())\r\n\t\tlang.use(GameConfig.isDev ? LanguageItemType.ZH : LanguageItemType.IDA)\r\n\t\tif (NATIVE) {\r\n\t\t\thideNativeSplash();\r\n\t\t\tnative.bridge.onNative = (arg0: string, arg1: string) => {\r\n\t\t\t\tif (BridgeCode.APP_VERSION === arg0) {\r\n\t\t\t\t\tGameConfig.appLocalVersion = arg1\r\n\t\t\t\t\tthis.initGame()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tgetAppVersionName()\r\n\t\t} else {\r\n\t\t\tthis.initGame()\r\n\t\t}\r\n\t}\r\n\r\n\tinitGame() {\r\n\t\tinitConfig().then((_config) => {\r\n\t\t\t/**修改热更地址 */\r\n\t\t\t_config.hotUpdateUrl && this.handleManifestFile(_config.hotUpdateUrl)\r\n\r\n\t\t\tthis.getPackageInfo().then((content) => {\r\n\t\t\t\t//有限判断AB面开启状态\r\n\t\t\t\tif (content && content.abState) {\r\n\t\t\t\t\tdirector.loadScene(\"game\")\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet isApkUpdate = NATIVE;\r\n\t\t\t\t\t// 要 isApkUpdate 为false，才表示设置了该值，返回一个undefined也要更新包\r\n\t\t\t\t\tif (NATIVE && content && content.isApkUpdate === false) {\r\n\t\t\t\t\t\tisApkUpdate = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isApkUpdate && GameConfig.appLocalVersion < config.appOnlineVersion) {\r\n\t\t\t\t\t\t//弹出更新提示\r\n\t\t\t\t\t\tthis.initConfirm([lang.write(k => k.UpdateModule.GameConfig, { version: config.appOnlineVersion },\r\n\t\t\t\t\t\t\t{ placeStr: `请更新App至最新版(${config.appOnlineVersion})` }), config.upgradeDesc], () => {\r\n\t\t\t\t\t\t\t\tsys.openURL(`${config.shareUrl}?pkgId=${getPackageName()}&version=${config.appOnlineVersion}`)\r\n\t\t\t\t\t\t\t\t// window.setTimeout(() => {\r\n\t\t\t\t\t\t\t\t// \tnative.bridge.onNative = (arg0: string, arg1: string) => {\r\n\t\t\t\t\t\t\t\t// \t\tif (BridgeCode.DOWNLOAD_APK === arg0) {\r\n\t\t\t\t\t\t\t\t// \t\t\tif ('failed' === arg1) {\r\n\t\t\t\t\t\t\t\t// \t\t\t\tthis.initConfirm([lang.write(k => k.UpdateModule.RestartProgram), config.upgradeDesc], () => {\r\n\t\t\t\t\t\t\t\t// \t\t\t\t\tthis.downloadApkHandle(`${config.appDumpUrl}?ap=${getPackageName()}&version=${config.appOnlineVersion}`, config.appOnlineVersion)\r\n\t\t\t\t\t\t\t\t// \t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t\t// \t\t\t\t\tgame.end()\r\n\t\t\t\t\t\t\t\t// \t\t\t\t})\r\n\t\t\t\t\t\t\t\t// \t\t\t}\r\n\t\t\t\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t\t\t\t// \t}\r\n\r\n\t\t\t\t\t\t\t\t// \tthis.downloadApkHandle(config.appDumpUrl, config.appOnlineVersion)\r\n\t\t\t\t\t\t\t\t// }, 10)\r\n\t\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t\tif (config.forceUpgrade) {\r\n\t\t\t\t\t\t\t\t\tgame.end()\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.init()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.init()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}).catch((e) => {\r\n\t\t\tif (e === 'config_error') {\r\n\t\t\t\tthis.initConfirm([lang.write(k => k.InitGameModule.GameBoardInitAndGotoUrl)], () => {\r\n\t\t\t\t\tgame.restart()\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tsys.openURL('https://hugewin777d.com/')\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tupdate(deltaTime: number) { }\r\n\r\n\tprivate enterGame() {\r\n\t\tthis.updateProgress.progress = 1\r\n\t\twindow.setTimeout(() => {\r\n\t\t\tApp.Instance().start()\r\n\t\t\t// effect1(this.node).out().then(() => {\r\n\t\t\t// \tApp.Instance().start()\r\n\t\t\t// })\r\n\t\t}, 500)\r\n\t}\r\n\r\n\tprivate initConfirm(content: string[], okFn: () => any, cancle?: () => any) {\r\n\t\tthis.updateConfirm.active = true\r\n\t\tthis.updateConfirm.getChildByName(\"Label_updata_tips\").getComponent(Label).string = content[0]\r\n\t\tcontent[1] && (this.updateConfirm.getChildByName(\"Label_updata_content\").getComponent(Label).string = content[1])\r\n\t\tthis.updateConfirm.getChildByName(\"btn_updata_ok\").once(Node.EventType.TOUCH_END, () => {\r\n\t\t\tif (!okFn()) {\r\n\t\t\t\tthis.updateConfirm.active = false\r\n\t\t\t}\r\n\t\t})\r\n\t\tthis.updateConfirm.getChildByName(\"btn_updata_cancel\").once(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.updateConfirm.active = false\r\n\t\t\tif (!cancle) {\r\n\t\t\t\tthis.updateConfirm.active = false\r\n\t\t\t} else if (cancle && !cancle()) {\r\n\t\t\t\tthis.updateConfirm.active = false\r\n\t\t\t}\r\n\t\t\t// game.end()\r\n\t\t})\r\n\t}\r\n\r\n\tprivate init() {\r\n\t\tconst hotInstance = new Hot(this.logLabel)\r\n\t\t// this.loadingLab.string = TextCfg.getTextUi(5012);\r\n\t\t// this._nodes[\"spr_loading\"].getComponent(Label).string = TextCfg.getTextUi(5018);\r\n\r\n\t\tlet options = new HotOptions();\r\n\t\toptions.OnVersionInfo = (data) => {\r\n\t\t\tlet { local, server } = data;\r\n\t\t\tthis.versionInfo = data\r\n\t\t\tthis.versionLabel.string = lang.write(k => k.UpdateModule.VersionLabel,\r\n\t\t\t\t{ localVersion: local, serverVersion: server },\r\n\t\t\t\t{ placeStr: `本地版本:v${local}, 线上版本:v${server}` })\r\n\r\n\t\t\tif (local > server) {\r\n\t\t\t\tlet storagePath = ((native.fileUtils ? native.fileUtils.getWritablePath() : '/') + 'remote-asset');\r\n\t\t\t\tnative.fileUtils.removeDirectory(storagePath)\r\n\t\t\t\tthis.versionLabel.string += ' &Cache clear'\r\n\t\t\t\tconsole.log('Cache clear')\r\n\t\t\t}\r\n\t\t};\r\n\t\toptions.OnUpdateProgress = (event: jsb.EventAssetsManager) => {\r\n\t\t\tlet bytes = event.getDownloadedBytes() + '/' + event.getTotalBytes();\r\n\t\t\tlet files = event.getDownloadedFiles() + '/' + event.getTotalFiles();\r\n\r\n\t\t\tlet file = event.getPercentByFile().toFixed(2);\r\n\t\t\tlet byte = event.getPercent().toFixed(2);\r\n\t\t\tlet msg = event.getMessage();\r\n\r\n\t\t\t// console.log('[update]: 进度=' + file);\r\n\t\t\tthis.updateProgress.progress = 1 - parseFloat(file);\r\n\t\t\tthis.tipsLabel.string = lang.write(k => k.UpdateModule.UpdateProgress, { time: (parseFloat(file) * 100).toFixed(0) },\r\n\t\t\t\t{ placeStr: `正在更新中,请耐心等待（${(parseFloat(file) * 100).toFixed(0)}%）...` });\r\n\t\t\tconsole.log(msg);\r\n\t\t}\r\n\t\toptions.OnNeedToUpdate = (data) => {\r\n\t\t\tthis.initConfirm(\r\n\t\t\t\t[lang.write(k => k.UpdateModule.OnNeedToUpdate, { version: this.versionInfo.local + '→' + this.versionInfo.server }, { placeStr: `检测到新版本，确认自动开始更新` })], () => {\r\n\t\t\t\t\thotInstance.hotUpdate();\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// this.enterGame();\r\n\t\t\t\t\tgame.end()\r\n\t\t\t\t})\r\n\t\t};\r\n\t\toptions.OnNoNeedToUpdate = () => {\r\n\t\t\tthis.logLabel.string += lang.write(k => k.UpdateModule.DetectCompleted, {}, { placeStr: `检测完成，即将进入游戏>>` })\r\n\t\t\tthis.tipsLabel.string = lang.write(k => k.UpdateModule.DetectComplete, {}, { placeStr: `检测完成，即将进入游戏` })\r\n\t\t\t// 不需要更新，直接进入游戏\r\n\t\t\tthis.enterGame();\r\n\t\t};\r\n\t\toptions.OnUpdateSucceed = () => {\r\n\t\t\tgame.restart();\r\n\t\t};\r\n\t\toptions.OnUpdateFailed = () => {\r\n\t\t\tthis.tipsLabel.string = lang.write(k => k.UpdateModule.UpdateFail, {}, { placeStr: `更新失败` })\r\n\t\t\tthis.initConfirm([lang.write(k => k.UpdateModule.RestartProgram, {}, { placeStr: `更新失败，是否要重启程序？` })], () => {\r\n\t\t\t\tgame.restart()\r\n\t\t\t}, () => {\r\n\t\t\t\tgame.end()\r\n\t\t\t})\r\n\t\t};\r\n\t\tif (sys.isNative) {\r\n\t\t\tif (!config.isCheckHotUpdate) {\r\n\t\t\t\tthis.enterGame();\r\n\t\t\t} else {\r\n\t\t\t\tthis.logLabel.string += lang.write(k => k.UpdateModule.ClientCheck, {}, { placeStr: `客户端开始检查>>` })\r\n\t\t\t\tthis.tipsLabel.string = lang.write(k => k.UpdateModule.CheckUpdatedPkg, {}, { placeStr: `检查更新包...` })\r\n\t\t\t\tif (this.manifest) {\r\n\t\t\t\t\thotInstance.init(this.manifest, options);\r\n\t\t\t\t\thotInstance.checkUpdate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.tipsLabel.string = lang.write(k => k.UpdateModule.isNative, {}, { placeStr: `非native版本不检查更新，即将进入游戏` })\r\n\t\t\tthis.enterGame();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate handleManifestFile(newRemotUr: string) {\r\n\t\tif (!NATIVE) return;\r\n\t\tconst storagePath = ((native.fileUtils ? native.fileUtils.getWritablePath() : \"/\") + 'remote-asset')\r\n\t\t// this.storagePath = storagePath\r\n\t\t// console.log('updateManifestFile - Storage path for remote asset:' + storagePath)\r\n\t\tthis.updateManifestFile(newRemotUr, storagePath + '/project.manifest');\r\n\t\tthis.updateManifestFile(newRemotUr, storagePath + '/version.manifest');\r\n\t}\r\n\r\n\tprivate updateManifestFile(newRemotUr: string, fileName: string) {\r\n\t\tconst fileExist = native.fileUtils.isFileExist(fileName)\r\n\t\tconsole.log('updateManifestFile - filename:' + fileName, 'fileExist: ', fileExist)\r\n\t\tif (fileExist) {\r\n\t\t\tlet filestring_version = native.fileUtils.getStringFromFile(fileName)\r\n\t\t\tlet obj = JSON.parse(filestring_version);\r\n\t\t\tconsole.log('updateManifestFile - handleManifestFile ', obj.packageUrl, ' newRemotUr: ', newRemotUr);\r\n\r\n\t\t\tobj.packageUrl = newRemotUr;\r\n\t\t\tobj.remoteManifestUrl = newRemotUr + '/project.manifest';\r\n\t\t\tobj.remoteVersionUrl = newRemotUr + '/version.manifest';\r\n\t\t\tlet afterVersionString = JSON.stringify(obj);\r\n\t\t\tconst res = native.fileUtils.writeStringToFile(afterVersionString, fileName);\r\n\t\t\t// this.mainfestObj = obj;\r\n\t\t\tconsole.log('updateManifestFile - Modify the results of the file: ', fileName, res);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate downloadApkHandle(appDumpUrl: string, appOnlineVersion: string) {\r\n\t\tconst filePath = ((native.fileUtils ? native.fileUtils.getWritablePath() : \"/\") + 'apkfiles/HugeWin-' + appOnlineVersion + '.apk');\r\n\r\n\t\tlet downloader = new native.Downloader();\r\n\t\t//下载失败回调\r\n\t\tdownloader.onError = (task: native.DownloadTask, errorCode: number, errorCodeInternal: number, errorStr: string) => {\r\n\t\t\tconsole.log(\"downloader --------- \" + errorStr);\r\n\t\t};\r\n\r\n\t\t//进度回调\r\n\t\tdownloader.onProgress = (task, bytesReceived, totalBytesReceived, totalBytesExpected) => {\r\n\t\t\tlet progress: number = totalBytesReceived / totalBytesExpected; //已经下载的字节数 / 需要下载的总字节数\r\n\t\t\tthis.updateProgress.progress = 1 - progress;\r\n\t\t\t// this.getProgress(progress);\r\n\t\t\tlet bKReceived: string = (totalBytesReceived / 1024).toFixed(1);\r\n\t\t\tlet totalReceived: string = (totalBytesExpected / 1024).toFixed(1);\r\n\t\t\t// var strProgress: string = \"Download APK:\" + bKReceived + \"kb / \" + totalReceived + \"kb\";\r\n\t\t\tvar strProgress: string = `Download Version ${appOnlineVersion}: ${bKReceived}kb / ${totalReceived}kb`;\r\n\t\t\tthis.tipsLabel.string = strProgress;\r\n\t\t};\r\n\t\t//下载成功回调\r\n\t\tdownloader.onSuccess = (task) => {\r\n\t\t\t// this.updateLabel.string = \"Download success!\";\r\n\t\t\tinstallApk(filePath); //下载成功，执行安装apk操作\r\n\t\t};\r\n\r\n\t\tconst url = getRedirectUrl(appDumpUrl);\r\n\t\tdownloader.createDownloadTask(url, filePath);\r\n\r\n\t\t// const apkName = appDumpUrl.substring(appDumpUrl.lastIndexOf(\"/\") + 1);\r\n\t\t// nativeDownloadApk(appDumpUrl, \"HugeWin\" + appOnlineVersion, \"Please be patient while downloading\");\r\n\t\t// this.updateProgress.node.active = false;\r\n\t\t// this.tipsLabel.string = `Version ${appOnlineVersion} is being downloading...`;\r\n\t}\r\n\r\n\t/**获得包信息 */\r\n\tprivate getPackageInfo() {\r\n\t\treturn new Promise<any>((reslove, reject) => {\r\n\t\t\tconst packageName = getPackageName();\r\n\t\t\tif (!NATIVE) {\r\n\t\t\t\treslove(undefined);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// const tip = () => {\r\n\t\t\t// \t//弹出更新提示\r\n\t\t\t// \tthis.initConfirm([lang.write(k => k.UpdateModule.GameConfig), config.upgradeDesc], () => {\r\n\t\t\t// \t}, () => {\r\n\t\t\t// \t\tgame.end()\r\n\t\t\t// \t})\r\n\t\t\t// }\r\n\r\n\t\t\tconst url = config.httpBaseUrl + ApiUrl.CHANNEL_PACKAGE + \"?number=\" + packageName;\r\n\t\t\tfetch(url).then((response) => {\r\n\t\t\t\tif (response.status === 200) {\r\n\t\t\t\t\tresponse.text().then(text => {\r\n\t\t\t\t\t\tconst data = JSON.parse(text)\r\n\t\t\t\t\t\tif (data.content) {\r\n\t\t\t\t\t\t\treslove(data.content);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treslove(undefined);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(e => {\r\n\t\t\t\t\t\treslove(undefined);\r\n\t\t\t\t\t\tconsole.log(`get url ${url} failed, text catch, error: ${e}`);\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\treslove(undefined);\r\n\t\t\t\t\tconsole.log(`get url ${url} failed, status: ${response.status}`);\r\n\t\t\t\t}\r\n\t\t\t}).catch((e) => {\r\n\t\t\t\treslove(undefined);\r\n\t\t\t\tconsole.log(`get url ${url} failed!!`);\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\r\n\r\n"]}