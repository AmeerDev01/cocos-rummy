{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/godWealth111/components/GodWealth_dialogWin.ts"],"names":["_decorator","Label","Node","sp","BaseComponent","sourceManageSeletor","Task","TaskSchedulerDefault","StepNumber","SkeletonAnimationPlayer","ccclass","property","GodWealth_dialogWin","winnerConfig","numberStop","propertyNode","props_caishen_bw","props_cs_bw","props_slots_goldNum","props_big_win_box","props_jackpot_box","props_slots_jackPot_goldNum","props","winning","glodAmount","keepTime","events","killSelfHandler","start","initState","bindEvent","on","EventType","TOUCH_END","getComponent","string","formatAmountWithCommas","useProps","key","value","cur","titleSkeleton","Skeleton","skeletonData","getFile","fileName","source","count","id","active","playAnimation","joinqQueue","done","pre","num","toFixed","scheduleOnce","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, Node, Skeleton, sp, tween, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { DialogType } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport SkeletonAnimationPlayer from '../SkeletonPlay';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\twinning?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t},\r\n\tglodAmount?: number,\r\n\tkeepTime?: number\r\n}\r\nexport interface IEvent {\r\n\t/**自灭弹窗 */\r\n\tkillSelfHandler: () => void\r\n}\r\n\r\n@ccclass('GodWealth_dialogWin')\r\nexport class GodWealth_dialogWin extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate winnerConfig: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t}[] = []\r\n\tprivate numberStop: boolean = false;\r\n\r\n\tprotected propertyNode = {\r\n\t\t// props_sb_lbjs_BIGWIN: new Node(),\r\n\t\t// props_slots_common_game_bw_gold: new Node(),\r\n\t\t// props_slots_goldNum: new Label(),\r\n\t\tprops_caishen_bw: new Node(),\r\n\t\tprops_cs_bw:new Node(),\r\n\t\tprops_slots_goldNum: new Label(),\r\n\t\tprops_big_win_box: new Node(),\r\n\t\tprops_jackpot_box: new Node(),\r\n\t\tprops_slots_jackPot_goldNum:new Label(),\r\n\t\t\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\twinning: null,\r\n\t\tglodAmount: 0,\r\n\t\tkeepTime: 3000\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tkillSelfHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_cs_bw.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tif (this.numberStop) {\r\n\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t} else {\r\n\t\t\t\tthis.propertyNode.props_slots_goldNum.getComponent(Label).string = this.props.glodAmount.formatAmountWithCommas()\r\n\t\t\t\tthis.numberStop = true;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"winning\") {\r\n\t\t\tthis.winnerConfig = value.cur\r\n\t\t\tif (value.cur) {\r\n\t\t\t\tconst titleSkeleton = this.propertyNode.props_cs_bw.getComponent(sp.Skeleton)\t\t\t\t\r\n\t\t\t\ttitleSkeleton.skeletonData = sourceManageSeletor().getFile(this.props.winning.fileName[0]).source;\r\n\t\t\t\tlet count = 0;\r\n\t\t\t\tif (value.cur.id === 4) {\r\n\t\t\t\t\tthis.propertyNode.props_big_win_box.active = false;\r\n\t\t\t\t\tthis.propertyNode.props_jackpot_box.active = true;\r\n\t\t\t\t\tnew SkeletonAnimationPlayer(titleSkeleton, 'a2', true, () => {\r\n\t\t\t\t\t\tcount++\r\n\t\t\t\t\t\tif (this.numberStop && count > 1) {\r\n\t\t\t\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).playAnimation()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.propertyNode.props_big_win_box.active = true;\r\n\t\t\t\t\tthis.propertyNode.props_jackpot_box.active = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"glodAmount\") {\r\n\t\t\tthis.numberStop = false;\r\n\t\t\tif (this.props.winning.id === 4) {\r\n\t\t\t\tTaskSchedulerDefault().joinqQueue(new Task((done) => {\r\n\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\tthis.propertyNode && this.propertyNode.props_slots_jackPot_goldNum && (this.propertyNode.props_slots_jackPot_goldNum.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tthis.numberStop = true;\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t})).start()\r\n\t\t\t\t}), true)\r\n\t\t\t} else {\r\n\t\t\t\tTaskSchedulerDefault().joinqQueue(new Task((done) => {\r\n\t\t\t\t\t(new StepNumber(value.pre, value.cur, (num) => {\r\n\t\t\t\t\t\tthis.propertyNode && this.propertyNode.props_slots_goldNum && (this.propertyNode.props_slots_goldNum.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tthis.numberStop = true;\r\n\t\t\t\t\t\t\tthis.events.killSelfHandler()\r\n\t\t\t\t\t\t\t//数字展示完了之后，再停留1秒钟\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t},2)\r\n\t\t\t\t\t\t// window.setTimeout(() => {\r\n\t\t\t\t\t\t// this.numberStop = true;\r\n\t\t\t\t\t\t// \tthis.events.killSelfHandler()\r\n\t\t\t\t\t\t// \t//数字展示完了之后，再停留1秒钟\r\n\t\t\t\t\t\t// \tdone()\r\n\t\t\t\t\t\t// }, 2000)\r\n\t\t\t\t\t\t// this.numberStop = true;\r\n\t\t\t\t\t\t// done()\r\n\t\t\t\t\t})).start()\r\n\t\t\t\t}), true)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n"]}