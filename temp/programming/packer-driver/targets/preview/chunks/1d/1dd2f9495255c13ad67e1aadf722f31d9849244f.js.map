{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_ResetPassword.ts"],"names":["_decorator","EditBox","Node","sys","BaseComponent","ApiUrl","InputValidator","fetcher","ccclass","property","Hall_ResetPassword","propertyNode","props_btn_node_close","props_btn_send","props_intput_phone_phoneNum","props_intput_phone_captcha","props_intput_phone_password","props_btn_login","props","smsCode","events","closeHandler","sendSmsHandler","phoneNumber","pwdLoginSuccess","inputError","error","start","initState","bindEvent","on","EventType","TOUCH_END","getComponent","string","send","SEND_SMS","phone","then","rsp","catch","e","console","log","verificationCode","password","begin","isChartLength","isPhoneNumber","isSmsCode","done","RESET_PASSWORD","data","localStorage","setItem","useProps","key","value","bindUI","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,O,OAAAA,O;AAASC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,G,OAAAA,G;;AACtCC,MAAAA,a,iBAAAA,a;;AAEAC,MAAAA,M,iBAAAA,M;;AACFC,MAAAA,c;;AACEC,MAAAA,O,iBAAAA,O;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;oCAmBjBU,kB,WADZF,OAAO,CAAC,oBAAD,C,gBAAR,MACaE,kBADb;AAAA;AAAA,0CAC8E;AAAA;AAAA;AAAA,eAKnEC,YALmE,GAKpD;AACxB;AACAC,YAAAA,oBAAoB,EAAE,IAAIV,IAAJ,EAFE;;AAGxB;AACAW,YAAAA,cAAc,EAAE,IAAIX,IAAJ,EAJQ;;AAKxB;AACAY,YAAAA,2BAA2B,EAAE,IAAIZ,IAAJ,EANL;;AAOxB;AACAa,YAAAA,0BAA0B,EAAE,IAAIb,IAAJ,EARJ;;AASxB;AACAc,YAAAA,2BAA2B,EAAE,IAAId,IAAJ,EAVL;;AAWxB;AACAe,YAAAA,eAAe,EAAE,IAAIf,IAAJ;AAZO,WALoD;AAAA,eAoBtEgB,KApBsE,GAoBtD;AACtBC,YAAAA,OAAO,EAAE;AADa,WApBsD;AAAA,eAwBtEC,MAxBsE,GAwBrD;AACvBC,YAAAA,YAAY,EAAE,MAAM,CAAG,CADA;AAEvBC,YAAAA,cAAc,EAAGC,WAAD,IAAyB,CAAG,CAFrB;AAGvBC,YAAAA,eAAe,EAAE,MAAM,CAAG,CAHH;AAIvBC,YAAAA,UAAU,EAAGC,KAAD,IAAmB,CAAG;AAJX,WAxBqD;AAAA;;AAC7EC,QAAAA,KAAK,GAAG,CAEP;;AA4BSC,QAAAA,SAAS,GAAG;AACrB,iBAAO,EAAP;AAGA;;AAESC,QAAAA,SAAS,GAAS;AAC3B,eAAKlB,YAAL,CAAkBC,oBAAlB,CAAuCkB,EAAvC,CAA0C5B,IAAI,CAAC6B,SAAL,CAAeC,SAAzD,EAAoE,MAAM;AACzE,iBAAKZ,MAAL,CAAYC,YAAZ;AACA,WAFD;AAGA,eAAKV,YAAL,CAAkBE,cAAlB,CAAiCiB,EAAjC,CAAoC5B,IAAI,CAAC6B,SAAL,CAAeC,SAAnD,EAA8D,MAAM;AACnE,gBAAMT,WAAW,GAAG,KAAKZ,YAAL,CAAkBG,2BAAlB,CAA8CmB,YAA9C,CAA2DhC,OAA3D,EAAoEiC,MAAxF;AACA;AAAA;AAAA,oCAAQC,IAAR,CAAa;AAAA;AAAA,kCAAOC,QAApB,EAA8B;AAAEC,cAAAA,KAAK,EAAEd;AAAT,aAA9B,EAAsDe,IAAtD,CAA4DC,GAAD,IAAS;AACnE,mBAAKnB,MAAL,CAAYE,cAAZ,CAA2BC,WAA3B;AACA,mBAAKZ,YAAL,CAAkBI,0BAAlB,CAA6CkB,YAA7C,CAA0DhC,OAA1D,EAAmEiC,MAAnE,GAA4EK,GAA5E;AACA,aAHD,EAGGC,KAHH,CAGUC,CAAD,IAAO;AACfC,cAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACA,aALD;AAMA,WARD;AASA,eAAK9B,YAAL,CAAkBM,eAAlB,CAAkCa,EAAlC,CAAqC5B,IAAI,CAAC6B,SAAL,CAAeC,SAApD,EAA+D,MAAM;AACpE,gBAAMK,KAAK,GAAG,KAAK1B,YAAL,CAAkBG,2BAAlB,CAA8CmB,YAA9C,CAA2DhC,OAA3D,EAAoEiC,MAAlF;AACA,gBAAMU,gBAAgB,GAAG,KAAKjC,YAAL,CAAkBI,0BAAlB,CAA6CkB,YAA7C,CAA0DhC,OAA1D,EAAmEiC,MAA5F;AACA,gBAAMW,QAAQ,GAAG,KAAKlC,YAAL,CAAkBK,2BAAlB,CAA8CiB,YAA9C,CAA2DhC,OAA3D,EAAoEiC,MAArF;AACA;AAAA;AAAA,oDAAqBY,KAArB,GAA6BC,aAA7B,CAA2C,CAAC,CAAD,EAAI,EAAJ,CAA3C,EAAoDF,QAApD,EAA8DG,aAA9D,CAA4EX,KAA5E,EAAmFY,SAAnF,CAA6FL,gBAA7F,EAA+GM,IAA/G,CAAoH,MAAM;AACzH;AAAA;AAAA,sCAAQf,IAAR,CAAa;AAAA;AAAA,oCAAOgB,cAApB,EAAoC;AAAEd,gBAAAA,KAAF;AAASO,gBAAAA,gBAAT;AAA2BC,gBAAAA;AAA3B,eAApC,EAA2EP,IAA3E,CAAiFc,IAAD,IAAU;AACzFjD,gBAAAA,GAAG,CAACkD,YAAJ,CAAiBC,OAAjB,CAAyB,OAAzB,EAAkCF,IAAlC;AACA,qBAAKhC,MAAL,CAAYI,eAAZ;AACA,eAHD,EAGGgB,KAHH,CAGUC,CAAD,IAAO;AACfC,gBAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACA,eALD;AAMA,aAPD;AAQA,WAZD;AAaA;;AAESc,QAAAA,QAAQ,CAACC,GAAD,EAAoBC,KAApB,EAA2E,CAE5F;;AAESC,QAAAA,MAAM,GAAS,CAExB;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AA3E4E,O","sourcesContent":["import { _decorator, Component, EditBox, Node, sys } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport Fetcher from '../../utils/Fetcher';\r\nimport { ApiUrl } from '../apiUrl';\r\nimport InputValidator from '../../utils/InputValidator'\r\nimport { fetcher } from '../index';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n}\r\nexport interface IEvent {\r\n\tcloseHandler: () => void\r\n\t/*发送验证码*/\r\n\tsendSmsHandler: (phoneNumber: string) => void\r\n\t/**登录完成 */\r\n\tpwdLoginSuccess: () => void\r\n\t/**输入错误 */\r\n\tinputError: (error: string) => void\r\n}\r\n\r\n@ccclass('Hall_ResetPassword')\r\nexport class Hall_ResetPassword extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprotected propertyNode = {\r\n\t\t/**关闭 */\r\n\t\tprops_btn_node_close: new Node(),\r\n\t\t/**发送验证码 */\r\n\t\tprops_btn_send: new Node(),\r\n\t\t/**手机号码 */\r\n\t\tprops_intput_phone_phoneNum: new Node(),\r\n\t\t/**验证码 */\r\n\t\tprops_intput_phone_captcha: new Node(),\r\n\t\t/**密码输入框 */\r\n\t\tprops_intput_phone_password: new Node(),\r\n\t\t/**登录注册按钮 */\r\n\t\tprops_btn_login: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tsmsCode: \"\"\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tcloseHandler: () => { },\r\n\t\tsendSmsHandler: (phoneNumber: string) => { },\r\n\t\tpwdLoginSuccess: () => { },\r\n\t\tinputError: (error: string) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.propertyNode.props_btn_node_close.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.events.closeHandler()\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_send.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tconst phoneNumber = this.propertyNode.props_intput_phone_phoneNum.getComponent(EditBox).string\r\n\t\t\tfetcher.send(ApiUrl.SEND_SMS, { phone: phoneNumber }).then((rsp) => {\r\n\t\t\t\tthis.events.sendSmsHandler(phoneNumber)\r\n\t\t\t\tthis.propertyNode.props_intput_phone_captcha.getComponent(EditBox).string = rsp\r\n\t\t\t}).catch((e) => {\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t})\r\n\t\t})\r\n\t\tthis.propertyNode.props_btn_login.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tconst phone = this.propertyNode.props_intput_phone_phoneNum.getComponent(EditBox).string\r\n\t\t\tconst verificationCode = this.propertyNode.props_intput_phone_captcha.getComponent(EditBox).string\r\n\t\t\tconst password = this.propertyNode.props_intput_phone_password.getComponent(EditBox).string\r\n\t\t\tnew InputValidator().begin().isChartLength([6, 40], password).isPhoneNumber(phone).isSmsCode(verificationCode).done(() => {\r\n\t\t\t\tfetcher.send(ApiUrl.RESET_PASSWORD, { phone, verificationCode, password }).then((data) => {\r\n\t\t\t\t\tsys.localStorage.setItem(\"token\", data)\r\n\t\t\t\t\tthis.events.pwdLoginSuccess()\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: Partial<IState>, cur: Partial<IState> }) {\r\n\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}