{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfcV2/components/GxfcV2_Roller.ts"],"names":["_decorator","instantiate","Node","tween","UITransform","Vec3","BaseComponent","config","calBetAmount","GameType","getColumnLockIconArr","IconId","GxfcV2_Audio","getNodeByNameDeep","SoundPathDefine","cacheData","ccclass","property","GxfcV2_Roller","lastIndex","showIconCount","normalRollOption","stopIconIndex","columnIndex","iconPool","iconRollerQueue","isRoll","iconArr","rollOverCallback","isSpeedBorder","props_column_effect_node","iconAnimationNode","props_lock_icon_list","speddBorderNode","isMergeIcon","lockIcons","singleIconRollerViewModels","wildIcon","winWildIcon","rollerCount","bigNode","rollerLaunchResult","sendBetTime","propertyNode","props_icon_list","props_big_icon","props_wild_icon_list","props","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","positionId","events","onCheckNextLeftCount","start","initState","getWildListNode","setColumnEffectNode","getChildByName","initSlot","Math","floor","random","length","initColumn","isSubGame1","iconCount","i","joinIcon","isSubGame2","SUBGAME2","SUBGAME1","addIconIndex","index","value","newValue","isSubGame2SpecialIcon","id","getIntervalHeight","gameType","undefined","subGameRollOption","intervalHeight1","intervalHeight2","intervalHeight","iconId","iconConfig","icon","find","v","getIcon","showAmount","position","getRollerPaddingBottom","getHeight","y","getIconContainerAnchorPos","lastNode","getPosition","getNode","setPosition","push","setBeetleAmount","randomBeetleAmount","diff","calIndexDiff","lockIconDatas","getFixedChessboardIcon","lockIconData","setAmount","amount","betAmount","si","dl","fixedChessboardIcon","joinJinWildIcon","rollerId","active","removeAllChildren","jinWildicon","addChild","endPos","singleRollerHeight","to","console","log","isWinJinWildIcon","index1","index2","bindEvent","useProps","key","node","isValid","replaceSingleRollerIcon","changeRollerHeight","hideIconWin","stopWinIcon","children","forEach","name","destroy","startRoll","unscheduleAllCallbacks","hideScatterAnimation","comp","stopRoll","setSpeedBorderStatus","stopSingleRollerIcon","addLastJoinIconIndex","stopIndex","getStopIconIndex","totalCount","bindUI","getRollSpeed","rollerSpeed","mergeIcon","parentNode","getAlikeIconCount","pos","getMergeIconPos","buildSkeleton","bool","isWinIcon","worldPosition","getId","clone","add","wp","values","iconIndexs","isWinWild","WILD1","WILD2","show","setWorldPosition","x","scaleX","expectBorderScaleX","scaleY","expectBorderScaleY","setScale","getBigNodeScaleY","twoIconScaleY","threeIconScaleY","count","filter","SCATTER","hideWin","pauseWinIcon","pauseWin","playWinIcon","scheduleOnce","playWin","playJinFaWild","RollerId","done","wildRollerId","element","playJinWild","changeToJinWild","faceNode","getComponent","width","height","playOneScatterAnimation","playScatterAnimation","freeGame","freegame","isLoop","Object","keys","playScatterWin","rollOverHandle","addLockIcon","playOneShot","beatDrum","time","isPlayAnimation","playCount","lockValues","GxfcV2Icon","iconv","getIconIndex","replaceIcon","restore","removeSingleRollerIcon","playBeetleAnimation","getSlotIndex","unMount","splice","removeLockIcon","destory","getIconPosByIndex","halfHeight","paddingBottom","interval","iconListUI","anchorY","rollerHeight","rollerHeight2","rollerHeight1","getWorldPosition","resetIconPos","lock","buildSingleRollerIcon","replaceMultiRollerIcon","firstIcon","getFirstIcon","removeFromParent","rollerPaddingBottom","multiIconRoller","frist","iconHideY","shift","endIcon","duration","isMultiRoll","onDestroy","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAkBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAUC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,W,OAAAA,W;AAAmBC,MAAAA,I,OAAAA,I;;AACnEC,MAAAA,a,iBAAAA,a;;AAEFC,MAAAA,M;;AAEEC,MAAAA,Y,iBAAAA,Y;AAAcC,MAAAA,Q,iBAAAA,Q;AAAwBC,MAAAA,oB,iBAAAA,oB;AAAsBC,MAAAA,M,iBAAAA,M;;AAC5DC,MAAAA,Y,iBAAAA,Y;;AAGAC,MAAAA,iB,iBAAAA,iB;;AAGAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,S,iBAAAA,S;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBjB,U;;+BAqBjBkB,a,WADZF,OAAO,CAAC,eAAD,C,gBAAR,MACaE,aADb;AAAA;AAAA,0CACyE;AAAA;AAAA;;AAKxE;AALwE,eAMhEC,SANgE,GAMpD,CANoD;;AAOxE;AAPwE,eAQhEC,aARgE,GAQhD;AAAA;AAAA,gCAAOC,gBAAP,CAAwBD,aARwB;;AASxE;AATwE,eAUhEE,aAVgE,GAUhD,CAAC,CAV+C;;AAWxE;AAXwE,eAYhEC,WAZgE,GAYlD,CAZkD;;AAaxE;AAbwE,eAchEC,QAdgE;;AAexE;AAfwE,eAgBhEC,eAhBgE;;AAiBxE;AAjBwE,eAkBjEC,MAlBiE,GAkBxD,KAlBwD;;AAmBxE;AAnBwE,eAoBjEC,OApBiE,GAoBzC,EApByC;;AAsBxE;AAtBwE,eAuBhEC,gBAvBgE;;AAwBxE;AAxBwE,eAyBhEC,aAzBgE;;AA0BxE;AA1BwE,eA2BhEC,wBA3BgE;;AA4BxE;AA5BwE,eA6BhEC,iBA7BgE;;AA8BxE;AA9BwE,eA+BhEC,oBA/BgE;;AAgCxE;AAhCwE,eAiChEC,eAjCgE;;AAkCxE;AAlCwE,eAmChEC,WAnCgE,GAmClD,KAnCkD;;AAqCxE;AArCwE,eAsChEC,SAtCgE,GAsCtC,EAtCsC;;AAuCxE;AAvCwE,eAwChEC,0BAxCgE,GAwCA,EAxCA;AAAA,eA0ChEC,QA1CgE;AA2CxE;AA3CwE,eA4CjEC,WA5CiE,GA4CnD,EA5CmD;;AA+CxE;AA/CwE,eAgDhEC,WAhDgE,GAgDlD,CAAC,CAhDiD;;AAkDxE;AAlDwE,eAmDhEC,OAnDgE;AAAA,eAoDhEC,kBApDgE;AAAA,eAqDhEC,WArDgE,GAqDlD,CArDkD;AAAA,eAuD9DC,YAvD8D,GAuD/C;AACxBC,YAAAA,eAAe,EAAE,IAAI1C,IAAJ,EADO;AAExB2C,YAAAA,cAAc,EAAE,IAAI3C,IAAJ,EAFQ;AAGxB4C,YAAAA,oBAAoB,EAAE,IAAI5C,IAAJ;AAHE,WAvD+C;AAAA,eA8DjE6C,KA9DiE,GA8DjD;AACtBC,YAAAA,YAAY,EAAE;AACbC,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASC,IADV;AAEbC,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASD,IAFV;AAGbE,cAAAA,YAAY,EAAE;AAAA;AAAA,wCAASF,IAHV;AAIbG,cAAAA,SAAS,EAAE;AAJE,aADQ;AAOtBC,YAAAA,UAAU,EAAE;AAPU,WA9DiD;AAAA,eAwEjEC,MAxEiE,GAwEhD;AACvBC,YAAAA,oBAAoB,EAAE,MAAM,CAAG;AADR,WAxEgD;AAAA;;AACxEC,QAAAA,KAAK,GAAG,CAEP;;AAyESC,QAAAA,SAAS,GAAG;AACrB,iBAAO,EAAP;AACA;;AAEMC,QAAAA,eAAe,GAAG;AACxB,iBAAO,KAAKhB,YAAL,CAAkBG,oBAAzB;AACA;;AAEMc,QAAAA,mBAAmB,CAAC9B,wBAAD,EAAiC;AAC1D,eAAKA,wBAAL,GAAgCA,wBAAhC;AACA,eAAKC,iBAAL,GAAyB,KAAKD,wBAAL,CAA8B+B,cAA9B,CAA6C,sBAA7C,CAAzB;AACA,eAAK5B,eAAL,GAAuB,KAAKH,wBAAL,CAA8B+B,cAA9B,CAA6C,oBAA7C,CAAvB;AACA,eAAK7B,oBAAL,GAA4B;AAAA;AAAA,sDAAkB,sBAAlB,EAA0C,KAAKF,wBAA/C,CAA5B;AACA;;AAEMgC,QAAAA,QAAQ,CAACvC,WAAD,EAAsBC,QAAtB,EAA0C;AACxD,eAAKA,QAAL,GAAgBA,QAAhB;AACA,eAAKD,WAAL,GAAmBA,WAAnB;AACA,eAAKE,eAAL,GAAuB;AAAA;AAAA,gCAAOA,eAAP,CAAuB,KAAKF,WAA5B,CAAvB;AACA,eAAKJ,SAAL,GAAiB4C,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,KAAKxC,eAAL,CAAqByC,MAAhD,CAAjB;AAEA,eAAKC,UAAL,CAAgB,KAAK/C,aAAL,GAAqB,CAArC;;AAEA,cAAI,KAAKgD,UAAL,EAAJ,EAAuB,CACtB;AACA;AACD;;AAEOD,QAAAA,UAAU,CAACE,SAAD,EAAoB;AACrC,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,SAApB,EAA+BC,CAAC,EAAhC,EAAoC;AACnC,iBAAKC,QAAL;AACA;AACD;;AAEOC,QAAAA,UAAU,GAAG;AACpB,iBAAO,KAAKzB,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASqB,QAAzD;AACA;;AACOL,QAAAA,UAAU,GAAG;AACpB,iBAAO,KAAKrB,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASsB,QAAzD;AACA;;AAEOC,QAAAA,YAAY,CAACC,KAAD,EAAgBC,KAAhB,EAA+B;AAClD,cAAIC,QAAQ,GAAGF,KAAK,GAAGC,KAAvB;;AACA,cAAIC,QAAQ,IAAI,KAAKrD,eAAL,CAAqByC,MAArC,EAA6C;AAC5CY,YAAAA,QAAQ,GAAGA,QAAQ,GAAG,KAAKrD,eAAL,CAAqByC,MAA3C;AACA;;AACD,iBAAOY,QAAP;AACA;AAED;;;AACQC,QAAAA,qBAAqB,CAACC,EAAD,EAAa,CACzC;AACA;;AAEOC,QAAAA,iBAAiB,CAACC,QAAD,EAAiC;AAAA,cAAhCA,QAAgC;AAAhCA,YAAAA,QAAgC,GAAXC,SAAW;AAAA;;AACzD,cAAID,QAAQ,KAAKC,SAAjB,EAA4B;AAC3BD,YAAAA,QAAQ,GAAG,KAAKnC,KAAL,CAAWC,YAAX,CAAwBI,YAAnC;AACA;;AACD,cAAI8B,QAAQ,KAAK;AAAA;AAAA,oCAASR,QAA1B,EAAoC;AACnC,mBAAO;AAAA;AAAA,kCAAOU,iBAAP,CAAyBC,eAAhC;AACA,WAFD,MAEO,IAAIH,QAAQ,KAAK;AAAA;AAAA,oCAAST,QAA1B,EAAoC;AAC1C,mBAAO;AAAA;AAAA,kCAAOW,iBAAP,CAAyBE,eAAhC;AACA;;AACD,iBAAO;AAAA;AAAA,gCAAOjE,gBAAP,CAAwBkE,cAA/B;AACA;;AAEOhB,QAAAA,QAAQ,GAAG;AAClB,cAAML,MAAM,GAAG,KAAKvC,OAAL,CAAauC,MAA5B;AAEA,eAAK/C,SAAL,GAAiB,KAAKA,SAAL,GAAiB,CAAjB,GAAqB,CAArB,GAAyB,KAAKM,eAAL,CAAqByC,MAArB,GAA8B,CAAvD,GAA2D,EAAE,KAAK/C,SAAnF;AACA,cAAMqE,MAAM,GAAG,KAAK/D,eAAL,CAAqB,KAAKN,SAA1B,CAAf;AACA,cAAMsE,UAAU,GAAG;AAAA;AAAA,gCAAOC,IAAP,CAAYC,IAAZ,CAAiBC,CAAC,IAAIA,CAAC,CAACZ,EAAF,KAASQ,MAA/B,CAAnB,CALkB,CAOlB;AACA;AACA;AACA;AACA;;AAEA,cAAME,IAAI,GAAG,KAAKlE,QAAL,CAAcqE,OAAd,CAAsBJ,UAAtB,EAAkC,KAAK9C,YAAL,CAAkBC,eAApD,EAAqE,KAAKzB,SAA1E,CAAb;AACAuE,UAAAA,IAAI,CAACI,UAAL;AACA,cAAMC,QAAQ,GAAG,IAAI1F,IAAJ,CAAS,CAAT,EAAY,KAAK2F,sBAAL,KAAgCN,IAAI,CAACO,SAAL,KAAmB,CAA/D,CAAjB;AACAF,UAAAA,QAAQ,CAACG,CAAT,IAAc,KAAKC,yBAAL,EAAd;;AACA,cAAIjC,MAAM,GAAG,CAAb,EAAgB;AACf,gBAAMkC,QAAQ,GAAG,KAAKzE,OAAL,CAAauC,MAAM,GAAG,CAAtB,CAAjB;AACA6B,YAAAA,QAAQ,CAACG,CAAT,GAAaE,QAAQ,CAACC,WAAT,GAAuBH,CAAvB,GAA2BE,QAAQ,CAACH,SAAT,EAA3B,GAAkD,KAAKhB,iBAAL,EAA/D;AACA;;AAEDS,UAAAA,IAAI,CAACY,OAAL,GAAeC,WAAf,CAA2BR,QAA3B;AACA,eAAKpE,OAAL,CAAa6E,IAAb,CAAkBd,IAAlB;AAEA,eAAKe,eAAL,CAAqBf,IAArB;AACA;AAED;AACD;AACA;;;AACSe,QAAAA,eAAe,CAACf,IAAD,EAAmB;AACzC;AACA;AACA;AAEA,cAAI,KAAK3C,KAAL,CAAWC,YAAX,CAAwBG,YAAxB,KAAyC;AAAA;AAAA,oCAASsB,QAAlD,IAA8D,KAAK1B,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASqB,QAApH,EAA8H;AAC7H,iBAAKiC,kBAAL,CAAwBhB,IAAxB;AACA;AACA;;AAED,cAAMiB,IAAI,GAAG,KAAKC,YAAL,CAAkB,KAAKzF,SAAvB,EAAkC,KAAKG,aAAvC,CAAb;;AACA,cAAIqF,IAAI,IAAI,CAAZ,EAAe;AACd,iBAAKD,kBAAL,CAAwBhB,IAAxB;AACA;AACA,WAdwC,CAgBzC;;;AAEA,cAAMmB,aAAa,GAAG;AAAA;AAAA,4DAAqB,KAAKC,sBAAL,EAArB,EAAoD,KAAKvF,WAAzD,CAAtB;;AACA,cAAIsF,aAAa,CAAC3C,MAAd,KAAyB,CAA7B,EAAgC;AAC/B;AACA,iBAAKwC,kBAAL,CAAwBhB,IAAxB;AACA;AACA;;AACD,cAAMd,KAAK,GAAG+B,IAAI,KAAK,CAAT,GAAa,CAAb,GAAiBA,IAAI,KAAK,CAAT,GAAa,CAAb,GAAiB,CAAhD;AAEA,cAAMI,YAAY,GAAGF,aAAa,CAAClB,IAAd,CAAmBC,CAAC,IAAIA,CAAC,CAAChB,KAAF,KAAYA,KAApC,CAArB;;AACA,cAAImC,YAAJ,EAAkB;AACjBrB,YAAAA,IAAI,CAACsB,SAAL,CAAeD,YAAY,CAACE,MAA5B;AACA;AACD;;AAEOP,QAAAA,kBAAkB,CAAChB,IAAD,EAAmB;AAC5C;AACA,cAAMwB,SAAS,GAAG;AAAA;AAAA,4CAAa,KAAKnE,KAAL,CAAWO,UAAxB,CAAlB;AACA,cAAI2D,MAAM,GAAGlD,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBiD,SAA3B,CAAb;AACAD,UAAAA,MAAM,GAAGA,MAAM,IAAI,CAAV,GAAcA,MAAM,GAAG,CAAvB,GAA2BA,MAApC;AACAvB,UAAAA,IAAI,CAACsB,SAAL,CAAeC,MAAf;AACA;;AAEOH,QAAAA,sBAAsB,GAAG;AAChC,cAAI,KAAKrE,kBAAT,EAA6B;AAC5B,gBAAM0E,EAAE,GAAG,KAAK1E,kBAAL,CAAwB2E,EAAxB,CAA2BD,EAA3B,CAA8B,CAA9B,CAAX;;AACA,gBAAIA,EAAE,CAACjC,QAAH,KAAgB;AAAA;AAAA,sCAAST,QAAzB,IAAqC,KAAK1B,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,sCAASqB,QAA3F,EAAqG;AACpG,qBAAO0C,EAAE,CAACE,mBAAV;AACA;;AACD,mBAAOlC,SAAP;AACA,WAND,MAMO;AACN,mBAAO;AAAA;AAAA,wCAAUkC,mBAAjB;AACA;AACD;;AAEMC,QAAAA,eAAe,CAACC,QAAD,EAAW9E,kBAAX,EAAmD;AACxE,eAAKE,YAAL,CAAkBG,oBAAlB,CAAuC0E,MAAvC,GAAgD,IAAhD;AACA,cAAI9B,IAAI,GAAG,KAAKrD,QAAhB;AACA,eAAKM,YAAL,CAAkBG,oBAAlB,CAAuC2E,iBAAvC;;AACA,eAAK,IAAInD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,gBAAMoD,WAAW,GAAGzH,WAAW,CAACyF,IAAD,CAA/B;AACAgC,YAAAA,WAAW,CAACnB,WAAZ,CAAwB,CAAxB,EAA2B,CAAC,GAA5B;AACA,iBAAK5D,YAAL,CAAkBG,oBAAlB,CAAuC6E,QAAvC,CAAgDD,WAAhD;AACA,gBAAME,MAAM,GAAG,IAAIvH,IAAJ,CAAS,CAAT,EAAY,CAAC,GAAD,GAAQ;AAAA;AAAA,kCAAOgB,gBAAP,CAAwBwG,kBAAxB,GAA6CvD,CAAjE,CAAf;AACAnE,YAAAA,KAAK,CAACuH,WAAD,CAAL,CAAmBI,EAAnB,CAAsB,GAAtB,EAA2B;AAAE/B,cAAAA,QAAQ,EAAE6B;AAAZ,aAA3B,EAAiDnE,KAAjD;AACAsE,YAAAA,OAAO,CAACC,GAAR,CAAY,wDAAZ,EAAqE,KAAKC,gBAAL,CAAsB3D,CAAtB,EAAyB7B,kBAAzB,EAA6C8E,QAA7C,CAArE;;AAEA,gBAAI,KAAKU,gBAAL,CAAsB3D,CAAtB,EAAyB7B,kBAAzB,EAA6C8E,QAA7C,CAAJ,EAA4D;AAC3D;AACA;AACA;AACA;AACA;AACA,mBAAKjF,WAAL,CAAiBkE,IAAjB,CAAsBkB,WAAtB,EAN2D,CAQ3D;AACA;AACD;AACD;AAED;;;AACQd,QAAAA,YAAY,CAACsB,MAAD,EAAiBC,MAAjB,EAAiC;AACpD,cAAIxB,IAAI,GAAGuB,MAAM,GAAGC,MAApB;;AACA,cAAID,MAAM,GAAGC,MAAb,EAAqB;AACpBxB,YAAAA,IAAI,GAAGuB,MAAM,GAAG,KAAKzG,eAAL,CAAqByC,MAA9B,GAAuCiE,MAA9C;AACA;;AACD,iBAAOxB,IAAP;AACA;;AAESyB,QAAAA,SAAS,GAAS,CAC3B;;AAESC,QAAAA,QAAQ,CAACC,GAAD,EAAoBzD,KAApB,EAAmD;AACpE,cAAI,KAAK0D,IAAL,IAAa,KAAKA,IAAL,CAAUC,OAA3B,EAAoC;AACnC,gBAAIF,GAAG,KAAK,cAAZ,EAA4B;AAC3B,kBAAI,KAAKvF,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,wCAASqB,QAAlD,IAA8D,KAAKrC,0BAAL,CAAgC8B,MAAhC,KAA2C,CAA7G,EAAgH;AAC/G,qBAAKuE,uBAAL;AACA;;AACD,mBAAKC,kBAAL,CAAwB,KAAK3F,KAAL,CAAWC,YAAX,CAAwBI,YAAhD;AACA;AACD;AACD;AAED;;;AACOuF,QAAAA,WAAW,GAAG;AACpB,eAAKC,WAAL;AACA,eAAK7G,iBAAL,CAAuB8G,QAAvB,CAAgCC,OAAhC,CAAwClD,CAAC,IAAI;AAC5CA,YAAAA,CAAC,CAACmD,IAAF,KAAW,SAAX,IAAwBnD,CAAC,CAACoD,OAAF,EAAxB;AACA,WAFD;AAGA,eAAKxG,OAAL,IAAgB,KAAKA,OAAL,CAAawG,OAAb,EAAhB;AACA,eAAKxG,OAAL,GAAe,IAAf;AACA,eAAKT,iBAAL,CAAuB0F,iBAAvB;AACA,eAAK9E,YAAL,CAAkBE,cAAlB,CAAiC4E,iBAAjC;AACA;;AAEMwB,QAAAA,SAAS,GAAG;AAClB,eAAKC,sBAAL;AACA,eAAKP,WAAL;AACA,eAAKQ,oBAAL;AACA,eAAK5G,WAAL,GAAmB,CAAC,CAApB;AACA,eAAKL,WAAL,GAAmB,KAAnB;AACA,eAAKL,aAAL,GAAqB,KAArB;AACA,eAAKH,MAAL,GAAc,IAAd;AACA,eAAKiB,YAAL,CAAkBG,oBAAlB,CAAuC0E,MAAvC,GAAgD,KAAhD;AACA,eAAK7E,YAAL,CAAkBG,oBAAlB,CAAuC2E,iBAAvC;AACA,eAAKnF,WAAL,GAAmB,EAAnB;;AACA,cAAI,KAAKkC,UAAL,EAAJ,EAAuB;AACtB,iBAAKpC,0BAAL,CAAgC0G,OAAhC,CAAwClD,CAAC,IAAIA,CAAC,CAACwD,IAAF,CAAOH,SAAP,EAA7C;AACA;AACD;;AAEMI,QAAAA,QAAQ,CAAC/H,aAAD,EAAwBM,gBAAxB,EAAoDC,aAApD,EAA4EY,kBAA5E,EAAoH;AAClI,eAAKZ,aAAL,GAAqBA,aAArB;AACA,eAAKP,aAAL,GAAqBA,aAArB;AACA,eAAKM,gBAAL,GAAwBA,gBAAxB;AACA,eAAKa,kBAAL,GAA0BA,kBAA1B;AACA,eAAKC,WAAL,GAAmB;AAAA;AAAA,sCAAUA,WAA7B;AACAqF,UAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsB,KAAKtF,WAAvC,EANkI,CAOlI;;AACA,eAAKH,WAAL,GAAmB,CAAnB;;AAEA,cAAI,CAAC,KAAKiC,UAAL,EAAL,EAAwB;AACvB3C,YAAAA,aAAa,IAAI,KAAKyH,oBAAL,CAA0B,IAA1B,CAAjB,CADuB,CAEvB;AACA;AACA,WAJD,MAIO;AACN,iBAAKC,oBAAL,CAA0B9G,kBAA1B;AACA;AACD;;AAEO+G,QAAAA,oBAAoB,CAACC,SAAD,EAAoB5E,KAApB,EAAmC;AAC9D,cAAI4E,SAAS,GAAG,CAAhB,EAAmB;AAClB;AACA;;AACD,cAAI3E,QAAQ,GAAG2E,SAAS,GAAG5E,KAA3B;;AACA,cAAIC,QAAQ,IAAI,KAAKrD,eAAL,CAAqByC,MAArC,EAA6C;AAC5CY,YAAAA,QAAQ,GAAGA,QAAQ,GAAG,KAAKrD,eAAL,CAAqByC,MAA3C;AACA;;AACD,eAAK/C,SAAL,GAAiB2D,QAAjB;AACA;;AAEO4E,QAAAA,gBAAgB,GAAG;AAC1B;AACA,cAAIC,UAAU,GAAG,KAAK,KAAKpI,WAAL,GAAmB,CAAxB,CAAjB,CAF0B,CAG1B;AACA;AACA;;AACA,cAAI,KAAKgB,WAAL,IAAoBoH,UAAxB,EAAoC;AACnC,gBAAI,KAAKpH,WAAL,KAAqBoH,UAAzB,EAAqC;AACpC;AACA,mBAAKH,oBAAL,CAA0B,KAAKlI,aAA/B,EAA8C,CAA9C;AACA;;AACD,mBAAO,CAAC,CAAR;AACA;;AACD,iBAAO,KAAKA,aAAZ;AACA;;AAESsI,QAAAA,MAAM,GAAS;AACxB,eAAKvH,QAAL,GAAc,KAAKM,YAAL,CAAkBG,oBAAlB,CAAuCe,cAAvC,CAAsD,MAAtD,CAAd;AACA;AAED;;;AACQgG,QAAAA,YAAY,GAAG;AACtB;AACA;AACA;AACA,iBAAO;AAAA;AAAA,gCAAOxI,gBAAP,CAAwByI,WAA/B;AACA;;AAEOC,QAAAA,SAAS,CAACC,UAAD,EAAmBvH,kBAAnB,EAA2D;AAC3E,cAAI4B,SAAS,GAAG,KAAK4F,iBAAL,CAAuBxH,kBAAvB,CAAhB;AACA,cAAIyH,GAAS,GAAG,KAAKC,eAAL,CAAqB1H,kBAArB,CAAhB;;AAEA,cAAIyH,GAAJ,EAAS;AACR,iBAAKE,aAAL,CAAmBJ,UAAnB,EAA+BE,GAA/B,EAAoC7F,SAApC;AACA,iBAAKnC,WAAL,GAAmB,IAAnB;AACA;AACD;AAED;;;AACQiI,QAAAA,eAAe,CAAC1H,kBAAD,EAAyCyC,QAAzC,EAAyE;AAAA,cAAhCA,QAAgC;AAAhCA,YAAAA,QAAgC,GAAXC,SAAW;AAAA;;AAC/F,cAAID,QAAQ,KAAKC,SAAjB,EAA4B;AAC3BD,YAAAA,QAAQ,GAAG,KAAKnC,KAAL,CAAWC,YAAX,CAAwBI,YAAnC;AACA;;AACD,cAAIiB,SAAS,GAAG,KAAK4F,iBAAL,CAAuBxH,kBAAvB,CAAhB;AACA,cAAIyH,GAAJ;;AACA,cAAI7F,SAAS,KAAK,KAAKjD,aAAvB,EAAsC;AACrC,gBAAIiJ,IAAI,GAAG,IAAX;;AACA,iBAAK,IAAI/F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,kBAAI,CAAC,KAAKgG,SAAL,CAAehG,CAAf,EAAkB7B,kBAAlB,CAAL,EAA4C;AAC3C4H,gBAAAA,IAAI,GAAG,KAAP;AACA;AACA;AACD;;AACD,gBAAIA,IAAJ,EAAU;AACT;AACAH,cAAAA,GAAG,GAAG,KAAKvI,OAAL,CAAa,CAAb,EAAgB2E,OAAhB,GAA0BiE,aAAhC;AACA;AACD,WAZD,MAYO,IAAIlG,SAAS,IAAI,KAAKjD,aAAL,GAAqB,CAAtC,EAAyC;AAC/C;AACA,iBAAK,IAAIkD,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,KAAKlD,aAAL,GAAqB,CAAzC,EAA4CkD,EAAC,EAA7C,EAAiD;AAChD,kBAAI,KAAK3C,OAAL,CAAa2C,EAAb,EAAgBkG,KAAhB,OAA4B,KAAK7I,OAAL,CAAa2C,EAAC,GAAG,CAAjB,EAAoBkG,KAApB,EAA5B,IAA2D,KAAKF,SAAL,CAAehG,EAAf,EAAkB7B,kBAAlB,CAA3D,IAAoG,KAAK6H,SAAL,CAAehG,EAAC,GAAG,CAAnB,EAAsB7B,kBAAtB,CAAxG,EAAmJ;AAClJ;AACAyH,gBAAAA,GAAG,GAAG,KAAKvI,OAAL,CAAa2C,EAAb,EAAgBgC,OAAhB,GAA0BiE,aAA1B,CAAwCE,KAAxC,GAAgDC,GAAhD,CAAoD,IAAIrK,IAAJ,CAAS,CAAT,EAAY,KAAKsB,OAAL,CAAa2C,EAAb,EAAgB2B,SAAhB,KAA8B,CAA9B,GAAkC,KAAKhB,iBAAL,CAAuBC,QAAvB,IAAmC,CAAjF,CAApD,CAAN,CAFkJ,CAGlJ;AACA;AACD;AACD;;AACD,iBAAOgF,GAAP;AACA;AAED;;;AACQI,QAAAA,SAAS,CAAC1F,KAAD,EAAgBnC,kBAAhB,EAAwD+C,MAAxD,EAAoF;AAAA,cAA5BA,MAA4B;AAA5BA,YAAAA,MAA4B,GAAXL,SAAW;AAAA;;AACpG,cAAMwF,EAAE,GAAGlI,kBAAkB,CAAC2E,EAAnB,CAAsBD,EAAtB,CAAyB,CAAzB,EAA4BwD,EAAvC;;AACA,eAAK,IAAMrC,GAAX,IAAkBqC,EAAlB,EAAsB;AACrB,gBAAMC,MAAM,GAAGD,EAAE,CAACrC,GAAD,CAAjB;AACA,gBAAMuC,UAAU,GAAGD,MAAM,CAACjF,IAAP,CAAYC,CAAC,IAAIA,CAAC,CAAC,CAAD,CAAD,KAAS,KAAKrE,WAA/B,CAAnB;;AACA,gBAAIsJ,UAAU,IAAIA,UAAU,CAAC,CAAD,CAAV,KAAkBjG,KAApC,EAA2C;AAC1C,kBAAIY,MAAJ,EAAY;AACX,uBAAO,KAAK7D,OAAL,CAAaiD,KAAb,EAAoB4F,KAApB,OAAgChF,MAAvC;AACA;;AACD,qBAAO,IAAP;AACA;AACD;;AACD,iBAAO,KAAP;AACA;AAED;;;AACQyC,QAAAA,gBAAgB,CAACrD,KAAD,EAAgBnC,kBAAhB,EAAwDlB,WAAxD,EAAqE;AAC5F,cAAMoJ,EAAE,GAAGlI,kBAAkB,CAAC2E,EAAnB,CAAsBD,EAAtB,CAAyB,CAAzB,EAA4BwD,EAAvC;;AACA,eAAK,IAAMrC,GAAX,IAAkBqC,EAAlB,EAAsB;AACrB,gBAAMC,MAAM,GAAGD,EAAE,CAACrC,GAAD,CAAjB;AACA,gBAAMuC,UAAU,GAAGD,MAAM,CAACjF,IAAP,CAAYC,CAAC,IAAIA,CAAC,CAAC,CAAD,CAAD,KAASrE,WAA1B,CAAnB;;AACA,gBAAIsJ,UAAU,IAAIA,UAAU,CAAC,CAAD,CAAV,KAAkBjG,KAApC,EAA2C;AAC1C;AACA;AACA;AACA,qBAAO,IAAP;AACA;AACD;;AACD,iBAAO,KAAP;AACA;AAED;;;AACOkG,QAAAA,SAAS,GAAG;AAClB,cAAI,KAAKrI,kBAAT,EAA6B;AAC5B,iBAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,kBAAI,KAAKgG,SAAL,CAAehG,CAAf,EAAkB,KAAK7B,kBAAvB,EAA2C;AAAA;AAAA,oCAAOsI,KAAlD,KAA2D,KAAKT,SAAL,CAAehG,CAAf,EAAkB,KAAK7B,kBAAvB,EAA2C;AAAA;AAAA,oCAAOuI,KAAlD,CAA/D,EAAyH;AACxH,uBAAO,IAAP;AACA;AACD;AACD;;AACD,iBAAO,KAAP;AACA;;AAEO1B,QAAAA,oBAAoB,CAAC2B,IAAD,EAAgB;AAC3C,eAAKhJ,eAAL,CAAqBuF,MAArB,GAA8ByD,IAA9B;;AACA,cAAIA,IAAJ,EAAU;AACT,iBAAKhJ,eAAL,CAAqBiJ,gBAArB,CAAsC,IAAI7K,IAAJ,CAAS,KAAKkI,IAAL,CAAUgC,aAAV,CAAwBY,CAAxB,GAA4B,EAArC,EAAyC,KAAK5C,IAAL,CAAUgC,aAAV,CAAwBrE,CAAxB,GAA4B,EAArE,CAAtC,EADS,CAET;;AAEA,gBAAIkF,MAAM,GAAG;AAAA;AAAA,kCAAO/J,gBAAP,CAAwBgK,kBAArC;AACA,gBAAIC,MAAM,GAAG;AAAA;AAAA,kCAAOjK,gBAAP,CAAwBkK,kBAArC;;AACA,gBAAI,KAAKxI,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,sCAASsB,QAAtD,EAAgE;AAC/D0G,cAAAA,MAAM,GAAG;AAAA;AAAA,oCAAOhG,iBAAP,CAAyBiG,kBAAlC;AACAC,cAAAA,MAAM,GAAG;AAAA;AAAA,oCAAOlG,iBAAP,CAAyBmG,kBAAlC;AACA;;AACD,iBAAKtJ,eAAL,CAAqBuJ,QAArB,CAA8B,IAAInL,IAAJ,CAAS+K,MAAT,EAAiBE,MAAjB,EAAyB,CAAzB,CAA9B;AACA;AACD;;AAEOlB,QAAAA,aAAa,CAACJ,UAAD,EAAmBE,GAAnB,EAA8B7F,SAA9B,EAAiD,CACrE;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEOoH,QAAAA,gBAAgB,CAACpH,SAAD,EAAoBa,QAApB,EAAoD;AAAA,cAAhCA,QAAgC;AAAhCA,YAAAA,QAAgC,GAAXC,SAAW;AAAA;;AAC3E,cAAID,QAAQ,KAAKC,SAAjB,EAA4B;AAC3BD,YAAAA,QAAQ,GAAG,KAAKnC,KAAL,CAAWC,YAAX,CAAwBI,YAAnC;AACA;;AAED,cAAI8B,QAAQ,KAAK;AAAA;AAAA,oCAASR,QAA1B,EAAoC;AACnC,mBAAOL,SAAS,GAAG;AAAA;AAAA,kCAAOhD,gBAAP,CAAwBqK,aAA3B,GAA2C;AAAA;AAAA,kCAAOrK,gBAAP,CAAwBsK,eAAnF;AACA,WAFD,MAEO;AACN,mBAAOtH,SAAS,GAAG;AAAA;AAAA,kCAAOe,iBAAP,CAAyBsG,aAA5B,GAA4C;AAAA;AAAA,kCAAOtG,iBAAP,CAAyBuG,eAArF;AACA;AACD;AAED;;;AACQ1B,QAAAA,iBAAiB,CAACxH,kBAAD,EAAyC;AACjE,cAAImJ,KAAK,GAAG,CAAZ;;AACA,eAAK,IAAItH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAL,GAAqB,CAAzC,EAA4CkD,CAAC,EAA7C,EAAiD;AAChD,gBAAI,CAAC,KAAK3C,OAAL,CAAa2C,CAAb,EAAgBkG,KAAhB,OAA4B;AAAA;AAAA,kCAAOO,KAAnC,IAA4C,KAAKpJ,OAAL,CAAa2C,CAAb,EAAgBkG,KAAhB,OAA4B;AAAA;AAAA,kCAAOQ,KAAhF,KACH,KAAKrJ,OAAL,CAAa2C,CAAb,EAAgBkG,KAAhB,OAA4B,KAAK7I,OAAL,CAAa2C,CAAC,GAAG,CAAjB,EAAoBkG,KAApB,EADzB,IAEH,KAAKF,SAAL,CAAehG,CAAf,EAAkB7B,kBAAlB,CAFG,IAEsC,KAAK6H,SAAL,CAAehG,CAAC,GAAG,CAAnB,EAAsB7B,kBAAtB,CAF1C,EAEqF;AACpFmJ,cAAAA,KAAK;AACL;AACD;;AACD,iBAAOA,KAAP;AACA;AAED;;;AACOhD,QAAAA,WAAW,GAAG;AACpB,eAAKjH,OAAL,CAAakK,MAAb,CAAoBjG,CAAC,IAAIA,CAAC,CAAC4E,KAAF,OAAc;AAAA;AAAA,gCAAOsB,OAA9C,EAAuDhD,OAAvD,CAA+DlD,CAAC,IAAIA,CAAC,CAACmG,OAAF,EAApE;AACA;AAED;;;AACOC,QAAAA,YAAY,GAAG;AACrB,eAAKrK,OAAL,CAAakK,MAAb,CAAoBjG,CAAC,IAAIA,CAAC,CAAC4E,KAAF,OAAc;AAAA;AAAA,gCAAOsB,OAA9C,EAAuDhD,OAAvD,CAA+DlD,CAAC,IAAIA,CAAC,CAACqG,QAAF,EAApE;AACA;;AAEO9C,QAAAA,oBAAoB,GAAG;AAC9B,eAAKxH,OAAL,CAAakK,MAAb,CAAoBjG,CAAC,IAAIA,CAAC,CAAC4E,KAAF,OAAc;AAAA;AAAA,gCAAOsB,OAA9C,EAAuDhD,OAAvD,CAA+DlD,CAAC,IAAIA,CAAC,CAACmG,OAAF,EAApE;AACA;AAED;;;AACOG,QAAAA,WAAW,CAACtH,KAAD,EAAQ;AACzB;AAEA,cAAI,KAAKlD,MAAT,EAAiB;AAChB;AACA,WALwB,CAMzB;AACA;;;AAEA,cAAI,CAAC,KAAKQ,WAAV,EAAuB;AACtB,iBAAK6H,SAAL,CAAe,KAAKpH,YAAL,CAAkBE,cAAjC,EAAiD,KAAKJ,kBAAtD;AACA;;AAED,eAAK0J,YAAL,CAAkB,MAAM;AACvB,gBAAI,KAAK5D,IAAL,CAAUC,OAAd,EAAuB;AACtB,kBAAM9C,IAAI,GAAG,KAAK/D,OAAL,CAAaiD,KAAb,CAAb,CADsB,CAEtB;;AACA,kBAAIc,IAAI,CAAC8E,KAAL,OAAiB;AAAA;AAAA,oCAAOO,KAAxB,IAAgCrF,IAAI,CAAC8E,KAAL,OAAiB;AAAA;AAAA,oCAAOQ,KAAxD,IAAiE,CAAC,KAAK9I,WAA3E,EAAwF;AACvFwD,gBAAAA,IAAI,CAAC0G,OAAL,CAAa,KAAKzJ,YAAL,CAAkBE,cAA/B;AACA;AACD;AACD,WARD,EAQG,GARH;AASA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACD;AACA;;;AACQwJ,QAAAA,aAAa,CAAC5J,kBAAD,EAAyC6J,QAAzC,EAAmDC,IAAnD,EAAyD;AAAA;;AAC5ExE,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BsE,QAA7B;AACA,cAAME,YAAY,GAAG/J,kBAAkB,CAAC2E,EAAnB,CAAsBD,EAAtB,CAAyB,CAAzB,EAA4BqF,YAAjD;;AAF4E,wCAG1B;AAEjD,gBAAMC,OAAO,GAAG,KAAI,CAAC9K,OAAL,CAAa2C,CAAb,CAAhB;AACAyD,YAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuByE,OAAvB,EAHiD,CAIjD;;AAEA,gBAAID,YAAY,IAAIA,YAAY,CAACtI,MAAb,GAAsB,CAA1C,EAA6C;AAC5C;AACCuI,cAAAA,OAAO,CAACC,WAAR,CAAoB,KAAI,CAAC/J,YAAL,CAAkBE,cAAtC,EAAsD,MAAM;AAC3D,gBAAA,KAAI,CAACsJ,YAAL,CAAkB,MAAM;AACvB,sBAAI7H,CAAC,KAAK,CAAV,EAAa;AACZmI,oBAAAA,OAAO,CAACE,eAAR;AACAF,oBAAAA,OAAO,CAACG,QAAR,CAAiBC,YAAjB,CAA8BzM,WAA9B,EAA2C0M,KAA3C,GAAmD,GAAnD;AACAL,oBAAAA,OAAO,CAACG,QAAR,CAAiBC,YAAjB,CAA8BzM,WAA9B,EAA2C2M,MAA3C,GAAoD,GAApD;;AACA,wBAAIzI,CAAC,KAAK,CAAV,EAAa;AACZ,sBAAA,KAAI,CAAC6H,YAAL,CAAkB,MAAM;AACvBI,wBAAAA,IAAI,IAAIA,IAAI,EAAZ;AACA,uBAFD,EAEG,CAFH;AAGA;AACD;AACD,iBAXD,EAWE,CAXF;AAYA,eAbD,EAF2C,CAgB5C;AACA;AACA;AACD,WA5B2E;;AAG5E,eAAK,IAAIjI,CAAC,GAAG,KAAKlD,aAAL,GAAqB,CAAlC,EAAqCkD,CAAC,IAAI,CAA1C,EAA6CA,CAAC,EAA9C;AAAA;AAAA;AA0BA;AACD;AACA;AACC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AAEA;;;AACQ0I,QAAAA,uBAAuB,GAAG;AACjC;AACA,cAAI,KAAKxI,UAAL,EAAJ,EAAuB;AACtB;AACA;;AACD,eAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,gBAAMmI,OAAO,GAAG,KAAK9K,OAAL,CAAa2C,CAAb,CAAhB;;AACA,gBAAImI,OAAO,CAACjC,KAAR,OAAoB;AAAA;AAAA,kCAAOsB,OAA/B,EAAwC;AACvCW,cAAAA,OAAO,CAACL,OAAR,CAAgB,KAAKzJ,YAAL,CAAkBE,cAAlC,EAAkD,KAAlD,EAAyD,KAAzD;AACA;AACD;AACD;AAGD;;;AACOoK,QAAAA,oBAAoB,GAAG;AAC7B;AACA,cAAMC,QAAQ,GAAG;AAAA;AAAA,sCAAUzK,kBAAV,IAAgC;AAAA;AAAA,sCAAUA,kBAAV,CAA6B2E,EAA7B,CAAgCD,EAAhC,CAAmC,CAAnC,EAAsCgG,QAAvF;AACA,cAAMC,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYJ,QAAZ,EAAsBhJ,MAAtB,GAA+B,CAA/B,GAAmC,IAAnC,GAA0C,KAAzD;;AACA,cAAIkJ,MAAJ,EAAY;AACX,iBAAK,IAAI9I,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,kBAAMmI,OAAO,GAAG,KAAK9K,OAAL,CAAa2C,CAAb,CAAhB;;AACA,kBAAImI,OAAO,CAACjC,KAAR,OAAoB;AAAA;AAAA,oCAAOsB,OAA/B,EAAwC;AACvCW,gBAAAA,OAAO,CAACc,cAAR,CAAuB,KAAK5K,YAAL,CAAkBE,cAAzC,EAAyD,IAAzD;AACA;AACD;AACD;AACD;;AAEO2K,QAAAA,cAAc,CAAC/K,kBAAD,EAAyC;AAC9DsF,UAAAA,OAAO,CAACC,GAAR,CAAY,kCAAkC,KAAKtF,WAAnD;AACA,eAAKhB,MAAL,GAAc,KAAd;AACA,eAAKJ,aAAL,GAAqB,CAAC,CAAtB;AAEA,eAAKO,aAAL,IAAsB,KAAKyH,oBAAL,CAA0B,KAA1B,CAAtB,CAL8D,CAM9D;;AACA,eAAK0D,uBAAL,GAP8D,CAQ9D;;AACA,eAAKxI,UAAL,MAAqB,KAAKiJ,WAAL,EAArB;AAEA;AAAA;AAAA,4CAAaC,WAAb,CAAyB;AAAA;AAAA,kDAAgBC,QAAzC,EAX8D,CAa9D;;AACA,cAAMC,IAAI,GAAG,KAAKpJ,UAAL,KAAoB,GAApB,GAA0B,IAAvC;AACA,eAAKjB,MAAL,CAAYC,oBAAZ,GAf8D,CAgB9D;;AACA,eAAK2I,YAAL,CAAkB,MAAM;AACvB,iBAAK5D,IAAL,CAAUC,OAAV,IAAqB,KAAK5G,gBAAL,EAArB;AACA,WAFD,EAEGgM,IAFH;AAIA;AAID;;;AACOH,QAAAA,WAAW,CAACI,eAAD,EAAkC;AAAA,cAAjCA,eAAiC;AAAjCA,YAAAA,eAAiC,GAAN,IAAM;AAAA;;AACnD,cAAI,CAAC,KAAKrM,QAAV,EAAoB;AACnB;AACA;;AAED,cAAIsM,SAAS,GAAG,CAAhB;AACA,cAAMC,UAAU,GAAG;AAAA;AAAA,4DAAqB,KAAKjH,sBAAL,EAArB,EAAoD,KAAKvF,WAAzD,CAAnB;AACAwM,UAAAA,UAAU,CAACjF,OAAX,CAAmBlD,CAAC,IAAI;AACvB,gBAAIoI,UAAU,GAAG,KAAK7L,SAAL,CAAewD,IAAf,CAAoBsI,KAAK,IAAIA,KAAK,CAACC,YAAN,OAAyBtI,CAAC,CAAChB,KAAxD,CAAjB;;AACA,gBAAI,CAACoJ,UAAL,EAAiB;AAChB,kBAAMvI,UAAU,GAAG;AAAA;AAAA,oCAAOC,IAAP,CAAYC,IAAZ,CAAiBD,IAAI,IAAIA,IAAI,CAACV,EAAL,KAAYY,CAAC,CAACJ,MAAvC,CAAnB;AACAwI,cAAAA,UAAU,GAAG,KAAKxM,QAAL,CAAcqE,OAAd,CAAsBJ,UAAtB,EAAkC,KAAK9C,YAAL,CAAkBC,eAApD,EAAqEgD,CAAC,CAAChB,KAAvE,CAAb,CAFgB,CAGhB;AACA;AACA;AACA;AACA;AACA;;AAEA,kBAAMuJ,WAAW,GAAG,KAAKxM,OAAL,CAAaiE,CAAC,CAAChB,KAAf,CAApB;AACAoJ,cAAAA,UAAU,CAACzH,WAAX,CAAuB4H,WAAW,CAAC9H,WAAZ,EAAvB;AACA8H,cAAAA,WAAW,CAACC,OAAZ;AAEA,mBAAKzM,OAAL,CAAaiE,CAAC,CAAChB,KAAf,IAAwBoJ,UAAxB;AACA,mBAAK7L,SAAL,CAAeqE,IAAf,CAAoBwH,UAApB;AAEA,mBAAKK,sBAAL,CAA4BzI,CAAC,CAAChB,KAA9B;AAEAiJ,cAAAA,eAAe,IAAIG,UAAU,CAACM,mBAAX,CAA+B,MAAM;AACvDN,gBAAAA,UAAU,CAACjC,OAAX;AACA,eAFkB,CAAnB;AAGA+B,cAAAA,SAAS,GAtBO,CAuBhB;AACA;AACD,WA3BD;AA4BA,iBAAOA,SAAP;AACA;;AAEOO,QAAAA,sBAAsB,CAACzJ,KAAD,EAAgB;AAC7C,eAAK,IAAIN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlC,0BAAL,CAAgC8B,MAApD,EAA4DI,CAAC,EAA7D,EAAiE;AAChE,gBAAMmI,OAAO,GAAG,KAAKrK,0BAAL,CAAgCkC,CAAhC,CAAhB;;AACA,gBAAImI,OAAO,CAACrD,IAAR,CAAamF,YAAb,OAAgC3J,KAApC,EAA2C;AAC1C6H,cAAAA,OAAO,CAAC+B,OAAR;AACA,mBAAKpM,0BAAL,CAAgCqM,MAAhC,CAAuCnK,CAAvC,EAA0C,CAA1C;AACA;AACA;AACD;AACD;AAED;;;AACOoK,QAAAA,cAAc,GAAG;AACvB,eAAKvM,SAAL,CAAe2G,OAAf,CAAuBlD,CAAC,IAAIA,CAAC,CAAC+I,OAAF,EAA5B;AACA,eAAKxM,SAAL,GAAiB,EAAjB;AACA;AAED;AACD;AACA;AACA;AACA;;;AACSyM,QAAAA,iBAAiB,CAAChK,KAAD,EAAgBM,QAAhB,EAAgD;AAAA,cAAhCA,QAAgC;AAAhCA,YAAAA,QAAgC,GAAXC,SAAW;AAAA;;AACxE,cAAID,QAAQ,KAAKC,SAAjB,EAA4B;AAC3BD,YAAAA,QAAQ,GAAG,KAAKnC,KAAL,CAAWC,YAAX,CAAwBI,YAAnC;AACA;;AACD,cAAM2J,MAAM,GAAG;AAAA;AAAA,gCAAO1L,gBAAP,CAAwBwG,kBAAvC;AACA,cAAMgH,UAAU,GAAG9B,MAAM,GAAG,CAA5B;AACA,cAAM+B,aAAa,GAAG,KAAK9I,sBAAL,CAA4Bd,QAA5B,CAAtB;AACA,cAAIgB,CAAC,GAAG,CAAR;;AACA,cAAItB,KAAK,KAAK,CAAd,EAAiB;AAChB;AACAsB,YAAAA,CAAC,GAAG4I,aAAa,GAAGD,UAApB;AACA,WAHD,MAGO;AACN;AACA,gBAAME,QAAQ,GAAG,KAAK9J,iBAAL,CAAuBC,QAAvB,IAAmCN,KAApD;AACAsB,YAAAA,CAAC,GAAG4I,aAAa,GAAGD,UAAhB,GAA6BE,QAA7B,GAAwChC,MAAM,GAAGnI,KAArD;AACA;;AACDsB,UAAAA,CAAC,IAAI,KAAKC,yBAAL,EAAL;AACA,iBAAO,IAAI9F,IAAJ,CAAS,CAAT,EAAY6F,CAAZ,CAAP;AACA;AAED;;;AACQC,QAAAA,yBAAyB,GAAG;AACnC,cAAM6I,UAAU,GAAG,KAAKrM,YAAL,CAAkBC,eAAlB,CAAkCiK,YAAlC,CAA+CzM,WAA/C,CAAnB;AACA,iBAAO4O,UAAU,CAACjC,MAAX,GAAoBiC,UAAU,CAACC,OAAtC;AACA;;AAEMvG,QAAAA,kBAAkB,CAACxD,QAAD,EAAqB;AAC7C,cAAIgK,YAAY,GAAG;AAAA;AAAA,gCAAO7N,gBAAP,CAAwB6N,YAA3C;;AACA,cAAIhK,QAAQ,KAAK;AAAA;AAAA,oCAAST,QAA1B,EAAoC;AACnCyK,YAAAA,YAAY,GAAG;AAAA;AAAA,kCAAO9J,iBAAP,CAAyB+J,aAAxC;AACA,WAFD,MAEO,IAAIjK,QAAQ,KAAK;AAAA;AAAA,oCAASR,QAA1B,EAAoC;AAC1CwK,YAAAA,YAAY,GAAG;AAAA;AAAA,kCAAO9J,iBAAP,CAAyBgK,aAAxC;AACA;;AACD,eAAKzM,YAAL,CAAkBC,eAAlB,CAAkCiK,YAAlC,CAA+CzM,WAA/C,EAA4D2M,MAA5D,GAAqEmC,YAArE;;AAGA,cAAI,KAAKhN,WAAT,EAAsB;AACrB6F,YAAAA,OAAO,CAACC,GAAR,qCAAgD,KAAKxF,OAAL,CAAa6M,gBAAb,GAAgClE,CAAhF,EAAmF,KAAK3I,OAAL,CAAa6M,gBAAb,GAAgCnJ,CAAnH;AACA,gBAAMgE,GAAG,GAAG,KAAKC,eAAL,CAAqB,KAAK1H,kBAA1B,EAA8CyC,QAA9C,CAAZ,CAFqB,CAGrB;AACA;;AACA6C,YAAAA,OAAO,CAACC,GAAR,mCAA8CkC,GAAG,CAACiB,CAAlD,EAAqDjB,GAAG,CAAChE,CAAzD;AACA;AACD;AAED;;;AACOoJ,QAAAA,YAAY,CAACpK,QAAD,EAAqB;AACvC,eAAKwD,kBAAL,CAAwBxD,QAAxB;;AACA,cAAIA,QAAQ,KAAK;AAAA;AAAA,oCAAST,QAA1B,EAAoC;AACnC,iBAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK3C,OAAL,CAAauC,MAAjC,EAAyCI,CAAC,EAA1C,EAA8C;AAC7C,kBAAMoB,IAAI,GAAG,KAAK/D,OAAL,CAAa2C,CAAb,CAAb;AACA,kBAAM4F,GAAG,GAAG,KAAK0E,iBAAL,CAAuBtK,CAAvB,EAA0BY,QAA1B,CAAZ;AACAQ,cAAAA,IAAI,CAACa,WAAL,CAAiB2D,GAAjB;AACA;AACD;;AAED,cAAI,KAAKhI,WAAT,EAAsB;AACrB;AACA,gBAAMgI,IAAG,GAAG,KAAKC,eAAL,CAAqB,KAAK1H,kBAA1B,EAA8CyC,QAA9C,CAAZ,CAFqB,CAGrB;;;AACA,iBAAK1C,OAAL,CAAa0I,gBAAb,CAA8BhB,IAA9B,EAJqB,CAKrB;;AACA,gBAAI7F,SAAS,GAAG,KAAK4F,iBAAL,CAAuB,KAAKxH,kBAA5B,CAAhB;AACA,iBAAKD,OAAL,CAAagJ,QAAb,CAAsB,IAAInL,IAAJ,CAAS,CAAT,EAAY,KAAKoL,gBAAL,CAAsBpH,SAAtB,EAAiCa,QAAjC,CAAZ,CAAtB;AACA;AACD;AAED;;;AACOuD,QAAAA,uBAAuB,GAAG;AAAA;;AAChC,eAAKgF,WAAL,CAAiB,KAAjB;AAEA,cAAMM,UAAU,GAAG;AAAA;AAAA,4DAAqB,KAAKjH,sBAAL,EAArB,EAAoD,KAAKvF,WAAzD,CAAnB;;AAHgC,0CAIc;AAC7C,gBAAMqE,CAAC,GAAG,MAAI,CAACjE,OAAL,CAAa2C,CAAb,CAAV,CAD6C,CAE7C;AACA;;AACA,gBAAI,CAACyJ,UAAU,CAACpI,IAAX,CAAgB4J,IAAI,IAAIA,IAAI,CAAC3K,KAAL,KAAeN,CAAvC,CAAL,EAAgD;AAC/C,cAAA,MAAI,CAACkL,qBAAL,CAA2BlL,CAA3B,EAA8BsB,CAAC,CAACS,WAAF,EAA9B,EAA+CT,CAA/C;;AACAA,cAAAA,CAAC,CAACU,OAAF,GAAYkB,MAAZ,GAAqB,KAArB;AACA;AACD,WAZ+B;;AAIhC,eAAK,IAAIlD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK3C,OAAL,CAAauC,MAAjC,EAAyCI,CAAC,EAA1C;AAAA;AAAA;AASA;AAED;;;AACOmL,QAAAA,sBAAsB,GAAG;AAC/B,eAAKrN,0BAAL,CAAgC0G,OAAhC,CAAwClD,CAAC,IAAI;AAC5C,gBAAM8J,SAAS,GAAG9J,CAAC,CAACwD,IAAF,CAAOuG,YAAP,EAAlB;AACAD,YAAAA,SAAS,CAACpJ,OAAV,GAAoBsJ,gBAApB;AAEA,gBAAMhL,KAAK,GAAGgB,CAAC,CAACwD,IAAF,CAAOmF,YAAP,EAAd;AACA,iBAAK5L,YAAL,CAAkBC,eAAlB,CAAkC+E,QAAlC,CAA2C+H,SAAS,CAACpJ,OAAV,EAA3C;AACAoJ,YAAAA,SAAS,CAACnJ,WAAV,CAAsB,KAAKqI,iBAAL,CAAuBhK,KAAvB,CAAtB;AACA,iBAAKjD,OAAL,CAAaiD,KAAb,IAAsB8K,SAAtB;AAEA9J,YAAAA,CAAC,CAAC4I,OAAF;AACA,WAVD,EAD+B,CAa/B;;AACA,cAAI,KAAKzL,KAAL,CAAWC,YAAX,CAAwBC,YAAxB,KAAyC;AAAA;AAAA,oCAASwB,QAAlD,IACH,KAAK1B,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASqB,QADnD,EAC6D;AAC5D;AACA,iBAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlD,aAAzB,EAAwCkD,CAAC,EAAzC,EAA6C;AAC5C,kBAAIA,CAAC,IAAI,KAAK3C,OAAL,CAAauC,MAAtB,EAA8B;AAC7B;AACA;;AACD,kBAAM0B,CAAC,GAAG,KAAKjE,OAAL,CAAa2C,CAAb,CAAV,CAJ4C,CAK5C;AACA;AACA;AACA;AACD;;AAED,eAAKnC,SAAL,GAAiB,EAAjB;AACA,eAAKC,0BAAL,GAAkC,EAAlC;AACA;AAED;;;AACQoN,QAAAA,qBAAqB,CAAC5K,KAAD,EAAgBsF,GAAhB,EAA2BxE,IAA3B,EAA6C,CACzE;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEOM,QAAAA,sBAAsB,CAACd,QAAD,EAAiC;AAAA,cAAhCA,QAAgC;AAAhCA,YAAAA,QAAgC,GAAXC,SAAW;AAAA;;AAC9D,cAAID,QAAQ,KAAKC,SAAjB,EAA4B;AAC3BD,YAAAA,QAAQ,GAAG,KAAKnC,KAAL,CAAWC,YAAX,CAAwBI,YAAnC;AACA;;AACD,cAAI8B,QAAQ,KAAK;AAAA;AAAA,oCAASR,QAA1B,EAAoC;AACnC,mBAAO;AAAA;AAAA,kCAAOU,iBAAP,CAAyByK,mBAAhC;AACA;;AACD,iBAAO;AAAA;AAAA,gCAAOxO,gBAAP,CAAwBwO,mBAA/B;AACA;AAED;;;AACQC,QAAAA,eAAe,GAAG;AACzB,eAAKnO,OAAL,CAAamH,OAAb,CAAqBlD,CAAC,IAAI;AACzBA,YAAAA,CAAC,CAACW,WAAF,CAAc,IAAIlG,IAAJ,CAASuF,CAAC,CAACS,WAAF,GAAgB8E,CAAzB,EAA4BvF,CAAC,CAACS,WAAF,GAAgBH,CAAhB,GAAoB,KAAK2D,YAAL,EAAhD,CAAd;AACA,WAFD;AAIA,cAAMkG,KAAK,GAAG,KAAKpO,OAAL,CAAa,CAAb,CAAd,CALyB,CAMzB;;AACA,cAAIqO,SAAS,GAAG,EAAED,KAAK,CAAC9J,SAAN,KAAoB,CAApB,GAAwB,KAAKD,sBAAL,EAA1B,CAAhB;AACAgK,UAAAA,SAAS,IAAI,KAAK7J,yBAAL,EAAb;;AACA,cAAI4J,KAAK,CAAC1J,WAAN,GAAoBH,CAApB,IAAyB8J,SAA7B,EAAwC;AACvC;AACA,gBAAI,KAAKzN,WAAL,IAAoB,CAAxB,EAA2B;AAC1B,mBAAKA,WAAL;AACA;;AACD,iBAAKZ,OAAL,CAAasO,KAAb;AACAF,YAAAA,KAAK,CAAC3B,OAAN;AACA,iBAAK7J,QAAL;AAEA,gBAAM2L,OAAO,GAAG,KAAKvO,OAAL,CAAa,CAAb,CAAhB;;AAEA,gBAAIuO,OAAO,CAAChC,YAAR,OAA2B,KAAKxE,gBAAL,EAA/B,EAAwD;AACvD;AACA,mBAAKhI,MAAL,GAAc,KAAd;AACA,mBAAKJ,aAAL,GAAqB,CAAC,CAAtB;AAEA,kBAAM6O,QAAQ,GAAG,GAAjB,CALuD,CAMvD;;AACA,mBAAK,IAAI7L,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK3C,OAAL,CAAauC,MAAjC,EAAyCI,CAAC,EAA1C,EAA8C;AAC7C,oBAAMoB,IAAI,GAAG,KAAK/D,OAAL,CAAa2C,CAAb,CAAb;AACAnE,gBAAAA,KAAK,CAACuF,IAAI,CAACY,OAAL,EAAD,CAAL,CAAsBwB,EAAtB,CAAyBqI,QAAzB,EAAmC;AAAEpK,kBAAAA,QAAQ,EAAE,KAAK6I,iBAAL,CAAuBtK,CAAvB;AAAZ,iBAAnC,EAA4Eb,KAA5E;AACA,eAVsD,CAYvD;;;AAEA,mBAAK0I,YAAL,CAAkB,MAAM;AACvB,qBAAKqB,cAAL,CAAoB,KAAK/K,kBAAzB;AACA,eAFD,EAEG0N,QAFH;AAGA;AACD;AACD;;AAEOC,QAAAA,WAAW,GAAG;AACrB,iBAAO,KAAKrN,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASF,IAAlD,IAA0D,KAAKH,KAAL,CAAWC,YAAX,CAAwBI,YAAxB,KAAyC;AAAA;AAAA,oCAASsB,QAAnH;AACA;AAED;;;AACQ6E,QAAAA,oBAAoB,CAAC9G,kBAAD,EAAyC;AACpE,cAAImJ,KAAK,GAAG,CAAZ;;AACA,cAAI,KAAKxJ,0BAAL,CAAgC8B,MAAhC,KAA2C,CAA/C,EAAkD;AACjD,iBAAKxC,MAAL,GAAc,KAAd;AACA,iBAAK6G,IAAL,CAAUC,OAAV,IAAqB,KAAKgF,cAAL,CAAoB,KAAK/K,kBAAzB,CAArB;AACA,WAHD,MAGO;AACN,iBAAKL,0BAAL,CAAgC0G,OAAhC,CAAwClD,CAAC,IAAIA,CAAC,CAACwD,IAAF,CAAOC,QAAP,CAAgB,KAAK/H,aAArB,EAAoC,MAAM;AACtFsK,cAAAA,KAAK;;AACL,kBAAIA,KAAK,IAAI,KAAKxJ,0BAAL,CAAgC8B,MAA7C,EAAqD;AACpD,qBAAKxC,MAAL,GAAc,KAAd;AACA,qBAAK6G,IAAL,CAAUC,OAAV,IAAqB,KAAKgF,cAAL,CAAoB,KAAK/K,kBAAzB,CAArB;AACA;AACD,aAN4C,EAM1CA,kBAN0C,CAA7C;AAOA;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEU4N,QAAAA,SAAS,GAAS;AAC3B,eAAK3O,MAAL,GAAc,KAAd;AACA;;AAED4O,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACzB,cAAI,KAAK7O,MAAL,IAAe,KAAKC,OAAL,CAAauC,MAAb,GAAsB,CAAzC,EAA4C;AAC3C,gBAAI,KAAKkM,WAAL,EAAJ,EAAwB;AACvB,mBAAKN,eAAL;AACA;AACD;AACD;;AA37BuE,O","sourcesContent":["import { _decorator, Game, instantiate, Node, sp, tween, UITransform, Vec2, Vec3, view } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { GxfcV2Icon } from './GxfcV2_Icon';\r\nimport { calBetAmount, GameType, GameTypeInfo, getColumnLockIconArr, IconId, LockIcon, RollerInfo, RollerLaunchResult, RollerStatus } from '../type';\r\nimport { GxfcV2_Audio, mainViewModel, sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nimport { GxfcV2_SingleIconRoller } from './GxfcV2_SingleIconRoller';\r\nimport GxfcV2SingleIconRollerViewModel from '../viewModel/GxfcV2SingleIconRollerViewModel';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport game from '../store/reducer/game';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\ntype WildIcon = {\r\n\tindex: number,\r\n\twildIcon:Node\r\n}\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/** 选择的线id */\r\n\tpositionId: number,\r\n}\r\nexport interface IEvent {\r\n\tonCheckNextLeftCount: () => void\r\n}\r\n\r\n@ccclass('GxfcV2_Roller')\r\nexport class GxfcV2_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = config.normalRollOption.showIconCount;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**是否正在滚动 */\r\n\tpublic isRoll = false;\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tpublic iconArr: GxfcV2Icon[] = [];\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**是否快速边框（期待scatter中奖边框） */\r\n\tprivate isSpeedBorder;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\t/**锁定图标节点 */\r\n\tprivate props_lock_icon_list: Node;\r\n\t/**快速滚动层节点 */\r\n\tprivate speddBorderNode: Node;\r\n\t/**是否合并图标了 */\r\n\tprivate isMergeIcon = false;\r\n\r\n\t/**锁定图标列表 */\r\n\tprivate lockIcons: GxfcV2Icon[] = [];\r\n\t/**单个图标的滚动 */\r\n\tprivate singleIconRollerViewModels: GxfcV2SingleIconRollerViewModel[] = [];\r\n\r\n\tprivate wildIcon\r\n\t// public winWildIcon: WildIcon[] = []\r\n\tpublic winWildIcon = []\r\n\t\r\n\r\n\t/**滚动次数 */\r\n\tprivate rollerCount = -1;\r\n\r\n\t/**大图标 */\r\n\tprivate bigNode: Node;\r\n\tprivate rollerLaunchResult: RollerLaunchResult;\r\n\tprivate sendBetTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t\tprops_big_icon: new Node(),\r\n\t\tprops_wild_icon_list: new Node(),\r\n\t\t\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\tpositionId: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonCheckNextLeftCount: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic getWildListNode() {\r\n\t\treturn this.propertyNode.props_wild_icon_list\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t\tthis.speddBorderNode = this.props_column_effect_node.getChildByName(\"props_speed_border\")\r\n\t\tthis.props_lock_icon_list = getNodeByNameDeep(\"props_lock_icon_list\", this.props_column_effect_node);\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, iconPool: IconPool) {\r\n\t\tthis.iconPool = iconPool;\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.lastIndex = Math.floor(Math.random() * this.iconRollerQueue.length);\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\r\n\t\tif (this.isSubGame1()) {\r\n\t\t\t// this.initWildColumn(this.showIconCount + 1);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isSubGame2() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2;\r\n\t}\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\t/**是否小游戏2的特殊图标 */\r\n\tprivate isSubGame2SpecialIcon(id: number) {\r\n\t\t// return id === IconId.BEETLE || id === IconId.SUN_GOD;\r\n\t}\r\n\r\n\tprivate getIntervalHeight(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight1\r\n\t\t} else if (gameType === GameType.SUBGAME2) {\r\n\t\t\treturn config.subGameRollOption.intervalHeight2;\r\n\t\t}\r\n\t\treturn config.normalRollOption.intervalHeight;\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\t// 在子游戏2中，初始化不显示甲壳虫和太阳神\r\n\t\t// if (this.isSubGame2() && this.isSubGame2SpecialIcon(iconConfig.id)) {\r\n\t\t// \tthis.joinIcon();\r\n\t\t// \treturn;\r\n\t\t// }\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\ticon.showAmount();\r\n\t\tconst position = new Vec3(0, this.getRollerPaddingBottom() + icon.getHeight() / 2);\r\n\t\tposition.y -= this.getIconContainerAnchorPos();\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.getIntervalHeight();\r\n\t\t}\r\n\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置甲壳虫上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: GxfcV2Icon) {\r\n\t\t// if (icon.getId() !== IconId.BEETLE) {\r\n\t\t// \treturn;\r\n\t\t// }\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff >= 3) {\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// console.log(`setBeetleAmount--- diff:${diff},stopIconIndex:${this.stopIconIndex},lastIndex:${this.lastIndex},columnIndex:${this.columnIndex}`);\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\t// 没有锁定图标就随机一个金额\r\n\t\t\tthis.randomBeetleAmount(icon);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst index = diff === 2 ? 0 : diff === 0 ? 2 : 1;\r\n\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === index)\r\n\t\tif (lockIconData) {\r\n\t\t\ticon.setAmount(lockIconData.amount)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate randomBeetleAmount(icon: GxfcV2Icon) {\r\n\t\t// 没有锁定图标就随机一个金额\r\n\t\tconst betAmount = calBetAmount(this.props.positionId)\r\n\t\tlet amount = Math.floor(Math.random() * betAmount)\r\n\t\tamount = amount <= 0 ? amount + 1 : amount\r\n\t\ticon.setAmount(amount)\r\n\t}\r\n\r\n\tprivate getFixedChessboardIcon() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tconst si = this.rollerLaunchResult.dl.si[0]\r\n\t\t\tif (si.gameType === GameType.SUBGAME2 || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t\treturn si.fixedChessboardIcon;\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\treturn cacheData.fixedChessboardIcon;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic joinJinWildIcon(rollerId, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.propertyNode.props_wild_icon_list.active = true;\r\n\t\tlet icon = this.wildIcon;\r\n\t\tthis.propertyNode.props_wild_icon_list.removeAllChildren();\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst jinWildicon = instantiate(icon);\r\n\t\t\tjinWildicon.setPosition(0, -150);\r\n\t\t\tthis.propertyNode.props_wild_icon_list.addChild(jinWildicon);\r\n\t\t\tconst endPos = new Vec3(0, -150 + (config.normalRollOption.singleRollerHeight * i));\r\n\t\t\ttween(jinWildicon).to(0.5, { position: endPos }).start();\r\n\t\t\tconsole.log(\"this.isWinJinWildIcon(i, rollerLaunchResult, rollerId)\",this.isWinJinWildIcon(i, rollerLaunchResult, rollerId));\r\n\t\t\t\r\n\t\t\tif (this.isWinJinWildIcon(i, rollerLaunchResult, rollerId)) {\r\n\t\t\t\t// const wild = {\r\n\t\t\t\t// \tindex: i,\r\n\t\t\t\t// \twildIcon:jinWildicon\r\n\t\t\t\t// }\r\n\t\t\t\t// this.winWildIcon.push(wild);\r\n\t\t\t\tthis.winWildIcon.push(jinWildicon);\r\n\r\n\t\t\t\t// mainViewModel.rollerPanelViewModel.comp.winWildIcon.push(jinWildicon)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'gameTypeInfo') {\r\n\t\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2 && this.singleIconRollerViewModels.length === 0) {\r\n\t\t\t\t\tthis.replaceSingleRollerIcon();\r\n\t\t\t\t}\r\n\t\t\t\tthis.changeRollerHeight(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tpublic hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.bigNode && this.bigNode.destroy();\r\n\t\tthis.bigNode = null;\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t\tthis.propertyNode.props_big_icon.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tthis.hideIconWin();\r\n\t\tthis.hideScatterAnimation();\r\n\t\tthis.rollerCount = -1;\r\n\t\tthis.isMergeIcon = false;\r\n\t\tthis.isSpeedBorder = false;\r\n\t\tthis.isRoll = true;\r\n\t\tthis.propertyNode.props_wild_icon_list.active = false;\r\n\t\tthis.propertyNode.props_wild_icon_list.removeAllChildren();\r\n\t\tthis.winWildIcon = [];\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.startRoll());\r\n\t\t}\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function, isSpeedBorder: boolean, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.isSpeedBorder = isSpeedBorder;\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\t\tthis.rollerLaunchResult = rollerLaunchResult;\r\n\t\tthis.sendBetTime = cacheData.sendBetTime;\r\n\t\tconsole.log(\"roller stop time \" + this.sendBetTime);\r\n\t\t// let value = isSpeedBorder ? 15 : this.columnIndex + 1\r\n\t\tthis.rollerCount = 0;\r\n\r\n\t\tif (!this.isSubGame2()) {\r\n\t\t\tisSpeedBorder && this.setSpeedBorderStatus(true);\r\n\t\t\t// let value = isSpeedBorder ? 30 : 3;\r\n\t\t\t// this.addLastJoinIconIndex(this.stopIconIndex, 30);\r\n\t\t} else {\r\n\t\t\tthis.stopSingleRollerIcon(rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tif (stopIndex < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet newValue = stopIndex + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\tthis.lastIndex = newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex}`);\r\n\t\tlet totalCount = 1 * (this.columnIndex + 1);\r\n\t\t// if (this.isSpeedBorder) {\r\n\t\t// \ttotalCount = 20;\r\n\t\t// }\r\n\t\tif (this.rollerCount <= totalCount) {\r\n\t\t\tif (this.rollerCount === totalCount) {\r\n\t\t\t\t// console.log(`getStopIconIndex--- rollerCount:${this.rollerCount},columnIndex:${this.columnIndex},lastIndex:${this.lastIndex},\tstopIconIndex:${this.stopIconIndex}`);\r\n\t\t\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3)\r\n\t\t\t}\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.wildIcon=this.propertyNode.props_wild_icon_list.getChildByName(\"icon\")\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\t// if (this.isSpeedBorder) {\r\n\t\t// \treturn config.normalRollOption.expectRollerSpeed;\r\n\t\t// }\r\n\t\treturn config.normalRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tprivate mergeIcon(parentNode: Node, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet iconCount = this.getAlikeIconCount(rollerLaunchResult);\r\n\t\tlet pos: Vec3 = this.getMergeIconPos(rollerLaunchResult);\r\n\r\n\t\tif (pos) {\r\n\t\t\tthis.buildSkeleton(parentNode, pos, iconCount);\r\n\t\t\tthis.isMergeIcon = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得合并图标的位置 */\r\n\tprivate getMergeIconPos(rollerLaunchResult: RollerLaunchResult, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tlet iconCount = this.getAlikeIconCount(rollerLaunchResult);\r\n\t\tlet pos: Vec3;\r\n\t\tif (iconCount === this.showIconCount) {\r\n\t\t\tlet bool = true;\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (!this.isWinIcon(i, rollerLaunchResult)) {\r\n\t\t\t\t\tbool = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (bool) {\r\n\t\t\t\t// 3个图标取中间的图标的坐标\r\n\t\t\t\tpos = this.iconArr[1].getNode().worldPosition;\r\n\t\t\t}\r\n\t\t} else if (iconCount == this.showIconCount - 1) {\r\n\t\t\t// 找出两个相邻的图标\r\n\t\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\t\tif (this.iconArr[i].getId() === this.iconArr[i + 1].getId() && this.isWinIcon(i, rollerLaunchResult) && this.isWinIcon(i + 1, rollerLaunchResult)) {\r\n\t\t\t\t\t// 用开始的图标的坐标 + 图标的一半 + 间隔的一半\r\n\t\t\t\t\tpos = this.iconArr[i].getNode().worldPosition.clone().add(new Vec3(0, this.iconArr[i].getHeight() / 2 + this.getIntervalHeight(gameType) / 2));\r\n\t\t\t\t\t// console.log(`getMergeIconPos begin`, pos.x, pos.y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pos;\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tprivate isWinIcon(index: number, rollerLaunchResult: RollerLaunchResult, iconId: IconId = undefined) {\r\n\t\tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === this.columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\tif (iconId) {\r\n\t\t\t\t\treturn this.iconArr[index].getId() === iconId;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否中奖图标 */\r\n\tprivate isWinJinWildIcon(index: number, rollerLaunchResult: RollerLaunchResult, columnIndex) {\r\n\t\tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t\tfor (const key in wp) {\r\n\t\t\tconst values = wp[key] as [];\r\n\t\t\tconst iconIndexs = values.find(v => v[0] === columnIndex)\r\n\t\t\tif (iconIndexs && iconIndexs[1] === index) {\r\n\t\t\t\t// if (iconId) {\r\n\t\t\t\t// \treturn this.iconArr[index].getId() === iconId;\r\n\t\t\t\t// }\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**是否有中奖图标wild */\r\n\tpublic isWinWild() {\r\n\t\tif (this.rollerLaunchResult) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (this.isWinIcon(i, this.rollerLaunchResult, IconId.WILD1) ||this.isWinIcon(i, this.rollerLaunchResult, IconId.WILD2)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate setSpeedBorderStatus(show: boolean) {\r\n\t\tthis.speddBorderNode.active = show;\r\n\t\tif (show) {\r\n\t\t\tthis.speddBorderNode.setWorldPosition(new Vec3(this.node.worldPosition.x + 11, this.node.worldPosition.y + 13));\r\n\t\t\t// GxfcV2_Audio.playOneShot(SoundPathDefine.fast_roller)\r\n\r\n\t\t\tlet scaleX = config.normalRollOption.expectBorderScaleX;\r\n\t\t\tlet scaleY = config.normalRollOption.expectBorderScaleY;\r\n\t\t\tif (this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1) {\r\n\t\t\t\tscaleX = config.subGameRollOption.expectBorderScaleX;\r\n\t\t\t\tscaleY = config.subGameRollOption.expectBorderScaleY;\r\n\t\t\t}\r\n\t\t\tthis.speddBorderNode.setScale(new Vec3(scaleX, scaleY, 1));\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildSkeleton(parentNode: Node, pos: Vec3, iconCount: number) {\r\n\t\t// const fileName = iconCount === 2 ? PrefabPathDefine.TWO_ICON : PrefabPathDefine.THREE_ICON;\r\n\t\t// this.bigNode = instantiate(sourceManageSeletor().getFile(fileName).source);\r\n\t\t// this.bigNode.name = \"bigNode-\" + iconCount;\r\n\t\t// parentNode.addChild(this.bigNode);\r\n\t\t// this.bigNode.setWorldPosition(pos);\r\n\r\n\t\t// this.bigNode.setScale(new Vec3(1, this.getBigNodeScaleY(iconCount)))\r\n\t}\r\n\r\n\tprivate getBigNodeScaleY(iconCount: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\r\n\t\tif (gameType !== GameType.SUBGAME1) {\r\n\t\t\treturn iconCount ? config.normalRollOption.twoIconScaleY : config.normalRollOption.threeIconScaleY;\r\n\t\t} else {\r\n\t\t\treturn iconCount ? config.subGameRollOption.twoIconScaleY : config.subGameRollOption.threeIconScaleY;\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得相同图标个数 */\r\n\tprivate getAlikeIconCount(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 1;\r\n\t\tfor (let i = 0; i < this.showIconCount - 1; i++) {\r\n\t\t\tif ((this.iconArr[i].getId() === IconId.WILD1 || this.iconArr[i].getId() === IconId.WILD2) &&\r\n\t\t\t\tthis.iconArr[i].getId() === this.iconArr[i + 1].getId() &&\r\n\t\t\t\tthis.isWinIcon(i, rollerLaunchResult) && this.isWinIcon(i + 1, rollerLaunchResult)) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**暂停赢的图标 */\r\n\tpublic pauseWinIcon() {\r\n\t\tthis.iconArr.filter(v => v.getId() !== IconId.SCATTER).forEach(v => v.pauseWin());\r\n\t}\r\n\r\n\tprivate hideScatterAnimation() {\r\n\t\tthis.iconArr.filter(v => v.getId() === IconId.SCATTER).forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\t// console.log(\"222222222\",this.isRoll);\r\n\t\t\r\n\t\tif (this.isRoll) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// console.log(\"222222222\");\r\n\t\t// debugger\r\n\r\n\t\tif (!this.isMergeIcon) {\r\n\t\t\tthis.mergeIcon(this.propertyNode.props_big_icon, this.rollerLaunchResult);\r\n\t\t}\r\n\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (this.node.isValid) {\r\n\t\t\t\tconst icon = this.iconArr[index];\r\n\t\t\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\t\t\tif (icon.getId() !== IconId.WILD1 ||icon.getId() !== IconId.WILD2 || !this.isMergeIcon) {\r\n\t\t\t\t\ticon.playWin(this.propertyNode.props_big_icon)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 0.2)\r\n\t}\r\n\r\n\t/**是否是与金发同一列的图标 */\r\n\t// private isChangeJinFa(rollerLaunchResult: RollerLaunchResult,index,RollerId) {\r\n\t// \tconst wildRollerId = rollerLaunchResult.dl.si[0].wildRollerId\r\n\t// \tconst wp = rollerLaunchResult.dl.si[0].wp\r\n\t// \tfor (const key in wp) {\r\n\t// \t\tconst values = wp[key] as [];\r\n\t// \t\tconst iconIndexs = values.find(v => v[0] === RollerId)\r\n\t// \t\tif (iconIndexs ) {//&& iconIndexs[1] === index\r\n\t// \t\t\treturn true\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \treturn false\r\n\t// }\r\n\r\n\t/**播放金发wild动画\r\n\t * @param RollerId 滚轴的id值\r\n\t */\r\n\tpublic playJinFaWild(rollerLaunchResult: RollerLaunchResult, RollerId, done) {\r\n\t\tconsole.log(\"playJinFaWild\", RollerId);\r\n\t\tconst wildRollerId = rollerLaunchResult.dl.si[0].wildRollerId\r\n\t\tfor (let i = this.showIconCount - 1; i >= 0; i--) {\r\n\t\t\t\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tconsole.log(\"element\", element);\r\n\t\t\t// console.log(this.isChangeJinFa(rollerLaunchResult, i, RollerId));\r\n\t\t\t\r\n\t\t\tif (wildRollerId && wildRollerId.length > 0) {\r\n\t\t\t\t// if (i === 2) {\r\n\t\t\t\t\telement.playJinWild(this.propertyNode.props_big_icon, () => {\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tif (i !== 2) {\r\n\t\t\t\t\t\t\t\telement.changeToJinWild()\r\n\t\t\t\t\t\t\t\telement.faceNode.getComponent(UITransform).width = 160;\r\n\t\t\t\t\t\t\t\telement.faceNode.getComponent(UITransform).height = 146;\r\n\t\t\t\t\t\t\t\tif (i === 0) {\r\n\t\t\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\t\t\tdone && done()\r\n\t\t\t\t\t\t\t\t\t}, 1)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},1)\r\n\t\t\t\t\t})\r\n\t\t\t\t// } else {\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**播放甲壳虫动画 */\r\n\t// public playBeetleAnimation(done) {\r\n\t\t// let count = 0;\r\n\t\t// const beetleArr = this.iconArr.filter((v, index) => v.getId() === IconId.BEETLE && index < this.showIconCount)\r\n\t\t// if (beetleArr.length === 0) {\r\n\t\t// \tdone && done();\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\t// beetleArr.forEach(v => {\r\n\t\t// \tv.playBeetleAnimation(() => {\r\n\t\t// \t\tcount++;\r\n\t\t// \t\tif (count >= beetleArr.length) {\r\n\t\t// \t\t\tdone && done();\r\n\t\t// \t\t}\r\n\t\t// \t})\r\n\t\t// })\r\n\t// }\r\n\r\n\t/**播放一次scatter动画 */\r\n\tprivate playOneScatterAnimation() {\r\n\t\t// 小游戏2不播放\r\n\t\tif (this.isSubGame2()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\tconst element = this.iconArr[i];\r\n\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\telement.playWin(this.propertyNode.props_big_icon, false, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n\t/**播放scatter动画 进入小游戏 */\r\n\tpublic playScatterAnimation() {\r\n\t\t// this.hideIconWin();\r\n\t\tconst freeGame = cacheData.rollerLaunchResult && cacheData.rollerLaunchResult.dl.si[0].freegame;\r\n\t\tconst isLoop = Object.keys(freeGame).length > 0 ? true : false;\t\r\n\t\tif (isLoop) {\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tconst element = this.iconArr[i];\r\n\t\t\t\tif (element.getId() === IconId.SCATTER) {\r\n\t\t\t\t\telement.playScatterWin(this.propertyNode.props_big_icon, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconsole.log(\"roller over handle stop time \" + this.sendBetTime);\r\n\t\tthis.isRoll = false;\r\n\t\tthis.stopIconIndex = -1;\r\n\r\n\t\tthis.isSpeedBorder && this.setSpeedBorderStatus(false);\r\n\t\t// this.mergeIcon(this.propertyNode.props_big_icon, rollerLaunchResult);\r\n\t\tthis.playOneScatterAnimation();\r\n\t\t// 滚动结束时，只有在小游戏2才立马添加锁定图标\r\n\t\tthis.isSubGame2() && this.addLockIcon();\r\n\r\n\t\tGxfcV2_Audio.playOneShot(SoundPathDefine.beatDrum)\r\n\r\n\t\t// 滚动停止之后需要延迟的时间\r\n\t\tconst time = this.isSubGame2() ? 1.5 : 0.05;\r\n\t\tthis.events.onCheckNextLeftCount();\r\n\t\t// const time = 0.05;\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, time)\r\n\r\n\t}\r\n\r\n\r\n\r\n\t/**添加锁定图标 */\r\n\tpublic addLockIcon(isPlayAnimation: boolean = true) {\r\n\t\tif (!this.iconPool) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet playCount = 0;\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tlockValues.forEach(v => {\r\n\t\t\tlet GxfcV2Icon = this.lockIcons.find(iconv => iconv.getIconIndex() === v.index)\r\n\t\t\tif (!GxfcV2Icon) {\r\n\t\t\t\tconst iconConfig = config.icon.find(icon => icon.id === v.iconId)\r\n\t\t\t\tGxfcV2Icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, v.index);\r\n\t\t\t\t// if (!isPlayAnimation || GxfcV2Icon.isBeetleIcon()) {\r\n\t\t\t\t// \tGxfcV2Icon.setAmount(v.amount);\r\n\t\t\t\t// } else if (GxfcV2Icon.isSunGod()) {\r\n\t\t\t\t// \t// 播放太阳神出现的音效\r\n\t\t\t\t// \t// GxfcV2_Audio.playOneShot(SoundPathDefine.sunGod)\r\n\t\t\t\t// }\r\n\r\n\t\t\t\tconst replaceIcon = this.iconArr[v.index];\r\n\t\t\t\tGxfcV2Icon.setPosition(replaceIcon.getPosition())\r\n\t\t\t\treplaceIcon.restore();\r\n\r\n\t\t\t\tthis.iconArr[v.index] = GxfcV2Icon;\r\n\t\t\t\tthis.lockIcons.push(GxfcV2Icon)\r\n\r\n\t\t\t\tthis.removeSingleRollerIcon(v.index);\r\n\r\n\t\t\t\tisPlayAnimation && GxfcV2Icon.playBeetleAnimation(() => {\r\n\t\t\t\t\tGxfcV2Icon.hideWin();\r\n\t\t\t\t})\r\n\t\t\t\tplayCount++;\r\n\t\t\t\t// console.log(`addlockicon columnIndex ${this.columnIndex} index ${v.index} amount ${v.amount}, this.lockIcons.length ${this.lockIcons.length}`);\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn playCount;\r\n\t}\r\n\r\n\tprivate removeSingleRollerIcon(index: number) {\r\n\t\tfor (let i = 0; i < this.singleIconRollerViewModels.length; i++) {\r\n\t\t\tconst element = this.singleIconRollerViewModels[i];\r\n\t\t\tif (element.comp.getSlotIndex() === index) {\r\n\t\t\t\telement.unMount();\r\n\t\t\t\tthis.singleIconRollerViewModels.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**删除锁定图标 */\r\n\tpublic removeLockIcon() {\r\n\t\tthis.lockIcons.forEach(v => v.destory());\r\n\t\tthis.lockIcons = [];\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number, gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst halfHeight = height / 2;\r\n\t\tconst paddingBottom = this.getRollerPaddingBottom(gameType)\r\n\t\tlet y = 0;\r\n\t\tif (index === 0) {\r\n\t\t\t// 第一个图标的坐标位置 = 下边距 + icon高度的一半\r\n\t\t\ty = paddingBottom + halfHeight;\r\n\t\t} else {\r\n\t\t\t// 从第二开始的坐标 = 下边距 + icon高度的一半 + 图标间隔个数 + icon高度个数\r\n\t\t\tconst interval = this.getIntervalHeight(gameType) * index\r\n\t\t\ty = paddingBottom + halfHeight + interval + height * index;\r\n\t\t}\r\n\t\ty -= this.getIconContainerAnchorPos();\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得图标容器锚点的起始位置 */\r\n\tprivate getIconContainerAnchorPos() {\r\n\t\tconst iconListUI = this.propertyNode.props_icon_list.getComponent(UITransform)\r\n\t\treturn iconListUI.height * iconListUI.anchorY\r\n\t}\r\n\r\n\tpublic changeRollerHeight(gameType: GameType) {\r\n\t\tlet rollerHeight = config.normalRollOption.rollerHeight\r\n\t\tif (gameType === GameType.SUBGAME2) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight2;\r\n\t\t} else if (gameType === GameType.SUBGAME1) {\r\n\t\t\trollerHeight = config.subGameRollOption.rollerHeight1;\r\n\t\t}\r\n\t\tthis.propertyNode.props_icon_list.getComponent(UITransform).height = rollerHeight;\r\n\r\n\r\n\t\tif (this.isMergeIcon) {\r\n\t\t\tconsole.log(`bigNode11 setWorldPosition begin`, this.bigNode.getWorldPosition().x, this.bigNode.getWorldPosition().y);\r\n\t\t\tconst pos = this.getMergeIconPos(this.rollerLaunchResult, gameType);\r\n\t\t\t// 重新设置合并图标位置\r\n\t\t\t// this.bigNode.setWorldPosition(pos);\r\n\t\t\tconsole.log(`bigNode11 setWorldPosition end`, pos.x, pos.y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**重置图标位置 */\r\n\tpublic resetIconPos(gameType: GameType) {\r\n\t\tthis.changeRollerHeight(gameType);\r\n\t\tif (gameType !== GameType.SUBGAME2) {\r\n\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\tconst pos = this.getIconPosByIndex(i, gameType);\r\n\t\t\t\ticon.setPosition(pos);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isMergeIcon) {\r\n\t\t\t// console.log(`bigNode setWorldPosition begin`, this.bigNode.getWorldPosition().x, this.bigNode.getWorldPosition().y);\r\n\t\t\tconst pos = this.getMergeIconPos(this.rollerLaunchResult, gameType);\r\n\t\t\t// 重新设置合并图标位置\r\n\t\t\tthis.bigNode.setWorldPosition(pos);\r\n\t\t\t// console.log(`bigNode setWorldPosition end`, pos.x, pos.y);\r\n\t\t\tlet iconCount = this.getAlikeIconCount(this.rollerLaunchResult);\r\n\t\t\tthis.bigNode.setScale(new Vec3(1, this.getBigNodeScaleY(iconCount, gameType)));\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换单个滚动图标 */\r\n\tpublic replaceSingleRollerIcon() {\r\n\t\tthis.addLockIcon(false);\r\n\r\n\t\tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\tconst v = this.iconArr[i];\r\n\t\t\t// 替换不是甲壳虫和太阳神图标\r\n\t\t\t// if (!this.isSubGame2SpecialIcon(v.getId())) {\r\n\t\t\tif (!lockValues.find(lock => lock.index === i)) {\r\n\t\t\t\tthis.buildSingleRollerIcon(i, v.getPosition(), v);\r\n\t\t\t\tv.getNode().active = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**替换多个滚动图标 */\r\n\tpublic replaceMultiRollerIcon() {\r\n\t\tthis.singleIconRollerViewModels.forEach(v => {\r\n\t\t\tconst firstIcon = v.comp.getFirstIcon();\r\n\t\t\tfirstIcon.getNode().removeFromParent();\r\n\r\n\t\t\tconst index = v.comp.getSlotIndex();\r\n\t\t\tthis.propertyNode.props_icon_list.addChild(firstIcon.getNode());\r\n\t\t\tfirstIcon.setPosition(this.getIconPosByIndex(index))\r\n\t\t\tthis.iconArr[index] = firstIcon;\r\n\r\n\t\t\tv.unMount();\r\n\t\t})\r\n\r\n\t\t// 只有从小游戏2退出去的才隐藏甲壳虫上面的数字\r\n\t\tif (this.props.gameTypeInfo.lastGameType === GameType.SUBGAME2 ||\r\n\t\t\tthis.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\t// 在切到游戏之后，把甲壳虫上面的数字隐藏了\r\n\t\t\tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t\t\t\tif (i >= this.iconArr.length) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tconst v = this.iconArr[i];\r\n\t\t\t\t// if (v.isBeetleIcon() || v.getId() === IconId.SUN_GOD) {\r\n\t\t\t\t// \tv.hideAmount();\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.lockIcons = [];\r\n\t\tthis.singleIconRollerViewModels = [];\r\n\t}\r\n\r\n\t/**构建单个图标滚动 */\r\n\tprivate buildSingleRollerIcon(index: number, pos: Vec3, icon: GxfcV2Icon) {\r\n\t\t// const viewModel = new GxfcV2SingleIconRollerViewModel()\r\n\t\t// \t.mountView(sourceManageSeletor().getFile(PrefabPathDefine.SINGLE_ICON_ROLLER).source)\r\n\t\t// \t.appendTo(this.propertyNode.props_icon_list);\r\n\t\t// viewModel.viewNode.getComponent(UITransform).width = config.subGameRollOption.singleIconMaskWidth;\r\n\t\t// viewModel.viewNode.getComponent(UITransform).height = config.subGameRollOption.singleIconMaskHeight;\r\n\t\t// this.singleIconRollerViewModels.push(viewModel);\r\n\t\t// viewModel.viewNode.setPosition(pos);\r\n\r\n\t\t// viewModel.comp.initSlot(this.columnIndex, index, icon.getIconIndex(), this.iconPool);\r\n\t}\r\n\r\n\tprivate getRollerPaddingBottom(gameType: GameType = undefined) {\r\n\t\tif (gameType === undefined) {\r\n\t\t\tgameType = this.props.gameTypeInfo.viewGameType;\r\n\t\t}\r\n\t\tif (gameType === GameType.SUBGAME1) {\r\n\t\t\treturn config.subGameRollOption.rollerPaddingBottom;\r\n\t\t}\r\n\t\treturn config.normalRollOption.rollerPaddingBottom;\r\n\t}\r\n\r\n\t/**多图标滚动 */\r\n\tprivate multiIconRoller() {\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - this.getRollSpeed()));\r\n\t\t})\r\n\r\n\t\tconst frist = this.iconArr[0];\r\n\t\t// 图标隐藏的Y坐标 = 图标一半高度 + 滚轴下内边距 + 容器锚点的高度\r\n\t\tlet iconHideY = -(frist.getHeight() / 2 + this.getRollerPaddingBottom())\r\n\t\ticonHideY -= this.getIconContainerAnchorPos()\r\n\t\tif (frist.getPosition().y <= iconHideY) {\r\n\t\t\t// console.log(`columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex}, rollerCount:${this.rollerCount}`);\r\n\t\t\tif (this.rollerCount >= 0) {\r\n\t\t\t\tthis.rollerCount++;\r\n\t\t\t}\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[2]\r\n\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\t// console.log(`xxxxxxxxxxx-----columnIndex:${this.columnIndex},stopIconIndex:${this.stopIconIndex},endIcon.getIconIndex():${endIcon.getIconIndex()},this.getStopIconIndex():${this.getStopIconIndex()}`);\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\r\n\t\t\t\tconst duration = 0.1;\r\n\t\t\t\t// 结束之后计算每个图标的最终位置，\r\n\t\t\t\tfor (let i = 0; i < this.iconArr.length; i++) {\r\n\t\t\t\t\tconst icon = this.iconArr[i];\r\n\t\t\t\t\ttween(icon.getNode()).to(duration, { position: this.getIconPosByIndex(i) }).start();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if(this.isSubGame1() && )\r\n\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t}, duration)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isMultiRoll() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN || this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**停止单个图标的滚动 */\r\n\tprivate stopSingleRollerIcon(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet count = 0;\r\n\t\tif (this.singleIconRollerViewModels.length === 0) {\r\n\t\t\tthis.isRoll = false;\r\n\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t} else {\r\n\t\t\tthis.singleIconRollerViewModels.forEach(v => v.comp.stopRoll(this.stopIconIndex, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.singleIconRollerViewModels.length) {\r\n\t\t\t\t\tthis.isRoll = false;\r\n\t\t\t\t\tthis.node.isValid && this.rollOverHandle(this.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t}, rollerLaunchResult));\r\n\t\t}\r\n\t}\r\n\r\n\t/**获得甲壳虫上面的数字节点 */\r\n\t// public getBeetleNode(isIncludeSunGod: boolean = false) {\r\n\t// \tconst nodes: GxfcV2Icon[] = [];\r\n\t// \tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t// \t\tconst element = this.iconArr[i];\r\n\t// \t\t// 获得太阳神图标，数字必须要大于0的\r\n\t// \t\tconst isSunGod = isIncludeSunGod && element.getId() === IconId.SUN_GOD && element.getAmount() > 0;\r\n\t// \t\tif (element.getId() === IconId.BEETLE || isSunGod) {\r\n\t// \t\t\tnodes.push(element);\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \treturn nodes;\r\n\t// }\r\n\r\n\t/**获得太阳神图标 */\r\n\t// public getSunGodIconNode() {\r\n\t// \tconst lockValues = getColumnLockIconArr(this.getFixedChessboardIcon(), this.columnIndex)\r\n\t// \tfor (let i = 0; i < this.showIconCount; i++) {\r\n\t// \t\tconst element = this.iconArr[i];\r\n\t// \t\t// 并且要是锁定的图标\r\n\t// \t\tif (element.getId() === IconId.SUN_GOD && element.getAmount() === 0 && lockValues.find(v => v.index === i)) {\r\n\t// \t\t\treturn element;\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \treturn undefined;\r\n\t// }\r\n\r\n\tprotected onDestroy(): void {\r\n\t\tthis.isRoll = false;\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll && this.iconArr.length > 0) {\r\n\t\t\tif (this.isMultiRoll()) {\r\n\t\t\t\tthis.multiIconRoller();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}