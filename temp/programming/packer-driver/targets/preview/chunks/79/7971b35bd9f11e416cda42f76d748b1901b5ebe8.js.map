{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/starlight/components/Starlight_Roller.ts"],"names":["_decorator","Mask","Node","sp","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","RollerIconViewModel","sourceManageSeletor","starlight_Audio","PrefabPathDefine","config","endRollingAction","SkeletonAnimationPlayer","dataTransfer","DataKeyType","SoundPathDefine","ccclass","property","Starlight_Roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","coordList","rollerHeight","rollConfig","normalRollOption","timeCounter","scrollInterval","renderState","scatterCount","destructionIsComplete","multiple","itemHeight","winningData","multiplierIcon","propertyNode","props_roller","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","time","isHasten","events","rollStart","setMask","bl","rollEnd","rollerIndex","setRoleAttack","isState","effectEnd","start","initState","roundEnd","bindEvent","useProps","key","value","pre","initRoller","rolling","cur","setState","effectLength","length","effectCount","itemEffectEnd","reScroll","playOneShot","SCATTERT_RIGGER","filter","i","isUnMount","isReScroll","item","indexOf","setProps","scheduleOnce","WIN1","unMount","then","l","sparkling","callback","count","forEach","comp","palyScatter","multiplier","callBack","playallPurpose","getDestroyed","state","children","renderIcons","index","x","y","getPosition","yp","getRollerHeight","to","position","easing","call","creator","iconViewModel","joinIcon","insideCount","active","node","iconData","iconQueue","getComponent","height","intervalHeight","direction","DOWN","py","iconId","push","getChildByName","setPosition","Skeleton","TheNameOfTheAnimation","playAnimation","DROP_DOWN","maxCount","j","LargeRoller","largeRollOption","width","left","intervalWidth","right","rateItem","RATES","find","mountView","getFile","ICON","source","appendTo","speed","cache","bindUI","useState","enabled","window","setInterval","iconMv","undefined","isResetConditionMet","nodeHeight","scrollElement","_node","z","dispatch","destroyAllChildren","timer","stopIconIndex","clearInterval","update","deltaTime","getRoundEnd","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, log, Mask, Node, sp, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { sourceManageSeletor, starlight_Audio, winShowViewModel } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction } from '../store/actions/roller';\r\nimport SkeletonAnimationPlayer from '../SkeletonPlay';\r\nimport dataTransfer, { DataKeyType } from '../dataTransfer';\r\nimport { getNodePositionInCanvas } from '../../../utils/tool';\r\nimport { changeMultipleTotal } from '../store/actions/game';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[],\r\n\t\ttime: number\r\n\t}\r\n\tisHasten: boolean\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\tsetMask?: (bl) => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n\tsetRoleAttack?: (isState: number) => void\r\n\teffectEnd?: () => void\r\n}\r\n\r\n@ccclass('Starlight_Roller')\r\nexport class Starlight_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\tprivate coordList: Array<number> = []\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\tprivate timeCounter = 0\r\n\tprivate scrollInterval: number = 0.3; // 滚动间隔，可以根据需求调整\r\n\tprivate renderState = false;\r\n\tprivate scatterCount=0\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tdestructionIsComplete = false // 图标销毁情况\r\n\tmultiple = 0 //倍数\r\n\tprivate itemHeight = 0\r\n\tprivate winningData=[]\r\n\tprivate multiplierIcon=[]\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\t//props_daqipao: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: [],\r\n\t\t\ttime: 0\r\n\t\t},\r\n\t\tisHasten: false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\tsetMask: (bl) =>  { },\r\n\t\trollEnd: (rollerIndex: number) => { },\r\n\t\tsetRoleAttack: (isState) => { },\r\n\t\teffectEnd: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif(key === 'isHasten'){\r\n\t\t\tthis.scrollInterval=!this.props.isHasten?0.1:0.3\r\n\t\t}\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\t//this.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\tthis.renderState = true\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\tthis.winningData=[]\r\n\t\t\t\t\tthis.multiple = 0\r\n\t\t\t\t\tthis.multiplierIcon=[]\r\n\t\t\t\t\tthis.scatterCount=0\r\n\t\t\t\t\tthis.events.setRoleAttack(0)\r\n\t\t\t\t\t//  this.events.setMask(true)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\tconst effectLength = this.props.iconEffectData.iconEffectArr.length\r\n\t\t\tlet effectCount = 0;\r\n\t\t\tconst itemEffectEnd = () => {\r\n\t\t\t\teffectCount++;\r\n\t\t\t\tif (effectCount >= effectLength) {\r\n\t\t\t\t\t// this.events.effectEnd();\r\n                    this.reScroll(true) // 重新滚动\r\n                    starlight_Audio.playOneShot(SoundPathDefine.SCATTERT_RIGGER)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.destructionIsComplete = false\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tlet isReScroll = false\r\n\t\t\t//console.log(this.props.iconEffectData);\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t// const index = this.props.rollerType.direction === DirectionType.DOWN ? i : (this.displayIconList.length - 1 - i)\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst item = this.displayIconList[i]\r\n\t\t\t\t// console.log('clear --------- ' , this.props.rollerType.index, JSON.stringify(item.comp.props.iconData), i,\r\n\t\t\t\t// \tJSON.stringify(this.props.iconEffectData.iconEffectArr), this.props.iconEffectData.iconEffectArr.indexOf(i));\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(i) !== -1) {\r\n\t\t\t\t\tisReScroll = true;\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\tstarlight_Audio.playOneShot(SoundPathDefine.WIN1)\r\n\t\t\t\t\t\titem.unMount().then(() => {\r\n\t\t\t\t\t\t\titemEffectEnd();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, 1.2)\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.destructionIsComplete = true\r\n\r\n\t\t}\r\n\t}\r\n\tsparkling(callback){\r\n\t\tlet count=0\r\n\t\tif(this.winningData.length>0){\r\n\t\t\tthis.winningData.length>0&&this.winningData.forEach((item,i)=>{\r\n\t\t\t\titem.comp.palyScatter(true,()=>{\r\n\t\t\t\t\tcount++\r\n\t\t\t\t\tif(count>=this.winningData.length){\r\n\t\t\t\t\t\tcallback()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tcallback()\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tmultiplier(callBack){ // 倍数相乘特效\r\n\t\tlet count=0\r\n\t\tif(this.multiplierIcon.length>0){\r\n\t\t\tthis.multiplierIcon.forEach(item=>{\r\n\t\t\t\titem.comp.playallPurpose(()=>{\r\n\t\t\t\t\tcount++\r\n\t\t\t\t\tif(count>=this.winningData.length){\r\n\t\t\t\t\t\tcallBack()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t}else{\r\n\t\t\tcallBack()\r\n\t\t}\r\n\t}\r\n\tpublic getDestroyed() {\r\n\t\treturn this.destructionIsComplete\r\n\t}\r\n\tprivate reScroll(state?) { // 重新滚动\r\n\t\tlet length = this.propertyNode.props_roller.children.length\r\n\t\tif (length === 5) {\r\n\t\t\treturn;\r\n\t\t} else if (length === 0) {\r\n\t\t\tthis.renderIcons(length, state)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.propertyNode.props_roller.children.forEach((item, index) => {\r\n\t\t\t\tlet { x, y } = item.getPosition()\r\n\t\t\t\tlet yp = -this.getRollerHeight() + index * this.itemHeight + (this.itemHeight / 2)\r\n\t\t\t\ttween(item)\r\n\t\t\t\t\t.to(this.scrollInterval, { position: new Vec3(x, yp, 1) }, { easing: 'cubicIn' }) // 使用 to 缓动到新位置\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\t// 在动画完成后执行操作\r\n\t\t\t\t\t\tif (index === length - 1) {\r\n\t\t\t\t\t\t\tthis.renderIcons(length, state)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\tif (y !== yp) {\r\n\t\t\t\t\t\t\ttween(item).to(0.08, { position: new Vec3(x, yp + 8, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\t\t\t\t\t\t// .to(0.05, { position: new Vec3(x, yp - 6, 1) }, { easing: 'sineIn' }) // 回弹向下\r\n\t\t\t\t\t\t\t\t// .to(0.05, { position: new Vec3(x, yp + 3, 1) }, { easing: 'sineOut' }) // 再次回弹向上\r\n\t\t\t\t\t\t\t\t.to(0.05, { position: new Vec3(x, yp, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t\t\t\t\t\t\t.call(()=>{\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.start()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\tprivate creator() {\r\n\t\tconst iconViewModel = this.joinIcon()\r\n\t\tconst insideCount = this.propertyNode.props_roller.children.filter(i => i.active).length - 1\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tthis.itemHeight = itemHeight\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\tlet py = -this.getRollerHeight() + (itemHeight / 2) + (insideCount * itemHeight)\r\n\t\t\ttween(iconViewModel.comp.node)\r\n\t\t\t\t.to(this.scrollInterval, { position: new Vec3(position.x, py, 1) }, { easing: 'cubicIn' }) // 使用 to 缓动到新位置\r\n\t\t\t\t.call(() => {\r\n\t\t\t\t\t// 在动画完成后执行操作\r\n\t\t\t\t\tif(iconViewModel.iconId == 10){\r\n\t\t\t\t\t\tthis.winningData.push(iconViewModel)\r\n\t\t\t\t\t\t// iconViewModel.comp.playAni(true)\r\n\t\t\t\t\t\t// // this.events.setMask(false)\r\n\t\t\t\t\t\t// let zindex=iconViewModel.comp.node._siblingIndex\r\n\t\t\t\t\t\t// iconViewModel.comp.node.setSiblingIndex(100)\r\n\t\t\t\t\t\t// this.scheduleOnce(()=>{\r\n\t\t\t\t\t\t// \t// this.events.setMask(true)\r\n\t\t\t\t\t\t// \ticonViewModel.comp.node.setSiblingIndex(zindex)\r\n\t\t\t\t\t\t// },1)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iconViewModel.iconId > 10) {\r\n\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').setPosition(new Vec3(0, -300 + (insideCount * itemHeight) + itemHeight / 2, 1))\r\n\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').active = true\r\n\t\t\t\t\t\t// if(iconViewModel.iconId>11){\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\tnew SkeletonAnimationPlayer(this.node.getChildByName('shandian_icon').getComponent(sp.Skeleton), iconViewModel.TheNameOfTheAnimation, false, () => {\r\n\t\t\t\t\t\t\tthis.node.getChildByName('shandian_icon').active = false\r\n\t\t\t\t\t\t\t// let props_label_rate_num=iconViewModel.comp.node.getChildByName('props_label_rate_num')\r\n\t\t\t\t\t\t\t// let node = instantiate(props_label_rate_num)\r\n\t\t\t\t\t\t\t// const beginPosition = getNodePositionInCanvas(node)\r\n\t\t\t\t\t\t\t// let parentNode = winShowViewModel.comp.getPropertyNode().props_label_gold as Node\r\n\t\t\t\t\t\t\t// const targetPosition = getNodePositionInCanvas(parentNode)\r\n\t\t\t\t\t\t\t// node.setPosition(new Vec3(targetPosition))\r\n\t\t\t\t\t\t}).playAnimation();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.to(0.08, { position: new Vec3(position.x, py + 8, 1) }, { easing: 'sineOut' }) // 初次回弹向上\r\n\t\t\t\t.to(0.05, { position: new Vec3(position.x, py, 1) }, { easing: 'sineIn' }) // 最终回到原位\r\n\t\t\t\t.start();\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -(insideCount * itemHeight) - (itemHeight / 2), 1))\r\n\t\t}\r\n\t\tthis.coordList.push(iconViewModel.comp.node.position.y)\r\n\t\treturn iconViewModel\r\n\t}\r\n\trenderIcons(i?, state?) {\r\n\t\t// console.log('renderIcons -- index: ', this.props.rollerType.index, 'count: ', i ,'stopIconIndex: ', this.props.rollerType.stopIconIndex)\r\n\t\tstarlight_Audio.playOneShot(SoundPathDefine.DROP_DOWN, 1, false)\r\n\t\tlet count = i || 0;\r\n\t\tconst maxCount = 5;\r\n\t\tfor (let j = count; j < maxCount; j++) {\r\n\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\tthis.lastInsertIconViewModel = this.creator();\t\t\t\r\n\t\t\t\t}, j * 0.05)\r\n\t\t\t} else {\r\n\t\t\t\tbreak; // 如果方向不是 DOWN，跳出循环\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**初始化 */\r\n\tprivate initRoller() {\r\n\t\t//取队列最后n个图标\r\n\t\t// const iconQueue = [...this.props.iconQueue]\r\n\t\t// const iconQueue = clone(this.props.iconQueue)\r\n\t\tthis.rollConfig = this.props.rollerType.LargeRoller ? config.largeRollOption : config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\tthis.renderIcons()\r\n\t}\r\n\r\n\t/**添加图标 */\r\n\tprivate joinIcon() {\r\n\t\t//滑槽中的图表数\r\n\t\t//下一个要加入的图标\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tif (iconData.iconId > 10) {\r\n\t\t\tconst rateItem = dataTransfer(DataKeyType.RATES).find(item => item[2] === iconData.iconId && this.props.rollerType.index === item[0]);\r\n\t\t\tif (rateItem) {\r\n\t\t\t\ticonData.multiple = rateItem[3];\r\n\t\t\t\tthis.multiple += rateItem[3];\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst iconViewModel: any = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source).appendTo(this.propertyNode.props_roller).setProps({ iconData })\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\t//icon的高度加上上下纵向高度\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY + itemHeight - this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex++\r\n\t\t\tthis.nextJoinIconIndex === this.props.rollerType.iconQueue.length && (this.nextJoinIconIndex = 0)\r\n\t\t\tthis.compensation = iconViewModel.comp.node.position.y\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY - itemHeight + this.props.rollerType.speed, 1))\r\n\t\t\tthis.nextJoinIconIndex--\r\n\t\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t}\r\n\t\tif (iconData.iconId == 10) {\r\n\t\t\ticonViewModel.iconId = iconData.iconId\r\n\t\t\tthis.scatterCount++\r\n\t\t\tif(this.scatterCount>3){\r\n\t\t\t\tthis.events.setRoleAttack(1)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (iconData.iconId > 10) {\r\n\t\t\ticonViewModel.iconId = iconData.iconId\r\n\t\t\tswitch (iconData.iconId) {\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_green\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 12:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_blue\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 13:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_purple\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 14:\r\n\t\t\t\t\ticonViewModel.TheNameOfTheAnimation = \"sd_red\"\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis.events.setRoleAttack(2)\r\n\t\t\tthis.multiplierIcon.push(iconViewModel)\r\n\t\t\t// this.events.setRoleAttack(1)\r\n\t\t}\r\n\t\t// this.events.setRoleAttack(true)\r\n\t\tthis.displayIconList.push(iconViewModel)\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns\r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\t\t}, [\"roundEnd\"])\r\n\t\t!this.timer_clear && (this.timer_clear = window.setInterval(() => {\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(iconMv => {\r\n\t\t\t\tif (iconMv.isUnMount) {\r\n\t\t\t\t\ticonMv = undefined\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t}, 200))\r\n\t}\r\n\tisResetConditionMet(index, node, rollerHeight) { \r\n\t\tconst nodeHeight = node.getComponent(UITransform).height;\r\n\t\treturn this.timeCounter != 0 && index === this.displayIconList.length - 1 && \r\n\t\t\t   node.getPosition().y <= -(rollerHeight + nodeHeight * 5);\r\n\t}\r\n\r\n\tprivate scrollElement() {\r\n\t\tconst rollerHeight = this.getRollerHeight(true);\r\n\t\tthis.displayIconList.filter(item => item.comp.node && item.comp.node.active).forEach((iconMv, i) => {\r\n\t\t\tconst _node = iconMv.comp.node\r\n\t\t\tconst { x, y, z } = _node.getPosition()\r\n\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\t_node.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t\tif (this.isResetConditionMet(i, _node, rollerHeight)) {\r\n\t\t\t\t\tthis.timeCounter = 0\r\n\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t// starlight_Audio.playOneShot(SoundPathDefine.DROP_DOWN)\r\n\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\tthis.propertyNode.props_roller.destroyAllChildren()\t// 超过底部卸载所以node\r\n\t\t\t\t\tlet timer = setInterval(() => {\r\n\t\t\t\t\t\tif (!this.props) {\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex && this.props.rollerType.stopIconIndex != -1) { // 接口返回停止下标才开始掉落\r\n\t\t\t\t\t\t\tclearInterval(timer)\r\n\t\t\t\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.stopIconIndex - 1\r\n\t\t\t\t\t\t\tthis.renderIcons(this.propertyNode.props_roller.children.length)\r\n\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\t\tif (this.props.rollerType.index === 5 && this.renderState) { //避免触发多次\r\n\t\t\t\t\t\t\t\t\tthis.renderState = false\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 0.5)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 100)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.props.rollerType.rolling) {\r\n\t\t\tthis.timeCounter += 0.05\r\n\t\t\tif (this.timeCounter >= this.scrollInterval * this.props.rollerType.index) {\r\n\t\t\t\tthis.scrollElement();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n\r\n"]}