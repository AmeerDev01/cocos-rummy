{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/BindPhoneViewModel.ts"],"names":["BindPhoneViewModel","ViewModel","ApiUrl","ToastType","addToastAction","SKT_MAG_TYPE","sktInstance","sktMsgListener","fetcher","lang","constructor","begin","add","MODIFY_BIND_PHONE","dispatch","content","write","k","BindPhoneModule","BindPhoneChange","placeStr","type","SUCCESS","comp","events","onClosePanel","setEvent","sendSmsCode","phoneNumber","Promise","reslove","reject","send","SEND_SMS","phone","then","rsp","BindPhoneSend","catch","e","BindPhonesSendError","modifyPhoneDone","verificationCode","sendSktMessage","unMountCallBack","removeById","connect","storeState","store","getState","inject","memberInfo","state"],"mappings":"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","sourcesContent":["import { Node } from \"cc\"\r\nimport ViewModel from \"../../base/ViewModel\"\r\nimport { Hall_BindPhonePanel, IProps, IEvent } from \"../components/Hall_BindPhonePanel\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport Fetcher from \"../../utils/Fetcher\"\r\nimport { ApiUrl } from \"../apiUrl\"\r\nimport { ToastType, addToastAction } from \"../store/actions/baseBoard\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { fetcher, lang } from \"../index\"\r\n\r\nclass BindPhoneViewModel extends ViewModel<Hall_BindPhonePanel, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_BindPhonePanel')\r\n  }\r\n\r\n  protected begin() {\r\n    sktMsgListener.add(SKT_MAG_TYPE.MODIFY_BIND_PHONE, 'bindPhone', () => {\r\n      this.dispatch(addToastAction({ content: lang.write(k => k.BindPhoneModule.BindPhoneChange,{},{ placeStr:\"修改成功~\" }), type: ToastType.SUCCESS }))\r\n      this.comp.events.onClosePanel()\r\n    })\r\n    this.setEvent({\r\n      sendSmsCode: (phoneNumber: string) => {\r\n        return new Promise((reslove, reject) => {\r\n          fetcher.send(ApiUrl.SEND_SMS, { phone: phoneNumber }).then((rsp) => {\r\n            this.dispatch(addToastAction({ content: lang.write(k => k.BindPhoneModule.BindPhoneSend,{},{ placeStr:\"验证信息已经发送，请注意查收\" }) }))\r\n            reslove(rsp)\r\n          }).catch((e) => {\r\n            this.dispatch(addToastAction({ content: lang.write(k => k.BindPhoneModule.BindPhonesSendError,{},{ placeStr:\"请求失败：${e}\" }) }))\r\n            reject(e)\r\n          })\r\n        })\r\n      },\r\n      modifyPhoneDone: (phoneNumber: string, verificationCode: string) => {\r\n        sktInstance.sendSktMessage(SKT_MAG_TYPE.MODIFY_BIND_PHONE, { phone: phoneNumber, verificationCode })\r\n      }\r\n    })\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    sktMsgListener.removeById(\"bindPhone\")\r\n  }\r\n  public connect() {\r\n    const storeState = this.store.getState() as StateType;\r\n    this.inject({\r\n      phone: storeState.memberInfo.phone\r\n    }, (state: StateType) => {\r\n      return {\r\n        phone: state.memberInfo.phone\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default BindPhoneViewModel"]}