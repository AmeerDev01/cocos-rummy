{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/thorV2/components/ThorV2_RollerPanel.ts"],"names":["_decorator","instantiate","Label","tween","Vec3","BaseComponent","IconPool","config","ThorV2RollerViewModel","DialogType","GameType","getBigWinConfig","RollerStatus","updateRollerStatus","cacheData","playWinOddsAnimation","updateFreeGameOdds","updateGold","updateSubGameAnimationPlayInfo","updateSubGameWinloss","updateWinIconDataItem","updateWinloss","thorv2_Audio","mainViewModel","sourceManageSeletor","PrefabPathDefine","SoundPathDefine","global","setLoadingAction","ccclass","property","ThorV2_RollerPanel","rollerViewModelArr","iconPool","icon","inStop","isWaitEnding","sendBetTime","propertyNode","props","rollerStatus","END","isSpeed","isManualSpeed","autoLauncherInfo","gameTypeInfo","lastGameType","MAIN","currGameType","viewGameType","leftCount","winloss","subGameWinloss","freeGameOdds","events","start","initState","initRoller","i","columnCount","column","getFile","ROLLER","source","roller","mountView","appendTo","node","connect","push","setEvent","onCheckNextLeftCount","initSlot","forEach","v","index","comp","startRoll","console","log","playOneShot","ROLLER_BEGIN","dispatch","unscheduleAllCallbacks","count","length","setWaitReturnSchedule","scheduleOnce","hallDispatch","isShow","waitDataReturnTime","speedRoller","speed","stopRollAll","rollerLaunchResult","RUNNING","ENDING","playStopRollSound","stopIconIndex","dl","si","rollerId","stopRoll","isValid","rollEndHandle","DROP_BOTTOM","QUICK_STOP","clearIconPositions","getClearIconPos","clearFlowHandle","playScatterAnimation","done","clearRoundDatas","updateEndStatus","clearIconHandle","otherGameAttributesVo","itemTotalMultiplier","flyFreeGameTotalOdds","isFly","playOddsAnimation","playLabelAnimation","isChangeGame","overHandle","isUpdateGold","changeGameHandle","totalRewards","overHandleBeforeHandle","isSubGame1","subGameOverHandle","bigWinConfig","magnification","playBigWinHandle","firstDelayTime","freeGameAmount","gameFreeGametotalMultiplier","delay","call","getTotalOdds","odds","rates","isFlyTotalOdds","parentNode","viewNode","endPos","getWinOddsPosition","oddsIcons","concat","getOddsLabelNodes","isMoreOddsLabel","intervalTime","normalRollOption","oddsLabelAnimationParam","moreIntervalTime","playSingleLabelAnimation","getOddsLabelNode","isEnd","playWinlossAnimation","getOddsLabelValue","time","Date","now","timeScale","params","labelNode","oddsLabel","getComponent","string","parseInt","toUpperCase","replace","labelTemp","active","addChild","setWorldPosition","worldPosition","WILD_FLASH","delayTime","magnifyTime","magnifyScale","lessenTime","lessenScale","to","scale","destroy","clearRoundData","doneHandle","clearIconDatas","SP_WIN","SP_WIN_SHOW","showPlayWinAmount","columnIndex","clearIcon","iconIndex","addIconHandle","clearAfterFillIconHandle","rounds","splitClearRoundData","round","sort","v1","v2","getMiddleOrder","winIconData","winIconDatas","iconData","playAmount","amount","roundData","data","iconDataTemp","isIconType","itemId","playWinAudio","showDialogWin","isSubGame","changeToSubGame","changeToMainGame","enterExitSubGame","dialogType","FREE_GAME_ENTRY","freeCount","gameType","param","balanceAfterSettlement","FREE_GAME_SETTLEMENT","isMain","SUBGAME1","SUBGAME2","getIsSpeed","singleResults","results","wp","winningPosition","gameWinningVos","map","key","iconPositions","iconPosition","clearIconData","find","bindEvent","useProps","value","cur","changeGame","position","rollerWindowX","rollerWindowY","subGameRollOption","isWinWild","element","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Label, Layout, Node, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport ThorV2RollerViewModel from '../viewModel/ThorV2RollerViewModel';\r\nimport { AutoLauncherInfo, ClearIconData, ClearRoundData, DialogType, GameType, GameTypeInfo, getBigWinConfig, isAuto, RollerLaunchResult, RollerStatus, WinIconData } from '../type';\r\nimport { updateRollerStatus } from '../store/actions/roller';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { changeGame, playWinOddsAnimation, updateFreeGameOdds, updateGold, updateSubGameAnimationPlayInfo, updateSubGameWinloss, updateWinIconDataItem, updateWinloss } from '../store/actions/game';\r\nimport { thorv2_Audio, mainViewModel, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { ThorV2Icon } from './ThorV2_Icon';\r\nimport { global } from '../../../hall';\r\nimport { setLoadingAction } from '../../../hall/store/actions/baseBoard';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\t/**滚动状态 */\r\n\trollerStatus: RollerStatus,\r\n\t/**是否加速 */\r\n\tisSpeed: boolean,\r\n\tisManualSpeed: boolean,\r\n\t/** 自动运行信息 */\r\n\tautoLauncherInfo: AutoLauncherInfo,\r\n\t/**游戏类型信息 */\r\n\tgameTypeInfo: GameTypeInfo,\r\n\t/**总输赢 */\r\n\twinloss: number,\r\n\t/** 小游戏的总输赢 */\r\n\tsubGameWinloss: number,\r\n\t/**免费游戏倍数 */\r\n\tfreeGameOdds: number,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('ThorV2_RollerPanel')\r\nexport class ThorV2_RollerPanel extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tprivate rollerViewModelArr: ThorV2RollerViewModel[] = [];\r\n\tprivate iconPool: IconPool = new IconPool(config.icon);\r\n\tprivate inStop = false;\r\n\r\n\tprivate isWaitEnding = false;\r\n\r\n\tprivate sendBetTime = 0;\r\n\r\n\tprotected propertyNode = {\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\t/**滚动状态 */\r\n\t\trollerStatus: RollerStatus.END,\r\n\t\tisSpeed: false,\r\n\t\tisManualSpeed: false,\r\n\t\tautoLauncherInfo: null,\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.MAIN,\r\n\t\t\tcurrGameType: GameType.MAIN,\r\n\t\t\tviewGameType: GameType.MAIN,\r\n\t\t\tleftCount: 0\r\n\t\t},\r\n\t\twinloss: 0,\r\n\t\tsubGameWinloss: 0,\r\n\t\tfreeGameOdds: 0,\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprivate initRoller() {\r\n\t\tfor (let i = 0; i < config.columnCount; i++) {\r\n\t\t\tconst column = sourceManageSeletor().getFile(PrefabPathDefine.ROLLER).source;\r\n\t\t\tconst roller = new ThorV2RollerViewModel().mountView(column).appendTo(this.node).connect();\r\n\t\t\tthis.rollerViewModelArr.push(roller);\r\n\t\t\t// roller.comp.setColumnEffectNode(this.propertyNode.props_column_effect);\r\n\t\t\troller.setEvent({\r\n\t\t\t\tonCheckNextLeftCount: () => {\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tpublic initSlot() {\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.initSlot(index, this.iconPool);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate startRoll() {\r\n\t\tlet sendBetTime = cacheData.sendBetTime;\r\n\t\tthis.sendBetTime = sendBetTime;\r\n\t\tconsole.log(\"start roll time \" + sendBetTime)\r\n\r\n\t\tthorv2_Audio.playOneShot(SoundPathDefine.ROLLER_BEGIN)\r\n\r\n\t\tthis.dispatch(updateWinloss(0))\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tlet count = 0;\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.startRoll(this.props.isSpeed, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.rollerViewModelArr.length) {\r\n\t\t\t\t\tthis.isWaitEnding = true;\r\n\t\t\t\t\tthis.setWaitReturnSchedule();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t});\r\n\t}\r\n\r\n\t/**等待数据返回定时器 */\r\n\tprivate setWaitReturnSchedule() {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tglobal.hallDispatch(setLoadingAction({\r\n\t\t\t\tisShow: true\r\n\t\t\t}));\r\n\t\t}, config.waitDataReturnTime)\r\n\t}\r\n\r\n\tprivate speedRoller() {\r\n\t\tthis.rollerViewModelArr.forEach((v, index) => {\r\n\t\t\tv.comp.speed();\r\n\t\t})\r\n\t}\r\n\r\n\tprivate stopRollAll(sendBetTime: number, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.inStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.unscheduleAllCallbacks();\r\n\t\tglobal.hallDispatch(setLoadingAction({\r\n\t\t\tisShow: false\r\n\t\t}));\r\n\t\tthis.inStop = true;\r\n\r\n\t\tif (RollerStatus.RUNNING === this.props.rollerStatus) {\r\n\t\t\tthis.dispatch(updateRollerStatus(RollerStatus.ENDING))\r\n\t\t}\r\n\r\n\t\tthis.playStopRollSound();\r\n\r\n\t\tconsole.log(\"rollerpanel stop roll time \" + sendBetTime);\r\n\r\n\t\tlet count = 0;\r\n\t\tthis.rollerViewModelArr.forEach((v, i) => {\r\n\t\t\t// 获得停下来的数据\r\n\t\t\tconst stopIconIndex = rollerLaunchResult.dl.si[0].rollerId[i];\r\n\t\t\tv.comp.stopRoll(stopIconIndex, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (this.node.isValid && count >= this.rollerViewModelArr.length) {\r\n\t\t\t\t\tthis.rollEndHandle(rollerLaunchResult)\r\n\t\t\t\t}\r\n\t\t\t}, false, rollerLaunchResult);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate playStopRollSound() {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tif (!this.props.isManualSpeed && !this.props.isSpeed) {\r\n\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.DROP_BOTTOM)\r\n\t\t\t} else {\r\n\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.QUICK_STOP)\r\n\t\t\t}\r\n\t\t}, 0.3)\r\n\t}\r\n\r\n\t/**\r\n\t * 动画滚动结束处理\r\n\t */\r\n\tprivate rollEndHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.inStop = false;\r\n\t\tconst clearIconPositions = this.getClearIconPos(rollerLaunchResult);\r\n\t\tthis.clearFlowHandle(rollerLaunchResult, clearIconPositions);\r\n\t}\r\n\r\n\tprivate playScatterAnimation(rollerLaunchResult: RollerLaunchResult, done) {\r\n\t\tlet count = 0;\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tv.comp.playScatterAnimation(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= this.rollerViewModelArr.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**消除流程处理 */\r\n\tprivate clearFlowHandle(rollerLaunchResult: RollerLaunchResult, clearRoundDatas: ClearRoundData[]) {\r\n\t\tif (clearRoundDatas.length === 0) {\r\n\t\t\tthis.updateEndStatus(rollerLaunchResult);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst si = rollerLaunchResult.dl.si[0]\r\n\t\tthis.clearIconHandle(0, clearRoundDatas, () => {\r\n\t\t\tif (clearRoundDatas.length > 1 && si.otherGameAttributesVo.itemTotalMultiplier > 0) {\r\n\t\t\t\tmainViewModel.comp.flyFreeGameTotalOdds((isFly: boolean) => {\r\n\t\t\t\t\tthis.playOddsAnimation(rollerLaunchResult)\r\n\t\t\t\t\tthis.playLabelAnimation(rollerLaunchResult, isFly, () => {\r\n\t\t\t\t\t\tthis.updateEndStatus(rollerLaunchResult);\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthis.updateEndStatus(rollerLaunchResult);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprivate updateEndStatus(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst si = rollerLaunchResult.dl.si[0]\r\n\t\tconst isChangeGame = this.isChangeGame();\r\n\t\tconst overHandle = (isUpdateGold: boolean = true) => {\r\n\t\t\tif (!isChangeGame) {\r\n\t\t\t\tmainViewModel.comp.updateEndStatus(isUpdateGold);\r\n\t\t\t} else {\r\n\t\t\t\tthis.changeGameHandle(rollerLaunchResult);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.dispatch(updateWinloss(si.totalRewards));\r\n\r\n\t\tconst overHandleBeforeHandle = () => {\r\n\t\t\tif (this.isSubGame1()) {\r\n\t\t\t\tthis.subGameOverHandle(rollerLaunchResult, () => {\r\n\t\t\t\t\toverHandle(false);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\toverHandle();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 有大奖播放大奖\r\n\t\tconst bigWinConfig = getBigWinConfig(si.magnification)\r\n\t\tif (bigWinConfig) {\r\n\t\t\tthis.playBigWinHandle(bigWinConfig, rollerLaunchResult, () => {\r\n\t\t\t\toverHandleBeforeHandle();\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\toverHandleBeforeHandle();\r\n\t\t}\r\n\t}\r\n\r\n\t/**子游戏的结束处理 */\r\n\tprivate subGameOverHandle(rollerLaunchResult: RollerLaunchResult, done) {\r\n\t\tconst si = rollerLaunchResult.dl.si[0]\r\n\t\tlet firstDelayTime = 0;\r\n\t\tif (si.freeGameAmount > this.props.subGameWinloss) {\r\n\t\t\tthis.dispatch(updateSubGameWinloss(si.freeGameAmount));\r\n\t\t\tfirstDelayTime = 0.5;\r\n\t\t}\r\n\r\n\t\tif (si.otherGameAttributesVo.gameFreeGametotalMultiplier > this.props.freeGameOdds) {\r\n\t\t\ttween(this.node).delay(0.5).call(() => {\r\n\t\t\t\tthis.dispatch(updateFreeGameOdds(si.otherGameAttributesVo.gameFreeGametotalMultiplier));\r\n\t\t\t}).delay(0.5).call(() => {\r\n\t\t\t\tdone && done();\r\n\t\t\t}).start();\r\n\t\t} else {\r\n\t\t\tdone && done();\r\n\t\t}\r\n\t}\r\n\r\n\t/**播放倍率动画 */\r\n\tprivate playOddsAnimation(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\tv.comp.playOddsAnimation(() => {\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t}\r\n\r\n\t/**获得总的倍率 */\r\n\tprivate getTotalOdds(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet odds = 0;\r\n\t\trollerLaunchResult.dl.si[0].otherGameAttributesVo.rates.forEach((v: number[]) => {\r\n\t\t\tif (v && v.length >= 4) {\r\n\t\t\t\todds += v[3]\r\n\t\t\t} else {\r\n\t\t\t\todds -= 999;\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn odds;\r\n\t}\r\n\r\n\t/**播放倍率label动画 */\r\n\tprivate playLabelAnimation(rollerLaunchResult: RollerLaunchResult, isFlyTotalOdds: boolean, done) {\r\n\t\tconst odds = this.getTotalOdds(rollerLaunchResult)\r\n\t\tconst parentNode = mainViewModel.viewNode;\r\n\t\tconst endPos = mainViewModel.comp.getWinOddsPosition();\r\n\t\tlet count = 0;\r\n\r\n\t\tlet oddsIcons: ThorV2Icon[] = [];\r\n\t\tthis.rollerViewModelArr.forEach(v => {\r\n\t\t\toddsIcons = oddsIcons.concat(v.comp.getOddsLabelNodes());\r\n\t\t})\r\n\r\n\t\tif (oddsIcons.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isMoreOddsLabel = oddsIcons.length > 1 || isFlyTotalOdds;\r\n\t\tconst intervalTime = config.normalRollOption.oddsLabelAnimationParam.moreIntervalTime;\r\n\t\toddsIcons.forEach((v, i) => {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.playSingleLabelAnimation(parentNode, v.getOddsLabelNode(), endPos, () => {\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t\tconst isEnd = count >= oddsIcons.length;\r\n\t\t\t\t\tif (isMoreOddsLabel) {\r\n\t\t\t\t\t\tmainViewModel.comp.playWinlossAnimation(this.getOddsLabelValue(v.getOddsLabelNode()), isEnd)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isEnd) {\r\n\t\t\t\t\t\t// 在结束的时候如果有倍率增加，就播放倍率的动画，否则直接结束\r\n\t\t\t\t\t\tif (odds <= 0) {\r\n\t\t\t\t\t\t\tdone && done();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.dispatch(playWinOddsAnimation({\r\n\t\t\t\t\t\t\t\ttime: Date.now(),\r\n\t\t\t\t\t\t\t\ttimeScale: 1,\r\n\t\t\t\t\t\t\t\tparams: [odds, isMoreOddsLabel ? 1 : 0, done]\r\n\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}, i * intervalTime)\r\n\t\t})\r\n\t}\r\n\r\n\tprivate getOddsLabelValue(labelNode: Node) {\r\n\t\tconst oddsLabel = labelNode.getComponent(Label).string;\r\n\t\tconst odds = parseInt(oddsLabel.toUpperCase().replace(\"X\", \"\"));\r\n\t\treturn odds;\r\n\t}\r\n\r\n\tprivate playSingleLabelAnimation(parentNode: Node, labelNode: Node, endPos: Vec3, done) {\r\n\t\tlet count = 0;\r\n\t\tconst labelTemp = instantiate(labelNode) as Node;\r\n\t\tlabelNode.active = false;\r\n\t\tparentNode.addChild(labelTemp);\r\n\t\tlabelTemp.setWorldPosition(labelNode.worldPosition);\r\n\r\n\t\tthorv2_Audio.playOneShot(SoundPathDefine.WILD_FLASH)\r\n\r\n\t\tconst delayTime = config.normalRollOption.oddsLabelAnimationParam.delayTime;\r\n\t\tconst magnifyTime = config.normalRollOption.oddsLabelAnimationParam.magnifyTime;\r\n\t\tconst magnifyScale = config.normalRollOption.oddsLabelAnimationParam.magnifyScale;\r\n\t\tconst lessenTime = config.normalRollOption.oddsLabelAnimationParam.lessenTime;\r\n\t\tconst lessenScale = config.normalRollOption.oddsLabelAnimationParam.lessenScale;\r\n\r\n\t\ttween(labelTemp).delay(delayTime)\r\n\t\t\t.to(magnifyTime, { scale: new Vec3(magnifyScale, magnifyScale) })\r\n\t\t\t.to(lessenTime, { worldPosition: endPos, scale: new Vec3(lessenScale, lessenScale) }).call(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tlabelTemp.destroy();\r\n\t\t\t\tdone && done();\r\n\t\t\t}).start();\r\n\t}\r\n\r\n\t/**消除图标处理 */\r\n\tprivate clearIconHandle(index: number, clearRoundDatas: ClearRoundData[], done) {\r\n\t\tconst clearRoundData = clearRoundDatas[index];\r\n\r\n\t\t/**动画完成之后执行 */\r\n\t\tconst doneHandle = () => {\r\n\t\t\tindex++;\r\n\t\t\tif (index >= clearRoundDatas.length) {\r\n\t\t\t\t// console.log(\"clearIconHandle over ====================\")\r\n\t\t\t\tdone && done();\r\n\t\t\t} else {\r\n\t\t\t\tthis.clearIconHandle(index, clearRoundDatas, done);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (clearRoundData.clearIconDatas.length === 0) {\r\n\t\t\tdone && done();\r\n\t\t\t// console.log(\"clearIconHandle over  111====================\")\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (index < clearRoundDatas.length - 1) {\r\n\t\t\tif (clearRoundDatas[index + 1].clearIconDatas.length === 0) {\r\n\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.SP_WIN)\r\n\t\t\t} else {\r\n\t\t\t\tthorv2_Audio.playOneShot(SoundPathDefine.SP_WIN_SHOW)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 播放金额\r\n\t\tthis.showPlayWinAmount(clearRoundData);\r\n\r\n\t\tlet count = 0;\r\n\t\tclearRoundData.clearIconDatas.forEach(v => {\r\n\t\t\tthis.rollerViewModelArr[v.columnIndex].comp.clearIcon(v.iconIndex, index, () => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= clearRoundData.clearIconDatas.length) {\r\n\t\t\t\t\tthis.addIconHandle(clearRoundData.clearIconDatas, doneHandle);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t/**添加图标处理 */\r\n\tprivate addIconHandle(clearIconDatas: ClearIconData[], done) {\r\n\t\tlet count = 0;\r\n\t\tclearIconDatas.forEach(v => {\r\n\t\t\tthis.rollerViewModelArr[v.columnIndex].comp.clearAfterFillIconHandle(() => {\r\n\t\t\t\tcount++;\r\n\t\t\t\tif (count >= clearIconDatas.length) {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\t/**显示中奖金额 */\r\n\tprivate showPlayWinAmount(clearRoundData: ClearRoundData) {\r\n\t\tconst rounds = this.splitClearRoundData(clearRoundData);\r\n\r\n\t\t// let winloss = this.props.winloss;\r\n\t\trounds.forEach(round => {\r\n\t\t\tround.clearIconDatas.sort((v1, v2) => this.rollerViewModelArr[v1.columnIndex].comp.getMiddleOrder(v1.iconIndex)\r\n\t\t\t\t- this.rollerViewModelArr[v2.columnIndex].comp.getMiddleOrder(v2.iconIndex))\r\n\r\n\t\t\tconst winIconData = round.winIconDatas[0];\r\n\t\t\tconst iconData = round.clearIconDatas[0];\r\n\t\t\tthis.rollerViewModelArr[iconData.columnIndex].comp.playAmount(iconData.iconIndex, winIconData.amount);\r\n\r\n\t\t\tthis.dispatch(updateWinIconDataItem({\r\n\t\t\t\t...winIconData,\r\n\t\t\t\ttime: Date.now(),\r\n\t\t\t}))\r\n\r\n\t\t\tconst winloss = this.props.winloss + winIconData.amount;\r\n\t\t\tthis.dispatch(updateWinloss(winloss));\r\n\t\t\tif (this.isSubGame1()) {\r\n\t\t\t\tconst subGameWinloss = this.props.subGameWinloss + winIconData.amount;\r\n\t\t\t\tthis.dispatch(updateSubGameWinloss(subGameWinloss));\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprivate splitClearRoundData(clearRoundData: ClearRoundData) {\r\n\t\tif (clearRoundData.winIconDatas.length <= 1) {\r\n\t\t\treturn [clearRoundData];\r\n\t\t}\r\n\r\n\t\tconst rounds: ClearRoundData[] = [];\r\n\t\tclearRoundData.winIconDatas.forEach(roundData => {\r\n\r\n\t\t\tconst data: ClearRoundData = {\r\n\t\t\t\tclearIconDatas: [],\r\n\t\t\t\twinIconDatas: [],\r\n\t\t\t}\r\n\r\n\t\t\tdata.winIconDatas.push(roundData);\r\n\r\n\t\t\tclearRoundData.clearIconDatas.forEach(iconData => {\r\n\t\t\t\tconst iconDataTemp: ClearIconData = {\r\n\t\t\t\t\tcolumnIndex: iconData.columnIndex,\r\n\t\t\t\t\ticonIndex: [],\r\n\t\t\t\t};\r\n\r\n\t\t\t\ticonData.iconIndex.forEach(iconIndex => {\r\n\t\t\t\t\tif (this.rollerViewModelArr[iconData.columnIndex].comp.isIconType(iconIndex, roundData.itemId)) {\r\n\t\t\t\t\t\ticonDataTemp.iconIndex.push(iconIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tdata.clearIconDatas.push(iconDataTemp);\r\n\t\t\t})\r\n\r\n\t\t\trounds.push(data);\r\n\t\t})\r\n\r\n\t\treturn rounds;\r\n\t}\r\n\r\n\tprivate playWinAudio() {\r\n\t\t// if (this.isWinWild()) {\r\n\t\t// \tegyptv2_Audio.playOneShot(SoundPathDefine.wild)\r\n\t\t// } else {\r\n\t\t// \tegyptv2_Audio.playOneShot(SoundPathDefine.haveCoin)\r\n\t\t// }\r\n\t}\r\n\r\n\t/**播放大奖处理 */\r\n\tprivate playBigWinHandle(bigWinConfig, rollerLaunchResult: RollerLaunchResult, done) {\r\n\t\tif (!bigWinConfig) {\r\n\t\t\tdone && done();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 延迟一点点播放大奖\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\t\tlet winloss = si.totalRewards;\r\n\t\t\t// winloss = winloss === 0 ? si.freeGameAmount : winloss;\r\n\t\t\t// const isChangeGame = this.isChangeGame();\r\n\t\t\t// if (isChangeGame && si.freeGameAmount > 0) {\r\n\t\t\t// \twinloss = si.freeGameAmount;\r\n\t\t\t// }\r\n\t\t\t// 中大奖提示框\r\n\t\t\tthis.node.isValid && mainViewModel.showDialogWin(bigWinConfig, winloss, () => {\r\n\t\t\t\tdone && done();\r\n\t\t\t})\r\n\t\t}, 0.1)\r\n\t}\r\n\r\n\tprivate changeGameHandle(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tif (this.isSubGame(this.props.gameTypeInfo.currGameType)) {\r\n\t\t\tthis.changeToSubGame(this.props.gameTypeInfo.currGameType, rollerLaunchResult);\r\n\t\t} else if (this.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n\t\t\tthis.changeToMainGame(this.props.gameTypeInfo.currGameType, rollerLaunchResult)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 切换到小游戏处理\r\n\t * @param currGameType 当前游戏\r\n\t * @param viewGameCountOver 当前小游戏次数是否结束\r\n\t * @param nextGameType 下一个游戏\r\n\t */\r\n\tprivate changeToSubGame(currGameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\tconst si = rollerLaunchResult.dl.si[0];\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.playScatterAnimation(rollerLaunchResult, () => {\r\n\t\t\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\t\t\tmainViewModel.enterExitSubGame({\r\n\t\t\t\t\tdialogType: DialogType.FREE_GAME_ENTRY,\r\n\t\t\t\t\tparams: [si.freeCount],\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\t// 播放切换游戏动画\r\n\t\t\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\t\t\tgameType: currGameType,\r\n\t\t\t\t\t\tparam: 0 //开门类型\r\n\t\t\t\t\t}))\r\n\t\t\t\t})\r\n\t\t\t})\r\n\r\n\t\t\tthis.dispatch(updateWinloss(si.totalRewards));\r\n\t\t\tthis.dispatch(updateGold(si.balanceAfterSettlement));\r\n\t\t}, 0.5)\r\n\t}\r\n\r\n\t/**切换到主游戏的处理 */\r\n\tprivate changeToMainGame(gameType: GameType, rollerLaunchResult: RollerLaunchResult) {\r\n\t\t// 如果是免费游戏，要接着弹出的免费次数框\r\n\t\tmainViewModel.enterExitSubGame({\r\n\t\t\tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t\tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t}, () => {\r\n\t\t\t// 播放切换游戏动画\r\n\t\t\tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t\t\tgameType: gameType,\r\n\t\t\t\tparam: 1\r\n\t\t\t}))\r\n\t\t})\r\n\t\t// 弹出结算面板\r\n\t\t// mainViewModel.showDialogWin({\r\n\t\t// \tdialogType: DialogType.FREE_GAME_SETTLEMENT,\r\n\t\t// \tparams: [rollerLaunchResult.dl.si[0].freeGameAmount],\r\n\t\t// }, () => {\r\n\t\t// \t// 播放切换游戏动画\r\n\t\t// \tthis.dispatch(updateSubGameAnimationPlayInfo({\r\n\t\t// \t\tgameType: gameType,\r\n\t\t// \t\tparam: 1 // 关门动画\r\n\t\t// \t}))\r\n\t\t// \t// this.changeRollerHeight(GameType.MAIN);\r\n\r\n\t\t// \t// 在开始切回主游戏时，就要把插槽的位置重置，等到gameTypeInfo数据变化时已经晚了，会看到坐标不正确\r\n\t\t// \tthis.changeGame(GameType.MAIN);\r\n\t\t// })\r\n\t}\r\n\r\n\t/**是否准备切换游戏 */\r\n\tprivate isChangeGame() {\r\n\t\tif (!this.props.gameTypeInfo) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn this.props.gameTypeInfo.viewGameType !== this.props.gameTypeInfo.currGameType;\r\n\t}\r\n\r\n\tprivate isMain() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.MAIN;\r\n\t}\r\n\r\n\tprivate isSubGame(gameType: GameType) {\r\n\t\treturn gameType === GameType.SUBGAME1 || gameType === GameType.SUBGAME2\r\n\t}\r\n\r\n\tprivate getIsSpeed() {\r\n\t\treturn this.props.isSpeed;\r\n\t}\r\n\r\n\tprivate isSubGame1() {\r\n\t\treturn this.props.gameTypeInfo.viewGameType === GameType.SUBGAME1;\r\n\t}\r\n\r\n\t/**获得要消除的图标位置 */\r\n\tprivate getClearIconPos(rollerLaunchResult: RollerLaunchResult) {\r\n\t\tlet clearRoundDatas: ClearRoundData[] = [];\r\n\t\tif (rollerLaunchResult) {\r\n\t\t\tconst singleResults = rollerLaunchResult.dl.si[0].otherGameAttributesVo.singleResults\r\n\r\n\t\t\tfor (let i = 0; i < singleResults.length; i++) {\r\n\t\t\t\tconst results = singleResults[i];\r\n\t\t\t\tconst wp = results.winningPosition;\r\n\r\n\t\t\t\tconst clearRoundData: ClearRoundData = {\r\n\t\t\t\t\tclearIconDatas: [],\r\n\t\t\t\t\twinIconDatas: []\r\n\t\t\t\t};\r\n\r\n\t\t\t\tclearRoundData.winIconDatas = results.gameWinningVos.map((v: any) => {\r\n\t\t\t\t\tconst winIconData: WinIconData = {\r\n\t\t\t\t\t\tamount: v.amount,\r\n\t\t\t\t\t\titemId: v.itemId,\r\n\t\t\t\t\t\tcount: v.count,\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn winIconData;\r\n\t\t\t\t})\r\n\r\n\t\t\t\tfor (const key in wp) {\r\n\t\t\t\t\tconst iconPositions = wp[key];\r\n\r\n\t\t\t\t\ticonPositions.forEach(iconPosition => {\r\n\t\t\t\t\t\tconst columnIndex = iconPosition[0];\r\n\t\t\t\t\t\tlet clearIconData = clearRoundData.clearIconDatas.find(v => v.columnIndex === columnIndex);\r\n\t\t\t\t\t\tif (!clearIconData) {\r\n\t\t\t\t\t\t\tclearIconData = {\r\n\t\t\t\t\t\t\t\tcolumnIndex: columnIndex,\r\n\t\t\t\t\t\t\t\ticonIndex: []\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tclearRoundData.clearIconDatas.push(clearIconData);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tclearIconData.iconIndex.push(iconPosition[1]);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// 按照列排序\r\n\t\t\t\t\t// clearRoundData.clearIconDatas.sort((v1, v2) => v1.columnIndex - v2.columnIndex)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclearRoundDatas.push(clearRoundData);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clearRoundDatas;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (this.node && this.node.isValid) {\r\n\t\t\tif (key === 'rollerStatus') {\r\n\t\t\t\tif (RollerStatus.RUNNING === value.cur) {\r\n\t\t\t\t\tthis.startRoll();\r\n\t\t\t\t} else if (RollerStatus.ENDING === value.cur) {\r\n\t\t\t\t\t// this.stopRollAll(true, this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'gameTypeInfo') {\r\n\t\t\t\tthis.changeGame(this.props.gameTypeInfo.viewGameType);\r\n\t\t\t} else if (key === 'isManualSpeed' && value.cur) {\r\n\t\t\t\tthis.speedRoller();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate changeGame(gameType: GameType) {\r\n\t\t// const columnListLayout = this.propertyNode.props_column_list.getComponent(Layout);\r\n\t\tconst isSubGame1 = gameType === GameType.SUBGAME1;\r\n\t\tconst isMain = gameType === GameType.MAIN;\r\n\t\tif (isMain) {\r\n\t\t\tthis.node.position = new Vec3(config.normalRollOption.rollerWindowX, config.normalRollOption.rollerWindowY);\r\n\t\t\t// columnListLayout.spacingX = config.normalRollOption.columnInterval;\r\n\t\t} else {\r\n\t\t\tthis.node.position = new Vec3(config.subGameRollOption.rollerWindowX, config.subGameRollOption.rollerWindowY);\r\n\t\t\t// columnListLayout.spacingX = config.subGameRollOption.columnInterval;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isWinWild() {\r\n\t\tfor (let i = 0; i < this.rollerViewModelArr.length; i++) {\r\n\t\t\tconst element = this.rollerViewModelArr[i];\r\n\t\t\tif (element.comp.isWinWild()) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\t// this.propertyNode.props_column_list.removeAllChildren();\r\n\r\n\t\tthis.initRoller();\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isWaitEnding && cacheData.rollerLaunchResult) {\r\n\t\t\tthis.isWaitEnding = false;\r\n\t\t\tthis.node.isValid && this.stopRollAll(this.sendBetTime, cacheData.rollerLaunchResult);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}