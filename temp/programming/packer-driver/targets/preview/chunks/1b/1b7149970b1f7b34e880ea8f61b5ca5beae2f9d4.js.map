{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/viewModel/MailBoxViewModel.ts"],"names":["MailBoxViewModel","ViewModel","ApiUrl","fetcher","constructor","begin","getMailList","setEvent","onDeleteHandler","item","Promise","resolve","reject","send","DELETE_EMAIL","data","id","then","rsp","onCheckMail","CHECK_EMAIL","EMAIL_LIST","setProps","mailList","catch","e","connect","inject","state"],"mappings":";;;2GASMA,gB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARCC,MAAAA,S;;AAIEC,MAAAA,M,iBAAAA,M;;AAEAC,MAAAA,O,iBAAAA,O;;;;;;;;;AAEHH,MAAAA,gB,GAAN,MAAMA,gBAAN;AAAA;AAAA,kCAAuE;AACrEI,QAAAA,WAAW,GAAG;AACZ,gBAAM,cAAN;AACD;;AAESC,QAAAA,KAAK,GAAG;AAChB,eAAKC,WAAL;AACA,eAAKC,QAAL,CAAc;AACZC,YAAAA,eAAe,EAAGC,IAAD,IAAU;AACzB,qBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC;AAAA;AAAA,wCAAQC,IAAR,CAAa;AAAA;AAAA,sCAAOC,YAApB,EAAkC;AAAEC,kBAAAA,IAAI,EAAEN,IAAI,CAACO;AAAb,iBAAlC,EAAqDC,IAArD,CAA2DC,GAAD,IAAS;AACjE;AACAP,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACD,iBAHD,EADsC,CAKtC;AACA;AACA;AACD,eARM,CAAP;AASD,aAXW;AAYZQ,YAAAA,WAAW,EAAGV,IAAD,IAAwB;AACnC,qBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC;AAAA;AAAA,wCAAQC,IAAR,CAAa;AAAA;AAAA,sCAAOO,WAApB,EAAiC;AAAEL,kBAAAA,IAAI,EAAEN,IAAI,CAACO;AAAb,iBAAjC,EAAoDC,IAApD,CAA0DC,GAAD,IAAS;AAChE;AACAP,kBAAAA,OAAO,CAAC,IAAD,CAAP;AACD,iBAHD;AAID,eALM,CAAP;AAMD;AAnBW,WAAd;AAsBD;;AAEOL,QAAAA,WAAW,GAAG;AACpB;AAAA;AAAA,kCAAQO,IAAR,CAAa;AAAA;AAAA,gCAAOQ,UAApB,EAAgC,EAAhC,EAAoC,KAApC,EAA2CJ,IAA3C,CAAiDC,GAAD,IAAS;AACvD,iBAAKI,QAAL,CAAc;AACZC,cAAAA,QAAQ,EAAEL;AADE,aAAd;AAGD,WAJD,EAIGM,KAJH,CAIUC,CAAD,IAAO,CACd;AACD,WAND;AAOD;;AAEMC,QAAAA,OAAO,GAAG;AACf,eAAKC,MAAL,CAAY,EAAZ,EAAiBC,KAAD,IAAsB;AACpC,mBAAO;AACLL,cAAAA,QAAQ,EAAE;AADL,aAAP;AAGD,WAJD;AAKA,iBAAO,IAAP;AACD;;AAhDoE,O;;yBAmDxDvB,gB","sourcesContent":["import { Node } from \"cc\"\r\nimport ViewModel from \"../../base/ViewModel\"\r\nimport { Hall_MailBox, IProps, IEvent, MailItemType } from \"../components/Hall_MailBox\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport Fetcher from \"../../utils/Fetcher\"\r\nimport { ApiUrl } from \"../apiUrl\"\r\nimport { addToastAction } from \"../store/actions/baseBoard\"\r\nimport { fetcher } from \"../index\"\r\n\r\nclass MailBoxViewModel extends ViewModel<Hall_MailBox, IProps, IEvent> {\r\n  constructor() {\r\n    super('Hall_MailBox')\r\n  }\r\n\r\n  protected begin() {\r\n    this.getMailList()\r\n    this.setEvent({\r\n      onDeleteHandler: (item) => {\r\n        return new Promise((resolve, reject) => {\r\n          fetcher.send(ApiUrl.DELETE_EMAIL, { data: item.id }).then((rsp) => {\r\n            // this.getMailList()\r\n            resolve(true)\r\n          })\r\n          //删除\r\n          // this.getMailList()\r\n          // resolve(true)\r\n        })\r\n      },\r\n      onCheckMail: (item: MailItemType) => {\r\n        return new Promise((resolve, reject) => {\r\n          fetcher.send(ApiUrl.CHECK_EMAIL, { data: item.id }).then((rsp) => {\r\n            // this.getMailList()\r\n            resolve(true)\r\n          })\r\n        })\r\n      }\r\n    })\r\n\r\n  }\r\n\r\n  private getMailList() {\r\n    fetcher.send(ApiUrl.EMAIL_LIST, {}, \"get\").then((rsp) => {\r\n      this.setProps({\r\n        mailList: rsp\r\n      })\r\n    }).catch((e) => {\r\n      //this.dispatch(addToastAction({ content: e }))\r\n    })\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      return {\r\n        mailList: []\r\n      }\r\n    })\r\n    return this\r\n  }\r\n}\r\n\r\nexport default MailBoxViewModel"]}