{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dragonTiger/index.ts"],"names":["Prefab","assetManager","bundlePkgName","PrefabPathDefine","LoaderPanelViewModel","DragonTigerFileMap","SubGameRunState","config","subGameList","dtConfig","socketConnect","DragonTigerMainViewModel","AudioMgr","SoundPathDefine","UseSetOption","global","lang","setSubGameRunState","sourceManageMap","bundleCommon","bundleDragonTiger","sourceManageSeletor","bundleName","find","i","bundle","name","startUp","rootNode","loadBundle","err","commonBundle","load","LOADING_PANEL","progress","total","hallDispatch","LOADING","setSubGameGate","gameId","prefab","isAllowOpenSubGame","READY","loaderviweModel","mountView","appendTo","setProps","loadBarType","setEvent","onLoadDone","_sourceManageMap","dragonTiger_Audio","gameConfig","item","comp","setTipContent","write","k","WebSocketModule","GameInit","placeStr","RUN","then","unMount","mainGameViewModel","getFile","MAIN_GAME","source","connect","play","MAIN_BG","Instance","option","music","catch","e","versionStr","md5","startLoad","playMainBg","playGame","playOneShot","VOICE_CHIP","playBtnClick","BTN_CLICK","playChip","CHIP","playDefeat","DEFEAT","playWin","WIN","playTimeout","TIME_OUT","playGetCoin","GET_COIN","playTurnCard","TURN_CARD","playTigerCard","TIGER_CARD","playDragonCard","DRAGON_CARD"],"mappings":"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","sourcesContent":["import { AssetManager, Node, Prefab, assetManager, find, instantiate } from \"cc\"\r\nimport dragonStore from './store';\r\nimport { bundlePkgName } from \"./sourceDefine\";\r\nimport { PrefabPathDefine } from \"./sourceDefine/prefabDefine\";\r\nimport LoaderPanelViewModel from \"../../common/viewModel/LoaderPanelViewModel\";\r\nimport SourceManage from \"../../base/SourceManage\";\r\nimport DragonTigerFileMap from './sourceDefine';\r\nimport { SubGameRunState, config, subGameList } from \"../../hall/config\";\r\nimport dtConfig from \"./config\";\r\nimport socketConnect from \"./socketConnect\";\r\nimport DragonTigerMainViewModel from \"./ViewModel/DragonTigerMainViewModel\";\r\nimport { listenerFactoy } from \"../../common/listenerFactoy\";\r\nimport { AudioMgr } from \"../../utils/AudioMgr\";\r\nimport { SoundPathDefine } from \"./sourceDefine/soundDefine\";\r\nimport UseSetOption, { setActiveAudio } from \"../../utils/UseSetOption\";\r\nimport { global, lang } from \"../../hall\";\r\nimport { setSubGameRunState } from \"../../hall/store/actions/baseBoard\";\r\n\r\nlet sourceManageMap: Array<SourceManage> = []\r\nexport let bundleCommon: AssetManager.Bundle = null\r\nexport let bundleDragonTiger: AssetManager.Bundle = null\r\nexport let mainGameViewModel: DragonTigerMainViewModel\r\nexport let dragonTiger_Audio: AudioMgr<SoundPathDefine>\r\nexport const sourceManageSeletor = (bundleName: string = 'dragonTiger') => sourceManageMap.find(i => i.bundle.name === bundleName)\r\n\r\nexport const startUp = (rootNode: Node) => {\r\n\r\n  assetManager.loadBundle(\"common\", (err, commonBundle) => {\r\n    bundleCommon = commonBundle\r\n    assetManager.loadBundle(bundlePkgName, Prefab, (err, bundle) => {\r\n      bundleDragonTiger = bundle\r\n\r\n      bundleDragonTiger.load(PrefabPathDefine.LOADING_PANEL, Prefab, (progress, total) => {\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.LOADING))\r\n        global.setSubGameGate(dtConfig.gameId, (progress / total))\r\n      }, (err, prefab) => {\r\n        if (!global.isAllowOpenSubGame(dtConfig.gameId)) return\r\n        global.hallDispatch(setSubGameRunState(SubGameRunState.READY))\r\n        const loaderviweModel = new LoaderPanelViewModel().mountView(prefab).appendTo(rootNode).setProps({\r\n          loadBarType: 1\r\n        }).setEvent({\r\n          onLoadDone: (_sourceManageMap) => {\r\n            sourceManageMap = _sourceManageMap\r\n            dragonTiger_Audio = new AudioMgr<SoundPathDefine>(sourceManageSeletor(\"dragonTiger\"))\r\n            config.gameConfig.find(item => item.name === \"dragonTiger\")\r\n            loaderviweModel.comp.setTipContent(lang.write(k => k.WebSocketModule.GameInit, {}, { placeStr: \"Game init...\" }))\r\n            global.hallDispatch(setSubGameRunState(SubGameRunState.RUN))\r\n            socketConnect().then(() => {\r\n              loaderviweModel.unMount().then(() => {\r\n                mainGameViewModel = new DragonTigerMainViewModel().mountView(sourceManageSeletor(\"dragonTiger\").getFile(PrefabPathDefine.MAIN_GAME).source).appendTo(rootNode).connect()\r\n                dragonTiger_Audio.play(SoundPathDefine.MAIN_BG, UseSetOption.Instance().option.music)\r\n              })\r\n            }).catch(e => loaderviweModel.comp.setTipContent(e || 'error'))\r\n          }\r\n        }).setProps({\r\n          versionStr: `md5: ${subGameList.find(i => i.gameId === dtConfig.gameId).md5}`\r\n        })\r\n        loaderviweModel.comp.startLoad([bundle], [...DragonTigerFileMap])\r\n\r\n      })\r\n    })\r\n  })\r\n}\r\n\r\n/**\r\n * 背景音乐\r\n */\r\nexport const playMainBg = () => {\r\n  dragonTiger_Audio.play(SoundPathDefine.MAIN_BG, true);\r\n}\r\n/**\r\n* 游戏开始\r\n*/\r\nexport const playGame = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.VOICE_CHIP);\r\n}\r\n/**\r\n* 按钮单击音效\r\n*/\r\nexport const playBtnClick = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.BTN_CLICK);\r\n}\r\n\r\n/**\r\n* 下注筹码音效\r\n*/\r\nexport const playChip = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.CHIP);\r\n}\r\n\r\n/**\r\n* 失败音效\r\n*/\r\nexport const playDefeat = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.DEFEAT);\r\n}\r\n\r\n/**\r\n* 胜利音效\r\n*/\r\nexport const playWin = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.WIN);\r\n}\r\n/**\r\n* 5秒倒计时\r\n*/\r\nexport const playTimeout = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.TIME_OUT);\r\n}\r\n/**\r\n* 金币收集音效\r\n*/\r\nexport const playGetCoin = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.GET_COIN);\r\n}\r\n/**\r\n* 翻牌声\r\n*/\r\nexport const playTurnCard = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.TURN_CARD);\r\n}\r\n/**\r\n* 翻虎\r\n*/\r\nexport const playTigerCard = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.TIGER_CARD);\r\n}\r\n/**\r\n* 翻龙\r\n*/\r\nexport const playDragonCard = () => {\r\n  dragonTiger_Audio.playOneShot(SoundPathDefine.DRAGON_CARD);\r\n}"]}