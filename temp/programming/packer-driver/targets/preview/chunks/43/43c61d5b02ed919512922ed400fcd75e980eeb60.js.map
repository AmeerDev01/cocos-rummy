{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fruit777/components/Fruit777_AwardBox.ts"],"names":["_decorator","instantiate","Label","Node","sp","tween","UIOpacity","Vec3","BaseComponent","TaskScheduler","Task","footerViewModel","fruit777_Audio","gameBoardViewModel","sourceManageSeletor","getNodePositionInCanvas","dataTransfer","DataKeyType","GameType","JactpotType","SoundPathDefine","ccclass","property","OpenStatus","Fruit777_AwardBox","propertyNode","props_btn_sg_box","props_spr_result_item","props_particle2D","props_score","taskScheduler","props","boxId","dataId","times","levelUp","fruitFileName","score","BONUS","distance","name","events","onOpenHandler","id","updateTimesHandler","jactpotType","checkFlyEndHandler","onFreeGameAmoundChange","amount","jackPotTypeName","APPLE","STRAWBERRY","GRAPE","WATERMELON","BANANA","LEVEL","start","initState","openStatus","CLOSE","bindEvent","node","on","EventType","TOUCH_END","GAME_TYPE","SUBGAME1","state","OPENING","openAwardBox","useProps","key","value","thenTimes","SUBGAME_TIMES","setState","OPEN","joinqQueue","done","getComponent","Skeleton","animation","scheduleOnce","active","e","console","log","skeleton","skeletonData","getFile","cur","source","x","y","z","position","setPosition","thenAmound","scoreTask","string","formatAmountWithCommas","ui","setScale","opacity","target","to","scale","easing","call","particleTask","playOneShot","FRUIT_UP","FREE_GAME_AMOUNT","fly","targetNode","beginPosition","targetPosition","flying","isExecute","comp","getProfitBar","currentGameViewModel","getHeaderNode","children","subscribeDone","LEVEV_UP","getLevelBodyNode","GET_COIN","getTimesNode","delayTime","viewNode","addChild","middlePosition","onUpdate","t","bezier","destroy","addComponent","startPos","middlePos","endPos","bindUI","DONE","useState","getOpenStatus","destroyCallBack","stopQueue","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, sp, Sprite, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport { bundleFruit777, footerViewModel, fruit777_Audio, gameBoardViewModel, sourceManageSeletor } from '../index';\r\nimport { getNodePositionInCanvas } from '../../../utils/tool';\r\nimport dataTransfer, { DataKeyType } from '../dataTransfer';\r\nimport { GameType, JactpotType } from '../type';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum OpenStatus {\r\n\tCLOSE,\r\n\tOPENING,\r\n\tOPEN,\r\n\tDONE\r\n}\r\nexport interface IState {\r\n\topenStatus: OpenStatus\r\n}\r\n\r\nexport interface IProps {\r\n\tboxId: number,\r\n\tdataId: number,\r\n\ttimes: number,\r\n\tlevelUp: number,\r\n\tfruitFileName: string,\r\n\tscore: number,\r\n\tBONUS: number,\r\n\tdistance: number[],\r\n\tname: string\r\n}\r\nexport interface IEvent {\r\n\tonOpenHandler: (id: number) => void,\r\n\tupdateTimesHandler: (times: number, jactpotType?: JactpotType) => void,\r\n\tcheckFlyEndHandler: () => void,\r\n\tonFreeGameAmoundChange: (amount: number) => void\r\n}\r\n\r\n@ccclass('Fruit777_AwardBox')\r\nexport class Fruit777_AwardBox extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_sg_box: new Node(),\r\n\t\tprops_spr_result_item: new Node(),\r\n\t\tprops_particle2D: new Node(),\r\n\t\tprops_score: new Node()\r\n\t}\r\n\tprivate taskScheduler: TaskScheduler = new TaskScheduler()\r\n\r\n\tpublic props: IProps = {\r\n\t\tboxId: 0,\r\n\t\tdataId: -1,\r\n\t\ttimes: 0,\r\n\t\tlevelUp: 0,\r\n\t\tfruitFileName: \"\",\r\n\t\tscore: 0,\r\n\t\tBONUS: 0,\r\n\t\tdistance: [0, 0],\r\n\t\tname: ''\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonOpenHandler: (id: number) => { },\r\n\t\tupdateTimesHandler: (times: number, jactpotType?: JactpotType) => { },\r\n\t\tcheckFlyEndHandler: () => { },\r\n\t\tonFreeGameAmoundChange: (amount: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\topenStatus: OpenStatus.CLOSE\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t// console.log('GAME_TYPE', dataTransfer(DataKeyType.GAME_TYPE))\r\n\t\t\tif (dataTransfer(DataKeyType.GAME_TYPE) !== GameType.SUBGAME1) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (this.state.openStatus === OpenStatus.CLOSE || this.state.openStatus === OpenStatus.OPENING) {\r\n\t\t\t\tthis.openAwardBox()\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tlet thenTimes = 0\r\n\t\tif (key !== \"boxId\") {\r\n\t\t\ttry {\r\n\t\t\t\tthenTimes = dataTransfer(DataKeyType.SUBGAME_TIMES)\r\n\t\t\t\tif (this.state.openStatus === OpenStatus.OPENING) {\r\n\t\t\t\t\t//执行贝壳动作\r\n\t\t\t\t\t// this.setState({ hasOpen: true })\r\n\t\t\t\t\tthis.setState({ openStatus: OpenStatus.OPEN })\r\n\t\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\t\tthis.propertyNode.props_btn_sg_box.getComponent(sp.Skeleton).animation = 'diankaibaoxiang'\r\n\t\t\t\t\t\tthis.scheduleOnce(() => { this.propertyNode.props_btn_sg_box.active = false }, 2)\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t}, 1)\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\t\tthis.events.checkFlyEndHandler()\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t}))\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"fruitFileName\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t//加定时器是确保distance肯定有数据\r\n\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.propertyNode.props_spr_result_item.active = true\r\n\t\t\t\t\tconst skeleton = this.propertyNode.props_spr_result_item.getComponent(sp.Skeleton)\r\n\t\t\t\t\tskeleton.skeletonData = sourceManageSeletor().getFile(value.cur).source\r\n\t\t\t\t\tskeleton.animation = \"animation\"\r\n\t\t\t\t\tconst { x, y, z } = this.propertyNode.props_spr_result_item.position\r\n\t\t\t\t\tthis.propertyNode.props_spr_result_item.setPosition(new Vec3(x + this.props.distance[0], y + this.props.distance[1], z))\r\n\t\t\t\t\tthis.scheduleOnce(() => done(), 1)\r\n\t\t\t\t}))\r\n\t\t\t}, 0.1)\r\n\t\t}\r\n\t\tif (key === \"score\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tlet thenAmound = 0\r\n\t\t\t\tconst scoreTask = new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.propertyNode.props_score.getComponent(Label).string = value.cur.formatAmountWithCommas()\r\n\t\t\t\t\tthis.propertyNode.props_score.active = true\r\n\t\t\t\t\tconst ui = this.propertyNode.props_score.getComponent(UIOpacity)\r\n\t\t\t\t\tthis.propertyNode.props_score.setScale(1.3, 1.3)\r\n\t\t\t\t\tui.opacity = 0\r\n\t\t\t\t\ttween().target(ui).to(0.2, { opacity: 255 }).start()\r\n\t\t\t\t\ttween().target(this.propertyNode.props_score).to(0.7, { scale: new Vec3(1, 1) }, { easing: \"backOut\" }).call(() => done()).start()\r\n\t\t\t\t})\r\n\t\t\t\t//飞粒子\r\n\t\t\t\tconst particleTask = new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfruit777_Audio.playOneShot(SoundPathDefine.FRUIT_UP)\r\n\t\t\t\t\tthenAmound = dataTransfer(DataKeyType.FREE_GAME_AMOUNT)\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\t\tthis.flying(this.propertyNode.props_particle2D, beginPosition, targetPosition, () => {\r\n\t\t\t\t\t\t\t\t!particleTask.isExecute && done()\r\n\t\t\t\t\t\t\t}, 0.6)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(footerViewModel.comp.getProfitBar())\r\n\t\t\t\t\tfly((gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode() as Node).children[this.props.dataId - 1])\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\t// if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.SUBGAME1) {\r\n\t\t\t\t\t// \t//如果已经要换游戏了，就不更新次数了，不然更新的是下一个游戏的剩余次数\r\n\t\t\t\t\t// \tthis.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tif (!this.propertyNode) return\r\n\t\t\t\t\tthis.events.updateTimesHandler(thenTimes, this.jackPotTypeName[this.props.name])\r\n\t\t\t\t\tthis.events.onFreeGameAmoundChange(thenAmound)\r\n\t\t\t\t})\r\n\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(scoreTask).joinqQueue(particleTask)\r\n\t\t\t}, 1)\r\n\t\t}\r\n\t\tif (key === \"levelUp\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tfruit777_Audio.playOneShot(SoundPathDefine.LEVEV_UP)\r\n\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\tthis.flying(this.propertyNode.props_spr_result_item, beginPosition, targetPosition, done, 0.1)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(gameBoardViewModel.currentGameViewModel['jackpot'].comp.getLevelBodyNode())\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\tthis.events && this.events.updateTimesHandler(thenTimes, this.jackPotTypeName[this.props.name])\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\t// this.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t}))\r\n\t\t\t}, 2)\r\n\t\t}\r\n\t\tif (key === \"times\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tfruit777_Audio.playOneShot(SoundPathDefine.GET_COIN)\r\n\t\t\t\t//确保资源被替换之后\r\n\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\tthis.flying(this.propertyNode.props_spr_result_item, beginPosition, targetPosition, done, 0.1)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(gameBoardViewModel.currentGameViewModel.comp.getTimesNode())\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\tthis.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t}))\r\n\t\t\t}, 2)\r\n\t\t}\r\n\t\tif (key === \"BONUS\") {\r\n\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\tthis.taskScheduler && this.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode()) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode())\r\n\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(footerViewModel.comp.getProfitBar())\r\n\t\t\t\t\tthis.flying(this.propertyNode.props_particle2D, beginPosition, targetPosition, done, 0.2)\r\n\t\t\t\t}))\r\n\t\t\t}, 2)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate flying(node: Node, beginPosition: Vec3, targetPosition: Vec3, done: Function, delayTime: number = 0) {\r\n\t\tconst targetNode = instantiate(node)\r\n\t\ttargetNode.active = true\r\n\t\tgameBoardViewModel.viewNode.addChild(targetNode)\r\n\t\ttargetNode.setPosition(beginPosition)\r\n\t\tlet middlePosition = new Vec3((beginPosition.x + targetPosition.x) / 2, (beginPosition.y + targetPosition.y) / 2 + 300, 0)\r\n\t\ttween().target(targetNode).to(0.7, { position: targetPosition, scale: new Vec3(0.5, 0.5, 1) }, {\r\n\t\t\tonUpdate: (target: Vec3, t: number) => {\r\n\t\t\t\tif (targetNode) {\r\n\t\t\t\t\ttargetNode.position = this.bezier(t, beginPosition, middlePosition, targetPosition);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).call(() => {\r\n\t\t\tif (delayTime === 0) {\r\n\t\t\t\ttargetNode.destroy()\r\n\t\t\t\tdone()\r\n\t\t\t} else {\r\n\t\t\t\tif (targetNode) {\r\n\t\t\t\t\t// 透明度暂不支持粒子\r\n\t\t\t\t\ttargetNode.getComponent(UIOpacity) && targetNode.addComponent(UIOpacity)\r\n\t\t\t\t\ttween(targetNode.getComponent(UIOpacity)).to(delayTime, { opacity: 0 }).call(() => {\r\n\t\t\t\t\t\ttargetNode.destroy()\r\n\t\t\t\t\t}).start()\r\n\t\t\t\t}\r\n\t\t\t\tdone()\r\n\t\t\t}\r\n\t\t\t// tween(targetNode).to(0.2, { scale: new Vec3(0.5, 0.5, 1) }).start()\r\n\t\t}).start()\r\n\t}\r\n\r\n\tprivate jackPotTypeName = {\r\n\t\t\"BxApple\": JactpotType.APPLE,\r\n\t\t\"BxStrawberry\": JactpotType.STRAWBERRY,\r\n\t\t\"BxGrape\": JactpotType.GRAPE,\r\n\t\t\"BxWatermelon\": JactpotType.WATERMELON,\r\n\t\t\"BxBanana\": JactpotType.BANANA,\r\n\t\t\"up\": JactpotType.LEVEL,\r\n\t}\r\n\r\n\tprivate bezier(t: number, startPos: Vec3, middlePos: Vec3, endPos: Vec3) {\r\n\t\tlet x = (1 - t) * (1 - t) * startPos.x + 2 * t * (1 - t) * middlePos.x + t * t * endPos.x;\r\n\t\tlet y = (1 - t) * (1 - t) * startPos.y + 2 * t * (1 - t) * middlePos.y + t * t * endPos.y;\r\n\t\treturn new Vec3(x, y, 0);\r\n\t}\r\n\r\n\t/**为什么要提出来，因为便于自定执行器调用 */\r\n\tpublic openAwardBox() {\r\n\t\tthis.setState({ openStatus: OpenStatus.OPENING })\r\n\t\tthis.events.onOpenHandler(this.props.boxId)\r\n\t}\r\n\tprotected bindUI(): void {\r\n\t\tthis.taskScheduler = new TaskScheduler(() => {\r\n\t\t\tthis && this.setState && this.setState({ openStatus: OpenStatus.DONE })\r\n\t\t})\r\n\t\tthis.useState((key, value) => {\r\n\t\t\t//执行开箱子的动作\r\n\r\n\t\t}, [\"openStatus\"])\r\n\t}\r\n\r\n\tpublic getOpenStatus() {\r\n\t\treturn this.state.openStatus\r\n\t}\r\n\r\n\tprotected destroyCallBack() {\r\n\t\tthis.taskScheduler.stopQueue(false)\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}