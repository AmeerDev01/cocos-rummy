{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/domino/components/Domino_Card.ts"],"names":["_decorator","instantiate","Node","Sprite","tween","UIOpacity","UITransform","Vec3","BaseComponent","CardPosition","DeskStatus","genCardItem","SpriteFramePathDefine","roomChooseViewModel","sourceManageSeletor","getNodePositionInCanvas","setDeskCardOutline","config","ccclass","property","Domino_Card","cardImageMap","CARD_NUMBER_0","CARD_NUMBER_1","CARD_NUMBER_2","CARD_NUMBER_3","CARD_NUMBER_4","CARD_NUMBER_5","CARD_NUMBER_6","propertyNode","props_spr_card_up","props_spr_card_down","props_grayscale","props_spr_card_bigBg","props_outline","initWidth","initHeight","initY","_isCanOutCard","outAzimuth","nodeCopy","startPos","isInitHide","isCheckedAnime","props","isOutline","deskStatus","newCardItem","upFace","downFace","lastAlignValue","alignValue","position","isAnime","isShow","undefined","isHand","isChecked","isBright","type","poseAzimuth","scale","value","isDisable","events","onOutCard","azimuth","onDestroy","downT","touchDown","tweenValue","start","initState","isDrag","isCanOutCard","dragMove","event","state","startPosition","getUIStartLocation","uiLocation","getUILocation","y","setWorldPosition","x","root","getComponent","convertToNodeSpaceAR","dragEnd","node","off","EventType","TOUCH_MOVE","setProps","backToPosition","bindEvent","outCardNode","mainBoardViewModel","comp","getOutCardWrapNode","on","TOUCH_START","isAllowDrag","dispatch","handle","cardComponent","setInitHide","name","setPosition","setOpacity","addChild","once","TOUCH_CANCEL","time","window","clearTimeout","setTimeout","isValid","clearLangPressStatus","setOutline","active","PLAYING","useProps","key","cur","spriteFrame","getFile","source","setBright","hide","show","setChecked","horizontal","outFlyCard","destroy","setCheckedAnime","offset","stop","to","done","uiTransform","width","getScaleWidth","speed","dealAnimeSpeed","call","uiOpacity","opacity","HORIZONTAL","angle","setScale","getInitWidth","getInitHeight","getScaleHeight","bindUI","transform","height","getWorldPosition","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, find, instantiate, Node, Sprite, Tween, tween, UIOpacity, UITransform, utils, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { CardItem, CardPosition, DeskStatus, genCardItem } from '../type';\r\nimport spriteDefine, { SpriteFramePathDefine } from '../sourceDefine/spriteDefine';\r\nimport { roomChooseViewModel, sourceManageSeletor } from '../index';\r\nimport { getNodePositionInCanvas } from '../../../utils/tool';\r\nimport { setDeskCardOutline } from '../store/action/game';\r\nimport config from '../config';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\tisDrag: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\tdeskStatus: DeskStatus,\r\n\tnewCardItem: CardItem,\r\n\t/**是否只有轮廓 */\r\n\tisOutline?: boolean,\r\n\t/**类型 0：大 1：小 */\r\n\ttype?: 0 | 1\r\n\t/**摆放方位 0：左 1：右 */\r\n\tposeAzimuth?: number\r\n\tindex?: number,\r\n\tupFace?: number,\r\n\tdownFace?: number,\r\n\tposition?: CardPosition,\r\n\tisAnime?: boolean,\r\n\tisShow?: boolean,\r\n\tisChecked?: boolean,\r\n\tisHand?: boolean,\r\n\tisBright?: boolean,\r\n\tlastAlignValue?: number,\r\n\talignValue?: number,\r\n\tscale?: number,\r\n\t/**对应服务器的牌值 */\r\n\tvalue?: number,\r\n\tisDisable?: boolean,\r\n}\r\nexport interface IEvent {\r\n\t/**\r\n\t * 出牌方法\r\n\t * @param value 出牌值，对应服务器的value\r\n\t * @param azimuth 0：左， 1：右\r\n\t * @returns \r\n\t */\r\n\tonOutCard: (value: number, azimuth: 0 | 1) => void,\r\n\tonDestroy: () => void\r\n}\r\n\r\n@ccclass('Domino_Card')\r\nexport class Domino_Card extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate cardImageMap = [\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_0,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_1,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_2,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_3,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_4,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_5,\r\n\t\tSpriteFramePathDefine.CARD_NUMBER_6\r\n\t]\r\n\tprotected propertyNode = {\r\n\t\tprops_spr_card_up: new Sprite(),\r\n\t\tprops_spr_card_down: new Sprite(),\r\n\t\tprops_grayscale: new Node(),\r\n\t\tprops_spr_card_bigBg: new Node(),\r\n\t\tprops_outline: new Node(),\r\n\t}\r\n\r\n\tprivate initWidth = 0;\r\n\tprivate initHeight = 0;\r\n\tprivate initY = 0;\r\n\t// 是否可以出牌了\r\n\tprivate _isCanOutCard = false;\r\n\tprivate outAzimuth = -1;\r\n\r\n\tpublic nodeCopy: Node\r\n\tprivate startPos: Vec3\r\n\t/**是否初始化隐藏 */\r\n\tprivate isInitHide: boolean = true;\r\n\tprivate isCheckedAnime = true;\r\n\r\n\tpublic props: IProps = {\r\n\t\tisOutline: false,\r\n\t\tdeskStatus: null,\r\n\t\tnewCardItem: null,\r\n\t\tupFace: -1,\r\n\t\tdownFace: -1,\r\n\t\tlastAlignValue: -1,\r\n\t\talignValue: -1,\r\n\t\tposition: null,\r\n\t\tisAnime: false,\r\n\t\tisShow: undefined,\r\n\t\tisHand: false,\r\n\t\tisChecked: false,\r\n\t\tisBright: false,\r\n\t\ttype: 0,\r\n\t\tposeAzimuth: -1,\r\n\t\tscale: 0.5,\r\n\t\tvalue: -1,\r\n\t\tisDisable: false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonOutCard: (value: number, azimuth: 0 | 1) => { },\r\n\t\tonDestroy: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\tisDrag: false,\r\n\t\t\tisInitHide: true,\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isCanOutCard() {\r\n\t\treturn this._isCanOutCard;\r\n\t}\r\n\r\n\tprivate dragMove(event: EventTouch) {\r\n\t\tif (this.touchDown === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.state.isDrag = true;\r\n\t\tconst startPosition = event.getUIStartLocation();\r\n\t\tconst uiLocation = event.getUILocation()\r\n\t\t// console.log(`start x ${startPosition.x}, y ${startPosition.y}, move x ${uiLocation.x}, y ${uiLocation.y}`);\r\n\r\n\t\tthis._isCanOutCard = uiLocation.y - startPosition.y >= 50;\r\n\t\tthis.nodeCopy.setWorldPosition(new Vec3(uiLocation.x, uiLocation.y));\r\n\r\n\t\tif (this._isCanOutCard) {\r\n\t\t\tconst position = this.root.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(uiLocation.x, uiLocation.y));\r\n\t\t\tthis.outAzimuth = position.x < 0 ? 0 : 1;\r\n\t\t}\r\n\t}\r\n\tpublic dragEnd() {\r\n\t\tthis.node.off(Node.EventType.TOUCH_MOVE)\r\n\t\tconst isDrag = this.state.isDrag;\r\n\t\tthis.state.isDrag = false;\r\n\t\tif (this._isCanOutCard) {\r\n\t\t\tthis.setProps({ isDisable: true });\r\n\t\t\tthis.events.onOutCard(this.props.value, this.outAzimuth === 0 ? 0 : 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.backToPosition()\r\n\t\tisDrag && this.setProps({ isChecked: false });\r\n\t\tthis._isCanOutCard = false;\r\n\t}\r\n\r\n\tprivate downT = 0;\r\n\tprivate touchDown = 0;\r\n\tprotected bindEvent(): void {\r\n\t\tconst outCardNode = roomChooseViewModel.mainBoardViewModel.comp.getOutCardWrapNode()\r\n\t\tthis.node.on(Node.EventType.TOUCH_START, () => {\r\n\t\t\t// 只有在牌局中才能拖动\r\n\t\t\tif (!this.isAllowDrag()) return;\r\n\t\t\tthis.dispatch(setDeskCardOutline(genCardItem(this.props.value)));\r\n\t\t\tconst handle = () => {\r\n\t\t\t\tthis.nodeCopy = instantiate(this.node)\r\n\t\t\t\tconst cardComponent = this.nodeCopy.getComponent(Domino_Card);\r\n\t\t\t\tcardComponent.setInitHide(false);\r\n\t\t\t\tthis.nodeCopy.name += '_copy';\r\n\t\t\t\tthis.nodeCopy.setPosition(getNodePositionInCanvas(this.node))\r\n\t\t\t\tthis.setOpacity(false)\r\n\t\t\t\toutCardNode.addChild(this.nodeCopy)\r\n\r\n\t\t\t\tthis.node.on(Node.EventType.TOUCH_MOVE, (event) => {\r\n\t\t\t\t\tthis.dragMove(event)\r\n\t\t\t\t})\r\n\t\t\t\tthis.node.once(Node.EventType.TOUCH_CANCEL, (event) => {\r\n\t\t\t\t\tthis.dragEnd()\r\n\t\t\t\t})\r\n\t\t\t\t// this.node.once(Node.EventType.TOUCH_END, (event) => {\r\n\t\t\t\t// \tthis.touchDown = 0;\r\n\t\t\t\t// \tthis.downT && window.clearTimeout(this.downT);\r\n\t\t\t\t// })\r\n\t\t\t}\r\n\r\n\t\t\tif (this.touchDown === 0) {\r\n\t\t\t\t// 长按时长\r\n\t\t\t\tconst time = 100;\r\n\t\t\t\tthis.downT && window.clearTimeout(this.downT);\r\n\t\t\t\tthis.downT = window.setTimeout(() => {\r\n\t\t\t\t\tthis.touchDown = 1;\r\n\t\t\t\t\tthis.props && this.node && this.node.isValid && handle();\r\n\t\t\t\t}, time);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t})\r\n\t}\r\n\r\n\tpublic clearLangPressStatus() {\r\n\t\tthis.touchDown = 0;\r\n\t\tthis.downT && window.clearTimeout(this.downT);\r\n\t}\r\n\r\n\tprivate setOutline() {\r\n\t\tthis.propertyNode.props_outline.active = this.props.isOutline;\r\n\t\tthis.propertyNode.props_grayscale.active = !this.props.isOutline;\r\n\t\tthis.propertyNode.props_spr_card_bigBg.active = !this.props.isOutline;\r\n\t\tthis.propertyNode.props_spr_card_down.node.active = !this.props.isOutline;\r\n\t\tthis.propertyNode.props_spr_card_up.node.active = !this.props.isOutline;\r\n\t}\r\n\r\n\t/**是否允许拖动 */\r\n\tprivate isAllowDrag() {\r\n\t\treturn !this.props.isDisable && this.props.type === 0\r\n\t\t\t&& this.props.deskStatus === DeskStatus.PLAYING\r\n\t\t\t&& this.props.isBright\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === 'isOutline') {\r\n\t\t\tthis.setOutline();\r\n\t\t}\r\n\t\tif (key === \"upFace\" && value.cur >= 0) {\r\n\t\t\tthis.propertyNode.props_spr_card_up.spriteFrame = sourceManageSeletor().getFile(this.cardImageMap[value.cur]).source\r\n\t\t\tthis.setBright(false);\r\n\t\t}\r\n\t\tif (key === \"downFace\" && value.cur >= 0) {\r\n\t\t\tthis.propertyNode.props_spr_card_down.spriteFrame = sourceManageSeletor().getFile(this.cardImageMap[value.cur]).source\r\n\t\t\tthis.setBright(false);\r\n\t\t}\r\n\t\tif (key === \"isShow\") {\r\n\t\t\tif (value.cur === false) {\r\n\t\t\t\tthis.hide(this.props.isAnime)\r\n\t\t\t} else {\r\n\t\t\t\tthis.show(this.props.isAnime)\r\n\t\t\t}\r\n\t\t} else if (key === 'isChecked') {\r\n\t\t\tthis.setChecked(value.cur)\r\n\t\t} else if (key === 'isBright') {\r\n\t\t\tthis.setBright(value.cur);\r\n\t\t} else if (key === 'position') {\r\n\t\t\tthis.horizontal();\r\n\t\t} else if (key === 'type') {\r\n\t\t\tthis.scale();\r\n\t\t} else if (key === 'newCardItem' && value.cur && this.props.isHand) {\r\n\t\t\tif (this.props.value === value.cur.value) {\r\n\t\t\t\tthis.outFlyCard();\r\n\t\t\t\tthis.events.onDestroy();\r\n\t\t\t\tthis.nodeCopy && this.nodeCopy.isValid && this.nodeCopy.destroy();\r\n\t\t\t} else {\r\n\t\t\t\t// 如果拖动过程中不是出的当前拖动的这张牌，就直接销毁\r\n\t\t\t\tthis.clearLangPressStatus();\r\n\t\t\t\tthis._isCanOutCard = false;\r\n\t\t\t\tthis.dragEnd();\r\n\r\n\t\t\t\tthis.isCheckedAnime = false;\r\n\t\t\t\tthis.setProps({ isChecked: false })\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic setCheckedAnime(value: boolean) {\r\n\t\tthis.isCheckedAnime = value;\r\n\t}\r\n\r\n\tprivate tweenValue: Tween<Node>;\r\n\tprivate setChecked(isChecked: boolean) {\r\n\t\tconst offset = isChecked ? this.initY + 20 : this.initY;\r\n\t\tthis.tweenValue && this.tweenValue.stop();\r\n\t\tif (this.isCheckedAnime) {\r\n\t\t\tthis.tweenValue = tween(this.node).to(0.2, { position: new Vec3(this.node.position.x, offset) }).start();\r\n\t\t} else {\r\n\t\t\tthis.node.setPosition(new Vec3(this.node.position.x, offset))\r\n\t\t}\r\n\t\tthis.isCheckedAnime = true;\r\n\t}\r\n\r\n\tprivate setBright(value: boolean) {\r\n\t\tthis.propertyNode.props_grayscale.active = !value;\r\n\t}\r\n\r\n\tpublic show(isAnime: boolean, done?: () => void) {\r\n\t\tconst uiTransform = this.node.getComponent(UITransform)\r\n\t\tif (this.props.type === 1) {\r\n\t\t\tuiTransform.width = this.getScaleWidth();\r\n\t\t\tthis.setOpacity(true);\r\n\t\t} else {\r\n\t\t\tif (isAnime) {\r\n\t\t\t\tconst speed = config.dealAnimeSpeed;\r\n\t\t\t\ttween(uiTransform).to(speed, { width: this.initWidth }).call(() => {\r\n\t\t\t\t\tthis.setOpacity(true)\r\n\t\t\t\t\tdone && done()\r\n\t\t\t\t}).start()\r\n\t\t\t} else {\r\n\t\t\t\tuiTransform.width = this.initWidth;\r\n\t\t\t\tthis.setOpacity(true)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic hide(isAnime: boolean, done?: () => void) {\r\n\t\tthis.setOpacity(false)\r\n\t\tconst uiTransform = this.node.getComponent(UITransform)\r\n\t\tif (this.props.type === 0) {\r\n\t\t\tif (isAnime) {\r\n\t\t\t\ttween(uiTransform).to(0.1, { width: 0 }).call(() => done && done()).start()\r\n\t\t\t} else {\r\n\t\t\t\tuiTransform.width = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate backToPosition() {\r\n\t\ttween(this.nodeCopy).to(0.2, { position: getNodePositionInCanvas(this.node) }).call(() => {\r\n\t\t\tthis.nodeCopy && this.nodeCopy.destroy()\r\n\t\t\tthis.nodeCopy = null;\r\n\t\t\tthis.setOpacity(true)\r\n\t\t}).start()\r\n\t}\r\n\r\n\tpublic setOpacity(show: boolean) {\r\n\t\tif (!this.node || !this.node.isValid) return;\r\n\t\tconst uiOpacity = this.node.getComponent(UIOpacity)\r\n\t\tuiOpacity.opacity = show ? 255 : 0\r\n\t}\r\n\r\n\t/**横向旋转角度 */\r\n\tpublic horizontal() {\r\n\t\t// this.props.type === 1 && console.log(`card ==== poseAzimuth ${this.props.poseAzimuth}, upFace ${this.props.upFace}, downFace: ${this.props.downFace}, alignValue: ${this.props.alignValue} `);\r\n\t\tif (this.props.position === CardPosition.HORIZONTAL) {\r\n\t\t\tif (this.props.alignValue === this.props.upFace) {\r\n\t\t\t\tthis.node.angle = this.props.poseAzimuth === 0 ? -90 : 90;\r\n\t\t\t} else {\r\n\t\t\t\tthis.node.angle = this.props.poseAzimuth === 0 ? 90 : -90;\r\n\t\t\t}\r\n\t\t} else if (this.props.type === 1 && this.props.alignValue >= 0) {\r\n\t\t\tif (this.props.upFace !== this.props.downFace) {\r\n\t\t\t\tif (this.props.alignValue === this.props.upFace) {\r\n\t\t\t\t\tthis.node.angle = this.props.poseAzimuth === 0 ? 180 : 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.node.angle = this.props.poseAzimuth === 0 ? 0 : 180;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**缩放 */\r\n\tprivate scale() {\r\n\t\tif (this.props.type === 1) {\r\n\t\t\tthis.node.setScale(new Vec3(this.props.scale, this.props.scale))\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getInitWidth() {\r\n\t\treturn this.initWidth;\r\n\t}\r\n\r\n\tpublic getInitHeight() {\r\n\t\treturn this.initHeight;\r\n\t}\r\n\r\n\tpublic getScaleWidth() {\r\n\t\treturn this.initWidth * this.props.scale;\r\n\t}\r\n\r\n\tpublic getScaleHeight() {\r\n\t\treturn this.initHeight * this.props.scale;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tconst transform = this.node.getComponent(UITransform)\r\n\t\tthis.initHeight = transform.height;\r\n\t\tthis.initWidth = transform.width;\r\n\t\tthis.initY = this.node.position.y;\r\n\t\t// 拖动复制出来的组件不隐藏\r\n\t\tthis.isInitHide && this.hide(false);\r\n\t}\r\n\r\n\tpublic setInitHide(value: boolean) {\r\n\t\tthis.isInitHide = value;\r\n\t}\r\n\r\n\tprivate outFlyCard() {\r\n\t\tthis.nodeCopy = this.nodeCopy ? this.nodeCopy : this.node;\r\n\t\tthis.nodeCopy && this.nodeCopy.isValid && roomChooseViewModel.mainBoardViewModel.comp.outFlyCard(this.nodeCopy.getWorldPosition());\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}