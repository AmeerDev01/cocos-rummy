{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/starlight/components/Starlight_BigPrize.ts"],"names":["_decorator","Label","Node","sp","BaseComponent","Task","TaskSchedulerDefault","StepNumber","SkeletonAnimationPlayer","ccclass","property","Starlight_BigPrize","glodAmount","winnerConfig","propertyNode","props_sb_lbjs_BIGWIN","props_slots_goldNum","props_layout_goldMin","props_layout_goldMax","props","winning","keepTime","events","killSelfHandler","start","initState","bindEvent","useProps","key","value","cur","active","wintype","titleSkeleton","getComponent","Skeleton","setSkin","defaultSkin","timeScale","nanzhuAnimation","joinqQueue","done","num","string","toFixed","formatAmountWithCommas","changeAnimation","playAnimation","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, log, Node, Skeleton, sp, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { DialogType } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport StepNumber from '../../../utils/StepNumber';\r\nimport SkeletonAnimationPlayer from '../SkeletonPlay';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\twinning?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string;\r\n\t\tdefaultSkin: string;\r\n\t\twintype: string;\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t},\r\n\tglodAmount?: number,\r\n\tkeepTime?: number\r\n}\r\nexport interface IEvent {\r\n\t/**自灭弹窗 */\r\n\tkillSelfHandler: () => void\r\n}\r\n\r\n@ccclass('Starlight_BigPrize')\r\nexport class Starlight_BigPrize extends BaseComponent<IState, IProps, IEvent> {\r\n\tglodAmount = 0\r\n\tstart() { }\r\n\tprivate winnerConfig: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tfileName: string[];\r\n\t\tminRate: number;\r\n\t\tmaxRate: number;\r\n\t}[] = []\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_sb_lbjs_BIGWIN: new Node(),\r\n\t\tprops_slots_goldNum: new Label(),\r\n\t\tprops_layout_goldMin: new Node(),\r\n\t\tprops_layout_goldMax: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\twinning: null,\r\n\t\tglodAmount: 0,\r\n\t\tkeepTime: 3000\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tkillSelfHandler: () => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"winning\") {\r\n\t\t\tthis.winnerConfig = value.cur\r\n\t\t\tif (value.cur) {\r\n\t\t\t\tthis.propertyNode.props_layout_goldMax.active = value.cur.wintype === \"big\"\r\n\t\t\t\tthis.propertyNode.props_layout_goldMin.active = !(value.cur.wintype === \"big\")\r\n\t\t\t\tconst titleSkeleton = this.propertyNode.props_sb_lbjs_BIGWIN.getComponent(sp.Skeleton)\r\n\t\t\t\ttitleSkeleton.setSkin(value.cur.defaultSkin)\r\n\t\t\t\ttitleSkeleton.timeScale = 1\r\n\t\t\t\tlet nanzhuAnimation = new SkeletonAnimationPlayer(titleSkeleton, 'animation2', false, () => { // 动画开始\r\n\t\t\t\t\t// 显示数字\r\n\t\t\t\t\tTaskSchedulerDefault().joinqQueue(new Task((done) => {\r\n\t\t\t\t\t\t(new StepNumber(0,this.glodAmount, (num) => {\r\n\t\t\t\t\t\t\tthis.propertyNode && this.propertyNode.props_slots_goldNum && (this.propertyNode.props_slots_goldNum.string = (+num.toFixed(0)).formatAmountWithCommas())\r\n\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t// window.setTimeout(() => {\r\n\t\t\t\t\t\t\t// \t// this.events.killSelfHandler()\r\n\t\t\t\t\t\t\t// \t//数字展示完了之后，再停留1秒钟\r\n\t\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\t// }, 1000)\r\n\t\t\t\t\t\t})).start()\r\n\t\t\t\t\t}), true)\r\n\t\t\t\t\tnanzhuAnimation.changeAnimation('animation', false, () => {\r\n\t\t\t\t\t\tnanzhuAnimation.changeAnimation('animation3', false, () => {\r\n\t\t\t\t\t\t\t this.events.killSelfHandler()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\tnanzhuAnimation.playAnimation()\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"glodAmount\") {\r\n\t\t\tthis.glodAmount = value.cur\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n"]}