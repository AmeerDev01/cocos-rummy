{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/egypt/Slot/Command/BgCommand.ts"],"names":["BgCommand","DialogType","BgMediatorConst","RollerMediatorConst","SubGameType","config","getBgProxy","getSocketProxy","BaseCommand","AudioManager","SceneBgMusic","SoundList","UseSetOption","BgCommandConst","listExecute","type","INIT_MAIN_PANEL","handler","notification","AUTH","sendAnth","GAME_TYPE_CHANGE","done","getBody","fbp","nextGame","getIsChangeGameRunning","sendNotification","REMOVE_THECHEST_LAYER","iconStay","getTransferGameInfo","getIconStay","gameTypePre","getLastGame","gameTypeNew","INITSCORE","state","window","setTimeout","MAIN","SUB_GAME2","SUB_GAME1","setIsChangeNextGameType","getInstance","playMusic","mainBg","TOGGLESSCROLLINGPANELS","gameType","UPDATE_GAME_STATUS","playSound","admission","gameBg","gameBgT","UPDATE_BET_AMOUNT","order","updateBetAmount","AUTO_LAUNCH","checkAutoLaunch","sendLaunch","getNextGame","subtractAutoLaunchTimes","SHOW_DIALOG_WIN","dialogType","amount","keepTime","_amount","getCurrentScore","_keepTime","magnification","getMagnification","win","winning","find","item","minRate","maxRate","BIG_WIN","name","MEGA_WIN","SUPER_WIN","JACKPOT","str","getShiftAmount","baseBetAmount","value","Instance","setGameOption","betTarget","lineCount","linesQueue","length","execute"],"mappings":"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","sourcesContent":["import Facade from \"../../Framework/care/Facade\"\r\nimport { INotification } from \"../../Framework/interfaces/INotification\"\r\nimport { DialogType } from \"../Component/Egypt_DialogWin\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SubGameType } from \"../Proxy/SocketProxy\";\r\nimport config from \"../config\";\r\nimport { getBgProxy, getSocketProxy } from \"../utils\";\r\nimport { BaseCommand, IListExecute } from './BaseCommand'\r\nimport { AudioManager, SceneBgMusic, SoundList } from \"../Managr/AudioManager\";\r\nimport UseSetOption from \"db://assets/script/utils/UseSetOption\";\r\n\r\nexport enum BgCommandConst {\r\n\tAUTH = \"authentication\",\r\n\t/**切换游戏界面 */\r\n\tGAME_TYPE_CHANGE = \"gameTypeChange\",\r\n\t/**检查自动启动启动，如果是就进行下一局 */\r\n\tAUTO_LAUNCH = \"autoLaunch\"\r\n}\r\n\r\n// const listNotificationConst: Array<IlistNotificationer<FruitsSlotCommand>> = [\r\n// \t{\r\n// \t\ttype: MainSlotViewType.INIT_MAIN_PANEL,\r\n// \t\thandler(notification: INotification) {\r\n\r\n// \t\t\treturn false\r\n// \t\t}\r\n// \t}\r\n// ]\r\n\r\nexport class BgCommand extends BaseCommand {\r\n\tprotected listExecute: Array<IListExecute<BgCommand>> = [\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.INIT_MAIN_PANEL,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\t// this.updateBetAmount(\"curr\")\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tgetSocketProxy().sendAnth()\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.GAME_TYPE_CHANGE,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { done } = notification.getBody();\r\n\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\tconst nextGame = fbp.getIsChangeGameRunning()\r\n\t\t\t\tthis.sendNotification(RollerMediatorConst.REMOVE_THECHEST_LAYER, { iconStay: getSocketProxy().getTransferGameInfo().getIconStay() })\r\n\t\t\t\tif (nextGame !== -1) {\r\n\t\t\t\t\t// //开始切换屏幕\r\n\t\t\t\t\t// this.sendNotification(CommandDefine.BG, { gameTypePre: fbp.getLastGame(), gameTypeNew: nextGame }, FruitsBgCommandConst.GAME_TYPE_CHANGE)\r\n\t\t\t\t\t// const { gameTypePre, gameTypeNew } = notification.getBody()\r\n\t\t\t\t\tconst gameTypePre = fbp.getLastGame()\r\n\t\t\t\t\tconst gameTypeNew = nextGame\r\n\t\t\t\t\t// 播放飞水果动画,2秒的时候悄悄切换界面\r\n\t\t\t\t\tthis.sendNotification(BgMediatorConst.INITSCORE, { state: true })\r\n\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t// 先卸载之前的游戏，由于是渐出，所以给一个时间\r\n\t\t\t\t\t\tif (gameTypePre === SubGameType.MAIN || gameTypePre === SubGameType.SUB_GAME2) {\r\n\t\t\t\t\t\t\t//this.sendNotification(CommandDefine.ROLLER, {}, RollerMediatorConst.UNINSTALL_ROLLER_PANEL)\r\n\t\t\t\t\t\t} else if (gameTypePre === SubGameType.SUB_GAME1) {\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\tif (gameTypeNew === SubGameType.MAIN) {\r\n\t\t\t\t\t\t\t\tgetBgProxy().setIsChangeNextGameType(gameTypePre, 0)\r\n\t\t\t\t\t\t\t\tAudioManager.getInstance().playMusic(SceneBgMusic.mainBg, true)\r\n\t\t\t\t\t\t\t\tthis.sendNotification(BgMediatorConst.TOGGLESSCROLLINGPANELS, { gameType: 0, done })\r\n\t\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, { gameType: 0 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t\tthis.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME1) {\r\n\t\t\t\t\t\t\t\tAudioManager.getInstance().playSound(SoundList.admission);\r\n\t\t\t\t\t\t\t\tAudioManager.getInstance().playMusic(SceneBgMusic.gameBg, true)\r\n\t\t\t\t\t\t\t\tthis.sendNotification(BgMediatorConst.TOGGLESSCROLLINGPANELS, { gameType: 1, done })\r\n\t\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, { gameType: 1 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME2) {\r\n\t\t\t\t\t\t\t\t//大滑槽\r\n\t\t\t\t\t\t\t\tAudioManager.getInstance().playMusic(SceneBgMusic.gameBgT, true)\r\n\t\t\t\t\t\t\t\tthis.sendNotification(BgMediatorConst.TOGGLESSCROLLINGPANELS, { gameType: 2, done })\r\n\t\t\t\t\t\t\t\t// this.sendNotification(CommandDefine.ROLLER, { gameType: 2 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 300)\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdone && done();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// {\r\n\t\t// \ttype: BgMediatorConst.UPDATE_NUMBER,\r\n\t\t// \thandler(notification: INotification) {\r\n\t\t// \t\tconst betAmount = this.getSocketProxy().getRepository().userServerData\r\n\t\t// \t\treturn {\r\n\t\t// \t\t\tbetAmount: betAmount,\r\n\t\t// \t\t\tscore: 0\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// },\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.UPDATE_BET_AMOUNT,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { order } = notification.getBody()\r\n\t\t\t\treturn this.updateBetAmount(order)\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTO_LAUNCH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tif (getBgProxy().checkAutoLaunch()) {\r\n\t\t\t\t\tgetSocketProxy().sendLaunch()\r\n\r\n\t\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\t\tif (fbp.getNextGame() === SubGameType.MAIN) {\r\n\t\t\t\t\t\tgetBgProxy().subtractAutoLaunchTimes()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.SHOW_DIALOG_WIN,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { dialogType, amount, keepTime, order, done } = notification.getBody()\r\n\t\t\t\tconst _amount = amount || getSocketProxy().getTransferGameInfo().getCurrentScore(order)\r\n\t\t\t\tconst _keepTime = keepTime || 2500\r\n\t\t\t\t//获取奖励类型\r\n\t\t\t\tconst magnification = getSocketProxy().getTransferGameInfo().getMagnification()\r\n\t\t\t\tconst win = config.winning.find(item => item.minRate <= magnification && magnification <= item.maxRate)\r\n\t\t\t\tif (win && !dialogType) {\r\n\t\t\t\t\tlet dialogType: DialogType = DialogType.BIG_WIN;\r\n\t\t\t\t\tswitch (win.name) {\r\n\t\t\t\t\t\tcase \"bigwin\": dialogType = DialogType.BIG_WIN; break;\r\n\t\t\t\t\t\tcase \"megawin\": dialogType = DialogType.MEGA_WIN; break;\r\n\t\t\t\t\t\tcase \"superwin\": dialogType = DialogType.SUPER_WIN; break;\r\n\t\t\t\t\t\tcase \"jackpot\": dialogType = DialogType.JACKPOT; break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t} else if (dialogType) {\r\n\t\t\t\t\t//如果dialogType被强制赋值，那么就会强制显示\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdone()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t]\r\n\tprivate updateBetAmount(order: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n\t\tlet str = getSocketProxy().getShiftAmount(order)\r\n\t\tconst baseBetAmount = str.value\r\n\t\tUseSetOption.Instance().setGameOption(\"egypt\", { betTarget: str })\r\n\t\tconst lineCount = config.linesQueue.length\r\n\t\treturn { baseBetAmount, lineCount }\r\n\t}\r\n\tpublic execute(notification: INotification): void {\r\n\t\tsuper.execute(notification)\r\n\t}\r\n}\r\n"]}