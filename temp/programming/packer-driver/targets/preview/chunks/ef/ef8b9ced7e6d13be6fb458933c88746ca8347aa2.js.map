{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenix/Slot/Component/phoenix_Roller.ts"],"names":["_decorator","instantiate","Mask","Node","Prefab","Size","tween","UITransform","Vec3","phoenix_BaseComponent","config","AudioManager","SoundList","ccclass","property","phoenix_Roller","rollerDataRep","isRoll","rollerData","rollerIndex","endFlag","initStartIndex","lastJoinIconIndex","stopHandler","isSpeed","start","bindUI","getRollProxy","getRepository","rootUi","root","getComponent","anchorY","rollerUi","RollerLayOut","data","length","setContentSize","intervalWidth","rollerWidth","intervalHeight","rollerheight","portraitNum","setPosition","position","x","i","icon","y","addChild","index","setFace","initRollerLayOut2","RollerLayOut2","bindEvent","bindRollerData","playYuanbao","children","forEach","startRoll","stopIndex","joinIcon","setStopIndex","setEffect","node","enabled","stopRoll","cbFn","addLastJoinIconIndex","showResult","setEndFlag","flag","setSiblingIndex","stopCallBack","getInstance","playSound","theRollerStops","destroy","setIconEffect","mode","target","allState","comp","some","iconId","iconIndex","playFreeGae","addDockIcon","targetArr","removeAllDockIcon","item","find","name","id","hiddenAmounts","e","console","error","removeAllChildren","togglesThePopUpLayerState","state","active","amountNum","rollWithCell","to","rollSpeed","window","setTimeout","deviation","Math","abs","_lastJoinIconIndex","count","easing","call","lastChild","value","newValue","update","deltaTime","speed","lateUpdate"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Mask, Node, Prefab, Size, tween, UITransform, Vec3 } from 'cc';\r\nimport phoenix_BaseComponent from './phoenix_BaseComponent';\r\nimport { RollerType, SlotRepository } from '../Repositories/SlotRepository';\r\nimport { phoenix_Icon } from './phoenix_Icon';\r\nimport { SlotProxy } from '../Proxy/SlotProxy';\r\nimport config from '../phoenix_config';\r\nimport { AudioManager, SoundList } from '../Managr/AudioManager';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 动画停止回调\r\n */\r\ntype StopHandlerType = (rollerIndex: number, rollerData: RollerType) => void\r\n\r\n@ccclass('phoenix_Roller')\r\nexport class phoenix_Roller extends phoenix_BaseComponent {\r\n    @property(Node)\r\n    RollerLayOut: Node = null\r\n\r\n    @property(Node)\r\n    RollerLayOut2: Node = null\r\n\r\n    // @property(Node)\r\n    // bubble: Node = null\r\n\r\n    @property(Prefab)\r\n    icon: Prefab = null\r\n\r\n    @property(Prefab)\r\n    icon2: Prefab = null\r\n\r\n    private rollerDataRep: SlotRepository\r\n    private isRoll = false\r\n    private rollerData: RollerType\r\n    /**第几条滑槽，序号 */\r\n    private rollerIndex: number\r\n    /**此值存在，即要检测停止了 */\r\n    private endFlag: boolean = true\r\n    /**初始化时，图标开始的排列序号 */\r\n    private initStartIndex = 0\r\n    /**下一个要加入的图标 */\r\n    private lastJoinIconIndex = 0\r\n    // private target: number = -1\r\n    /**动态效果停止后的动态回调函数 */\r\n    private stopHandler: StopHandlerType\r\n\r\n    private isSpeed = false;\r\n\r\n    start() {\r\n    }\r\n\r\n    protected bindUI(): void {\r\n        this.rollerDataRep = this.getRollProxy().getRepository();\r\n        // const layout = this.RollerLayOut.getComponent(Layout)\r\n        // layout.spacingY = this.rollerData.roller.intervalHeight\r\n        // 配置滑槽宽高度(也就是蒙板宽高)\r\n        const rootUi = this.root.getComponent(UITransform) as UITransform\r\n        rootUi.anchorY = 1\r\n        const rollerUi = this.RollerLayOut.getComponent(UITransform) as UITransform\r\n        // rootUi.anchorX = 0\r\n        rollerUi.anchorY = 1\r\n        // rollerUi.anchorX = 0\r\n        this.lastJoinIconIndex = this.initStartIndex - 1\r\n        this.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n        // 设置蒙版组件高度\r\n        rootUi.setContentSize(new Size(this.rollerData.intervalWidth + this.rollerData.rollerWidth,\r\n            ((this.rollerData.intervalHeight + this.rollerData.rollerheight) * this.rollerData.portraitNum) + this.rollerData.intervalHeight))\r\n        //设置滑道高度，多一个高度\r\n        rollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n            (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum + 1)))\r\n        // 滑道网上顶一个单位（但是上沿有遮挡，再降30）\r\n        this.RollerLayOut.setPosition(this.RollerLayOut.position.x, (this.rollerData.intervalHeight + this.rollerData.rollerheight) - this.rollerData.intervalHeight)\r\n        // 初始化即将开始的图标\r\n        for (let i = 0; i < this.rollerData.portraitNum; i++) {\r\n            const icon = instantiate(this.icon)\r\n            icon.setPosition(new Vec3(0, icon.position.y - (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (i + 1)))\r\n            this.RollerLayOut.addChild(icon);\r\n            const index = this.initStartIndex + i;\r\n            (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).setFace(this.rollerData.data[index])\r\n\r\n        }\r\n        // this.bubble.active = this.rollerData.isBigIcon\r\n        this.initRollerLayOut2()\r\n    }\r\n\r\n    private initRollerLayOut2() {\r\n        const rollerUi = this.RollerLayOut2.getComponent(UITransform) as UITransform\r\n        rollerUi.anchorY = 1\r\n        rollerUi.setContentSize(new Size(this.rollerData.rollerWidth,\r\n            (this.rollerData.intervalHeight + this.rollerData.rollerheight) * (this.rollerData.portraitNum)))\r\n    }\r\n\r\n\r\n    protected bindEvent(): void {\r\n\r\n    }\r\n\r\n    /**指定滑槽数据 */\r\n    public bindRollerData(rollerIndex: number, data: RollerType) {\r\n        this.rollerData = data\r\n        this.rollerIndex = rollerIndex\r\n    }\r\n    // 元宝动画\r\n    playYuanbao(i) {\r\n        if (i == 0) {\r\n            i = 2\r\n        } else if (i == 2) {\r\n            i = 0\r\n        }\r\n        this.RollerLayOut.children.forEach((icon, index) => {\r\n            if (i == index) { // 确认元宝位置\r\n                (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).playYuanbao();\r\n            }\r\n        })\r\n    }\r\n    /**\r\n     * 开始滚动\r\n     * @param stopIndex 设定要停止的序号（从1开始的）\r\n     */\r\n    public startRoll(stopIndex: number, isSpeed: boolean = false) {\r\n        this.isSpeed = isSpeed;\r\n        // 往上移动一个网格，以便放上下一个要显示的icon\r\n        this.joinIcon();\r\n        // console.log(this.rollerIndex, stopIndex);\r\n        (this.getRollProxy() as SlotProxy).setStopIndex(this.rollerIndex, stopIndex)\r\n        this.isRoll = true\r\n        this.endFlag = false\r\n        this.RollerLayOut.children.forEach(icon => {\r\n            (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).setEffect()\r\n        })\r\n        this.node.getComponent(Mask).enabled = true\r\n        // this.rollWithCell('down')\r\n        // console.log(this.getRollProxy().getRepository())\r\n\r\n        // if (this.isSpeed) {\r\n        // }\r\n    }\r\n\r\n    // 停止滚动\r\n    public stopRoll(cbFn: StopHandlerType) {\r\n        this.endFlag = true\r\n        this.stopHandler = cbFn\r\n        this.addLastJoinIconIndex(this.rollerData.showResult.stopIndex, 3);\r\n        // (this.getRollProxy() as FruitsSlotProxy).setStopIndex(this.rollerIndex)\r\n    }\r\n\r\n    public setEndFlag(flag: boolean) {\r\n        this.endFlag = flag\r\n    }\r\n\r\n    private joinIcon() {\r\n        // this.lastJoinIconIndex === this.rollerData.data.length && (this.lastJoinIconIndex = 0)\r\n        // console.log(this.lastJoinIconIndex)\r\n        const icon = instantiate(this.icon)\r\n        icon.setPosition(icon.position.x, 0)\r\n        this.RollerLayOut.addChild(icon);\r\n        (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).setFace(this.rollerData.data[this.lastJoinIconIndex])\r\n        icon.setSiblingIndex(0)\r\n        this.lastJoinIconIndex--\r\n        this.lastJoinIconIndex === -1 && (this.lastJoinIconIndex = this.rollerData.data.length - 1)\r\n        // this.RollerLayOut.removeChild(this.RollerLayOut.children[this.RollerLayOut.children.length - 1])\r\n        // this.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n    }\r\n\r\n    private stopCallBack() {\r\n        this.node.getComponent(Mask).enabled = false\r\n        this.stopHandler && this.stopHandler(this.rollerIndex, this.rollerData)\r\n        \r\n        // this.RollerLayOut.children.forEach(icon => {\r\n        // \tconst comp = (<Icon>icon.getComponent(\"dragon_Icon\"))\r\n        // \tif (comp.iconId === this.target) {\r\n        // \t\tcomp.setEffect('animation')\r\n        // \t}\r\n        // })\r\n\r\n        AudioManager.getInstance().playSound(SoundList.theRollerStops)\r\n        this.RollerLayOut.children[this.RollerLayOut.children.length - 1].destroy()\r\n    }\r\n\r\n    /**\r\n     * 设置当前滑槽的闪动图标()\r\n     * @param mode 传入的是光标id，还是左边序列号\r\n     * @param target 光标位置或者y轴坐标序列\r\n     */\r\n    public setIconEffect(mode: 'index' | 'coord', target: number[], allState: boolean = false) {\r\n        if (mode === 'index') {\r\n            this.RollerLayOut.children.forEach(icon => {\r\n                const comp = (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\"))\r\n                if (target.some(i => i === comp.iconId)) {\r\n                    comp.setEffect(1)\r\n                } else {\r\n                    comp.setEffect()\r\n                }\r\n            })\r\n        } else {\r\n            let iconIndex = this.rollerData.portraitNum\r\n            this.RollerLayOut.children.forEach((icon, index) => {\r\n                iconIndex--\r\n                const comp = (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\"))\r\n                if (target.some(i => i === iconIndex)) {\r\n                    comp.setEffect(1)\r\n                    comp.playFreeGae(true);\r\n                } else {\r\n                    if (allState) {\r\n                        comp.setEffect()\r\n                    }\r\n                }\r\n            })\r\n\r\n\r\n            //向上数第几个光标闪动\r\n            // for (let i = 2; i >= 0; i--) {\r\n            // \tconst comp = (<Icon>this.RollerLayOut.children[i].getComponent(\"dragon_Icon\"))\r\n            // \tif (!comp) continue\r\n            // \tif (i === target) {\r\n            // \t\tcomp.setEffect(1)\r\n            // \t} else {\r\n            // \t\tcomp.setEffect()\r\n            // \t}\r\n            // }\r\n            this.RollerLayOut.children.forEach((icon, index) => {\r\n                const comp = (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\"))\r\n\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加停靠图标\r\n     * @param index 停靠的序号，从下到上\r\n     */\r\n    public addDockIcon(targetArr: number[]) {\r\n        this.removeAllDockIcon()\r\n        targetArr.forEach((item, index) => {\r\n            try {\r\n                const icon = instantiate(this.RollerLayOut.children[this.rollerData.portraitNum - 1 - item[0]]);\r\n                (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).setFace(config.icon.find(i => i.name === 'baohe').id);\r\n                (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).setEffect(1);\r\n                (<phoenix_Icon>icon.getComponent(\"phoenix_Icon\")).hiddenAmounts(true, item[1])\r\n                // const _index = this.rollerData.portraitNum - index\r\n                icon.setPosition(new Vec3(0, icon.position.y - this.rollerData.intervalHeight))\r\n                this.RollerLayOut2.addChild(icon);\r\n            } catch (e) {\r\n                console.error(this.RollerLayOut.children[this.rollerData.portraitNum - 1 - item[0]])\r\n            }\r\n        })\r\n    }\r\n\r\n    public removeAllDockIcon() {\r\n        this.RollerLayOut2.removeAllChildren()\r\n    }\r\n\r\n    //隐藏显示弹出层2\r\n    public togglesThePopUpLayerState(state: boolean = false) {\r\n        this.RollerLayOut2.active = state\r\n    }\r\n\r\n    public hiddenAmounts(state, amountNum) {\r\n        this.RollerLayOut.children.forEach(icon => {\r\n            (<phoenix_Icon>icon.getComponent(\"dragon_Icon\")).hiddenAmounts(state, amountNum)\r\n        })\r\n    }\r\n\r\n    /**滚动一个格子 */\r\n    private rollWithCell(position: 'up' | 'down') {\r\n        if (this.isRoll) {\r\n            this.RollerLayOut.children.forEach(icon => {\r\n                // icon.setPosition(new Vec3(icon.position.x, icon.position.y - this.rollerData.rollSpeed))\r\n                tween(icon).to(this.rollerData.rollSpeed / 1000, { position: new Vec3(icon.position.x, icon.position.y - ((this.rollerData.intervalHeight + this.rollerData.rollerheight))) }).start()\r\n            })\r\n            window.setTimeout(() => {\r\n                if (this.RollerLayOut.children.length) {\r\n                    // if (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n                    const deviation = Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n                    this.joinIcon()\r\n                    // 这里要注意\r\n                    let _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n                    if (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n                        _lastJoinIconIndex = 0\r\n                    }\r\n                    if (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n                        this.isRoll = false\r\n                        let count = 0\r\n                        this.RollerLayOut.children.forEach(icon => {\r\n                            tween().target(icon).to(this.rollerData.rollSpeed / 1000 + 0.3, {\r\n                                position: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n                            }, {\r\n                                easing: \"backOut\"//\"elasticOut\"\r\n                            }).call(() => {\r\n                                count++\r\n                                if (count === this.RollerLayOut.children.length) {\r\n                                    this.stopCallBack()\r\n                                }\r\n                            }).start()\r\n                        })\r\n                    }\r\n                    // }\r\n                    const lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n                    if (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n                        lastChild.destroy()\r\n                    }\r\n                    this.rollWithCell(position)\r\n                }\r\n            }, this.rollerData.rollSpeed)\r\n        }\r\n    }\r\n\r\n    private addLastJoinIconIndex(stopIndex: number, value: number) {\r\n        let newValue = stopIndex + value;\r\n        if (newValue >= this.rollerData.data.length) {\r\n            this.lastJoinIconIndex = newValue - this.rollerData.data.length;\r\n        } else {\r\n            this.lastJoinIconIndex = newValue;\r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this.isRoll) {\r\n            this.RollerLayOut.children.forEach(icon => {\r\n                const speed = this.rollerData.rollSpeed;\r\n                icon.setPosition(new Vec3(icon.position.x, icon.position.y - speed))\r\n            })\r\n            if (this.RollerLayOut.children.length) {\r\n                if (this.RollerLayOut.children[0].position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight)) {\r\n                    const deviation = 0// Math.abs(this.RollerLayOut.children[0].position.y) - (this.rollerData.rollerheight + this.rollerData.intervalHeight) //瞬时的纵向误差\r\n                    this.joinIcon()\r\n\r\n                    // 这里要注意\r\n                    let _lastJoinIconIndex = this.lastJoinIconIndex + 1\r\n                    if (this.lastJoinIconIndex + 1 >= this.rollerData.data.length) {\r\n                        _lastJoinIconIndex = 0\r\n                    }\r\n                    // console.log(`rollindex: ${this.rollerIndex}, end: ${this.endFlag}, stopIndex: ${this.rollerData.showResult.stopIndex} , lastindex: ${_lastJoinIconIndex}`);\r\n                    if (this.endFlag && this.rollerData.showResult.stopIndex - 1 === _lastJoinIconIndex) {\r\n                        this.isRoll = false\r\n                        let count = 0\r\n                        this.RollerLayOut.children.forEach((icon, index) => {\r\n                            tween().target(icon).to(0.5, {\r\n                                position: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight) + index * 18)\r\n                            }, {\r\n                                easing: \"backOut\"//\"elasticOut\"\r\n                            }).call(() => {\r\n                                count++\r\n                                if (count === this.RollerLayOut.children.length) {\r\n                                    this.stopCallBack()\r\n                                }\r\n                            }).start()\r\n                        })\r\n                    }\r\n                }\r\n                const lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n                if (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n                    lastChild.destroy()\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    lateUpdate() {\r\n        // if (this.RollerLayOut.children.length) {\r\n        // \tconst lastChild = this.RollerLayOut.children[this.RollerLayOut.children.length - 1]\r\n        // \tif (lastChild.position.y <= -(this.rollerData.rollerheight + this.rollerData.intervalHeight) * (this.rollerData.portraitNum + 1)) {\r\n        // \t\tlastChild.destroy()\r\n        // \t}\r\n        // }\r\n    }\r\n}\r\n\r\n"]}