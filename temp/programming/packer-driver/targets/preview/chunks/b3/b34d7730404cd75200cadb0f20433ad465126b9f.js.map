{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/Crash/manager/AudioManager.ts"],"names":["AudioManager","assert","AudioClip","clamp01","LocalStorageUtils","LOCAL_DATA_KEY","Singleton","SceneBgMusic","mainBg","SoundList","buttonClick","bingo","ding","xiu","audioSource","soundVolume","MusicVolum","AudioClipArray","getInstance","_getInstance","init","_bundle","Promise","resolve","reject","loadDir","err","clip","console","warn","updateTheMusicStatus","OPTION","getItem","JSON","sound","music","setMusicVolume","setAudioSource","playMusic","name","loop","isValid","pauseMusic","find","item","info","playing","play","pause","resumeMusic","playSound","playOneShot","volume","flag","setSoundVolume","openMusic","closeMusic","cb","destroy","openSound","closeSound"],"mappings":"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","sourcesContent":["import { assert, AudioClip, AudioSource, clamp01 } from \"cc\";\r\nimport LocalStorageUtils, { LOCAL_DATA_KEY } from \"../utils/LocalStorageUtils\";\r\nimport Singleton from \"./Singleton\";\r\nexport const SceneBgMusic = {\r\n    mainBg: \"main_bgm\", // 背景音乐\r\n}\r\nexport const SoundList = {\r\n    buttonClick: \"btn_click\", //点击按钮\r\n    bingo:\"bingo\", //爆炸\r\n    ding:\"ding\", //亮晶晶\r\n    xiu:\"xiu\", //火箭发射\r\n}\r\nexport  class AudioManager extends Singleton {\r\n    //private static instance: AudioManager = null;\r\n    private audioSource?: AudioSource = null;\r\n    private soundVolume: number = 1;\r\n    private MusicVolum: number = 1;\r\n    private AudioClipArray=[]\r\n    public static getInstance() : AudioManager {\r\n        return super._getInstance<AudioManager>();\r\n    }\r\n    public init(_bundle){\r\n        return new Promise((resolve,reject)=>{\r\n            _bundle.loadDir(\"res/audio\" , AudioClip, (err, clip)=> {\r\n                if (err) {\r\n                    console.warn('load audioClip failed: ', err);\r\n                    reject(err)\r\n                    return;\r\n                }\r\n                resolve(true)\r\n                this.AudioClipArray=clip\r\n            })\r\n        })\r\n\r\n    }\r\n    public updateTheMusicStatus(){\r\n        let OPTION = LocalStorageUtils.getItem(LOCAL_DATA_KEY.OPTION, JSON, true);\r\n        this.soundVolume = OPTION.sound ? 1 : 0;\r\n        this.MusicVolum = OPTION.music ? 0.5 : 0;\r\n        this.setMusicVolume(this.MusicVolum);\r\n    }\r\n    public setAudioSource(audioSource: AudioSource) {\r\n        let OPTION = LocalStorageUtils.getItem(LOCAL_DATA_KEY.OPTION, JSON, true);\r\n        this.audioSource = audioSource;\r\n        this.soundVolume = OPTION.sound ? 1 : 0;\r\n        this.MusicVolum = OPTION.music ? 0.5 : 0;\r\n        this.setMusicVolume(this.MusicVolum);\r\n    }\r\n    public playMusic(name: string, loop: boolean) {\r\n        if(!this.audioSource || !this.audioSource.isValid) return;\r\n        assert(this.audioSource, 'AudioManager not inited!');\r\n        if(name == \"\") { return; }\r\n        // if(!(this.audioSource.volume > 0)) {\r\n        //     return;\r\n        // }\r\n        this.pauseMusic()\r\n        this.audioSource.loop = loop;\r\n        let music=this.AudioClipArray.find(item=>item.name===name)\r\n        if(music){\r\n            if(!this.audioSource || !this.audioSource.isValid) return;\r\n            console.info(\"playMusic \", name);\r\n            this.audioSource.clip = music;\r\n            if (!this.audioSource.playing) {\r\n                this.audioSource.play();\r\n            }\r\n        }else {\r\n            console.info(\"audioNotFound \", name);\r\n        }\r\n\r\n        // this.bundle.load(\"audio/\" + name, AudioClip, (err, clip)=> {\r\n        //     if (err) {\r\n        //         console.warn('load audioClip failed: ', err);\r\n        //         return;\r\n        //     }\r\n        //     if(!this.audioSource || !this.audioSource.isValid) return;\r\n        //     console.info(\"playMusic \", name);\r\n        //     this.audioSource.clip = clip;\r\n        //     if (!this.audioSource.playing) {\r\n        //         this.audioSource.play();\r\n        //     }\r\n        // });\r\n    }\r\n\r\n    public pauseMusic() {\r\n        if(!this.audioSource || !this.audioSource.isValid) { return; }\r\n        this.audioSource.playing && this.audioSource.pause();\r\n    }\r\n\r\n    public resumeMusic() {\r\n        if(!this.audioSource || !this.audioSource.isValid) { return; }\r\n\r\n        this.audioSource.playing && this.audioSource.play();\r\n    }\r\n\r\n    public playSound(name: string) {\r\n        if(!(this.soundVolume > 0)) {\r\n            return;\r\n        }\r\n        if(!this.audioSource || !this.audioSource.isValid) return;\r\n        name = name ?? \"\";\r\n        assert(this.audioSource, 'AudioManager not inited!');\r\n        let sound=this.AudioClipArray.find(item=>item.name===name)\r\n        if(sound){\r\n            if(!this.audioSource || !this.audioSource.isValid) return;\r\n            console.info(\"playSound \", name);\r\n            this.setMusicVolume(this.soundVolume)\r\n            this.audioSource.playOneShot(sound, this.audioSource.volume ? this.audioSource.volume / this.soundVolume : this.soundVolume);\r\n            this.setMusicVolume(this.MusicVolum)\r\n        }else {\r\n            console.info(\"audioNotFound \", name);\r\n        }\r\n        // this.bundle.load(\"audio/\" + name, AudioClip, (err, clip)=> {\r\n        //     if (err) {\r\n        //         console.warn('load audioClip failed: ', err);\r\n        //         return;\r\n        //     }\r\n        //     if(!this.audioSource || !this.audioSource.isValid) return;\r\n        //     console.info(\"playSound \", name);\r\n        //     this.setMusicVolume(this.soundVolume)\r\n        //     this.audioSource.playOneShot(clip, this.audioSource.volume ? this.audioSource.volume / this.soundVolume : this.soundVolume);\r\n        //     this.setMusicVolume(this.MusicVolum)\r\n        // });\r\n    }\r\n\r\n    private setMusicVolume (flag: number) {\r\n        assert(this.audioSource, 'AudioManager not inited!');\r\n        flag = clamp01(flag);\r\n        this.audioSource.volume = flag;\r\n    }\r\n\r\n    private setSoundVolume (flag: number) {\r\n        this.soundVolume = flag;\r\n    }\r\n\r\n    public openMusic () {\r\n        this.setMusicVolume(0.5);\r\n    }\r\n\r\n    public closeMusic (cb) {\r\n        this.setMusicVolume(0);\r\n        this.audioSource.destroy()\r\n        cb()\r\n    }\r\n\r\n    public openSound () {\r\n        this.setSoundVolume(1);\r\n    }\r\n\r\n    public closeSound () {\r\n        this.setSoundVolume(0);\r\n    }\r\n}\r\n"]}