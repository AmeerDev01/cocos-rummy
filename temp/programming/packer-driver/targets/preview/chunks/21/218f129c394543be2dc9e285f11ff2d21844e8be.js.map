{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenix/Slot/Proxy/SocketProxy.ts"],"names":["SocketProxy","CommandDefine","ProxyDefine","BgMediatorConst","RollerMediatorConst","SocketRepository","config","getBgProxy","BaseProxy","global","lang","addToastAction","SubGameType","goldState","SKT_MAG_TYPE","dataMap","sktMsgListener","add","key","id","handler","sortId","item","find","i","handlerList","push","dispath","data","sort","a","b","forEach","remove","filter","removeAllListener","constructor","proxyName","ws","heartBeatTimer","socketConfig","switcher","repository","initSocket","cbFn","err","WebSocket","OPEN","readyState","close","socketIp","onopen","event","console","log","connectCallback","window","setInterval","sendSktMessage","HEART_BEAT","undefined","onerror","onmessage","ev","onclose","clearInterval","e","sendNotification","SHOW_TOAST","content","evData","JSON","parse","heartbeat","gameCode","jackpot","JACKPOT_TOTAL","code","msgArr","split","success","error","typeCode","hallDispatch","write","k","WebSocketModule","socketConnectDateFail","placeStr","includes","closeSubGame","confirmContent","msgType","send","stringify","closeSocket","sendAnth","AUTH","token","gameId","roomId","calculateTheBalanceStatus","gold","rollerLaunchResult","dl","si","balanceAfterSettlement","betAmount","getShiftAmount","value","linesQueue","length","InsufficientBalanceDisplay","bl","sendLaunch","openShop","LAUNCH","positionId","userServerData","tableId","getFreeGamePositionId","direction","userSwitch","SETGREYOUT","state","initUserSwitch","val","betSwitcher","map","lv","level","amount","setTimeout","getTransferGameInfo","stopIndexArr","rollerId","targetList","_linesDir","winningPosition","freegameDir","freeGame","linesDir","lineList","lines","lineIndex","coord","item2","index2","t","item3","getDockIcon","line","gameType","MAIN","indexGameType","nextGameType","getIconStay","setIconStay","iconStay","getOpenBoxEffect","winningAmount","getOtherGameAttributesVo","otherGameAttributesVo","getRemainTimes","freeCount","getCurrentScore","order","bettingGoldCoins","totalRewards","freeGameAmount","getFreeGameAmount","getMagnification","magnification","getUserLevel","getNumberOfRounds","getUserGold","OLD_GOLD","PROCESS_GOLD","coinsAfterBetting","topUpCoins","getLocalCacheDataProxy","facade","retrieveProxy","LOCAL_CACHE_DATA","Object","assign","freeGameCount","freeGameCoins","coinsBeforeBetting","ROLLER","INIT_ROLLER_PANEL","SUB_GAME1","SUB_GAME2","initGameData","REFRESHCOINS","UPDATE_USER_GOLD","VACATETHEROOM","UpdateModule","GameNotice","getCurrentGame","UPDATE_CURRENT_SCORE","clear","UPDATE_BTN_LABEL","TOGGLETHESTARTBUTTON","setGameInfo","JACKPOT","setJackPot","UPDATE_JACKPOT_TOTAL","total","UPDATE_JACKPOT","jackPotData","gameTypePre","gameTypeNew","setIsChangeNextGameType","UPDATE_GAME_STATUS","setGameCount","setGameTotalNumber","totalFreeGameCount","setFreeGamePositionId","phoenixFreeGameLine","setCurrentGame","getLastGame"],"mappings":"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","sourcesContent":["import { log } from \"cc\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SocketRepository } from \"../Repositories/SocketRepository\";\r\nimport config from \"../phoenix_config\";\r\nimport { getBgProxy } from \"../phoenix_utils\";\r\nimport BaseProxy from \"./BaseProxy\";\r\nimport { LocalCacheDataProxy } from \"./LocalCacheDataProxy\";\r\nimport { phoenix_SlotBg } from \"db://assets/script/subGame/phoenix/Slot/Component/phoenix_SlotBg\";\r\nimport { global, lang } from \"../../../../hall\";\r\nimport { addToastAction } from \"../../../../hall/store/actions/baseBoard\";\r\n\r\nexport enum SubGameType {\r\n    /**主滑槽游戏 */\r\n    MAIN,\r\n    /**开宝箱游戏 */\r\n    SUB_GAME1,\r\n    /**大滑槽游戏 */\r\n    SUB_GAME2\r\n}\r\n\r\nexport enum goldState {\r\n    /**默认金币 || 结算金币*/\r\n    OLD_GOLD,\r\n    /**扣除金币 */\r\n    PROCESS_GOLD,\r\n    /**充值刷新金币 */\r\n    topUpCoins\r\n}\r\n\r\nexport enum SKT_MAG_TYPE {\r\n    /**心跳 */\r\n    HEART_BEAT = \"1\",\r\n    /**认证 */\r\n    AUTH = \"2\",\r\n    /**排行榜 */\r\n    JACKPOT = \"8\",\r\n    /**总数 */\r\n    JACKPOT_TOTAL = \"7\",\r\n    /**退出 */\r\n    EXIT = \"3\",\r\n    /**启动 */\r\n    LAUNCH = \"501\",\r\n    /**通知刷新金币 */\r\n    REFRESHCOINS = \"10\",\r\n    /**清退房间 */\r\n    VACATETHEROOM = \"3\"\r\n}\r\ntype SktMessageType = {\r\n    code: string,\r\n    messageId: string,\r\n    success: boolean,\r\n    data?: any\r\n}\r\n\r\nlet dataMap: Array<{\r\n    key: SKT_MAG_TYPE,\r\n    handlerList: Array<{\r\n        id: string,\r\n        sortId: number,\r\n        handler: (data: any) => void\r\n    }>\r\n}> = []\r\n/**自定义的监听器 */\r\nexport const sktMsgListener = {\r\n    add: (key: SKT_MAG_TYPE, id: string, handler: (data: any) => void, sortId: number = 0) => {\r\n        let item = dataMap.find(i => i.key === key)\r\n        if (!item) {\r\n            item = {\r\n                key,\r\n                handlerList: [{ id, sortId, handler }]\r\n            }\r\n            dataMap.push(item)\r\n        } else {\r\n            item.handlerList.push({ id, sortId, handler })\r\n        }\r\n    },\r\n    dispath: (key: SKT_MAG_TYPE, data: any) => {\r\n        const item = dataMap.find(i => i.key === key)\r\n        item && item.handlerList.sort((a, b) => a.sortId - b.sortId).forEach(item => item.handler(data))\r\n    },\r\n    remove: (key: SKT_MAG_TYPE, id?: string) => {\r\n        if (id) {\r\n            let item = dataMap.find(item => item.key === key)\r\n            item.handlerList = item.handlerList.filter(item => item.id !== id)\r\n        } else {\r\n            dataMap = dataMap.filter(item => item.key !== key)\r\n        }\r\n    },\r\n    removeAllListener: () => {\r\n        dataMap = []\r\n    }\r\n}\r\n\r\nexport class SocketProxy extends BaseProxy<SocketRepository> {\r\n    private ws: WebSocket\r\n    private heartBeatTimer: number\r\n    private socketConfig: {\r\n        socketIp: string;\r\n        token: string;\r\n        gameId: number;\r\n        roomId: string;\r\n    }\r\n    private switcher = []\r\n    constructor(proxyName: string = null, data: any = null) {\r\n        super(proxyName, data)\r\n        this.repository = new SocketRepository()\r\n        this.socketConfig = null\r\n    }\r\n\r\n    public async initSocket(cbFn: () => void, err: (e) => void) {\r\n        try {\r\n            this.socketConfig = await this.repository.socketConfig()\r\n            if (this.ws && WebSocket.OPEN == this.ws.readyState) {\r\n                this.ws.close()\r\n                this.ws = null\r\n            }\r\n\r\n            this.ws = new WebSocket(this.socketConfig.socketIp)\r\n            /**当连接建立成功后，这个函数就会被调用 */\r\n            this.ws.onopen = (event) => {\r\n                console.log(\"WebSocket connected\")\r\n                this.connectCallback()\r\n                cbFn && cbFn()\r\n                //this.sendSktMessage(SKT_MAG_TYPE.JACKPOT_TOTAL, undefined)\r\n                this.heartBeatTimer = window.setInterval(() => {\r\n                    this.sendSktMessage(SKT_MAG_TYPE.HEART_BEAT, undefined)\r\n                    //this.sendSktMessage(SKT_MAG_TYPE.JACKPOT_TOTAL, undefined)\r\n                }, 5000)\r\n                // this.sendNotification(CommandDefine.START_UP);\r\n            }\r\n            this.ws.onerror = (event) => {\r\n                err && err(event)\r\n            }\r\n            this.ws.onmessage = (ev: MessageEvent<any>) => {\r\n                this.onmessage(ev)\r\n            }\r\n            this.ws.onclose = () => {\r\n                //重连\r\n                window.clearInterval(this.heartBeatTimer)\r\n                this.ws = new WebSocket(this.socketConfig.socketIp)\r\n                console.log(\"exit and reconnect\")\r\n            }\r\n        } catch (e) {\r\n            this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: `网络错误：${e}` })\r\n        }\r\n    }\r\n\r\n    public onmessage(ev: MessageEvent<any> | SktMessageType) {\r\n        const evData = JSON.parse(ev.data) as SktMessageType\r\n        const heartbeat = `${config.gameCode}:-${SKT_MAG_TYPE.HEART_BEAT}`;\r\n        const jackpot = `${config.gameCode}:-${SKT_MAG_TYPE.JACKPOT_TOTAL}`;\r\n        if (evData.code !== heartbeat && evData.code !== jackpot) {\r\n            console.log(evData)\r\n        }\r\n        const msgArr = evData.code.split(\":-\")\r\n        if (evData.success) {\r\n            if (msgArr[0] !== config.gameCode) {\r\n                this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: \"错误的游戏代码\" })\r\n                console.error('服务错误', '错误的游戏代码')\r\n                return\r\n            }\r\n            const typeCode = msgArr[1]//(parseInt(msgArr[1]) * -1) + ''\r\n            sktMsgListener.dispath(typeCode as SKT_MAG_TYPE, evData.data || undefined)\r\n        } else {\r\n            global.hallDispatch(addToastAction({ content: lang.write(k => k.WebSocketModule.socketConnectDateFail, {}, { placeStr: \"连接失败\" }) }))\r\n            if (evData['code'].includes('-2')) {\r\n                global.closeSubGame({ confirmContent: evData['reason'] })\r\n            }\r\n            console.error(`服务错误`, evData)\r\n        }\r\n    }\r\n\r\n    public sendSktMessage(msgType: SKT_MAG_TYPE, data: string | ArrayBuffer | Blob | ArrayBufferView | any) {\r\n        if (msgType !== SKT_MAG_TYPE.HEART_BEAT && msgType !== SKT_MAG_TYPE.JACKPOT_TOTAL) {\r\n            console.log(\"send: \", config.gameCode, msgType, data);\r\n        }\r\n        this.ws && this.ws.send(JSON.stringify({\r\n            code: `${config.gameCode}:${msgType}`, data\r\n        }))\r\n    }\r\n\r\n    public closeSocket() {\r\n        if (this.ws) {\r\n            this.ws.close()\r\n            this.ws = null\r\n        }\r\n    }\r\n\r\n    public sendAnth() {\r\n        this.sendSktMessage(SKT_MAG_TYPE.AUTH,\r\n            {\r\n                \"token\": this.socketConfig.token,\r\n                \"gameId\": this.socketConfig.gameId,\r\n                \"roomId\": this.socketConfig.roomId\r\n            }\r\n        )\r\n    }\r\n    public calculateTheBalanceStatus() {\r\n        let gold = this.repository.rollerLaunchResult.dl.si[0].balanceAfterSettlement\r\n        let betAmount = (this.getShiftAmount(\"curr\").value) * config.linesQueue.length\r\n        this.sendNotification(BgMediatorConst.InsufficientBalanceDisplay, { bl: gold < betAmount });\r\n        return gold < betAmount\r\n    }\r\n    /**发送下注请求 */\r\n    public sendLaunch() {\r\n        // socket断开的时候临时这样搞\r\n        // window.setTimeout(() => {\r\n        //   sktMsgListener.dispath(SKT_MAG_TYPE.LAUNCH, this.repository.rollerLaunchResult)\r\n        // }, 100)\r\n        // return\r\n        let bl = this.calculateTheBalanceStatus()\r\n        if (bl) {\r\n            global.openShop()\r\n        } else {\r\n            this.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n                \"positionId\": this.getShiftAmount(\"curr\").positionId,\r\n                \"tableId\": this.repository.userServerData.tableId,\r\n                \"freeGamePositionId\": getBgProxy().getFreeGamePositionId()\r\n            })\r\n        }\r\n    }\r\n    /**获取下一档位数据(根据用户级别取得可以下注的额度列表),传max就是获取最大档位 */\r\n    public getShiftAmount(direction: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n         //先获取用户\r\n        if (direction === \"add\" && this.repository.userSwitch < this.switcher.length) {\r\n            this.repository.userSwitch++\r\n        } else if (direction === \"add\" && this.repository.userSwitch === this.switcher.length) {\r\n            //this.repository.userSwitch = 1\r\n        }\r\n\r\n        if (direction === \"subtract\" && this.repository.userSwitch > 1) {\r\n            this.repository.userSwitch--\r\n        } else if (direction === \"subtract\" && this.repository.userSwitch === 1) {\r\n            //this.repository.userSwitch = switcher.length\r\n        }\r\n        if (this.repository.userSwitch != 1 && this.repository.userSwitch !== this.switcher.length) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 0 });\r\n        } else if (this.repository.userSwitch - 1 <= 1) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n        } else {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n        }\r\n        if (direction === \"max\") {\r\n            this.repository.userSwitch = this.switcher.length\r\n        }\r\n        return this.switcher[this.repository.userSwitch - 1]\r\n    }\r\n    public initUserSwitch(val) {\r\n        this.repository.userSwitch = val - 1 < 1 ? 1 : val\r\n        this.switcher = []\r\n        config.betSwitcher.map(item => {\r\n            if (this.repository.userServerData.lv >= item.level[0]) {\r\n                this.switcher.push(...item.amount)\r\n            }\r\n        })\r\n        if (this.repository.userSwitch <= 1) {\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n            }, 200)\r\n        }else if(this.repository.userSwitch == this.switcher.length){\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n            }, 200)\r\n        }\r\n    }\r\n    /**获取转义的游戏数据 */\r\n    public getTransferGameInfo() {\r\n        return {\r\n            // 获取停止的序号\r\n            stopIndexArr: () => {\r\n                // return this.repository.rollerLaunchResult.dl.si[0].rl.map(item => item[0])\r\n                return this.repository.rollerLaunchResult.dl.si[0].rollerId\r\n            },\r\n            /**获取需要闪动的图标列表，转成平铺数组，不闪动的加-1 */\r\n            targetList: () => {\r\n                let _linesDir = this.repository.rollerLaunchResult.dl.si[0].winningPosition\r\n                const freegameDir = this.repository.rollerLaunchResult.dl.si[0].freeGame || {}\r\n                const linesDir = {\r\n                    ..._linesDir,\r\n                    ...freegameDir\r\n                }\r\n                const lineList: Array<{ lineIndex: string, coord: Array<Array<any>> }> = []\r\n                for (let lineIndex in linesDir) {\r\n                    const lines: number[][] = linesDir[lineIndex]\r\n                    /**\r\n                     [[0,1],[0,2],[1,1],[2,2]]\r\n                     */\r\n                    const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                    coord.forEach((item2, index2) => {\r\n                        const t = lines.filter((item3) => item3[0] === index2).map(i => i[1]);\r\n                        // const t = lines.find((item3) => item3[0] === index2)\r\n                        t.length && (item2[1] = t)\r\n                    })\r\n                    lineList.push({ lineIndex, coord })\r\n                }\r\n                return lineList\r\n            },\r\n            /**获取需要停靠的图标 */\r\n            getDockIcon: () => {\r\n                let lineList: { lineIndex: string, coord: Array<Array<any>> }\r\n                // const lines: number[][] = this.repository.rollerLaunchResult.dl.si[0].fixedChessboardIcon || []\r\n                const lines: number[][] = []\r\n                /**\r\n                 [[0,1],[0,2],[1,1],[2,2]]\r\n                 */\r\n                const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                coord.forEach((item2, index2) => {\r\n                    const t = lines.filter((line) => line[0] === index2).map(i => [i[1], i[2]]);\r\n                    // const t = lines.find((item3) => item3[0] === index2)\r\n                    t.length && (item2[1] = t)\r\n                })\r\n                return coord\r\n            },\r\n            /**获取gameType */\r\n            gameType: (i?) => {\r\n                if (!this.repository.rollerLaunchResult) {\r\n                    return SubGameType.MAIN\r\n                }\r\n                if (i === 0) { // 当前游戏\r\n                    return this.repository.rollerLaunchResult.dl.si[0].indexGameType as SubGameType\r\n                }\r\n                if (i === 1) { // 下一把游戏\r\n                    return this.repository.rollerLaunchResult.dl.si[0].nextGameType as SubGameType\r\n                }\r\n                return this.repository.rollerLaunchResult.dl.si[0].indexGameType as SubGameType\r\n            },\r\n            getIconStay: () => {\r\n                // return this.repository.rollerLaunchResult.dl.si[0].iconStay\r\n            },\r\n            setIconStay(key) {\r\n                this.repository.rollerLaunchResult.dl.si[0].iconStay = key\r\n            },\r\n            /**获取要执行的宝箱效果 */\r\n            getOpenBoxEffect: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].winningAmount\r\n            },\r\n            // 凤凰的特殊对象\r\n            getOtherGameAttributesVo: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].otherGameAttributesVo\r\n            },\r\n            /**获取剩余抽奖次数 */\r\n            getRemainTimes: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            /**获取当前的总奖励 */\r\n            getCurrentScore: (order: 'curr' | 'total' | 'auto') => {\r\n                if (this.repository.rollerLaunchResult.dl.si[0].bettingGoldCoins != 0) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].totalRewards\r\n                } else {\r\n                    if (order === 'curr') {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].totalRewards || this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    } else {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    }\r\n                }\r\n                // if (order === 'curr') {\r\n                //     return this.repository.rollerLaunchResult.dl.si[0].totalRewards\r\n                // } else if (order === \"total\") {\r\n                //     return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                // }\r\n                // if (fbg.getNextGame() === SubGameType.MAIN) {\r\n                //     return this.repository.rollerLaunchResult.dl.si[0].totalRewards\r\n                // } else {\r\n                //     return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                // }\r\n            },\r\n            getFreeGameAmount: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n            },\r\n            /**获取奖励倍数 */\r\n            getMagnification: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].magnification\r\n            },\r\n            /**获取用户级别 */\r\n            getUserLevel: () => {\r\n                return this.repository.userServerData.lv\r\n            },\r\n            /* 获取第几局*/\r\n            getNumberOfRounds: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            getUserGold: (state: goldState) => {\r\n                if (state === goldState.OLD_GOLD) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].balanceAfterSettlement\r\n                } else if (state === goldState.PROCESS_GOLD) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].coinsAfterBetting\r\n                } else if (state === goldState.topUpCoins) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].balanceAfterSettlement\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public close() {\r\n        this.ws.close()\r\n    }\r\n\r\n    getLocalCacheDataProxy(): LocalCacheDataProxy {\r\n        return <LocalCacheDataProxy>this.facade.retrieveProxy(ProxyDefine.LOCAL_CACHE_DATA);\r\n    }\r\n\r\n    private connectCallback() {\r\n        sktMsgListener.add(SKT_MAG_TYPE.AUTH, 'proxy', (data) => {\r\n            this.repository.userServerData = Object.assign({}, data)\r\n\r\n            this.repository.rollerLaunchResult.dl.si[0].freeCount = data.freeGameCount\r\n            this.repository.rollerLaunchResult.dl.si[0].freeGameAmount = data.freeGameCoins\r\n            this.repository.rollerLaunchResult.dl.si[0].balanceAfterSettlement = data.coinsBeforeBetting\r\n            this.repository.rollerLaunchResult.dl.si[0].indexGameType = data.gameType\r\n            this.repository.rollerLaunchResult.dl.si[0].nextGameType = data.gameType\r\n\r\n            if (data.gameType === SubGameType.MAIN) {\r\n                //主游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 0 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME1) {\r\n                // 次数游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 1, freeGameCount: data.freeGameCount }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME2) {\r\n                //大滑槽\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 2 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            }\r\n            this.initGameData(data)\r\n        })\r\n        // 后台刷新金币\r\n        sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult.dl.si[0].balanceAfterSettlement = data\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.topUpCoins })\r\n        }, 1)\r\n        // 清退用户\r\n        sktMsgListener.add(SKT_MAG_TYPE.VACATETHEROOM, 'proxy', (data) => {\r\n            global.closeSubGame({ confirmContent: lang.write(k => k.UpdateModule.GameNotice, {}, { placeStr: \"对不起，系统维护中，请稍后再尝试登录\" }) })\r\n        }, 1)\r\n        sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult = Object.assign({}, data)\r\n            getBgProxy().getCurrentGame() === SubGameType.MAIN && this.sendNotification(BgMediatorConst.UPDATE_CURRENT_SCORE, { clear: true })\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.PROCESS_GOLD })\r\n            this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL, { state: true })\r\n            if (this.getTransferGameInfo().gameType() === SubGameType.MAIN) {\r\n                // 按钮状态\r\n                this.sendNotification(BgMediatorConst.TOGGLETHESTARTBUTTON,{state:false});\r\n            }\r\n            this.setGameInfo()\r\n        }, 1)\r\n        sktMsgListener.add(SKT_MAG_TYPE.JACKPOT, 'proxy', (data) => {\r\n            this.setJackPot(data)\r\n        }, 1)\r\n        sktMsgListener.add(SKT_MAG_TYPE.JACKPOT_TOTAL, 'proxy', (data) => {\r\n            this.sendNotification(RollerMediatorConst.UPDATE_JACKPOT_TOTAL, { total: data })\r\n        }, 1)\r\n\r\n    }\r\n\r\n    public setJackPot(data) {\r\n        this.sendNotification(BgMediatorConst.UPDATE_JACKPOT, { jackPotData: data })\r\n    }\r\n\r\n    public setGameInfo() {\r\n        const gameTypePre = this.getTransferGameInfo().gameType(0);\r\n        const gameTypeNew = this.getTransferGameInfo().gameType(1);\r\n        getBgProxy().setIsChangeNextGameType(gameTypePre, gameTypeNew)\r\n        this.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n    }\r\n\r\n    public initGameData(data) {\r\n        Object.assign(this.repository.rollerLaunchResult.dl.si[0], data)\r\n\r\n        // 设置游戏次数\r\n        getBgProxy().setGameCount(data.freeGameCount)\r\n        getBgProxy().setGameTotalNumber(data.totalFreeGameCount)\r\n        getBgProxy().setFreeGamePositionId(data.phoenixFreeGameLine);\r\n        this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.OLD_GOLD })\r\n        if (data.gameType != 0) {\r\n            this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL, { state: false })\r\n        }\r\n        this.setGameInfo()\r\n        getBgProxy().setCurrentGame(getBgProxy().getLastGame());\r\n    }\r\n}\r\n"]}