{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenixV2/viewModel/PhoenixV2MainViewModel.ts"],"names":["ViewModel","StoreInject","ModalBox","global","lang","addToastAction","UseSetOption","config","cacheData","clearCacheData","mainViewModel","phoenixV2_Audio","sourceManageSeletor","SKT_MAG_TYPE","sktInstance","sktMsgListener","bundlePkgName","PrefabPathDefine","getStore","changeGame","setAutoLauncherInfo","updateGold","updateJackpotAmount","updateJackpotDatas","updatePositionId","updateSubGameAnimationPlayInfo","updateWinloss","chooseSmallGame","initGameStore","initRoller","updateRollerStatus","AutoLauncherType","GameType","RollerStatus","calBetAmount","isAuto","isSubGameToSubGame","verifyBetResultData","PhoenixV2DialogWinViewModel","PhoenixV2FoolerViewModel","PhoenixV2HeaderViewModel","PhoenixV2RollerPanelViewModel","PhoenixV2RulePanelViewModel","EffectType","SoundPathDefine","PhoenixV2SgChooseSmallViewMode","PhoenixV2MainViewModel","constructor","initCallback","gameType","smallGameInfo","chooseSmallGameSg","headerViewModel","footerViewModel","rollerPanelViewModel","isAuthDone","isBetResult","goodLuckPos","startBtnV","freeNumNode","betCallbackFun","begin","mountViewNode","comp","getHeader","connect","setEvent","quitGame","onQuitGame","getFooter","getRoller","onSendBet","sendBet","onOpenRule","openRule","add","AUTH","data","error","closeSubGame","confirmContent","write","k","InitGameModule","FetcherFaild","authData","dispatch","coinsBeforeBetting","freeGameCoins","SUBGAME1","lastGameType","viewGameType","currGameType","leftCount","freeGameCount","freeGameAmount","totalFreeGameCount","getSlotNode","active","getFreeNumNode","viewNode","getStartBtnNode","getChildByName","showSmallGame","initSlot","param","phoenixFreeGameLine","i","id","totalCount","smallGame","times","wildSprite","fileName","wildSkeleton","wildFileName","playBgMusic","MAIN","scheduleOnce","isValid","props","autoLauncherInfo","gameTypeInfo","sendSktMessage","token","localStorage","getItem","gameId","LAUNCH","unschedule","undefined","result","playOneShot","DING","content","Instance","show","type","rollerLaunchResult","si","dl","rollerId","length","localLeftCount","freeCount","nextLeftCount","isDelay","nextGameType","SUBGAME2","indexGameType","NONE","REFRESHCOINS","JACKPOT","JACKPOT_TOTAL","option","gameSet","phoenixV2","betTarget","console","log","betAmount","positionId","gold","hallDispatch","palyingModule","RechangeGlod","placeStr","autoLauncherType","sendBetTime","Date","now","fixedChessboardIcon","RUNNING","betListenerTimeHandle","bind","schedule","tableId","WebSocketModule","WebSocketError","unMountCallBack","removeById","unMount","getRollerPanelViewModel","showDialogWin","dialogInfo","done","phoenixV2DialogWinViewModel","mountView","getFile","DIALOG_WIN","source","appendTo","setProps","onWindowCloseHandler","PHOENIX_SG_CHOOSE","getGoodLuckPos","getStartBtnPos","getFreeNumPos","setGoodLuckPos","pos","setStartBtnPos","setFreeNumPos","rulePanelViewMode","RULEPANEL","effectType","EFFECT1","stop","play","MAIN_BG","GAME1_BG","inject","state","game","betDropDownlist","subGameAnimationPlayInfo","jackpotDatas","jackpotTotalAmount"],"mappings":"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","sourcesContent":["import { Vec3 } from \"cc\"\r\nimport ViewModel, { StoreInject } from \"../../../base/ViewModel\"\r\nimport ModalBox from \"../../../common/ModalBox\"\r\nimport { global, lang } from \"../../../hall\"\r\nimport { addToastAction } from \"../../../hall/store/actions/baseBoard\"\r\nimport UseSetOption from \"../../../utils/UseSetOption\"\r\nimport { PhoenixV2_Main, IEvent, IProps } from \"../components/PhoenixV2_Main\"\r\nimport config from \"../config\"\r\nimport { cacheData, clearCacheData } from \"../dataTransfer\"\r\nimport { mainViewModel, phoenixV2_Audio, sourceManageSeletor } from \"../index\"\r\nimport { SKT_MAG_TYPE, sktInstance, sktMsgListener } from \"../socketConnect\"\r\nimport { bundlePkgName } from \"../sourceDefine\"\r\nimport { PrefabPathDefine } from \"../sourceDefine/prefabDefine\"\r\nimport { getStore } from \"../store\"\r\nimport { changeGame, setAutoLauncherInfo, updateGold, updateJackpotAmount, updateJackpotDatas, updatePositionId, updateSubGameAnimationPlayInfo, updateWinloss, chooseSmallGame, initGameStore } from \"../store/actions/game\"\r\nimport { initRoller, updateRollerStatus } from \"../store/actions/roller\"\r\nimport { StateType } from \"../store/reducer\"\r\nimport { AuthDataVo, AutoLauncherType, DialogInfo, GameType, JackpotData, RollerLaunchResult, RollerStatus, calBetAmount, isAuto, isSubGameToSubGame, verifyBetResultData } from \"../type\"\r\nimport PhoenixV2DialogWinViewModel from \"./PhoenixV2DialogWinViewModel\"\r\nimport PhoenixV2FoolerViewModel from \"./PhoenixV2FoolerViewModel\"\r\nimport PhoenixV2HeaderViewModel from \"./PhoenixV2HeaderViewModel\"\r\nimport PhoenixV2RollerPanelViewModel from \"./PhoenixV2RollerPanelViewModel\"\r\nimport PhoenixV2RulePanelViewModel from \"./PhoenixV2RulePanelViewModel\"\r\nimport { EffectType } from \"../../../utils/NodeIOEffect\"\r\nimport { SoundPathDefine } from \"../sourceDefine/soundDefine\"\r\nimport PhoenixV2SgChooseSmallViewMode from \"./PhoenixV2SgChooseSmallViewModel\"\r\n\r\n@StoreInject(getStore())\r\nclass PhoenixV2MainViewModel extends ViewModel<PhoenixV2_Main, IProps, IEvent> {\r\n  private initCallback;\r\n  private gameType: GameType;\r\n  private smallGameInfo;\r\n  public chooseSmallGameSg\r\n  constructor(initCallback) {\r\n    super('PhoenixV2_Main')\r\n    this.initCallback = initCallback;\r\n  }\r\n\r\n  private headerViewModel: PhoenixV2HeaderViewModel;\r\n  private footerViewModel: PhoenixV2FoolerViewModel;\r\n  public rollerPanelViewModel: PhoenixV2RollerPanelViewModel;\r\n  public isAuthDone: boolean = false\r\n  private isBetResult = true;\r\n\r\n  /**奖励的坐标 */\r\n  private goodLuckPos: Vec3;\r\n  /**开始按钮坐标 */\r\n  private startBtnV: Vec3;\r\n  /**免费游戏次数坐标 */\r\n  private freeNumNode: Vec3;\r\n\r\n  private betCallbackFun;\r\n  protected begin() {\r\n\r\n    this.headerViewModel = new PhoenixV2HeaderViewModel().mountViewNode(this.comp.getHeader()).connect();\r\n    this.headerViewModel.setEvent({\r\n      quitGame: () => {\r\n        this.onQuitGame();\r\n      }\r\n    })\r\n    this.footerViewModel = new PhoenixV2FoolerViewModel().mountViewNode(this.comp.getFooter()).connect();\r\n    this.rollerPanelViewModel = new PhoenixV2RollerPanelViewModel().mountViewNode(this.comp.getRoller()).connect();\r\n\r\n    this.footerViewModel.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      },\r\n      onOpenRule: () => {\r\n        this.openRule();\r\n      }\r\n    })\r\n    this.setEvent({\r\n      onSendBet: () => {\r\n        this.sendBet();\r\n      }\r\n    })\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.AUTH, bundlePkgName, (data: AuthDataVo, error) => {\r\n      if (error) {\r\n        return;\r\n      }\r\n\r\n      if (!data) {\r\n        global.closeSubGame({\r\n          confirmContent: lang.write(k => k.InitGameModule.FetcherFaild) + '-' + SKT_MAG_TYPE.AUTH\r\n        });\r\n        return;\r\n      }\r\n      this.isAuthDone = true\r\n\r\n      cacheData.authData = data;\r\n      this.dispatch(updateGold(data.coinsBeforeBetting));\r\n\r\n      if (data.freeGameCoins > 0 && data.gameType === GameType.SUBGAME1) {\r\n        this.dispatch(updateWinloss(data.freeGameCoins));\r\n      }\r\n\r\n      this.dispatch(changeGame({\r\n        lastGameType: data.gameType,\r\n        viewGameType: data.gameType,\r\n        currGameType: data.gameType,\r\n        leftCount: data.freeGameCount,\r\n        freeGameAmount: data.freeGameCoins,\r\n      }))\r\n\r\n      if (data.gameType === GameType.SUBGAME1 && data.totalFreeGameCount <= 0) {//还未选择小游戏时\r\n        mainViewModel.comp.getSlotNode().active = false;\r\n        mainViewModel.comp.getFreeNumNode().active = false;\r\n        this.rollerPanelViewModel.viewNode.active = false;\r\n        this.footerViewModel.comp.getStartBtnNode().getChildByName(\"disable\").active = true;\r\n        this.showSmallGame((smallGameInfo) => {\r\n          // this.dispatch(updateRollerStatus(RollerStatus.END))\r\n          // 这里选择小游戏后再初始化插槽\r\n          this.rollerPanelViewModel.comp.initSlot(smallGameInfo);\r\n          // 播放切换游戏动画\r\n          this.dispatch(updateSubGameAnimationPlayInfo({\r\n            gameType: data.gameType,\r\n            param: 0 //开门类型\r\n          }))\r\n\r\n        })\r\n      } else {\r\n        if (data.phoenixFreeGameLine && data.totalFreeGameCount > 0 && data.freeGameCount > 0) {//上一把已进入小游戏\r\n          const i = data.phoenixFreeGameLine - 1;\r\n          this.dispatch(chooseSmallGame({\r\n            id: data.phoenixFreeGameLine,\r\n            totalCount: config.smallGame[i].times,\r\n            wildSprite: config.smallGame[i].fileName,\r\n            wildSkeleton: config.smallGame[i].wildFileName\r\n          }))\r\n          // 这里初始化插槽\r\n          this.rollerPanelViewModel.comp.initSlot();\r\n\r\n        }\r\n      }\r\n\r\n      this.playBgMusic();\r\n\r\n\r\n\r\n      if (data.gameType === GameType.MAIN) {\r\n        // 这里初始化插槽\r\n        this.rollerPanelViewModel.comp.initSlot();\r\n      }\r\n      // 延时一点时间才卸载laoding界面\r\n      this.comp.scheduleOnce(() => {\r\n        this.viewNode.isValid && this.initCallback && this.initCallback();\r\n        if (data.gameType === GameType.SUBGAME1 && data.totalFreeGameCount > 0 && data.freeGameCount > 0) {\r\n          // 进入游戏之后如果是自动游戏，就发送下注\r\n          if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n            this.comp.scheduleOnce(() => {\r\n              this.sendBet();\r\n            }, 1)\r\n          }\r\n        }\r\n      }, 0.1)\r\n    })\r\n    sktInstance.sendSktMessage(SKT_MAG_TYPE.AUTH, {\r\n      token: localStorage.getItem(\"token\"),\r\n      gameId: config.gameId\r\n    });\r\n\r\n    sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, bundlePkgName, (data: RollerLaunchResult, error) => {\r\n      this.comp.unschedule(this.betCallbackFun);\r\n      this.betCallbackFun = undefined;\r\n      this.isBetResult = true;\r\n      const result = verifyBetResultData(data)\r\n      if (!error && result > 0) {\r\n        phoenixV2_Audio.playOneShot(SoundPathDefine.DING)\r\n        const content = lang.write(k => k.InitGameModule.FetcherFaild) + '-ERROR(' + result + ')';\r\n        ModalBox.Instance().show({\r\n          content: content, type: 'Prompt'\r\n        }, () => {\r\n          return true\r\n        })\r\n        return;\r\n      }\r\n      cacheData.rollerLaunchResult = data;\r\n      const si = data.dl.si[0];\r\n      // if (si.nextGameType === GameType.SUBGAME2 || this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n      //   //每局的锁定图标\r\n      //   cacheData.fixedChessboardIcon = si.fixedChessboardIcon;\r\n      // }\r\n\r\n      // 服务器的索引是从1开始的\r\n      const rollerId = si.rollerId\r\n      for (let i = 0; i < rollerId.length; i++) {\r\n        rollerId[i]--;\r\n      }\r\n      // console.log(\"rollerId \", si.rollerId)\r\n      const localLeftCount = this.comp.props.gameTypeInfo.leftCount;\r\n      let leftCount = si.freeCount;\r\n      let nextLeftCount = undefined;\r\n      let isDelay = false;\r\n      // 小游戏切到小游戏时，暂不改变切换状态\r\n      // 为了让玩家延时看到剩余的次数，特殊处理\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.nextGameType)) {\r\n\r\n      }\r\n\r\n      if (isSubGameToSubGame(this.comp.props.gameTypeInfo.viewGameType, si.nextGameType)\r\n        || (si.freeCount >= localLeftCount && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) // 如果服务器给的次数比本地的次数大了，说明次数发生变化，延迟显示\r\n        || (localLeftCount - si.freeCount > 1 && this.comp.props.gameTypeInfo.viewGameType === GameType.SUBGAME2)) { //如果服务器给的次数小于本地的次数超过了1次，说明次数发生变化，延迟显示\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n\r\n      if (isDelay) {\r\n        leftCount = localLeftCount - 1;\r\n        leftCount = leftCount < 0 ? 0 : leftCount;\r\n        nextLeftCount = si.freeCount;\r\n      }\r\n      if (si.indexGameType === GameType.MAIN || (si.indexGameType === GameType.SUBGAME1 && si.freeCount < localLeftCount)) {\r\n        this.dispatch(changeGame({\r\n          lastGameType: GameType.NONE,\r\n          viewGameType: this.comp.props.gameTypeInfo.viewGameType,\r\n          currGameType: si.nextGameType,\r\n          leftCount: leftCount,\r\n          freeGameAmount: si.freeGameAmount,\r\n          nextLeftCount: nextLeftCount\r\n        }))\r\n      }\r\n      if (si.indexGameType === GameType.SUBGAME1 && si.freeCount >= localLeftCount) {\r\n        this.dispatch(changeGame({\r\n          lastGameType: GameType.NONE,\r\n          viewGameType: this.comp.props.gameTypeInfo.viewGameType,\r\n          currGameType: si.nextGameType,\r\n          leftCount: localLeftCount - 1,\r\n          freeGameAmount: si.freeGameAmount,\r\n          nextLeftCount: nextLeftCount\r\n        }))\r\n      }\r\n\r\n\r\n    })\r\n\r\n    // 更新金额\r\n    sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateGold(data));\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT, bundlePkgName, (data: JackpotData[], error) => {\r\n      this.dispatch(updateJackpotDatas(data))\r\n    })\r\n    sktMsgListener.add(SKT_MAG_TYPE.JACKPOT_TOTAL, bundlePkgName, (data, error) => {\r\n      this.dispatch(updateJackpotAmount(data))\r\n    })\r\n\r\n    if (UseSetOption.Instance().option.gameSet.phoenixV2 && UseSetOption.Instance().option.gameSet.phoenixV2.betTarget) {\r\n      this.dispatch(updatePositionId(UseSetOption.Instance().option.gameSet.phoenixV2.betTarget))\r\n    } else {\r\n      this.dispatch(updatePositionId(1))\r\n    }\r\n  }\r\n\r\n  private sendBet() {\r\n    if (!this.isAuthDone) return\r\n    if (!this.isBetResult) {\r\n      console.log(\"已经发送过了下注，不能重复发送，等待服务器返回\")\r\n      return;\r\n    }\r\n\r\n    const betAmount = calBetAmount(this.comp.props.positionId)\r\n    // 在主游戏中才提示余额不足\r\n    if (this.comp.props.gameTypeInfo.viewGameType === GameType.MAIN && this.comp.props.gold < betAmount) {\r\n      global.hallDispatch(addToastAction({ content: lang.write(k => k.palyingModule.RechangeGlod, {}, { placeStr: \"对不起，您的金币不足，请充值！\" }) }))\r\n\r\n      // 如果余额不足，并且是自动状态，就取消自动\r\n      if (isAuto(this.comp.props.autoLauncherInfo, this.comp.props.gameTypeInfo)) {\r\n        this.dispatch(setAutoLauncherInfo({\r\n          autoLauncherType: AutoLauncherType.NONE,\r\n          totalCount: 0,\r\n          leftCount: 0\r\n        }))\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (this.comp.props.gameTypeInfo.viewGameType === GameType.MAIN) {\r\n      this.dispatch(updateGold(this.comp.props.gold - betAmount));\r\n    }\r\n\r\n    cacheData.sendBetTime = Date.now();\r\n    // console.log(\"sendBet time \" + cacheData.sendBetTime)\r\n\r\n    cacheData.rollerLaunchResult = null;\r\n    cacheData.fixedChessboardIcon = null;\r\n    this.dispatch(updateRollerStatus(RollerStatus.RUNNING));\r\n    this.isBetResult = false;\r\n    this.betCallbackFun = this.betListenerTimeHandle.bind(this);\r\n    this.comp.schedule(this.betCallbackFun, 10);\r\n\r\n    // sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n    //   \"positionId\": this.comp.props.positionId,\r\n    //   \"tableId\": cacheData.authData.tableId,\r\n    // });\r\n\r\n    //发送下注\r\n    if (this.gameType === GameType.MAIN) {//主游戏\r\n      sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n        \"positionId\": this.comp.props.positionId,\r\n        \"tableId\": cacheData.authData.tableId,\r\n      })\r\n    } else if (this.gameType === GameType.SUBGAME1) {//小游戏\r\n      sktInstance.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n        \"positionId\": this.comp.props.positionId,\r\n        \"freeGamePositionId\": this.smallGameInfo.id,\r\n        \"tableId\": cacheData.authData.tableId,\r\n      })\r\n    }\r\n  }\r\n\r\n  private betListenerTimeHandle() {\r\n    if (!this.isBetResult) {\r\n      this.isBetResult = true;\r\n      const content = lang.write(k => k.WebSocketModule.WebSocketError) + '-' + SKT_MAG_TYPE.LAUNCH;\r\n      phoenixV2_Audio.playOneShot(SoundPathDefine.DING)\r\n      ModalBox.Instance().show({\r\n        content: content, type: 'Prompt'\r\n      }, () => {\r\n        this.onQuitGame();\r\n        return true\r\n      })\r\n    }\r\n  }\r\n\r\n  protected unMountCallBack(): void {\r\n    sktMsgListener.removeById(bundlePkgName)\r\n    this.footerViewModel.unMount();\r\n    this.headerViewModel.unMount();\r\n    this.rollerPanelViewModel.unMount();\r\n    clearCacheData();\r\n    getStore().dispatch(initGameStore(0));\r\n    getStore().dispatch(initRoller(0));\r\n  }\r\n  public getRollerPanelViewModel() {\r\n    return this.rollerPanelViewModel;\r\n  }\r\n  private onQuitGame() {\r\n    global.closeSubGame();\r\n  }\r\n\r\n  /**显示大奖 */\r\n  public showDialogWin(dialogInfo: DialogInfo, done) {\r\n    let phoenixV2DialogWinViewModel = new PhoenixV2DialogWinViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.DIALOG_WIN).source)\r\n      .appendTo(this.viewNode);\r\n    phoenixV2DialogWinViewModel.setProps({\r\n      dialogInfo: dialogInfo,\r\n      gameTypeInfo: this.comp.props.gameTypeInfo,\r\n      autoLauncherInfo: this.comp.props.autoLauncherInfo,\r\n    })\r\n    phoenixV2DialogWinViewModel.setEvent({\r\n      onWindowCloseHandler: () => {\r\n        done && done();\r\n      }\r\n    })\r\n  }\r\n\r\n  /**显示选择小游戏面板 */\r\n  public showSmallGame(done) {\r\n    this.chooseSmallGameSg = new PhoenixV2SgChooseSmallViewMode().mountView(sourceManageSeletor().getFile(PrefabPathDefine.PHOENIX_SG_CHOOSE).source)\r\n      .appendTo(this.viewNode)\r\n      .setEvent({\r\n        onWindowCloseHandler: (i: number) => {\r\n          this.dispatch(changeGame({\r\n            lastGameType: GameType.NONE,\r\n            viewGameType: this.comp.props.gameTypeInfo.viewGameType,\r\n            currGameType: this.gameType,\r\n            leftCount: config.smallGame[i].times,\r\n            freeGameAmount: this.comp.props.gameTypeInfo.freeGameAmount,\r\n            nextLeftCount: undefined\r\n          }))\r\n          const smallGameInfo = {\r\n            id: i + 1,\r\n            totalCount: config.smallGame[i].times,\r\n            wildSprite: config.smallGame[i].fileName,\r\n            wildSkeleton: config.smallGame[i].wildFileName\r\n          }\r\n          this.dispatch(chooseSmallGame(smallGameInfo))\r\n\r\n          done && done(smallGameInfo);\r\n        }\r\n      })\r\n  }\r\n\r\n  public getGoodLuckPos() {\r\n    return this.goodLuckPos;\r\n  }\r\n  public getStartBtnPos() {\r\n    return this.startBtnV\r\n  }\r\n\r\n  public getFreeNumPos() {\r\n    return this.freeNumNode\r\n  }\r\n\r\n  public setGoodLuckPos(pos: Vec3) {\r\n    this.goodLuckPos = pos;\r\n  }\r\n\r\n  public setStartBtnPos(pos: Vec3) {\r\n    this.startBtnV = pos;\r\n  }\r\n\r\n  public setFreeNumPos(pos: Vec3) {\r\n    this.freeNumNode = pos;\r\n  }\r\n\r\n  public openRule() {\r\n    const rulePanelViewMode = new PhoenixV2RulePanelViewModel()\r\n      .mountView(sourceManageSeletor().getFile(PrefabPathDefine.RULEPANEL).source)\r\n      .appendTo(this.viewNode, { effectType: EffectType.EFFECT1 });\r\n  }\r\n  public playBgMusic() {\r\n    phoenixV2_Audio.stop();\r\n    if (this.comp.props.gameTypeInfo.currGameType === GameType.MAIN) {\r\n      phoenixV2_Audio.play(SoundPathDefine.MAIN_BG, true)\r\n    } else if (this.comp.props.gameTypeInfo.currGameType === GameType.SUBGAME1) {\r\n      phoenixV2_Audio.play(SoundPathDefine.GAME1_BG, true)\r\n    }\r\n  }\r\n\r\n  public connect() {\r\n    this.inject({}, (state: StateType) => {\r\n      this.gameType = state.game.gameTypeInfo.currGameType;\r\n      this.smallGameInfo = state.game.chooseSmallGame;\r\n      return {\r\n        betDropDownlist: state.game.betDropDownlist,\r\n        positionId: state.game.positionId,\r\n        gold: state.game.gold,\r\n        gameTypeInfo: state.game.gameTypeInfo,\r\n        subGameAnimationPlayInfo: state.game.subGameAnimationPlayInfo,\r\n        jackpotDatas: state.game.jackpotDatas,\r\n        jackpotTotalAmount: state.game.jackpotTotalAmount,\r\n        autoLauncherInfo: state.game.autoLauncherInfo,\r\n\r\n      }\r\n    })\r\n    return this\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default PhoenixV2MainViewModel"]}