{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_PC_SubComp/Hall_PC_Share_member.ts"],"names":["_decorator","instantiate","Label","Node","ScrollView","BaseComponent","fetcher","ApiUrl","ccclass","property","Hall_PC_Share_member","memberList","isLoading","pageNum","pageSize","total","propertyNode","props_btn_help","props_img_validitas_hlep","props_content","props_layout_item","props_ScrollView","props","isShow","events","start","initState","bindEvent","on","EventType","TOUCH_END","active","node","once","renderData","onScrolling","useProps","key","value","cur","scrollOffset","getScrollOffset","maxScrollOffset","getMaxScrollOffset","y","console","log","obj","send","MYRECOMMENDINFO","then","rsp","i","list","length","getChildByName","getComponent","string","nickName","registerTime","totalBet","formatAmountWithCommas","effective","addChild","scheduleOnce","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, ImageAsset, instantiate, Label, log, native, Node, ScrollView, Sprite, SpriteFrame, sys, systemEvent, Texture2D, tween, UIOpacity, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nconst { ccclass, property } = _decorator;\r\nimport { fetcher, lang } from '../../index';\r\nimport { ApiUrl } from '../../apiUrl';\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n    isShow: boolean,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('Hall_PC_Share_member')\r\nexport class Hall_PC_Share_member extends BaseComponent<IState, IProps, IEvent> {\r\n    private memberList = []\r\n    isLoading = false\r\n    pageNum = 1\r\n    pageSize = 20\r\n    total = 0\r\n    start() {\r\n\r\n    }\r\n\r\n    protected propertyNode = {\r\n        props_btn_help: new Node(),\r\n        props_img_validitas_hlep: new Node(),\r\n        props_content: new Node(),\r\n        props_layout_item: new Node(),\r\n        props_ScrollView: new ScrollView(),\r\n    }\r\n\r\n    public props: IProps = {\r\n        isShow: true\r\n    }\r\n\r\n    public events: IEvent = {\r\n\r\n    }\r\n\r\n    protected initState() {\r\n        return {\r\n\r\n        }\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n        this.propertyNode.props_btn_help.on(Node.EventType.TOUCH_END, () => {\r\n            this.propertyNode.props_img_validitas_hlep.active = true\r\n            this.node.once(Node.EventType.TOUCH_END, () => {\r\n                this.propertyNode.props_img_validitas_hlep.active = false\r\n            })\r\n        })\r\n        this.propertyNode.props_img_validitas_hlep.on(Node.EventType.TOUCH_END, () => {\r\n            this.propertyNode.props_img_validitas_hlep.active = false\r\n        })\r\n        this.renderData()\r\n        this.propertyNode.props_ScrollView.node.on('scrolling', this.onScrolling, this);\r\n    }\r\n\r\n    protected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n        if (key === 'isShow') {\r\n            this.node.active = value.cur\r\n        }\r\n    }\r\n    onScrolling() {\r\n        let scrollOffset = this.propertyNode.props_ScrollView.getScrollOffset();\r\n        let maxScrollOffset = this.propertyNode.props_ScrollView.getMaxScrollOffset();\r\n        // 检查是否滚动到底部\r\n        if (scrollOffset.y >= maxScrollOffset.y) {\r\n            if (this.isLoading || (this.total / this.pageSize) <= this.pageNum) {\r\n                return;\r\n            } else {\r\n                this.isLoading = true;\r\n                this.pageNum++;\r\n                this.renderData()\r\n                console.log(this.pageNum);\r\n\r\n            }\r\n        }\r\n    }\r\n    private renderData() {\r\n        let obj = {\r\n            pageNum: this.pageNum,\r\n            pageSize: this.pageSize,\r\n        }\r\n        fetcher.send(ApiUrl.MYRECOMMENDINFO, obj, \"post\").then((rsp) => {\r\n            this.total = rsp.total\r\n            for (let i = 0; i <= rsp.list.length; i++) {\r\n                let node = instantiate(this.propertyNode.props_layout_item)\r\n                node.active = true\r\n                if (rsp.list[i]) {\r\n                    node.getChildByName('label_name').getComponent(Label).string = rsp.list[i].nickName\r\n                    node.getChildByName('label_date').getComponent(Label).string = rsp.list[i].registerTime\r\n                    node.getChildByName('label_total').getComponent(Label).string = rsp.list[i].totalBet.formatAmountWithCommas()\r\n                    node.getChildByName('label_validitas').getComponent(Label).string = rsp.list[i].effective ? 'Yes' : 'No'\r\n                    this.propertyNode.props_content.addChild(node)\r\n                }\r\n            }\r\n\r\n        })\r\n        this.scheduleOnce(() => {\r\n            this.isLoading = false;\r\n        }, 3)\r\n    }\r\n    protected bindUI(): void {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n"]}