{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfc/Slot/Component/gxfc_AwardBox.ts"],"names":["_decorator","Label","Node","sp","tween","UIOpacity","Vec3","BaseComponent","config","bindClickEvent","ccclass","property","BoxState","gxfc_AwardBox","SkeletonData","boxId","status","CLOSE","start","update","deltaTime","showScore","amount","score","node","getChildByName","getComponent","string","formatAmountWithCommas","ui","active","setScale","opacity","target","to","scale","setEffect","effectId","cb","skeletonRoot","Skeleton","animation","awardBoxItem","find","item","id","window","setTimeout","subIcon","skeleton","skeletonData","name","animafild","OPEN","destroy","setBoxId","bindEvent","bindUI"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;;AAC5DC,MAAAA,a;;AACAC,MAAAA,M;;AACEC,MAAAA,c,iBAAAA,c;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBX,U;;0BAGlBY,Q,0BAAAA,Q;AAAAA,QAAAA,Q,CAAAA,Q;AAAAA,QAAAA,Q,CAAAA,Q;AAAAA,QAAAA,Q,CAAAA,Q;eAAAA,Q;;;+BAQCC,a,WADZH,OAAO,CAAC,eAAD,C,UAONC,QAAQ,CAACT,IAAD,C,UAGRS,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,UAGRH,QAAQ,CAACR,EAAE,CAACW,YAAJ,C,2BA5BV,MACaD,aADb;AAAA;AAAA,0CACiD;AAAA;AAAA;;AAChD;AADgD,eAEzCE,KAFyC,GAEzB,EAFyB;;AAGhD;AAHgD,eAIzCC,MAJyC,GAItBJ,QAAQ,CAACK,KAJa;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;;AA8BhDC,QAAAA,KAAK,GAAG,CAEP;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AAGOC,QAAAA,SAAS,CAACC,MAAD,EAAiB;AACjC,cAAMC,KAAK,GAAG,KAAKC,IAAL,CAAUC,cAAV,CAAyB,OAAzB,CAAd;AACAF,UAAAA,KAAK,CAACG,YAAN,CAAmBzB,KAAnB,EAA0B0B,MAA1B,GAAmCL,MAAM,CAACM,sBAAP,KAAkC,EAArE;AACA,cAAMC,EAAE,GAAGN,KAAK,CAACG,YAAN,CAAmBrB,SAAnB,CAAX;AACAkB,UAAAA,KAAK,CAACO,MAAN,GAAe,IAAf;AACAP,UAAAA,KAAK,CAACQ,QAAN,CAAe,GAAf,EAAoB,GAApB;AACAF,UAAAA,EAAE,CAACG,OAAH,GAAa,CAAb;AACA5B,UAAAA,KAAK,GAAG6B,MAAR,CAAeJ,EAAf,EAAmBK,EAAnB,CAAsB,GAAtB,EAA2B;AAAEF,YAAAA,OAAO,EAAE;AAAX,WAA3B,EAA6Cd,KAA7C;AACAd,UAAAA,KAAK,GAAG6B,MAAR,CAAeV,KAAf,EAAsBW,EAAtB,CAAyB,GAAzB,EAA8B;AAAEC,YAAAA,KAAK,EAAE,IAAI7B,IAAJ,CAAS,CAAT,EAAY,CAAZ;AAAT,WAA9B,EAAyDY,KAAzD;AACA;AACD;;;AACOkB,QAAAA,SAAS,CAACC,QAAD,EAAmBf,MAAnB,EAAmCgB,EAAnC,EAAmD;AAClE;AACA,cAAMC,YAAY,GAAG,KAAKf,IAAL,CAAUE,YAAV,CAAuBvB,EAAE,CAACqC,QAA1B,CAArB;AACAD,UAAAA,YAAY,CAACE,SAAb,GAAyB,iBAAzB,CAHkE,CAIlE;;AACA,cAAMC,YAAY,GAAG;AAAA;AAAA,gCAAOA,YAAP,CAAoBC,IAApB,CAAyBC,IAAI,IAAIA,IAAI,CAACC,EAAL,KAAYR,QAA7C,CAArB;AACAS,UAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB;AACA,iBAAKC,OAAL,CAAalB,MAAb,GAAsB,IAAtB;AACA,gBAAMmB,QAAQ,GAAG,KAAKD,OAAL,CAAatB,YAAb,CAA0BvB,EAAE,CAACqC,QAA7B,CAAjB;AACAS,YAAAA,QAAQ,CAACC,YAAT,GAAwB,KAAKR,YAAY,CAACS,IAAlB,CAAxB;AACAF,YAAAA,QAAQ,CAACR,SAAT,GAAqBC,YAAY,CAACU,SAAlC;AACAN,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB;AACA,mBAAK/B,MAAL,GAAcJ,QAAQ,CAACyC,IAAvB;AACA/B,cAAAA,MAAM,IAAI,KAAKD,SAAL,CAAeC,MAAf,CAAV;AACAgB,cAAAA,EAAE,IAAIA,EAAE,EAAR;AACA,aALD,EAKG,IALH;AAMA,WAZD,EAYG,IAZH;AAaAQ,UAAAA,MAAM,CAACC,UAAP,CAAkB,MAAMR,YAAY,CAACe,OAAb,EAAxB,EAAgD,IAAhD;AACA;AAED;;;AACOC,QAAAA,QAAQ,CAACxC,KAAD,EAAgB;AAC9B,eAAKA,KAAL,GAAaA,KAAb;AACA,eAAKS,IAAL,CAAUC,cAAV,CAAyB,OAAzB,EAAkCC,YAAlC,CAA+CzB,KAA/C,EAAsD0B,MAAtD,GAA+DZ,KAA/D;AACA;;AAESyC,QAAAA,SAAS,GAAS,CAC3B;AACA;;AAESC,QAAAA,MAAM,GAAS;AACxB;AAAA;AAAA,gDAAe,KAAKjC,IAApB;AACA,eAAKA,IAAL,CAAUO,QAAV,CAAmB,GAAnB,EAAwB,GAAxB;AACA;;AArF+C,O;;;;;iBAOhC,I;;;;;;;iBAGW,I;;;;;;;iBAGK,I;;;;;;;iBAGL,I;;;;;;;iBAGK,I;;;;;;;iBAGJ,I;;;;;;;iBAGN,I;;;;;;;iBAGM,I","sourcesContent":["import { _decorator, Component, Label, Node, sp, tween, UIOpacity, Vec3 } from 'cc';\r\nimport BaseComponent from './BaseComponent';\r\nimport config from '../config';\r\nimport { bindClickEvent } from '../utils';\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\nexport enum BoxState {\r\n\tOPEN,\r\n\tCLOSE,\r\n\tOPRNING\r\n}\r\n\r\n\r\n@ccclass('gxfc_AwardBox')\r\nexport class gxfc_AwardBox extends BaseComponent {\r\n\t/**宝箱ID */\r\n\tpublic boxId: string = ''\r\n\t/**宝箱状态 */\r\n\tpublic status: BoxState = BoxState.CLOSE\r\n\r\n\t@property(Node)\r\n\tsubIcon: Node = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tBxApple: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tBxStrawberry: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tBxGrape: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tBxWatermelon: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tBxBanana: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\tup: sp.SkeletonData = null\r\n\r\n\t@property(sp.SkeletonData)\r\n\taddtimes: sp.SkeletonData = null\r\n\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n\r\n\r\n\tprivate showScore(amount: number) {\r\n\t\tconst score = this.node.getChildByName(\"score\")\r\n\t\tscore.getComponent(Label).string = amount.formatAmountWithCommas() + ''\r\n\t\tconst ui = score.getComponent(UIOpacity)\r\n\t\tscore.active = true\r\n\t\tscore.setScale(0.7, 0.7)\r\n\t\tui.opacity = 0\r\n\t\ttween().target(ui).to(0.2, { opacity: 255 }).start()\r\n\t\ttween().target(score).to(0.2, { scale: new Vec3(1, 1) }).start()\r\n\t}\r\n\t/**执行响应的效果 */\r\n\tpublic setEffect(effectId: string, amount: number, cb: () => void) {\r\n\t\t// console.log(this.boxId, '开始效果')\r\n\t\tconst skeletonRoot = this.node.getComponent(sp.Skeleton)\r\n\t\tskeletonRoot.animation = 'diankaibaoxiang';\r\n\t\t// skeletonRoot.loop = false //这个居然没有作用，MMP\r\n\t\tconst awardBoxItem = config.awardBoxItem.find(item => item.id === effectId)\r\n\t\twindow.setTimeout(() => {\r\n\t\t\t// 打开贝壳等一秒钟\r\n\t\t\tthis.subIcon.active = true\r\n\t\t\tconst skeleton = this.subIcon.getComponent(sp.Skeleton)\r\n\t\t\tskeleton.skeletonData = this[awardBoxItem.name]\r\n\t\t\tskeleton.animation = awardBoxItem.animafild\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t// 展示结果耗时\r\n\t\t\t\tthis.status = BoxState.OPEN\r\n\t\t\t\tamount && this.showScore(amount)\r\n\t\t\t\tcb && cb()\r\n\t\t\t}, 1500)\r\n\t\t}, 1000)\r\n\t\twindow.setTimeout(() => skeletonRoot.destroy(), 1500)\r\n\t}\r\n\r\n\t/**执行响应的效果 */\r\n\tpublic setBoxId(boxId: string) {\r\n\t\tthis.boxId = boxId\r\n\t\tthis.node.getChildByName(\"boxId\").getComponent(Label).string = boxId\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\t// this.node.on(Node.EventType.TOUCH_END, () => { })\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tbindClickEvent(this.node)\r\n\t\tthis.node.setScale(0.9, 0.9)\r\n\t}\r\n}\r\n\r\n"]}