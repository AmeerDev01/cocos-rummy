{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_Baseboard.ts"],"names":["_decorator","Button","director","instantiate","Label","Node","tween","Vec3","BaseComponent","setLoadingAction","setSubGameInfoAction","ToastPosition","ToastType","isEqual","BundleSplit","baseBoardView","hallAudio","SoundPathDefine","sendNativeVibrate","ccclass","property","Hall_Baseboard","toastTimer","openGameId","propertyNode","props_restart","props_Button_restart","props_toast_template_normal","props_toast_template_error","props_toastWrap_bottom","props_toastWrap_middle","props_toastWrap_top","props_mainBoard","props_loading","props_btn_close_loading","props_subGameBoard","props_icon_dating_loading","props_marquee","props_winnerBox","props","toastData","content","type","NORMAL","isLoading","isAllowCloseLoading","openGameInfo","events","toastDone","onGameClose","closeGameHandler","closeGameHandlerTempList","start","initState","bindEvent","node","on","EventType","TOUCH_END","dispatch","isShow","useProps","key","value","pre","cur","addToast","active","pause","disable","mainPanelViewModel","viewNode","find","item","gameId","closeFn","bindUI","addPersistRootNode","beginInitSubGame","gameInfo","startUpHandler","some","i","push","closeSubGame","isPre","playOneShot","BTU_CLICK","console","error","destroyAllChildren","resume","undefined","openReliefPanel","scheduleOnce","releaseBundle","toastObj","toastWrap","position","BOTTOM","MIDDLE","TOP","ERROR","setSiblingIndex","props_toast","getChildByName","getComponent","string","addChild","setScale","to","scale","delay","call","destroy","getSubGameWrapNode","getMainBoardNode","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, director, find, game, instantiate, Label, Node, sys, tween, UITransform, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { setLoadingAction, setSubGameInfoAction, ToastPosition, ToastType } from '../store/actions/baseBoard';\r\nimport isEqual from \"fast-deep-equal\"\r\nimport { HallGameGateType } from '../config';\r\nimport { effect1 } from '../../utils/NodeIOEffect';\r\nimport BundleSplit from '../../utils/BundleSplit';\r\nimport MarqueeViewModel from '../viewModel/MarqueeViewModel';\r\nimport { baseBoardView, hallAudio, sourceManageSeletor } from '../index';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { sendNativeVibrate } from '../../common/bridge';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\ttoastData?: { content: string, type: ToastType },\r\n\tisLoading?: boolean,\r\n\tisAllowCloseLoading?: boolean\r\n\t/**打开游戏 */\r\n\topenGameInfo?: HallGameGateType\r\n}\r\n\r\nexport interface IEvent {\r\n\ttoastDone?: () => void\r\n\tonGameClose?: () => void\r\n}\r\n\r\n@ccclass('Hall_Baseboard')\r\nexport class Hall_Baseboard extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate toastTimer: number = 0\r\n\tprivate openGameId = 0;\r\n\tprotected propertyNode = {\r\n\t\t/**底板重启 */\r\n\t\tprops_restart: new Node(),\r\n\t\t/**底板重启按钮 */\r\n\t\tprops_Button_restart: new Node(),\r\n\t\t/**toast模板节点(正常提示) */\r\n\t\tprops_toast_template_normal: new Node(),\r\n\t\t/**toast模板节点(错误提示) */\r\n\t\tprops_toast_template_error: new Node(),\r\n\t\t/**放置toast的包裹节点 */\r\n\t\tprops_toastWrap_bottom: new Node(),\r\n\t\tprops_toastWrap_middle: new Node(),\r\n\t\tprops_toastWrap_top: new Node(),\r\n\t\t/**放置主内容的面板 */\r\n\t\tprops_mainBoard: new Node(),\r\n\t\t/**加载中的节点 */\r\n\t\tprops_loading: new Node(),\r\n\t\t/**关闭loading */\r\n\t\tprops_btn_close_loading: new Button(),\r\n\t\t/**盛放子游戏的node */\r\n\t\tprops_subGameBoard: new Node(),\r\n\t\t/**游戏的头部框 */\r\n\t\t// props_subGameBoardHeader: new Node(),\r\n\t\t/**关闭按钮 */\r\n\t\t// props_closeButton: new Node(),\r\n\t\t/**加载图 */\r\n\t\tprops_icon_dating_loading: new Node(),\r\n\t\t/**头部条 */\r\n\t\t// props_subGameHeader: new Node(),\r\n\t\t/**跑马灯 */\r\n\t\tprops_marquee: new Node(),\r\n\t\t/**中奖通告 */\r\n\t\tprops_winnerBox: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\ttoastData: { content: \"\", type: ToastType.NORMAL },\r\n\t\tisLoading: false,\r\n\t\tisAllowCloseLoading: false,\r\n\t\topenGameInfo: null\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\ttoastDone: () => { },\r\n\t\tonGameClose: () => { },\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\t// this.propertyNode.props_Button_restart.on(Node.EventType.TOUCH_END, () => {\r\n\t\t// \tsys.isNative && game.restart()\r\n\t\t// })\r\n\r\n\t\t// this.propertyNode.props_subGameHeader.getChildByName(\"Up_Left\").getChildByName(\"Back_Bg\").on(Node.EventType.TOUCH_END, () => {\r\n\t\t// \t// this.closeSubGame()\r\n\t\t// \t(find(\"Canvas/baseBoard\").getComponent('Hall_Baseboard') as any).closeSubGame()\r\n\t\t// })\r\n\t\tthis.propertyNode.props_btn_close_loading.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\tthis.dispatch(setLoadingAction({ isShow: false }))\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"toastData\") {\r\n\t\t\tif (!isEqual(value.pre, value.cur) && value.cur.content) {\r\n\t\t\t\tthis.addToast(value.cur)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"isLoading\") {\r\n\t\t\tthis.propertyNode.props_loading.active = value.cur\r\n\t\t}\r\n\t\tif (key === \"isAllowCloseLoading\") {\r\n\t\t\tthis.propertyNode.props_btn_close_loading.node.active = value.cur\r\n\t\t}\r\n\t\tif (key === \"openGameInfo\") {\r\n\t\t\tif (value.cur) {\r\n\t\t\t\t//打开游戏\r\n\t\t\t\thallAudio.pause()\r\n\t\t\t\thallAudio.disable = true\r\n\t\t\t\tthis.dispatch(setLoadingAction({ isShow: false }))\r\n\t\t\t\tsendNativeVibrate(200)\r\n\t\t\t\tbaseBoardView.mainPanelViewModel.viewNode.active = false\r\n\t\t\t\tthis.closeGameHandler = this.closeGameHandlerTempList.find(item => item.gameId === this.props.openGameInfo.gameId).closeFn\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tdirector.addPersistRootNode(this.node)\r\n\t\t// new MarqueeViewModel().mountView(sourceManageSeletor(\"common\").getFile(PrefabPathDefine.MARQUEE).source).appendTo(this.propertyNode.props_marquee).connect()\r\n\t}\r\n\r\n\r\n\tprivate closeGameHandler: Function\r\n\tprivate closeGameHandlerTempList: Array<{ gameId: number, closeFn: Function }> = []\r\n\r\n\t/**开始初始化子游戏 */\r\n\tpublic beginInitSubGame(gameInfo: HallGameGateType) {\r\n\t\t// if (this.openGameId) return\r\n\t\t// 打开游戏底板\r\n\t\tthis.propertyNode.props_subGameBoard.active = true\r\n\t\t// this.propertyNode.props_subGameHeader.active = true\r\n\t\t// this.propertyNode.props_subGameBoardHeader.active = true\r\n\t\t// this.propertyNode.props_subGameBoardHeader.getChildByName(\"subGameName\").getComponent(Label).string = gameInfo.gameName\r\n\t\tthis.openGameId = gameInfo.gameId\r\n\t\tconst closeFn = gameInfo.startUpHandler(this.propertyNode.props_subGameBoard)\r\n\t\tif (this.closeGameHandlerTempList.some(i => i.gameId === gameInfo.gameId)) {\r\n\t\t\tthis.closeGameHandlerTempList.find(i => i.gameId === gameInfo.gameId).closeFn = closeFn\r\n\t\t} else {\r\n\t\t\tthis.closeGameHandlerTempList.push({ gameId: gameInfo.gameId, closeFn: closeFn })\r\n\t\t}\r\n\r\n\t\t// effect1(this.propertyNode.props_subGameBoard).enter().then(() => { })\r\n\t\t// director.loadScene(\"fruit777\")\r\n\t}\r\n\r\n\tpublic closeSubGame(isPre: boolean = false) {\r\n\t\tif (!this.props.openGameInfo) return\r\n\t\tthis.openGameId = 0\r\n\t\tconst gameId = this.props.openGameInfo.gameId\r\n\t\t// effect1(this.propertyNode.props_subGameBoard).out(false).then(() => { })\r\n\t\thallAudio.disable = false\r\n\t\thallAudio.playOneShot(SoundPathDefine.BTU_CLICK)\r\n\t\tif (!isPre) {\r\n\t\t\tif (this.closeGameHandler) {\r\n\t\t\t\tthis.closeGameHandler()\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\"未返回结束游戏的方案\")\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.propertyNode.props_subGameBoard.destroyAllChildren()\r\n\t\tthis.events.onGameClose()\r\n\t\tbaseBoardView.mainPanelViewModel.viewNode.active = true\r\n\t\tthis.dispatch(setSubGameInfoAction(null))\r\n\t\t// this.propertyNode.props_subGameBoard.active = false\r\n\t\t// hallAudio.resume()\r\n\t\thallAudio.resume()//.play(SoundPathDefine.MAIN_BGM, true)\r\n\t\tthis.closeGameHandler = undefined\r\n\t\tbaseBoardView.mainPanelViewModel.openReliefPanel()\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tBundleSplit.releaseBundle(gameId)\r\n\t\t}, 1)\r\n\t\t// this.propertyNode.props_subGameHeader.active = false\r\n\t}\r\n\r\n\tprivate addToast(toastObj: { content: string, type: ToastType, position: ToastPosition }) {\r\n\t\tlet toastWrap: Node\r\n\t\tswitch (toastObj.position) {\r\n\t\t\tcase ToastPosition.BOTTOM: toastWrap = this.propertyNode.props_toastWrap_bottom; break;\r\n\t\t\tcase ToastPosition.MIDDLE: toastWrap = this.propertyNode.props_toastWrap_middle; break;\r\n\t\t\tcase ToastPosition.TOP: toastWrap = this.propertyNode.props_toastWrap_top; break;\r\n\t\t}\r\n\r\n\t\tif (toastObj.type !== ToastType.ERROR && toastObj.position === ToastPosition.BOTTOM) {\r\n\t\t\ttoastWrap = this.propertyNode.props_toastWrap_middle\r\n\t\t}\r\n\r\n\t\t(toastWrap as Node).setSiblingIndex(1000)\r\n\t\tconst props_toast: Node = instantiate(toastObj.type === ToastType.ERROR ? this.propertyNode.props_toast_template_error : this.propertyNode.props_toast_template_normal)\r\n\t\tprops_toast.getChildByName(\"toastLabel\").getComponent(Label).string = toastObj.content\r\n\t\tprops_toast.active = true\r\n\t\ttoastWrap.addChild(props_toast)\r\n\t\tprops_toast.setScale(new Vec3(1, 0, 1))\r\n\t\ttween(props_toast).to(0.1, { scale: new Vec3(1, 1, 1) }).delay(3).to(0.1, { scale: new Vec3(1, 0, 1) }).call(() => {\r\n\t\t\tprops_toast.destroy()\r\n\t\t\tthis.events.toastDone()\r\n\t\t}).start()\r\n\r\n\t\t// props_toast.setScale(new Vec3(1, 1, 1))\r\n\t\t// const { x, y, z } = props_toast.position\r\n\t\t// tween(props_toast).to(0.1, { position: new Vec3(x, y, z) }).delay(3).to(0.1, { position: new Vec3(x, y + 100, z) }).call(() => {\r\n\t\t// \tprops_toast.destroy()\r\n\t\t// \tthis.events.toastDone()\r\n\t\t// }).start()\r\n\r\n\r\n\t\t// tween(props_toast).to(0.2, { position: new Vec3(x, y) }, { easing: \"backOut\" }).delay(2).to(0.1, { position: new Vec3(x, y + 200) }).call(() => {\r\n\t\t// \tprops_toast.destroy()\r\n\t\t// \tthis.events.toastDone()\r\n\t\t// }).start()\r\n\t}\r\n\tpublic getSubGameWrapNode() {\r\n\t\treturn this.propertyNode.props_subGameBoard\r\n\t}\r\n\tpublic getMainBoardNode() {\r\n\t\treturn this.propertyNode.props_mainBoard\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}