{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenix/Slot/Mediator/BaseMediator.ts"],"names":["BaseMediator","instantiate","Mediator","constructor","mediatorName","viewComponent","wrapView","getSource","path","isInst","sourceMap","find","i","source","init","addChild","listenerEvent","listNotificationInterests","listNotificationConst","map","name","handleNotification","notification","interest","getName","handler","bind"],"mappings":";;;sGAoB8BA,Y;;;;;;;;;;;;;;;;;;;;;;;;;;;AAlBtBC,MAAAA,W,OAAAA,W;;AADDC,MAAAA,Q;;;;;;;;;AAKP;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;yBAE8BF,Y,GAAf,MAAeA,YAAf;AAAA;AAAA,gCAA6C;AAIxD;;AAEA;AACA;AAEOG,QAAAA,WAAW,CAACC,YAAD,EAA8BC,aAA9B,EAA0D;AAAA,cAAzDD,YAAyD;AAAzDA,YAAAA,YAAyD,GAAlC,IAAkC;AAAA;;AAAA,cAA5BC,aAA4B;AAA5BA,YAAAA,aAA4B,GAAN,IAAM;AAAA;;AACxE,gBAAMD,YAAN,EAAoBC,aAApB;;AATJ;AAQ4E,eAPrEC,QAOqE;AAE3E;AAED;AACJ;AACA;;AAEI;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA;AACJ;AACA;AACA;AACA;AACA;AACIC,QAAAA,SAAS,CAACC,IAAD,EAAeC,MAAf,EAAuC;AAAA,cAAxBA,MAAwB;AAAxBA,YAAAA,MAAwB,GAAN,IAAM;AAAA;;AAC5C,cAAIA,MAAJ,EAAY;AACR,mBAAOR,WAAW,CAAC,KAAKS,SAAL,CAAeC,IAAf,CAAoBC,CAAC,IAAIA,CAAC,CAACJ,IAAF,KAAWA,IAApC,EAA0CK,MAA3C,CAAlB;AACH,WAFD,MAEO;AACH,mBAAO,KAAKH,SAAL,CAAeC,IAAf,CAAoBC,CAAC,IAAIA,CAAC,CAACJ,IAAF,KAAWA,IAApC,CAAP;AACH;AACJ;;AAESM,QAAAA,IAAI,GAAG;AACb,eAAKR,QAAL,GAAgB,KAAKC,SAAL,CAAe,KAAKG,SAAL,CAAe,CAAf,EAAkBF,IAAjC,CAAhB;AACA,eAAKH,aAAL,CAAmBU,QAAnB,CAA4B,KAAKT,QAAjC;AACA,eAAKU,aAAL;AACH;AAED;;;AAGOC,QAAAA,yBAAyB,GAAa;AACzC,iBAAO,KAAKC,qBAAL,CAA2BC,GAA3B,CAA+BP,CAAC,IAAIA,CAAC,CAACQ,IAAtC,CAAP;AACH;;AAEMC,QAAAA,kBAAkB,CAACC,YAAD,EAA8B;AACnD,cAAMC,QAAQ,GAAG,KAAKL,qBAAL,CAA2BP,IAA3B,CAAgCC,CAAC,IAAIA,CAAC,CAACQ,IAAF,KAAWE,YAAY,CAACE,OAAb,EAAhD,CAAjB;AACAD,UAAAA,QAAQ,CAACE,OAAT,CAAiBC,IAAjB,CAAsB,IAAtB,EAA4BJ,YAA5B;AACH;;AAhFuD,O","sourcesContent":["import {INotification} from \"../../Framework/interfaces/INotification\"\r\nimport Mediator from \"../../Framework/patterns/mediator/Mediator\"\r\nimport {instantiate, Node} from \"cc\"\r\nimport {IlistTypeHander} from \"../types/IlistTypeHander\"\r\nimport {ISourceFile} from \"../types/ISourceFile\"\r\n\r\n// export interface IlistNotificationer<O> {\r\n// \tname: string\r\n// \tisListen?: boolean\r\n// \t/**返回是否继续执行 */\r\n// \thandler(this: O, notification: INotification): void\r\n// }\r\n\r\n// export type SourceFileType = {\r\n// \tkey: string,\r\n// \tpath: string,\r\n// \tsourceType: __private._types_globals__Constructor<Asset>,\r\n// \tsource: any\r\n// }\r\n\r\nexport default abstract class BaseMediator extends Mediator {\r\n    /**最外层的预制组件节点 */\r\n    public wrapView: Node\r\n\r\n    // public isLoadAfterShowPrefavSource: boolean = true\r\n\r\n    /**预制组件资源，需要子类实现 */\r\n    // protected mainPrefabSource: SourceFileType\r\n\r\n    public constructor(mediatorName: string = null, viewComponent: Node = null) {\r\n        super(mediatorName, viewComponent)\r\n    }\r\n\r\n    /**\r\n     * 需要预先加载的文件\r\n     */\r\n    public abstract sourceMap: Array<ISourceFile>\r\n    /**这是Mediator需要监听的通知 */\r\n    protected abstract listNotificationConst: Array<IlistTypeHander<any>>\r\n    // public loadSource() {\r\n    //     return new Promise((reslove, reject) => {\r\n    //         this.inAdvanceLoadFiles.forEach(async ({ path, sourceType }) => {\r\n    //             resources.load(path, sourceType)\r\n    //         })\r\n    //         if (!this.mainPrefabSource) {\r\n    //             reject(\"mainPrefabSource为空\")\r\n    //         } else {\r\n    //             resources.load(this.mainPrefabSource.path, this.mainPrefabSource.sourceType, (err, prefab) => {\r\n    //                 this.mainPrefabSource.source = prefab\r\n    //                 reslove(prefab)\r\n    //             })\r\n    //         }\r\n    //     })\r\n    //     // 需要提前加载的预制组件，之后就可以通过resources.get获取\r\n    //     // this.inAdvanceLoadFiles.forEach(({ path, sourceType }) => resources.load(path, sourceType))\r\n\r\n    //     // resources.load(this.prefabSource.path, Prefab, (err, prefab) => {\r\n    //     //     this.prefabSource.source = prefab\r\n    //     //     this.viewComponent.addChild(instantiate(prefab))\r\n    //     // })\r\n\r\n\r\n    //     // if (this.isLoadAfterShowPrefavSource) {\r\n\r\n    //     // } else {\r\n    //     //     resources.preload(this.prefabSource.path, Prefab, (err, prefab) => {\r\n    //     //         this.prefabSource.source = prefab\r\n    //     //     })\r\n    //     // }\r\n    // }\r\n    /**\r\n     * 获取实例化的资源\r\n     * @param path 资源路径\r\n     * @param isInst 是否要实例化(不填写就要实例化,返回node)\r\n     * @returns isInst = true,返回ISourceFile\r\n     */\r\n    getSource(path: string, isInst: boolean = true) {\r\n        if (isInst) {\r\n            return instantiate(this.sourceMap.find(i => i.path === path).source)\r\n        } else {\r\n            return this.sourceMap.find(i => i.path === path)\r\n        }\r\n    }\r\n\r\n    protected init() {\r\n        this.wrapView = this.getSource(this.sourceMap[0].path)\r\n        this.viewComponent.addChild(this.wrapView)\r\n        this.listenerEvent()\r\n    }\r\n\r\n    /**绑定时间的数据处理逻辑 */\r\n    protected abstract listenerEvent(): void\r\n\r\n    public listNotificationInterests(): string[] {\r\n        return this.listNotificationConst.map(i => i.name)\r\n    }\r\n\r\n    public handleNotification(notification: INotification) {\r\n        const interest = this.listNotificationConst.find(i => i.name === notification.getName())\r\n        interest.handler.bind(this)(notification)\r\n    }\r\n}\r\n"]}