{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/gxfc/Slot/Proxy/SocketProxy.ts"],"names":["SocketProxy","CommandDefine","ProxyDefine","BgMediatorConst","RollerMediatorConst","SocketRepository","config","getBgProxy","BaseProxy","global","lang","addToastAction","SubGameType","goldState","SKT_MAG_TYPE","dataMap","sktMsgListener","add","key","id","handler","sortId","item","find","i","handlerList","push","dispath","data","sort","a","b","forEach","remove","filter","removeAllListener","constructor","proxyName","ws","heartBeatTimer","socketConfig","switcher","repository","initSocket","cbFn","err","WebSocket","OPEN","readyState","close","socketIp","onopen","event","console","log","connectCallback","window","setInterval","sendSktMessage","HEART_BEAT","undefined","onerror","onmessage","ev","onclose","clearInterval","e","sendNotification","SHOW_TOAST","content","evData","JSON","parse","code","gameCode","msgArr","split","success","error","typeCode","hallDispatch","write","k","WebSocketModule","socketConnectDateFail","placeStr","includes","closeSubGame","confirmContent","msgType","send","stringify","sendAnth","AUTH","token","gameId","roomId","closeSocket","calculateTheBalanceStatus","gold","rollerLaunchResult","dl","si","bl","betAmount","getShiftAmount","value","linesQueue","length","InsufficientBalanceDisplay","sendLaunch","openShop","LAUNCH","positionId","userServerData","tableId","direction","userSwitch","SETGREYOUT","state","initUserSwitch","val","betSwitcher","map","lv","level","amount","setTimeout","getTransferGameInfo","stopIndexArr","rollerId","targetList","_linesDir","wp","freegameDir","freegame","linesDir","lineList","lines","lineIndex","coord","item2","index2","t","item3","getDockIcon","fixedChessboardIcon","line","gameType","MAIN","getWildRollerId","wildRollerId","freeWildRollerId","setIconStay","iconStay","getOpenBoxEffect","lw","getRemainTimes","freeCount","getCurrentScore","order","tbb","tw","freeGameAmount","getMagnification","magnification","getUserLevel","getNumberOfRounds","getUserGold","OLD_GOLD","PROCESS_GOLD","blab","topUpCoins","setGametType","getLocalCacheDataProxy","facade","retrieveProxy","LOCAL_CACHE_DATA","Object","assign","ROLLER","INIT_ROLLER_PANEL","SUB_GAME1","SUB_GAME2","initGameData","UPDATE_USER_GOLD","TOGGLETHESTARTBUTTON","INITSCORE","setGameInfo","REFRESHCOINS","VACATETHEROOM","UpdateModule","GameNotice","init","gameTypePre","getNextGame","gameTypeNew","setIsChangeNextGameType","UPDATE_GAME_STATUS","REMOVE_THECHEST_LAYER","UPDATE_BTN_LABEL","frequency","freeGameCount"],"mappings":"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","sourcesContent":["import { log } from \"cc\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SocketRepository } from \"../Repositories/SocketRepository\";\r\nimport config from \"../config\";\r\nimport { convertToMandK, getBgProxy } from \"../utils\";\r\nimport BaseProxy from \"./BaseProxy\";\r\nimport { LocalCacheDataProxy } from \"./LocalCacheDataProxy\";\r\nimport { global, lang } from \"../../../../hall\";\r\nimport { addToastAction } from \"../../../../hall/store/actions/baseBoard\";\r\n\r\nexport enum SubGameType {\r\n    /**主滑槽游戏 */\r\n    MAIN,\r\n    /**开宝箱游戏 */\r\n    SUB_GAME1,\r\n    /**大滑槽游戏 */\r\n    SUB_GAME2\r\n}\r\nexport enum goldState {\r\n    /**默认金币 || 结算金币*/\r\n    OLD_GOLD,\r\n    /**扣除金币 */\r\n    PROCESS_GOLD,\r\n    /**充值刷新金币 */\r\n    topUpCoins\r\n}\r\nexport enum SKT_MAG_TYPE {\r\n    /**心跳 */\r\n    HEART_BEAT = \"1\",\r\n    /**认证 */\r\n    AUTH = \"2\",\r\n    /**退出 */\r\n    EXIT = \"3\",\r\n    /**启动 */\r\n    LAUNCH = \"501\",\r\n    /**通知刷新金币 */\r\n    REFRESHCOINS = \"10\",\r\n    /**清退房间 */\r\n    VACATETHEROOM = \"3\"\r\n}\r\n\r\ntype SktMessageType = {\r\n    code: string,\r\n    messageId: string,\r\n    success: boolean,\r\n    data?: any\r\n}\r\n\r\nlet dataMap: Array<{\r\n    key: SKT_MAG_TYPE,\r\n    handlerList: Array<{\r\n        id: string,\r\n        sortId: number,\r\n        handler: (data: any) => void\r\n    }>\r\n}> = []\r\n/**自定义的监听器 */\r\nexport const sktMsgListener = {\r\n    add: (key: SKT_MAG_TYPE, id: string, handler: (data: any) => void, sortId: number = 0) => {\r\n        let item = dataMap.find(i => i.key === key)\r\n        if (!item) {\r\n            item = {\r\n                key,\r\n                handlerList: [{ id, sortId, handler }]\r\n            }\r\n            dataMap.push(item)\r\n        } else {\r\n            item.handlerList.push({ id, sortId, handler })\r\n        }\r\n    },\r\n    dispath: (key: SKT_MAG_TYPE, data: any) => {\r\n        const item = dataMap.find(i => i.key === key)\r\n        item && item.handlerList.sort((a, b) => a.sortId - b.sortId).forEach(item => item.handler(data))\r\n    },\r\n    remove: (key: SKT_MAG_TYPE, id?: string) => {\r\n        if (id) {\r\n            let item = dataMap.find(item => item.key === key)\r\n            item.handlerList = item.handlerList.filter(item => item.id !== id)\r\n        } else {\r\n            dataMap = dataMap.filter(item => item.key !== key)\r\n        }\r\n    },\r\n    removeAllListener: () => {\r\n        dataMap = []\r\n    }\r\n}\r\n\r\nexport class SocketProxy extends BaseProxy<SocketRepository> {\r\n    private ws: WebSocket\r\n    private heartBeatTimer: number\r\n    private socketConfig: {\r\n        socketIp: string;\r\n        token: string;\r\n        gameId: number;\r\n        roomId: string;\r\n    }\r\n    private switcher = []\r\n    constructor(proxyName: string = null, data: any = null) {\r\n        super(proxyName, data)\r\n        this.repository = new SocketRepository()\r\n        this.socketConfig = null\r\n    }\r\n\r\n    public async initSocket(cbFn: () => void, err: (e) => void) {\r\n        try {\r\n            this.socketConfig = await this.repository.socketConfig()\r\n            if (this.ws && WebSocket.OPEN == this.ws.readyState) {\r\n                this.ws.close()\r\n                this.ws = null\r\n            }\r\n\r\n            this.ws = new WebSocket(this.socketConfig.socketIp)\r\n            /**当连接建立成功后，这个函数就会被调用 */\r\n            this.ws.onopen = (event) => {\r\n                console.log(\"WebSocket connected\")\r\n                this.connectCallback()\r\n                cbFn && cbFn()\r\n                this.heartBeatTimer = window.setInterval(() => {\r\n                    this.sendSktMessage(SKT_MAG_TYPE.HEART_BEAT, undefined)\r\n                }, 5000)\r\n                // this.sendNotification(CommandDefine.START_UP);\r\n            }\r\n            this.ws.onerror = (event) => {\r\n                err && err(event)\r\n            }\r\n            this.ws.onmessage = (ev: MessageEvent<any>) => {\r\n                this.onmessage(ev)\r\n            }\r\n            this.ws.onclose = () => {\r\n                //重连\r\n                window.clearInterval(this.heartBeatTimer)\r\n                this.ws = new WebSocket(this.socketConfig.socketIp)\r\n                console.log(\"exit and reconnect\")\r\n            }\r\n        } catch (e) {\r\n            this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: `网络错误：${e}` })\r\n        }\r\n    }\r\n\r\n    public onmessage(ev: MessageEvent<any> | SktMessageType) {\r\n        const evData = JSON.parse(ev.data) as SktMessageType\r\n        evData.code !== `${config.gameCode}:-${SKT_MAG_TYPE.HEART_BEAT}`\r\n        // evData.code !== `${config.gameCode}:-${SKT_MAG_TYPE.HEART_BEAT}` && console.log(evData)\r\n        const msgArr = evData.code.split(\":-\")\r\n        if (evData.success) {\r\n            if (msgArr[0] !== config.gameCode) {\r\n                this.sendNotification(BgMediatorConst.SHOW_TOAST, { content: \"错误的游戏代码\" })\r\n                console.error('服务错误', '错误的游戏代码')\r\n                return\r\n            }\r\n            const typeCode = msgArr[1]//(parseInt(msgArr[1]) * -1) + ''\r\n            sktMsgListener.dispath(typeCode as SKT_MAG_TYPE, evData.data)\r\n        } else {\r\n            global.hallDispatch(addToastAction({ content: lang.write(k => k.WebSocketModule.socketConnectDateFail, {}, { placeStr: \"连接失败\" }) }))\r\n            if (evData['code'].includes('-2')) {\r\n                global.closeSubGame({ confirmContent: evData['reason'] })\r\n            }\r\n            console.error(`服务错误`, evData)\r\n        }\r\n    }\r\n\r\n    public sendSktMessage(msgType: SKT_MAG_TYPE, data: string | ArrayBuffer | Blob | ArrayBufferView | any) {\r\n        this.ws && this.ws.send(JSON.stringify({\r\n            code: `${config.gameCode}:${msgType}`, data\r\n        }))\r\n    }\r\n\r\n    public sendAnth() {\r\n        this.sendSktMessage(SKT_MAG_TYPE.AUTH,\r\n            {\r\n                \"token\": this.socketConfig.token,\r\n                \"gameId\": this.socketConfig.gameId,\r\n                \"roomId\": this.socketConfig.roomId\r\n            }\r\n        )\r\n    }\r\n    public closeSocket() {\r\n        if (this.ws) {\r\n            this.ws.close()\r\n            this.ws = null\r\n        }\r\n    }\r\n    public calculateTheBalanceStatus() {\r\n        let gold = this.repository.rollerLaunchResult.dl.si[0].bl\r\n        let betAmount = (this.getShiftAmount(\"curr\").value) * config.linesQueue.length\r\n        this.sendNotification(BgMediatorConst.InsufficientBalanceDisplay, { bl: gold < (betAmount / 2) });\r\n        console.log(gold, (betAmount / 2));\r\n        return gold < (betAmount / 2)\r\n    }\r\n    /**发送下注请求 */\r\n    public sendLaunch() {\r\n        // socket断开的时候临时这样搞\r\n        // window.setTimeout(() => {\r\n        //   sktMsgListener.dispath(SKT_MAG_TYPE.LAUNCH, this.repository.rollerLaunchResult)\r\n        // }, 100)\r\n        // return\r\n        let bl = this.calculateTheBalanceStatus()\r\n        if (bl) {\r\n            global.openShop()\r\n        } else {\r\n            this.sendSktMessage(SKT_MAG_TYPE.LAUNCH, {\r\n                \"positionId\": this.getShiftAmount(\"curr\").positionId,\r\n                \"tableId\": this.repository.userServerData.tableId\r\n            })\r\n        }\r\n    }\r\n    /**获取下一档位数据(根据用户级别取得可以下注的额度列表),传max就是获取最大档位 */\r\n    public getShiftAmount(direction: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n        //先获取用户\r\n        if (direction === \"add\" && this.repository.userSwitch < this.switcher.length) {\r\n            this.repository.userSwitch++\r\n        } else if (direction === \"add\" && this.repository.userSwitch === this.switcher.length) {\r\n            //this.repository.userSwitch = 1\r\n        }\r\n\r\n        if (direction === \"subtract\" && this.repository.userSwitch > 1) {\r\n            this.repository.userSwitch--\r\n        } else if (direction === \"subtract\" && this.repository.userSwitch === 1) {\r\n            //this.repository.userSwitch = switcher.length\r\n        }\r\n        if (this.repository.userSwitch != 1 && this.repository.userSwitch !== this.switcher.length) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 0 });\r\n        } else if (this.repository.userSwitch - 1 <= 1) {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n        } else {\r\n            this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n        }\r\n        if (direction === \"max\") {\r\n            this.repository.userSwitch = this.switcher.length\r\n        }\r\n        return this.switcher[this.repository.userSwitch - 1]\r\n    }\r\n    public initUserSwitch(val) {\r\n        this.repository.userSwitch = val - 1 < 1 ? 1 : val\r\n        this.switcher = []\r\n        config.betSwitcher.map(item => {\r\n            if (this.repository.userServerData.lv >= item.level[0]) {\r\n                this.switcher.push(...item.amount)\r\n            }\r\n        })\r\n        if (this.repository.userSwitch <= 1) {\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 1 });\r\n            }, 200)\r\n        } else if(this.repository.userSwitch == this.switcher.length){\r\n            window.setTimeout(() => {\r\n                this.sendNotification(BgMediatorConst.SETGREYOUT, { state: 2 });\r\n            }, 200)\r\n        }\r\n    }\r\n    /**获取转义的游戏数据 */\r\n    public getTransferGameInfo() {\r\n        return {\r\n            // 获取停止的序号\r\n            stopIndexArr: () => {\r\n                // return this.repository.rollerLaunchResult.dl.si[0].rl.map(item => item[0])\r\n                return this.repository.rollerLaunchResult.dl.si[0].rollerId\r\n            },\r\n            /**获取需要闪动的图标列表，转成平铺数组，不闪动的加-1 */\r\n            targetList: () => {\r\n                let _linesDir = this.repository.rollerLaunchResult.dl.si[0].wp\r\n                const freegameDir = this.repository.rollerLaunchResult.dl.si[0].freegame || {}\r\n                const linesDir = {\r\n                    ..._linesDir,\r\n                    ...freegameDir\r\n                }\r\n                const lineList: Array<{ lineIndex: string, coord: Array<Array<any>> }> = []\r\n                for (let lineIndex in linesDir) {\r\n                    const lines: number[][] = linesDir[lineIndex]\r\n                    /**\r\n                     [[0,1],[0,2],[1,1],[2,2]]\r\n                     */\r\n                    const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                    coord.forEach((item2, index2) => {\r\n                        const t = lines.filter((item3) => item3[0] === index2).map(i => i[1]);\r\n                        // const t = lines.find((item3) => item3[0] === index2)\r\n                        t.length && (item2[1] = t)\r\n                    })\r\n                    lineList.push({ lineIndex, coord })\r\n                }\r\n                return lineList\r\n            },\r\n            /**获取需要停靠的图标 */\r\n            getDockIcon: () => {\r\n                let lineList: { lineIndex: string, coord: Array<Array<any>> }\r\n                const lines: number[][] = this.repository.rollerLaunchResult.dl.si[0].fixedChessboardIcon || []\r\n                /**\r\n                 [[0,1],[0,2],[1,1],[2,2]]\r\n                 */\r\n                const coord = [[0, []], [1, []], [2, []], [3, []], [4, []]]\r\n                coord.forEach((item2, index2) => {\r\n                    const t = lines.filter((line) => line[0] === index2).map(i => [i[1], i[2]]);\r\n                    // const t = lines.find((item3) => item3[0] === index2)\r\n                    t.length && (item2[1] = t)\r\n                })\r\n                return coord\r\n            },\r\n            /**获取gameType */\r\n            gameType: () => {\r\n                if (!this.repository.rollerLaunchResult) {\r\n                    return SubGameType.MAIN\r\n                }\r\n                return this.repository.rollerLaunchResult.dl.si[0].gameType as SubGameType\r\n            },\r\n            getWildRollerId: () => {\r\n                let data = {\r\n                    wildRollerId: [],\r\n                    freeWildRollerId: []\r\n                }\r\n                if (this.repository.rollerLaunchResult.dl.si[0].wildRollerId) {\r\n                    data.freeWildRollerId = this.repository.rollerLaunchResult.dl.si[0].wildRollerId\r\n                }\r\n                if (this.repository.rollerLaunchResult.dl.si[0].freeWildRollerId) {\r\n                    data.freeWildRollerId = this.repository.rollerLaunchResult.dl.si[0].freeWildRollerId\r\n                }\r\n                return data\r\n            },\r\n            setIconStay(key) {\r\n                this.repository.rollerLaunchResult.dl.si[0].iconStay = key\r\n            },\r\n            /**获取要执行的宝箱效果 */\r\n            getOpenBoxEffect: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].lw\r\n            },\r\n            /**获取剩余抽奖次数 */\r\n            getRemainTimes: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            /**获取当前的总奖励 */\r\n            getCurrentScore: (order: 'curr' | 'total' | 'auto') => {\r\n                if (this.repository.rollerLaunchResult.dl.si[0].tbb != 0) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].tw\r\n                } else {\r\n                    if (order === 'curr') {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].tw || this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    } else {\r\n                        return this.repository.rollerLaunchResult.dl.si[0].freeGameAmount\r\n                    }\r\n                }\r\n            },\r\n            /**获取奖励倍数 */\r\n            getMagnification: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].magnification\r\n            },\r\n            /**获取用户级别 */\r\n            getUserLevel: () => {\r\n                return this.repository.userServerData.lv\r\n            },\r\n            /* 获取第几局*/\r\n            getNumberOfRounds: () => {\r\n                return this.repository.rollerLaunchResult.dl.si[0].freeCount\r\n            },\r\n            getUserGold: (state: goldState) => {\r\n                if (state === goldState.OLD_GOLD) {\r\n                    console.log(this.repository.rollerLaunchResult.dl.si[0].bl)\r\n                    return this.repository.rollerLaunchResult.dl.si[0].bl\r\n                } else if (state === goldState.PROCESS_GOLD) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].blab\r\n                } else if (state === goldState.topUpCoins) {\r\n                    return this.repository.rollerLaunchResult.dl.si[0].bl\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public setGametType(gameType: number) {\r\n        this.repository.rollerLaunchResult.dl.si[0].gameType = gameType\r\n    }\r\n\r\n    public close() {\r\n        this.ws.close()\r\n    }\r\n\r\n    getLocalCacheDataProxy(): LocalCacheDataProxy {\r\n        return <LocalCacheDataProxy>this.facade.retrieveProxy(ProxyDefine.LOCAL_CACHE_DATA);\r\n    }\r\n\r\n    private connectCallback() {\r\n        sktMsgListener.add(SKT_MAG_TYPE.AUTH, 'proxy', (data) => {\r\n            this.repository.userServerData = Object.assign({}, data)\r\n            if (data.gameType === SubGameType.MAIN) {\r\n                //主游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 0 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME1) {\r\n                // 次数游戏\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 1 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            } else if (data.gameType === SubGameType.SUB_GAME2) {\r\n                //大滑槽\r\n                this.sendNotification(CommandDefine.ROLLER, { gameType: 2 }, RollerMediatorConst.INIT_ROLLER_PANEL)\r\n            }\r\n            this.initGameData(data)\r\n        })\r\n        sktMsgListener.add(SKT_MAG_TYPE.LAUNCH, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult = Object.assign({}, data)\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.PROCESS_GOLD })\r\n            if (this.getTransferGameInfo().gameType() === 0) {\r\n                // 按钮状态\r\n                this.sendNotification(BgMediatorConst.TOGGLETHESTARTBUTTON, { state: false });\r\n                this.sendNotification(BgMediatorConst.INITSCORE)\r\n            }\r\n            this.setGameInfo()\r\n        }, 1)\r\n        // 后台刷新金币\r\n        sktMsgListener.add(SKT_MAG_TYPE.REFRESHCOINS, 'proxy', (data) => {\r\n            this.repository.rollerLaunchResult.dl.si[0].bl = data\r\n            this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.topUpCoins })\r\n        }, 1)\r\n        // 清退用户\r\n        sktMsgListener.add(SKT_MAG_TYPE.VACATETHEROOM, 'proxy', (data) => {\r\n            global.closeSubGame({ confirmContent: lang.write(k => k.UpdateModule.GameNotice, {}, { placeStr: \"对不起，系统维护中，请稍后再尝试登录\" }) })\r\n        }, 1)\r\n    }\r\n    public setGameInfo(init: boolean = false) {\r\n        const gameType = this.getTransferGameInfo().gameType();\r\n        const gameTypePre = init ? gameType : getBgProxy().getNextGame();\r\n        const gameTypeNew = gameType;\r\n        getBgProxy().setIsChangeNextGameType(gameTypePre, gameTypeNew)\r\n        this.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n        this.sendNotification(RollerMediatorConst.REMOVE_THECHEST_LAYER, { iconStay: this.getTransferGameInfo().getWildRollerId().wildRollerId.length > 0 || this.getTransferGameInfo().getWildRollerId().freeWildRollerId.length > 0 })\r\n\r\n        //更新数据\r\n        if (gameType !== 0) {\r\n            init && this.sendNotification(BgMediatorConst.TOGGLETHESTARTBUTTON, { state: true });\r\n            this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL, { frequency: this.getTransferGameInfo().getNumberOfRounds() })\r\n        }\r\n    }\r\n    public initGameData(data) {\r\n        this.repository.rollerLaunchResult.dl.si[0].freeCount = data.freeGameCount\r\n        Object.assign(this.repository.rollerLaunchResult.dl.si[0], data)\r\n        this.sendNotification(BgMediatorConst.UPDATE_USER_GOLD, { state: goldState.OLD_GOLD })\r\n        this.setGameInfo(true)\r\n    }\r\n}\r\n"]}