{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/utils/HotUpdate.ts"],"names":["HotOptions","Hot","game","loader","log","native","sys","GameConfig","UseSetOption","OnVersionInfo","OnNeedToUpdate","OnNoNeedToUpdate","OnUpdateFailed","OnUpdateSucceed","OnUpdateProgress","check","key","console","constructor","label","logLabel","_assetsMgr","_options","_state","State","None","checkUpdate","string","getState","AssetsManager","UNINITED","getLocalManifest","isLoaded","setEventCallback","_hotUpdateCallBack","bind","Check","hotUpdate","Update","update","event","code","getEventCode","EventAssetsManager","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","getTotalBytes","UPDATE_PROGRESSION","UPDATE_FINISHED","_onUpdateFinished","ASSET_UPDATED","_onUpdateFailed","searchPaths","fileUtils","getSearchPaths","newPaths","Array","prototype","unshift","localStorage","setItem","JSON","stringify","setSearchPaths","showSearchPath","i","length","init","manifest","opt","isNative","Instance","setGameOption","hotUpdateVersion","curVerStr","getItem","previousVersion","parseInt","HotUpdateVersion","removeDirectory","String","restart","url","nativeUrl","md5Pipe","transformURL","storagePath","getWritablePath","versionA","versionB","local","server","vA","split","vB","a","b","setVerifyCallback","assetsFullPath","asset","compressed","md5","path","size","os","OS","ANDROID","localManifest"],"mappings":"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","sourcesContent":["import { Asset, Label, game, loader, log, native, sys } from \"cc\";\r\nimport { GameConfig } from \"../config/GameConfig\";\r\nimport UseSetOption from \"./UseSetOption\";\r\n\r\nexport class HotOptions {\r\n    OnVersionInfo: Function;\r\n    OnNeedToUpdate: Function;\r\n    OnNoNeedToUpdate: Function;\r\n    OnUpdateFailed: Function;\r\n    OnUpdateSucceed: Function;\r\n    OnUpdateProgress: Function;\r\n\r\n    check() {\r\n        for (let key in this) {\r\n            if (key !== 'check') {\r\n                if (!this[key]) {\r\n                    console.log(`HotOptions.${key}！set`);\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true\r\n    }\r\n}\r\n\r\n// const native = window.jsb\r\n\r\nclass Hot {\r\n    constructor(label: Label) {\r\n        this.logLabel = label\r\n    }\r\n    private logLabel: Label\r\n    _assetsMgr: native.AssetsManager = null;\r\n    _options: HotOptions = null;\r\n    _state = Hot.State.None;\r\n\r\n    static State = {\r\n        None: 0,\r\n        Check: 1,\r\n        Update: 2,\r\n    }\r\n    checkUpdate() {\r\n        if (!this._assetsMgr) {\r\n            console.log('please initialize')\r\n            this.logLabel.string += \"未初始化AssetsManager=>\"\r\n            // log.string += 'please initialize'\r\n            return;\r\n        }\r\n        if (this._assetsMgr.getState() === native.AssetsManager.State.UNINITED) {\r\n            console.log('uninitialized')\r\n            this.logLabel.string += `状态错误：${this._assetsMgr.getState()}=>`\r\n            // log.string += 'uninitialized'\r\n            return;\r\n        }\r\n        if (!this._assetsMgr.getLocalManifest().isLoaded()) {\r\n            console.log('Load the local manifest lose ...');\r\n            this.logLabel.string += \"manifest未找到=>\"\r\n            // log.string += 'Load the local manifest lose ...'\r\n            return;\r\n        }\r\n        this._assetsMgr.setEventCallback(this._hotUpdateCallBack.bind(this));\r\n        this._state = Hot.State.Check;\r\n        this.logLabel.string += \"开始checkUpdate=>\"\r\n        this._assetsMgr.checkUpdate();\r\n\r\n    }\r\n\r\n    hotUpdate() {\r\n        if (!this._assetsMgr) {\r\n            console.log('Please initialize first')\r\n            return\r\n        }\r\n        this._assetsMgr.setEventCallback(this._hotUpdateCallBack.bind(this));\r\n        this._state = Hot.State.Update;\r\n        this._assetsMgr.update();\r\n    }\r\n\r\n    _hotUpdateCallBack(event: native.EventAssetsManager) {\r\n        let code = event.getEventCode();\r\n        log(`hotUpdate Code: ${code}`);\r\n        this.logLabel.string += `hotUpdate Code: ${code}`\r\n        switch (code) {\r\n            case native.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                console.log(\"It is the same as the remote version and does not need to be updated\");\r\n                this.logLabel.string += \"ALREADY_UP_TO_DATE=>\"\r\n                this._options.OnNoNeedToUpdate && this._options.OnNoNeedToUpdate(code)\r\n                break;\r\n            case native.EventAssetsManager.NEW_VERSION_FOUND:\r\n                console.log('New version found, please update');\r\n                this.logLabel.string += \"NEW_VERSION_FOUND=>\"\r\n                this._options.OnNeedToUpdate && this._options.OnNeedToUpdate(event.getTotalBytes());\r\n                break;\r\n            case native.EventAssetsManager.UPDATE_PROGRESSION:\r\n                this.logLabel.string += \"UPDATE_PROGRESSION=>\"\r\n                if (this._state === Hot.State.Update) {\r\n                    this._options.OnUpdateProgress && this._options.OnUpdateProgress(event);\r\n                } else {\r\n                    // 检查状态下，不回调更新进度\r\n                }\r\n                break;\r\n            case native.EventAssetsManager.UPDATE_FINISHED:\r\n                console.log('update successfully');\r\n                this.logLabel.string += \"UPDATE_FINISHED=>\"\r\n                this._onUpdateFinished();\r\n                break;\r\n            case native.EventAssetsManager.ASSET_UPDATED:\r\n                this.logLabel.string += \"ASSET_UPDATED=>\"\r\n                break;\r\n            default:\r\n                this.logLabel.string += \"失败=>\"\r\n                this._onUpdateFailed(code);\r\n                break;\r\n        }\r\n    }\r\n\r\n    _onUpdateFailed(code) {\r\n        this._assetsMgr.setEventCallback(null)\r\n        this._options.OnUpdateFailed && this._options.OnUpdateFailed(code);\r\n    }\r\n\r\n    _onUpdateFinished() {\r\n        this._assetsMgr.setEventCallback(null)\r\n        let searchPaths = native.fileUtils.getSearchPaths();\r\n        // this.log.string += \"=>searchPaths2:\" +searchPaths\r\n        let newPaths = this._assetsMgr.getLocalManifest().getSearchPaths();\r\n        // this.log.string += \"=>newPaths:\" + newPaths\r\n        Array.prototype.unshift(searchPaths, newPaths);\r\n        sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\r\n        native.fileUtils.setSearchPaths(searchPaths);\r\n        // this.log.string += \"=>setSearchPaths done\"\r\n        this._options.OnUpdateSucceed && this._options.OnUpdateSucceed();\r\n    }\r\n\r\n    showSearchPath() {\r\n        let searchPaths = native.fileUtils.getSearchPaths();\r\n        for (let i = 0; i < searchPaths.length; i++) {\r\n            log(\"[\" + i + \"]: \" + searchPaths[i]);\r\n        }\r\n    }\r\n\r\n    init(manifest: Asset, opt: HotOptions) {\r\n        // log.string += \"=>INIT开始\"\r\n        // log.string += \"=>fileUtils:\" + native.fileUtils.getSearchPaths()\r\n        // log.string += \"=>INIT失败？\"\r\n        if (!sys.isNative) {\r\n            UseSetOption.Instance().setGameOption(\"hall\", { hotUpdateVersion: \"vh5\" })\r\n            return;\r\n        }\r\n        if (!opt.check()) {\r\n            return;\r\n        }\r\n        this._options = opt;\r\n        if (this._assetsMgr) {\r\n            return;\r\n        }\r\n        let curVerStr = sys.localStorage.getItem('currentVersion');\r\n        if (curVerStr) {\r\n            const previousVersion = parseInt(curVerStr);\r\n            if (previousVersion < GameConfig.HotUpdateVersion) {\r\n                let newPaths = this._assetsMgr.getLocalManifest().getSearchPaths();\r\n                for (let i = 0; i < newPaths.length; ++i) {\r\n                    native.fileUtils.removeDirectory(newPaths[i]);\r\n                }\r\n                sys.localStorage.setItem('currentVersion', String(GameConfig.HotUpdateVersion));\r\n                game.restart();\r\n            }\r\n        } else {\r\n            sys.localStorage.setItem('currentVersion', String(GameConfig.HotUpdateVersion));\r\n        }\r\n\r\n\r\n        this.showSearchPath();\r\n        // log.string += \"showSearchPath--\"\r\n        let url = manifest.nativeUrl;\r\n        if (loader.md5Pipe) {\r\n            url = loader.md5Pipe.transformURL(url)\r\n        }\r\n        let storagePath = ((native.fileUtils ? native.fileUtils.getWritablePath() : '/') + 'remote-asset');\r\n        this._assetsMgr = new native.AssetsManager(url, storagePath, (versionA, versionB) => {\r\n            // const localVersion = sys.localStorage.getItem('currentVersion') || versionA\r\n            console.log(\"Client Version: \" + versionA + ', The Latest Version: ' + versionB);\r\n            UseSetOption.Instance().setGameOption(\"hall\", { hotUpdateVersion: versionA })\r\n            this.logLabel.string += `Client Version: ${versionA}, The Latest Version: ${versionB}`\r\n            // log.string += \"Client Version: \" + versionA + ', The Latest Version: ' + versionB\r\n\r\n            this._options.OnVersionInfo({ local: versionA, server: versionB });\r\n            let vA = versionA.split('.');\r\n            let vB = versionB.split('.');\r\n            for (let i = 0; i < vA.length; ++i) {\r\n                let a = parseInt(vA[i]);\r\n                let b = parseInt(vB[i] || '0');\r\n                if (a !== b) {\r\n                    return a - b;\r\n                }\r\n            }\r\n            if (vB.length > vA.length) {\r\n                return -1;\r\n            } else {\r\n                return 0;\r\n            }\r\n        });\r\n        this._assetsMgr.setVerifyCallback((assetsFullPath, asset) => {\r\n            let { compressed, md5, path, size } = asset;\r\n            if (compressed) {\r\n                return true;\r\n            } else {\r\n                return true;\r\n            }\r\n        })\r\n        if (sys.os === sys.OS.ANDROID) {\r\n\r\n        }\r\n        let localManifest = this._assetsMgr.getLocalManifest()\r\n\r\n        // log.string += \"showSearchPath--\"\r\n        // log.string += ('=》[HotUpdate] 热更新资源存放路径: ' + storagePath);\r\n        // log.string += ('=》[HotUpdate] 本地manifest路径: ' + url);\r\n        // log.string += ('=》[HotUpdate] local packageUrl: ' + localManifest.getPackageUrl());\r\n        // log.string += ('=》[HotUpdate] project.manifest remote url: ' + localManifest.getManifestFileUrl());\r\n        // log.string += ('=》[HotUpdate] version.manifest remote url: ' + localManifest.getVersionFileUrl());\r\n    }\r\n}\r\n\r\n\r\n\r\nexport default Hot;\r\n\r\n// let hotInstance = new Hot();\r\n// export default hotInstance;\r\n"]}