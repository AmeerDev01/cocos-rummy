{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/fruit777/components/Fruit777_Roller.old2.ts"],"names":["_decorator","Mask","Node","tween","UITransform","Vec3","Widget","BaseComponent","DirectionType","IconEffectType","RollerIconViewModel","fruit777_Audio","sourceManageSeletor","PrefabPathDefine","config","endRollingAction","setRollSpeed","SoundPathDefine","ccclass","property","Fruit777_Roller","displayIconList","nextJoinIconIndex","lastRemoveIconIndex","compensation","lastInsertIconViewModel","timer_clear","lastLineY","speed","rollerHeight","rollConfig","normalRollOption","outIconPool","propertyNode","props_roller","props_daqipao","props","rollerType","iconEffectData","iconEffect","NONE","iconEffectArr","isSpeedUp","stopMode","isSortStop","events","rollStart","rollEnd","rollerIndex","start","schedule","move","initState","roundEnd","bindEvent","useProps","key","value","pre","direction","DOWN","cur","iconQueue","length","initRoller","stopIconIndex","bringForwardEnd","dispatch","rolling","comp","node","position","y","UP","getRollerHeight","creator","setState","speedUp","index","unschedule","filter","i","isUnMount","l","item","indexOf","setProps","iconViewModel","joinIcon","insideCount","children","active","getPosition","iconData","itemHeight","getComponent","height","intervalHeight","setPosition","x","LargeRoller","largeRollOption","width","left","intervalWidth","right","stopSpeed","console","log","mountView","getFile","ICON","source","shift","viewNode","appendTo","push","e","cache","bindUI","useState","enabled","window","setInterval","iconMv","undefined","parent","forEach","_node","z","queueIndex","removeFromParent","scheduleOnce","singleRollerHeight","singleIntervalHeight","playOneShot","DING","to","easing","call","state","unMount","then","update","deltaTime","getRoundEnd","onDestroy","clearInterval"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Mask, Node, tween, UITransform, Vec3, Widget } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { RollerType, IconType, DirectionType, IconEffectType, RollOptionType } from '../type';\r\nimport RollerIconViewModel from '../viewModel/RollerIconViewModel';\r\nimport { fruit777_Audio, sourceManageSeletor } from '../index';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport config from '../config';\r\nimport { endRollingAction, setRollSpeed } from '../store/actions/roller';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\t/**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\troundEnd: boolean,\r\n}\r\n\r\nexport interface IProps {\r\n\trollerType?: RollerType,\r\n\ticonEffectData?: {\r\n\t\ticonEffect: IconEffectType,\r\n\t\ticonEffectArr?: number[]\r\n\t},\r\n\tisSpeedUp?: boolean,\r\n\tstopMode: 'index' | 'jump'\r\n\tisSortStop: boolean\r\n}\r\nexport interface IEvent {\r\n\trollStart?: () => void,\r\n\trollEnd?: (rollerIndex: number) => void\r\n}\r\n\r\n@ccclass('Fruit777_Roller')\r\nexport class Fruit777_Roller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\t\tthis.schedule(this.move, 0.01)\r\n\t}\r\n\t/**展示中的图标列表 */\r\n\tpublic displayIconList: RollerIconViewModel[] = []\r\n\r\n\t/**下一个将要加入的icon */\r\n\tprivate nextJoinIconIndex: number = 0\r\n\t/**刚刚卸载掉的图标 */\r\n\tprivate lastRemoveIconIndex: number = 0\r\n\t/**删补图标时候的纵向补偿值 */\r\n\tprivate compensation: number = 0\r\n\tprivate lastInsertIconViewModel: RollerIconViewModel\r\n\tprivate timer_clear: number\r\n\tprivate lastLineY: number = 0\r\n\t// private coordList: Array<number> = []\r\n\t/**主要用于启动的速度变化 */\r\n\tprivate speed: number = 0\r\n\tprivate rollerHeight: number\r\n\tprivate rollConfig: RollOptionType = config.normalRollOption\r\n\t// /**本轮转动是否结束，不能使用rolling，因为rolling = false之后 ，才开始刹车停止，roundEnd是刹车完之后 */\r\n\t// public roundEnd: boolean = true\r\n\tprivate outIconPool: Array<RollerIconViewModel> = []\r\n\tprotected propertyNode = {\r\n\t\tprops_roller: new Node(),\r\n\t\tprops_daqipao: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\trollerType: null,\r\n\t\ticonEffectData: {\r\n\t\t\ticonEffect: IconEffectType.NONE,\r\n\t\t\ticonEffectArr: []\r\n\t\t},\r\n\t\tisSpeedUp: false,\r\n\t\tstopMode: 'jump',\r\n\t\tisSortStop: false\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\trollStart: () => { },\r\n\t\trollEnd: (rollerIndex: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\troundEnd: true\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"rollerType\") {\r\n\t\t\tif (!value.pre) {\r\n\t\t\t\tthis.nextJoinIconIndex = this.props.rollerType.direction === DirectionType.DOWN ? (value.cur.iconQueue as IconType[]).length - 1 : 0\r\n\t\t\t\tthis.initRoller()\r\n\t\t\t} else {\r\n\t\t\t\t/**\r\n\t\t\t\t * 2024-1-4 02:30记录（地点：菲律宾）\r\n\t\t\t\t * 尼玛。这个问题找了2个小时，下面这个if一定要在rolling（this.events.rollStart()）判断之前处理，不然在某种特殊情况下，比如上一次最后加入的图标index此时等于将要停止的图标index，\r\n\t\t\t\t * 将没有机会joinIcon，直接停止。因为调整nextJoinIconIndex的操作还没有被执行。\r\n\t\t\t\t */\r\n\t\t\t\tif (value.pre.stopIconIndex !== value.cur.stopIconIndex) {\r\n\t\t\t\t\tif (this.props.stopMode === \"jump\") {\r\n\t\t\t\t\t\t// 放弃这种模式(控制跳跃的距离来实现步停)\r\n\t\t\t\t\t\t// this.bringForwardEnd(this.props.rollerType, this.props.isSortStop ? 4 + this.props.rollerType.index * 8 : 4)\r\n\t\t\t\t\t\tthis.bringForwardEnd(this.props.rollerType, 5)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dispatch(setRollSpeed(this.props.isSpeedUp ? 1.5 : 1))\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (value.pre.rolling === false && value.cur.rolling === true) {\r\n\t\t\t\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\t\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ roundEnd: false })\r\n\t\t\t\t\t// this.roundEnd = false\r\n\t\t\t\t\tthis.events.rollStart()\r\n\t\t\t\t\tconst speedUp = (index) => {\r\n\t\t\t\t\t\t// console.log(index)\r\n\t\t\t\t\t\tif (this.speed < this.props.rollerType.speed) {\r\n\t\t\t\t\t\t\tthis.speed += this.props.rollerType.speed / 20;\r\n\t\t\t\t\t\t\t(this.speed > this.props.rollerType.speed) && (this.speed === this.props.rollerType.speed)\r\n\t\t\t\t\t\t} else if (this.speed === this.props.rollerType.speed) {\r\n\t\t\t\t\t\t\tthis.unschedule(speedUp)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.schedule(speedUp, 0.02)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"iconEffectData\") {\r\n\t\t\t// console.log(this.props.rollerType.index, value.cur)\r\n\t\t\t// console.log(this.props.rollerType.index, this.props.iconEffectData, this.displayIconList)\r\n\t\t\t//displayIconList可能还没有清除掉节点已经被释放的对象\r\n\t\t\tthis.speed = 0\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(i => !i.isUnMount)\r\n\t\t\tfor (let i = 0, l = this.displayIconList.length; i < l; i++) {\r\n\t\t\t\t// const index = this.props.rollerType.direction === DirectionType.DOWN ? i : (this.displayIconList.length - 1 - i)\r\n\t\t\t\t/**index是图标从下往上的序列号 */\r\n\t\t\t\tconst index = i\r\n\t\t\t\tconst item = this.displayIconList[index]\r\n\t\t\t\tif (this.props.iconEffectData.iconEffectArr.indexOf(index) !== -1) {\r\n\t\t\t\t\titem.setProps({ iconEffect: this.props.iconEffectData.iconEffect })\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.setProps({ iconEffect: IconEffectType.NONE })\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**主要用于初始化的时候 */\r\n\tprivate creator() {\r\n\t\tconst iconViewModel = this.joinIcon()\r\n\t\tconst insideCount = this.propertyNode.props_roller.children.filter(i => i.active).length - 1\r\n\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -this.getRollerHeight() + (itemHeight / 2) + (insideCount * itemHeight), 1))\r\n\t\t} else {\r\n\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, -(insideCount * itemHeight) - (itemHeight / 2), 1))\r\n\t\t}\r\n\t\t// this.coordList.push(iconViewModel.comp.node.position.y)\r\n\r\n\t\treturn iconViewModel\r\n\t}\r\n\r\n\t/**初始化 */\r\n\tprivate initRoller() {\r\n\t\t//取队列最后n个图标\r\n\t\t// const iconQueue = [...this.props.iconQueue]\r\n\t\t// const iconQueue = clone(this.props.iconQueue)\r\n\t\tthis.rollConfig = this.props.rollerType.LargeRoller ? config.largeRollOption : config.normalRollOption\r\n\t\tthis.propertyNode.props_roller.getComponent(UITransform).width = this.props.rollerType.width\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).left = this.props.rollerType.intervalWidth\r\n\t\tthis.propertyNode.props_roller.getComponent(Widget).right = this.props.rollerType.intervalWidth\r\n\t\tthis.node.getComponent(UITransform).width = this.props.rollerType.width + this.props.rollerType.intervalWidth * 2\r\n\t\tthis.propertyNode.props_daqipao.active = this.props.rollerType.LargeRoller\r\n\r\n\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\twhile ((this.props.rollerType.direction === DirectionType.DOWN && this.lastInsertIconViewModel.comp.node.position.y < 0) ||\r\n\t\t\t(this.props.rollerType.direction === DirectionType.UP && this.lastInsertIconViewModel.comp.node.position.y > -this.getRollerHeight())) {\r\n\t\t\tthis.lastInsertIconViewModel = this.creator()\r\n\t\t}\r\n\t}\r\n\t/**提前结束,这个停止方式，应该只支持indexTrgger这种触发方案 */\r\n\tprivate bringForwardEnd(rollerType: RollerType, stopSpeed: number = 4) {\r\n\t\tif (rollerType.stopIconIndex + stopSpeed >= this.props.rollerType.iconQueue.length) {\r\n\t\t\t// this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - rollerType.stopIconIndex\r\n\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed - this.props.rollerType.iconQueue.length\r\n\t\t} else {\r\n\t\t\tthis.nextJoinIconIndex = rollerType.stopIconIndex + stopSpeed\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 添加图标\r\n\t * @returns \r\n\t */\r\n\tprivate joinIcon() {\r\n\t\ttry {\r\n\t\t\t//下一个要加入的图标\r\n\t\t\t// this.nextJoinIconIndex < 0 && (this.nextJoinIconIndex = 0)\r\n\t\t\t// this.nextJoinIconIndex >= this.props.rollerType.iconQueue.length && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t\tconst iconData = this.props.rollerType.iconQueue[this.nextJoinIconIndex]\r\n\t\t\tif (!iconData) {\r\n\t\t\t\tconsole.log(this.nextJoinIconIndex, this.props.rollerType.iconQueue)\r\n\t\t\t}\r\n\t\t\tlet iconViewModel: RollerIconViewModel\r\n\t\t\tif (this.outIconPool.length === 0) {\r\n\t\t\t\ticonViewModel = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source)\r\n\t\t\t} else {\r\n\t\t\t\ticonViewModel = this.outIconPool.shift()\r\n\t\t\t\ticonViewModel.viewNode.setPosition(new Vec3(0, 0, 1))\r\n\t\t\t}\r\n\t\t\ticonViewModel.appendTo(this.propertyNode.props_roller).setProps({ iconData, iconEffect: IconEffectType.NONE })\r\n\r\n\t\t\t// const iconViewModel = new RollerIconViewModel().mountView(sourceManageSeletor().getFile(PrefabPathDefine.ICON).source).appendTo(this.propertyNode.props_roller).setProps({ iconData })\r\n\t\t\tconst position = iconViewModel.comp.node.getPosition()\r\n\t\t\t//icon的高度加上上下纵向高度\r\n\t\t\tconst itemHeight = iconViewModel.comp.node.getComponent(UITransform).height + iconData.intervalHeight * 2\r\n\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY + itemHeight - this.props.rollerType.speed, 1))\r\n\t\t\t\tthis.nextJoinIconIndex--\r\n\t\t\t\tthis.nextJoinIconIndex === -1 && (this.nextJoinIconIndex = this.props.rollerType.iconQueue.length - 1)\r\n\t\t\t\tthis.compensation = iconViewModel.comp.node.position.y\r\n\t\t\t} else {\r\n\t\t\t\ticonViewModel.comp.node.setPosition(new Vec3(position.x, this.lastLineY - itemHeight + this.props.rollerType.speed, 1))\r\n\t\t\t\tthis.nextJoinIconIndex++\r\n\t\t\t\tthis.nextJoinIconIndex === this.props.rollerType.iconQueue.length - 1 && (this.nextJoinIconIndex = 0)\r\n\t\t\t}\r\n\t\t\tthis.displayIconList.push(iconViewModel)\r\n\t\t\t// console.log(this.displayIconList.map(i => i.id))\r\n\t\t\treturn iconViewModel\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log(this.nextJoinIconIndex, this.props.rollerType.iconQueue)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 滑槽高度，考虑滑槽的高度可能动态，这里动态获取，当然，也可以设置cache=true，获取上一次动态取的高度\r\n\t * @param cache 是否取上一次动态取的高度\r\n\t * @returns \r\n\t */\r\n\tprivate getRollerHeight(cache: boolean = false) {\r\n\t\tif (!cache) {\r\n\t\t\tthis.rollerHeight = this.propertyNode.props_roller.getComponent(UITransform).height\r\n\t\t}\r\n\t\treturn this.rollerHeight\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\tthis.rollerHeight = this.getRollerHeight()\r\n\t\tthis.useState((key, value) => {\r\n\t\t\tthis.node.getComponent(Mask).enabled = !value.cur\r\n\r\n\t\t}, [\"roundEnd\"])\r\n\t\t!this.timer_clear && (this.timer_clear = window.setInterval(() => {\r\n\t\t\tthis.displayIconList = this.displayIconList.filter(iconMv => {\r\n\t\t\t\tif (iconMv.isUnMount) {\r\n\t\t\t\t\ticonMv = undefined\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\treturn true\r\n\t\t\t})\r\n\t\t}, 200))\r\n\t}\r\n\r\n\tprivate move() {\r\n\t\tif (this.props.rollerType.rolling) {\r\n\t\t\t// this.displayIconList.length > 10 && console.log(this.displayIconList.length)\r\n\t\t\tif (this.props.rollerType.index === 0 && this.displayIconList.filter(i => i.viewNode.parent).length === 3) {\r\n\t\t\t\tdebugger\r\n\t\t\t}\r\n\t\t\tthis.displayIconList.filter(item => item.comp.node && item.comp.node.active).forEach((iconMv, i) => {\r\n\t\t\t\tconst _node = iconMv.comp.node\r\n\t\t\t\tconst { x, y, z } = _node.getPosition()\r\n\t\t\t\tif (this.props.rollerType.direction === DirectionType.DOWN) {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y - this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\r\n\t\t\t\t\t\ticonMv.viewNode.removeFromParent()\r\n\t\t\t\t\t\tthis.outIconPool.push(iconMv)\r\n\t\t\t\t\t\tthis.displayIconList = this.displayIconList.filter(i => i.viewNode.parent)\r\n\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t}, 0.01)\r\n\r\n\t\t\t\t\t\t// iconMv.unMount().then(() => {\r\n\t\t\t\t\t\t// \tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// \t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// })\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t// console.log(this.props.rollerType.index, 'delete icon')\r\n\t\t\t\t\t\tfruit777_Audio.playOneShot(SoundPathDefine.DING)\r\n\t\t\t\t\t\tconsole.log(iconMv.comp.props.iconData.queueIndex, i, -this.getRollerHeight(true) + (i - 0.5) * itemHeight)\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -this.getRollerHeight(true) + (i - 0.5) * itemHeight, z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y <= -(this.getRollerHeight(true) + _node.getComponent(UITransform).height / 2)) {\r\n\t\t\t\t\t\t\t\t// 超出的要删除\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\ticonMv.viewNode.removeFromParent()\r\n\t\t\t\t\t\t\t\tthis.outIconPool.push(iconMv)\r\n\t\t\t\t\t\t\t\tthis.displayIconList = this.displayIconList.filter(i => i.viewNode.parent)\r\n\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd && this.displayIconList.length - 1 === i) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.scheduleOnce(() => {\r\n\r\n\r\n\t\t\t\t\t\t\t\t}, 0.03)\r\n\t\t\t\t\t\t\t\t// iconMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t// \t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t// \tif (!this.state.roundEnd && this.displayIconList.length - 1 === i) {\r\n\t\t\t\t\t\t\t\t// \t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t// \t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t// \t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t// \t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_node.setPosition(new Vec3(x, y + this.props.rollerType.speed, z))\r\n\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\tif (this.props.rollerType.stopIconIndex !== this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t\t\tthis.lastInsertIconViewModel = this.joinIcon()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.props.rollerType.stopIconIndex === this.lastInsertIconViewModel.comp.props.iconData.queueIndex) {\r\n\t\t\t\t\t\t// this.props.rollerType.rolling = false\r\n\t\t\t\t\t\tthis.dispatch(endRollingAction(this.props.rollerType.index, false))\r\n\t\t\t\t\t\tconst itemHeight = this.rollConfig.singleRollerHeight + (this.rollConfig.singleIntervalHeight * 2)\r\n\t\t\t\t\t\t//恢复到默认位置并对齐，第一个元素是最上面那个\r\n\t\t\t\t\t\ttween(iconMv.comp.node).to(this.rollConfig.stopSpeed, { position: new Vec3(x, -itemHeight * (i - 0.5), z) }, { easing: \"backOut\" }).call(() => {\r\n\t\t\t\t\t\t\tif (_node.getPosition().y >= _node.getComponent(UITransform).height / 2) {\r\n\t\t\t\t\t\t\t\tthis.lastLineY = this.propertyNode.props_roller.children[this.propertyNode.props_roller.children.length - 1].position.y\r\n\t\t\t\t\t\t\t\tthis.lastRemoveIconIndex = iconMv.comp.props.iconData.queueIndex\r\n\t\t\t\t\t\t\t\ticonMv.unMount().then(() => {\r\n\t\t\t\t\t\t\t\t\t// this.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t//这里有一定可能存在多个溢出滑道的图标，所以可能执行2次甚至2次以上\r\n\t\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\t\t// this.dispatch(setRoundEnd(true))\r\n\t\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\t\t// this.roundEnd = true\r\n\t\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (!this.state.roundEnd) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({ roundEnd: true })\r\n\t\t\t\t\t\t\t\t\tthis.events.rollEnd(this.props.rollerType.index)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).start()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n\tpublic getRoundEnd() {\r\n\t\treturn this.state.roundEnd\r\n\t}\r\n\tonDestroy() {\r\n\t\twindow.clearInterval(this.timer_clear)\r\n\t}\r\n}\r\n"]}