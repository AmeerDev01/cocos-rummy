{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/phoenix/Slot/Component/phoenix_RollerPanel.ts"],"names":["_decorator","instantiate","Layout","Prefab","tween","UIOpacity","Vec3","phoenix_BaseComponent","AudioManager","SoundList","getSpeedTime","ccclass","property","phoenix_RollerPanel","rollerList","isSpeed","startAllRoll","stopIndexArr","getInstance","playSound","rollerFast","forEach","roller","i","getComponent","startRoll","togglesALLLayer","state","togglesThePopUpLayerState","stopAllRoll","isManualStop","callBack","stopRoll","time","isEnd","length","rollerComp","rollerIndex","rollerData","node","isValid","scheduleOnce","playTheIngotsIconAnimation","yuanBaoPosition","item","columnIndex","console","log","playYuanbao","iconFlicker","mode","targetArr","allstate","cb","setIconEffect","setTimeout","clearStatus","iconDock","removeAllDockIcon","addDockIcon","uninstall","done","ui","parent","target","to","opacity","call","destroy","start","update","deltaTime","bindUI","getRollProxy","getRepository","layout","index","rollerNode","bindRollerData","setPosition","position","y","root","addChild","push","getParent","setScale","setSiblingIndex","bindEvent"],"mappings":"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","sourcesContent":["import {_decorator, instantiate, Layout, Node, Prefab, tween, UIOpacity, Vec3} from 'cc';\r\nimport phoenix_BaseComponent from './phoenix_BaseComponent';\r\nimport {phoenix_Roller} from './phoenix_Roller';\r\nimport {RollerType} from '../Repositories/SlotRepository';\r\nimport {AudioManager, SoundList} from \"../Managr/AudioManager\";\r\nimport { StopMode } from '../Repositories/BgRepository';\r\nimport { getSpeedTime } from '../../../../utils/SlotSpeedConfig';\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\n@ccclass('phoenix_RollerPanel')\r\nexport class phoenix_RollerPanel extends phoenix_BaseComponent {\r\n    @property(Prefab)\r\n    roller: Prefab = null\r\n\r\n    public rollerList: Array<Node> = []\r\n    private isSpeed;\r\n\r\n    /**所有的滑槽都开始转动，传入停止信号发出后要停止的序列号(从1开始) */\r\n    public startAllRoll(stopIndexArr: number[], isSpeed: boolean) {\r\n        this.isSpeed = isSpeed;\r\n        AudioManager.getInstance().playSound(SoundList.rollerFast);\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).startRoll(stopIndexArr[i], isSpeed)\r\n        })\r\n    }\r\n\r\n    public togglesALLLayer(state: boolean) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).togglesThePopUpLayerState(state)\r\n        })\r\n    }\r\n\r\n    /**发出停止的信号（启动的时候已经传入了停止位置，不是马上停止，转到位置才停，这里需要传入闪动的图标队列） */\r\n    public stopAllRoll(isManualStop: boolean, callBack: () => void) {\r\n\t\tif(isManualStop){\r\n\t\t\tthis.isSpeed = true;\r\n\t\t}\r\n        this.stopRoll(0, callBack);\r\n    }\r\n\r\n    private stopRoll(i: number, callBack: () => void){\r\n\t\t// 这里调停止滚动的速度\r\n\t\tconst time = getSpeedTime(this.isSpeed)\r\n        const isEnd = i >= this.rollerList.length - 1;\r\n        const rollerComp = this.rollerList[i].getComponent(\"phoenix_Roller\") as phoenix_Roller;\r\n        rollerComp.stopRoll((rollerIndex: number, rollerData: RollerType) => {\r\n            if(this.node.isValid){\r\n                if(isEnd){\r\n                    callBack();\r\n                }\r\n            }\r\n        })\r\n        this.scheduleOnce(()=>{\r\n            if(this.node.isValid){\r\n                if(!isEnd){\r\n                    this.stopRoll(i+1, callBack)\r\n                }\r\n            }\r\n        }, time)\r\n    }\r\n\r\n    /**播放元宝图标动画 */\r\n    playTheIngotsIconAnimation(yuanBaoPosition:any){\r\n        yuanBaoPosition.forEach(item=>{\r\n            const columnIndex = item[0];\r\n            console.log(\"playTheIngotsIconAnimation == \", columnIndex);\r\n            if(columnIndex !== 0 && columnIndex !== 4) return;\r\n            (<phoenix_Roller>this.rollerList[columnIndex].getComponent(\"phoenix_Roller\")).playYuanbao(item[1])\r\n        })\r\n    }\r\n    /**图标闪动 */\r\n    public iconFlicker(mode: 'index' | 'coord', targetArr: number[][], allstate: boolean = false, cb?) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).setIconEffect(mode, [],true)\r\n            if (targetArr[i].length && allstate) {\r\n                (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).setIconEffect(mode, targetArr[i]);\r\n                setTimeout(() => {\r\n                    this.clearStatus()\r\n                    cb()\r\n                }, 1000)\r\n            } else if (targetArr[i].length) {\r\n                (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).setIconEffect(mode, targetArr[i], true);\r\n            }\r\n        })\r\n    }\r\n\r\n    public clearStatus() {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).setIconEffect('coord', [], true)\r\n        })\r\n    }\r\n\r\n    /**图标定住 */\r\n    public iconDock(mode: 'index' | 'coord', targetArr: number[][][]) {\r\n        this.rollerList.forEach((roller, i) => {\r\n            (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).removeAllDockIcon()\r\n            targetArr[i][1].length && (<phoenix_Roller>roller.getComponent(\"phoenix_Roller\")).addDockIcon(targetArr[i][1])\r\n        })\r\n    }\r\n\r\n    /**卸载面板(淡出) */\r\n    public uninstall(done?: () => void) {\r\n        const ui = this.node.parent.getComponent(UIOpacity)\r\n        tween().target(ui).to(0.5, {opacity: 0}).call(() => {\r\n            // this.node.parent.removeAllChildren()\r\n            this.node.parent.destroy()\r\n            done && done()\r\n        }).start()\r\n\r\n        // tween().target(icon).to(0.5, {\r\n        // \tposition: new Vec3(icon.position.x, icon.position.y + deviation - (this.rollerData.rollerheight + this.rollerData.intervalHeight))\r\n        // }, {\r\n        // \teasing: \"backOut\"//\"elasticOut\"\r\n        // }).call(() => {\r\n        // \tcount++\r\n        // \tif (count === this.RollerLayOut.children.length) {\r\n        // \t\tthis.stopCallBack()\r\n        // \t}\r\n        // }).start()\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    protected bindUI(): void {\r\n        const rollerData = this.getRollProxy().getRepository()\r\n        const layout = this.node.getComponent(Layout)\r\n        // layout.spacingX = 35\r\n\r\n        rollerData.rollerList.forEach((roller, index) => {\r\n            const rollerNode = instantiate(this.roller);\r\n            (rollerNode.getComponent(\"phoenix_Roller\") as phoenix_Roller).bindRollerData(index, roller)\r\n            rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n            this.root.addChild(rollerNode)\r\n            this.rollerList.push(rollerNode)\r\n        })\r\n\r\n\r\n        // const rollerNode = instantiate(this.roller);\r\n        // (rollerNode.getComponent(\"Roller\") as Roller).bindRollerData(0, rollerData.rollerList.data[0])\r\n        // rollerNode.setPosition(new Vec3(0, rollerNode.position.y))\r\n        // this.root.addChild(rollerNode)\r\n        // this.rollerList.push(rollerNode)\r\n\r\n        this.node.getParent().setScale(0.95, 0.95)\r\n        this.node.getParent().setSiblingIndex(100)\r\n\r\n        const ui = this.node.parent.getComponent(UIOpacity)\r\n        ui.opacity = 0;\r\n        tween().target(ui).to(0.5, {opacity: 255}).call(() => {\r\n        }).start()\r\n    }\r\n\r\n    protected bindEvent(): void {\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}