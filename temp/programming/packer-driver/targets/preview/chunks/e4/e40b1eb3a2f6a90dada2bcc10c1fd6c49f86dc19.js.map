{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dragonV2/components/DragonV2_SingleIconRoller.ts"],"names":["_decorator","Node","Vec3","BaseComponent","config","GameType","getColumnLockIconArr","IconId","cacheData","ccclass","property","DragonV2_SingleIconRoller","lastIndex","showIconCount","stopIconIndex","columnIndex","slotIndex","iconPool","iconRollerQueue","iconArr","intervalHeight","normalRollOption","rollOverCallback","props_column_effect_node","iconAnimationNode","isRoll","rollCount","rollerSpeed","subGameRollOption","propertyNode","props_icon_list","props","gameTypeInfo","lastGameType","NONE","viewGameType","currGameType","leftCount","events","start","initState","setColumnEffectNode","getChildByName","initSlot","addIconIndex","initColumn","getSlotIndex","iconCount","i","joinIcon","length","iconId","iconConfig","icon","find","v","id","getIcon","position","amountNode","active","changeIcon","lastNode","y","getPosition","getHeight","getNode","setPosition","push","setBeetleAmount","getId","BEETLE","SUBGAME2","diff","calIndexDiff","lockIconDatas","fixedChessboardIcon","lockIconData","index","setAmount","amount","index1","index2","bindEvent","useProps","key","value","hideIconWin","stopWinIcon","children","forEach","name","destroy","removeAllChildren","startRoll","stopRoll","addLastJoinIconIndex","console","log","stopIndex","newValue","getStopIconIndex","bindUI","getRollSpeed","hideWin","playWinIcon","WILD","playWin","rollOverHandle","endIcon","scheduleOnce","node","isValid","getIconPosByIndex","height","singleRollerHeight","interval","getFirstIcon","shift","rollerIcon","speed","x","frist","hideY","restore","getIconIndex","onDestroy","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Mask, Node, sp, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport { IconPool } from '../IconPool';\r\nimport config from '../config';\r\nimport { DragonV2Icon } from './DragonV2Icon';\r\nimport { GameType, GameTypeInfo, getColumnLockIconArr, IconId, LockIcon, RollerInfo, RollerStatus } from '../type';\r\nimport { sourceManageSeletor } from '../index';\r\nimport { SkeletalPathDefine } from '../sourceDefine/skeletalDefine';\r\nimport { PrefabPathDefine } from '../sourceDefine/prefabDefine';\r\nimport { cacheData } from '../dataTransfer';\r\nimport { getNodeByNameDeep } from '../../../utils/tool';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tgameTypeInfo: GameTypeInfo,\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('DragonV2_SingleIconRoller')\r\nexport class DragonV2_SingleIconRoller extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() {\r\n\r\n\t}\r\n\r\n\t/**当前最后添加的图标索引位置 */\r\n\tprivate lastIndex = 0;\r\n\t/**显示图标数量 */\r\n\tprivate showIconCount = 1;\r\n\t/**停止图标索引 */\r\n\tprivate stopIconIndex = -1;\r\n\t/**列的索引 */\r\n\tprivate columnIndex = 0;\r\n\t/**插槽索引 */\r\n\tprivate slotIndex = 0;\r\n\t/**图标池 */\r\n\tprivate iconPool: IconPool;\r\n\t/**图标轮播队列 */\r\n\tprivate iconRollerQueue: any[]\r\n\t/**滚轴上的图标，包含看不见的 */\r\n\tprivate iconArr: DragonV2Icon[] = [];\r\n\t/**图标间隔 */\r\n\tprivate intervalHeight = config.normalRollOption.intervalHeight;\r\n\r\n\t/**滚动结束回调方法 */\r\n\tprivate rollOverCallback;\r\n\t/**列特效层 */\r\n\tprivate props_column_effect_node: Node;\r\n\t/**图标动画层节点 */\r\n\tprivate iconAnimationNode: Node;\r\n\r\n\tprivate isRoll = false;\r\n\tprivate rollCount = 0;\r\n\tprivate rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_icon_list: new Node(),\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tgameTypeInfo: {\r\n\t\t\tlastGameType: GameType.NONE,\r\n\t\t\tviewGameType: GameType.NONE,\r\n\t\t\tcurrGameType: GameType.NONE,\r\n\t\t\tleftCount: 0,\r\n\t\t},\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tpublic setColumnEffectNode(props_column_effect_node: Node) {\r\n\t\tthis.props_column_effect_node = props_column_effect_node;\r\n\t\tthis.iconAnimationNode = this.props_column_effect_node.getChildByName(\"props_icon_animation\")\r\n\t}\r\n\r\n\tpublic initSlot(columnIndex: number, slotIndex: number, lastIndex: number, iconPool: IconPool) {\r\n\t\tthis.columnIndex = columnIndex;\r\n\t\tthis.iconRollerQueue = config.iconRollerQueue[this.columnIndex]\r\n\t\tthis.slotIndex = slotIndex;\r\n\t\tthis.lastIndex = this.addIconIndex(lastIndex, 1);\r\n\t\tthis.iconPool = iconPool;\r\n\r\n\t\tthis.initColumn(this.showIconCount + 1);\r\n\t}\r\n\r\n\tpublic getSlotIndex() {\r\n\t\treturn this.slotIndex;\r\n\t}\r\n\r\n\tprivate initColumn(iconCount: number) {\r\n\t\tfor (let i = 0; i < iconCount; i++) {\r\n\t\t\tthis.joinIcon();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate joinIcon() {\r\n\t\tconst length = this.iconArr.length\r\n\t\tthis.lastIndex = this.lastIndex - 1 < 0 ? this.iconRollerQueue.length - 1 : --this.lastIndex;\r\n\t\tconst iconId = this.iconRollerQueue[this.lastIndex];\r\n\t\tconst iconConfig = config.icon.find(v => v.id === iconId);\r\n\r\n\t\tconst icon = this.iconPool.getIcon(iconConfig, this.propertyNode.props_icon_list, this.lastIndex);\r\n\t\tconst position = new Vec3(0, 0);\r\n\t\tif (iconConfig.id === 12) {\r\n\t\t\ticon.amountNode.active = true;\r\n\t\t\ticon.changeIcon(true)\r\n\t\t}\r\n\t\tif (length > 0) {\r\n\t\t\tconst lastNode = this.iconArr[length - 1];\r\n\t\t\tposition.y = lastNode.getPosition().y + lastNode.getHeight() + this.intervalHeight;\r\n\t\t}\r\n\t\ticon.getNode().setPosition(position);\r\n\t\tthis.iconArr.push(icon);\r\n\t\tthis.setBeetleAmount(icon);\r\n\t}\r\n\r\n\t/**\r\n\t * 设置甲壳虫上面的数字\r\n\t */\r\n\tprivate setBeetleAmount(icon: DragonV2Icon) {\r\n\t\tif (icon.getId() !== IconId.BEETLE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.props.gameTypeInfo.currGameType !== GameType.SUBGAME2 && this.props.gameTypeInfo.viewGameType === GameType.SUBGAME2) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst diff = this.calIndexDiff(this.lastIndex, this.stopIconIndex);\r\n\t\tif (diff > 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst lockIconDatas = getColumnLockIconArr(cacheData.fixedChessboardIcon, this.columnIndex)\r\n\t\tif (lockIconDatas.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst lockIconData = lockIconDatas.find(v => v.index === this.slotIndex)\r\n\t\tif (lockIconData) {\r\n\t\t\ticon.setAmount(lockIconData.amount)\r\n\t\t}\r\n\t}\r\n\r\n\t/**计算两个索引的差值 */\r\n\tprivate calIndexDiff(index1: number, index2: number) {\r\n\t\tlet diff = index1 - index2;\r\n\t\tif (index1 < index2) {\r\n\t\t\tdiff = index1 + this.iconRollerQueue.length - index2\r\n\t\t}\r\n\t\treturn diff;\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t}\r\n\r\n\t/**隐藏图标中奖效果 */\r\n\tprivate hideIconWin() {\r\n\t\tthis.stopWinIcon();\r\n\t\tthis.iconAnimationNode.children.forEach(v => {\r\n\t\t\tv.name === 'bigNode' && v.destroy();\r\n\t\t})\r\n\t\tthis.iconAnimationNode.removeAllChildren();\r\n\t}\r\n\r\n\tpublic startRoll() {\r\n\t\tthis.isRoll = true;\r\n\t\tthis.rollCount = 0;\r\n\t\tthis.rollerSpeed = config.subGameRollOption.rollerSpeed;\r\n\t}\r\n\r\n\tpublic stopRoll(stopIconIndex: number, rollOverCallback: Function) {\r\n\t\tthis.stopIconIndex = stopIconIndex;\r\n\t\tthis.rollOverCallback = rollOverCallback;\r\n\r\n\t\tconst diff = this.slotIndex === 2 ? 0 : this.slotIndex === 0 ? 2 : 1;\r\n\t\tthis.stopIconIndex = this.addIconIndex(this.stopIconIndex, diff);\r\n\t\tthis.addLastJoinIconIndex(this.stopIconIndex, 3);\r\n\r\n\t\tconsole.log(`stopRoll--- columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},stopIconIndex:${this.stopIconIndex}, lastIndex:${this.lastIndex}`)\r\n\t}\r\n\r\n\tprivate addLastJoinIconIndex(stopIndex: number, value: number) {\r\n\t\tthis.lastIndex = this.addIconIndex(stopIndex, value);\r\n\t}\r\n\r\n\tprivate addIconIndex(index: number, value: number) {\r\n\t\tlet newValue = index + value;\r\n\t\tif (newValue >= this.iconRollerQueue.length) {\r\n\t\t\tnewValue = newValue - this.iconRollerQueue.length;\r\n\t\t}\r\n\t\treturn newValue;\r\n\t}\r\n\r\n\tprivate getStopIconIndex() {\r\n\t\treturn this.stopIconIndex;\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t}\r\n\r\n\t/**获得滚动速度 */\r\n\tprivate getRollSpeed() {\r\n\t\tif (this.rollCount <= 30 || this.stopIconIndex === -1) {\r\n\t\t\t// this.rollCount >= 60 && this.addLastJoinIconIndex(this.stopIconIndex, 1)\r\n\t\t\treturn this.rollerSpeed;\r\n\t\t}\r\n\t\tlet rollerSpeed = this.rollerSpeed;\r\n\t\tif (this.rollCount % 5 === 0) {\r\n\t\t\trollerSpeed -= 5;\r\n\t\t\trollerSpeed = rollerSpeed <= 0 ? 1 : rollerSpeed;\r\n\t\t\tthis.rollerSpeed = rollerSpeed;\r\n\t\t}\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},rollCount:${this.rollCount},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},rollerSpeed:${rollerSpeed}`);\r\n\r\n\t\treturn rollerSpeed;\r\n\t}\r\n\r\n\t/**停止赢的图标闪烁 */\r\n\tpublic stopWinIcon() {\r\n\t\tthis.iconArr.forEach(v => v.hideWin());\r\n\t}\r\n\r\n\t/**播放中奖图标动画 */\r\n\tpublic playWinIcon(index) {\r\n\t\tconst icon = this.iconArr[index];\r\n\t\t\r\n\t\tconsole.log(\"playWinIcon\", index, this.columnIndex,'++++++++++');\r\n\t\t// 如果是WILD图标，并且合并了图标，就不在显示边框了\r\n\t\tif (icon.getId() !== IconId.WILD) {\r\n\t\t\ticon.playWin(this.iconAnimationNode)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rollOverHandle(endIcon: DragonV2Icon) {\r\n\t\tthis.scheduleOnce(() => {\r\n\t\t\tthis.node.isValid && this.rollOverCallback();\r\n\t\t}, 0.05)\r\n\t}\r\n\r\n\t/**\r\n\t * 根据索引获得图标的位置\r\n\t * @param index \r\n\t * @returns \r\n\t */\r\n\tprivate getIconPosByIndex(index: number) {\r\n\t\tconst height = config.normalRollOption.singleRollerHeight;\r\n\t\tconst interval = this.intervalHeight * (index + 1)\r\n\t\tconst y = interval + height / 2 + height * index;\r\n\t\treturn new Vec3(0, y);\r\n\t}\r\n\r\n\t/**获得第一个图标 */\r\n\tpublic getFirstIcon() {\r\n\t\treturn this.iconArr.shift();\r\n\t}\r\n\r\n\tpublic rollerIcon() {\r\n\t\tthis.rollCount++;\r\n\t\tconst speed = this.getRollSpeed();\r\n\t\tthis.iconArr.forEach(v => {\r\n\t\t\tv.setPosition(new Vec3(v.getPosition().x, v.getPosition().y - speed));\r\n\t\t})\r\n\t\tconst frist = this.iconArr[0];\r\n\t\tconst hideY = -(frist.getHeight() + this.intervalHeight)\r\n\t\t// console.log(`columnIndex:${this.columnIndex},slotIndex:${this.slotIndex},lastIndex:${this.lastIndex},stopIconIndex:${this.stopIconIndex},y:${frist.getPosition().y},hideY:${hideY}`);\r\n\t\tif (frist.getPosition().y <= hideY) {\r\n\t\t\tthis.iconArr.shift()\r\n\t\t\tfrist.restore();\r\n\t\t\tthis.joinIcon();\r\n\r\n\t\t\tconst endIcon = this.iconArr[0]\r\n\t\t\tif (endIcon.getIconIndex() === this.getStopIconIndex()) {\r\n\t\t\t\tthis.isRoll = false;\r\n\t\t\t\tthis.stopIconIndex = -1;\r\n\t\t\t\tthis.rollOverHandle(endIcon);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tprotected onDestroy(): void {\r\n\t\tthis.iconArr.forEach(v => v.restore());\r\n\t\tthis.iconArr = [];\r\n\t\tthis.iconRollerQueue = null;\r\n\t\tthis.props_column_effect_node = null;\r\n\t\tthis.iconAnimationNode = null;\r\n\t}\r\n\tupdate(deltaTime: number) {\r\n\t\tif (this.isRoll) {\r\n\t\t\tthis.rollerIcon();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n"]}