{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/dragon/Slot/Command/BgCommand.ts"],"names":["BgCommand","DialogType","CommandDefine","BgMediatorConst","SubGameType","config","getBgProxy","getSocketProxy","BaseCommand","AudioManager","SceneBgMusic","UseSetOption","BgCommandConst","listExecute","type","INIT_MAIN_PANEL","handler","notification","AUTH","sendAnth","GAME_TYPE_CHANGE","fbp","nextGame","getIsChangeGameRunning","gameTypePre","getLastGame","gameTypeNew","sendNotification","START_FLY_BG","INITSCORE","state","window","setTimeout","MAIN","setIsChangeNextGameType","getInstance","playMusic","mainBg","UPDATE_GAME_STATUS","UPDATE_BTN_LABEL","frequency","SUB_GAME1","getTransferGameInfo","getNumberOfRounds","gameBg","SUB_GAME2","gameBgT","BG","AUTO_LAUNCH","UPDATE_BET_AMOUNT","order","getBody","updateBetAmount","checkAutoLaunch","sendLaunch","getNextGame","subtractAutoLaunchTimes","SHOW_DIALOG_WIN","dialogType","amount","keepTime","done","_amount","getCurrentScore","_keepTime","magnification","getMagnification","win","winning","find","item","minRate","maxRate","BIG_WIN","name","MEGA_WIN","SUPER_WIN","JACKPOT","str","getShiftAmount","baseBetAmount","value","Instance","setGameOption","betTarget","lineCount","linesQueue","length","execute"],"mappings":"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","sourcesContent":["import Facade from \"../../Framework/care/Facade\"\r\nimport { INotification } from \"../../Framework/interfaces/INotification\"\r\nimport { DialogType } from \"../Component/dragon_DialogWin\";\r\nimport { CommandDefine } from \"../Const/CommandDefine\";\r\nimport { ProxyDefine } from \"../Const/ProxyDefine\";\r\nimport { BgMediatorConst } from \"../Mediator/BgMediator\";\r\nimport { RollerMediatorConst } from \"../Mediator/RollerMediator\";\r\nimport { SubGameType } from \"../Proxy/SocketProxy\";\r\nimport config from \"../config\";\r\nimport { getBgProxy, getSocketProxy } from \"../utils\";\r\nimport { BaseCommand, IListExecute } from './BaseCommand'\r\nimport {AudioManager, SceneBgMusic} from \"../Managr/AudioManager\";\r\nimport UseSetOption from \"../../../../utils/UseSetOption\";\r\nexport enum BgCommandConst {\r\n\tAUTH = \"authentication\",\r\n\t/**切换游戏界面 */\r\n\tGAME_TYPE_CHANGE = \"gameTypeChange\",\r\n\t/**检查自动启动启动，如果是就进行下一局 */\r\n\tAUTO_LAUNCH = \"autoLaunch\"\r\n}\r\n\r\n// const listNotificationConst: Array<IlistNotificationer<FruitsSlotCommand>> = [\r\n// \t{\r\n// \t\ttype: MainSlotViewType.INIT_MAIN_PANEL,\r\n// \t\thandler(notification: INotification) {\r\n\r\n// \t\t\treturn false\r\n// \t\t}\r\n// \t}\r\n// ]\r\n\r\nexport class BgCommand extends BaseCommand {\r\n\tprotected listExecute: Array<IListExecute<BgCommand>> = [\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.INIT_MAIN_PANEL,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\t// this.updateBetAmount(\"curr\")\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tgetSocketProxy().sendAnth()\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.GAME_TYPE_CHANGE,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\tconst nextGame = fbp.getIsChangeGameRunning()\r\n\t\t\t\tif (nextGame !== -1) {\r\n\t\t\t\t\t// //开始切换屏幕\r\n\t\t\t\t\t// this.sendNotification(CommandDefine.BG, { gameTypePre: fbp.getLastGame(), gameTypeNew: nextGame }, FruitsBgCommandConst.GAME_TYPE_CHANGE)\r\n\t\t\t\t\t// const { gameTypePre, gameTypeNew } = notification.getBody()\r\n\t\t\t\t\tconst gameTypePre = fbp.getLastGame()\r\n\t\t\t\t\tconst gameTypeNew = nextGame\r\n\t\t\t\t\t// 播放飞水果动画,2秒的时候悄悄切换界面\r\n\t\t\t\t\tthis.sendNotification(BgMediatorConst.START_FLY_BG)\r\n                    this.sendNotification(BgMediatorConst.INITSCORE,{state:true})\r\n\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\tif (gameTypeNew === SubGameType.MAIN) {\r\n\t\t\t\t\t\t\t\tgetBgProxy().setIsChangeNextGameType(gameTypePre, 0)\r\n                                AudioManager.getInstance().playMusic(SceneBgMusic.mainBg,true)\r\n                               this.sendNotification(BgMediatorConst.UPDATE_GAME_STATUS)\r\n                               this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:0})\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME1) {\r\n                                this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:getSocketProxy().getTransferGameInfo().getNumberOfRounds()})\r\n\t\t\t\t\t\t\t\tAudioManager.getInstance().playMusic(SceneBgMusic.gameBg,true)\r\n\t\t\t\t\t\t\t} else if (gameTypeNew === SubGameType.SUB_GAME2) {\r\n\t\t\t\t\t\t\t\t//大滑槽\r\n                                this.sendNotification(BgMediatorConst.UPDATE_BTN_LABEL,{frequency:getSocketProxy().getTransferGameInfo().getNumberOfRounds()})\r\n                                AudioManager.getInstance().playMusic(SceneBgMusic.gameBgT,true)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 1000)\r\n\t\t\t\t} else {\r\n                    this.sendNotification(CommandDefine.BG, {}, BgCommandConst.AUTO_LAUNCH)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// {\r\n\t\t// \ttype: BgMediatorConst.UPDATE_NUMBER,\r\n\t\t// \thandler(notification: INotification) {\r\n\t\t// \t\tconst betAmount = this.getSocketProxy().getRepository().userServerData\r\n\t\t// \t\treturn {\r\n\t\t// \t\t\tbetAmount: betAmount,\r\n\t\t// \t\t\tscore: 0\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// },\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.UPDATE_BET_AMOUNT,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tconst { order } = notification.getBody()\r\n\t\t\t\treturn this.updateBetAmount(order)\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgCommandConst.AUTO_LAUNCH,\r\n\t\t\thandler(notification: INotification) {\r\n\t\t\t\tif (getBgProxy().checkAutoLaunch()) {\r\n\t\t\t\t\tgetSocketProxy().sendLaunch()\r\n\r\n\t\t\t\t\tconst fbp = getBgProxy();\r\n\t\t\t\t\tif (fbp.getNextGame() === SubGameType.MAIN) {\r\n\t\t\t\t\t\tgetBgProxy().subtractAutoLaunchTimes()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\ttype: BgMediatorConst.SHOW_DIALOG_WIN,\r\n\t\t\thandler(notification: INotification) {\r\n                const { dialogType, amount, keepTime, order, done } = notification.getBody()\r\n\t\t\t\tconst _amount = amount || getSocketProxy().getTransferGameInfo().getCurrentScore(order)\r\n\t\t\t\tconst _keepTime = keepTime || 3000\r\n\t\t\t\t//获取奖励类型\r\n\t\t\t\tconst magnification = getSocketProxy().getTransferGameInfo().getMagnification()\r\n\t\t\t\tconst win = config.winning.find(item => item.minRate <= magnification && magnification <= item.maxRate)\r\n\t\t\t\tif (win && !dialogType) {\r\n\t\t\t\t\tlet dialogType: DialogType = DialogType.BIG_WIN;\r\n\t\t\t\t\tswitch (win.name) {\r\n\t\t\t\t\t\tcase \"bigwin\": dialogType = DialogType.BIG_WIN; break;\r\n\t\t\t\t\t\tcase \"megawin\": dialogType = DialogType.MEGA_WIN; break;\r\n\t\t\t\t\t\tcase \"superwin\": dialogType = DialogType.SUPER_WIN; break;\r\n\t\t\t\t\t\tcase \"jackpot\": dialogType = DialogType.JACKPOT; break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t} else if (dialogType) {\r\n\t\t\t\t\t//如果dialogType被强制赋值，那么就会强制显示\r\n\t\t\t\t\treturn { dialogType, amount: _amount, keepTime: _keepTime, done }\r\n\t\t\t\t}else {\r\n                    done()\r\n                }\r\n\t\t\t}\r\n\t\t}\r\n\t]\r\n\tprivate updateBetAmount(order: 'add' | 'subtract' | \"max\" | \"curr\") {\r\n        let  str=getSocketProxy().getShiftAmount(order)\r\n        const baseBetAmount = str.value\r\n        UseSetOption.Instance().setGameOption(\"dragon\", { betTarget:str})\r\n        const lineCount = config.linesQueue.length\r\n        return { baseBetAmount, lineCount }\r\n\t}\r\n\tpublic execute(notification: INotification): void {\r\n\t\tsuper.execute(notification)\r\n\t}\r\n}\r\n"]}