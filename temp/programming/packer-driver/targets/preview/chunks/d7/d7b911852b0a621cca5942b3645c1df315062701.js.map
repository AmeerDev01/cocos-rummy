{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/subGame/starlight/components/Thor_AwardBox.ts"],"names":["_decorator","instantiate","Label","Node","sp","tween","UIOpacity","Vec3","BaseComponent","TaskScheduler","Task","footerViewModel","gameBoardViewModel","sourceManageSeletor","getNodePositionInCanvas","dataTransfer","DataKeyType","GameType","JactpotType","ccclass","property","OpenStatus","Thor_AwardBox","propertyNode","props_btn_sg_box","props_spr_result_item","props_particle2D","props_score","taskScheduler","props","boxId","dataId","times","levelUp","fruitFileName","score","BONUS","distance","name","events","onOpenHandler","id","updateTimesHandler","jactpotType","checkFlyEndHandler","onFreeGameAmoundChange","amount","jackPotTypeName","APPLE","STRAWBERRY","GRAPE","WATERMELON","BANANA","LEVEL","start","initState","openStatus","CLOSE","bindEvent","node","on","EventType","TOUCH_END","GAME_TYPE","SUBGAME1","state","OPENING","openAwardBox","useProps","key","value","setState","DONE","thenTimes","SUBGAME_TIMES","OPEN","joinqQueue","done","getComponent","Skeleton","animation","window","setTimeout","active","skeleton","skeletonData","getFile","cur","source","x","y","z","position","setPosition","thenAmound","scoreTask","string","ui","setScale","opacity","target","to","scale","easing","call","particleTask","FREE_GAME_AMOUNT","fly","targetNode","beginPosition","targetPosition","flying","isExecute","comp","getProfitBar","currentGameViewModel","getHeaderNode","children","subscribeDone","getLevelBodyNode","getTimesNode","delayTime","viewNode","addChild","middlePosition","onUpdate","t","bezier","destroy","addComponent","startPos","middlePos","endPos","bindUI","useState","getOpenStatus","destroyCallBack","destoryQueue","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,E,OAAAA,E;AAAYC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;;AAC/EC,MAAAA,a,iBAAAA,a;;AACFC,MAAAA,a;AAAiBC,MAAAA,I,iBAAAA,I;;AACEC,MAAAA,e,iBAAAA,e;AAAkCC,MAAAA,kB,iBAAAA,kB;AAAoBC,MAAAA,mB,iBAAAA,mB;;AACvEC,MAAAA,uB,iBAAAA,uB;;AAEFC,MAAAA,Y;AAAgBC,MAAAA,W,iBAAAA,W;;AACdC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,W,iBAAAA,W;;;;;;;;;OAGb;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBpB,U;;4BAElBqB,U,0BAAAA,U;AAAAA,QAAAA,U,CAAAA,U;AAAAA,QAAAA,U,CAAAA,U;AAAAA,QAAAA,U,CAAAA,U;AAAAA,QAAAA,U,CAAAA,U;eAAAA,U;;;+BA6BCC,a,WADZH,OAAO,CAAC,eAAD,C,gBAAR,MACaG,aADb;AAAA;AAAA,0CACyE;AAAA;AAAA;AAAA,eAE9DC,YAF8D,GAE/C;AACxBC,YAAAA,gBAAgB,EAAE,IAAIrB,IAAJ,EADM;AAExBsB,YAAAA,qBAAqB,EAAE,IAAItB,IAAJ,EAFC;AAGxBuB,YAAAA,gBAAgB,EAAE,IAAIvB,IAAJ,EAHM;AAIxBwB,YAAAA,WAAW,EAAE,IAAIxB,IAAJ;AAJW,WAF+C;AAAA,eAQhEyB,aARgE,GAQjC;AAAA;AAAA,+CARiC;AAAA,eAUjEC,KAViE,GAUjD;AACtBC,YAAAA,KAAK,EAAE,CADe;AAEtBC,YAAAA,MAAM,EAAE,CAAC,CAFa;AAGtBC,YAAAA,KAAK,EAAE,CAHe;AAItBC,YAAAA,OAAO,EAAE,CAJa;AAKtBC,YAAAA,aAAa,EAAE,EALO;AAMtBC,YAAAA,KAAK,EAAE,CANe;AAOtBC,YAAAA,KAAK,EAAE,CAPe;AAQtBC,YAAAA,QAAQ,EAAE,CAAC,CAAD,EAAI,CAAJ,CARY;AAStBC,YAAAA,IAAI,EAAE;AATgB,WAViD;AAAA,eAsBjEC,MAtBiE,GAsBhD;AACvBC,YAAAA,aAAa,EAAGC,EAAD,IAAgB,CAAG,CADX;AAEvBC,YAAAA,kBAAkB,EAAE,CAACV,KAAD,EAAgBW,WAAhB,KAA8C,CAAG,CAF9C;AAGvBC,YAAAA,kBAAkB,EAAE,MAAM,CAAG,CAHN;AAIvBC,YAAAA,sBAAsB,EAAGC,MAAD,IAAoB,CAAG;AAJxB,WAtBgD;AAAA,eAwOhEC,eAxOgE,GAwO9C;AACzB,uBAAW;AAAA;AAAA,4CAAYC,KADE;AAEzB,4BAAgB;AAAA;AAAA,4CAAYC,UAFH;AAGzB,uBAAW;AAAA;AAAA,4CAAYC,KAHE;AAIzB,4BAAgB;AAAA;AAAA,4CAAYC,UAJH;AAKzB,wBAAY;AAAA;AAAA,4CAAYC,MALC;AAMzB,kBAAM;AAAA;AAAA,4CAAYC;AANO,WAxO8C;AAAA;;AACxEC,QAAAA,KAAK,GAAG,CAAG;;AA4BDC,QAAAA,SAAS,GAAG;AACrB,iBAAO;AACNC,YAAAA,UAAU,EAAEnC,UAAU,CAACoC;AADjB,WAAP;AAGA;;AAESC,QAAAA,SAAS,GAAS;AAC3B,eAAKC,IAAL,CAAUC,EAAV,CAAazD,IAAI,CAAC0D,SAAL,CAAeC,SAA5B,EAAuC,MAAM;AAC5C;AACA,gBAAI;AAAA;AAAA,8CAAa;AAAA;AAAA,4CAAYC,SAAzB,MAAwC;AAAA;AAAA,sCAASC,QAArD,EAA+D;AAC9D;AACA;;AACD,gBAAI,KAAKC,KAAL,CAAWT,UAAX,KAA0BnC,UAAU,CAACoC,KAArC,IAA8C,KAAKQ,KAAL,CAAWT,UAAX,KAA0BnC,UAAU,CAAC6C,OAAvF,EAAgG;AAC/F,mBAAKC,YAAL;AACA;AACD,WARD;AASA;;AAESC,QAAAA,QAAQ,CAACC,GAAD,EAAoBC,KAApB,EAAmD;AACpE,eAAK1C,aAAL,GAAqB;AAAA;AAAA,8CAAkB,MAAM;AAC5C,iBAAK2C,QAAL,CAAc;AAAEf,cAAAA,UAAU,EAAEnC,UAAU,CAACmD;AAAzB,aAAd;AACA,WAFoB,CAArB;AAGA,cAAIC,SAAS,GAAG,CAAhB;;AAEA,cAAIJ,GAAG,KAAK,OAAZ,EAAqB;AACpBI,YAAAA,SAAS,GAAG;AAAA;AAAA,8CAAa;AAAA;AAAA,4CAAYC,aAAzB,CAAZ;;AACA,gBAAI,KAAKT,KAAL,CAAWT,UAAX,KAA0BnC,UAAU,CAAC6C,OAAzC,EAAkD;AACjD;AACA;AACA,mBAAKK,QAAL,CAAc;AAAEf,gBAAAA,UAAU,EAAEnC,UAAU,CAACsD;AAAzB,eAAd;AACA,mBAAK/C,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,qBAAKtD,YAAL,CAAkBC,gBAAlB,CAAmCsD,YAAnC,CAAgD1E,EAAE,CAAC2E,QAAnD,EAA6DC,SAA7D,GAAyE,iBAAzE;AACAC,gBAAAA,MAAM,CAACC,UAAP,CAAkB,MAAML,IAAI,EAA5B,EAAgC,IAAhC;AACA,eAH6B,CAA9B;AAIA,mBAAKjD,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,qBAAKtC,MAAL,CAAYK,kBAAZ;AACAiC,gBAAAA,IAAI;AACJ,eAH6B,CAA9B;AAIA;AACD;;AACD,cAAIR,GAAG,KAAK,eAAZ,EAA6B;AAC5BY,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB;AACA,mBAAKtD,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,oBAAI,CAAC,KAAKtD,YAAV,EAAwB;AACvBsD,kBAAAA,IAAI;AACJ;AACA;;AACD,qBAAKtD,YAAL,CAAkBE,qBAAlB,CAAwC0D,MAAxC,GAAiD,IAAjD;AACA,oBAAMC,QAAQ,GAAG,KAAK7D,YAAL,CAAkBE,qBAAlB,CAAwCqD,YAAxC,CAAqD1E,EAAE,CAAC2E,QAAxD,CAAjB;AACAK,gBAAAA,QAAQ,CAACC,YAAT,GAAwB;AAAA;AAAA,kEAAsBC,OAAtB,CAA8BhB,KAAK,CAACiB,GAApC,EAAyCC,MAAjE;AACAJ,gBAAAA,QAAQ,CAACJ,SAAT,GAAqB,WAArB;AACA,oBAAM;AAAES,kBAAAA,CAAF;AAAKC,kBAAAA,CAAL;AAAQC,kBAAAA;AAAR,oBAAc,KAAKpE,YAAL,CAAkBE,qBAAlB,CAAwCmE,QAA5D;AACA,qBAAKrE,YAAL,CAAkBE,qBAAlB,CAAwCoE,WAAxC,CAAoD,IAAItF,IAAJ,CAASkF,CAAC,GAAG,KAAK5D,KAAL,CAAWQ,QAAX,CAAoB,CAApB,CAAb,EAAqCqD,CAAC,GAAG,KAAK7D,KAAL,CAAWQ,QAAX,CAAoB,CAApB,CAAzC,EAAiEsD,CAAjE,CAApD;AACAV,gBAAAA,MAAM,CAACC,UAAP,CAAkB,MAAML,IAAI,EAA5B,EAAgC,IAAhC;AACA,eAZ6B,CAA9B;AAaA,aAfD,EAeG,GAfH;AAgBA;;AACD,cAAIR,GAAG,KAAK,OAAZ,EAAqB;AACpBY,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB,kBAAIY,UAAU,GAAG,CAAjB;AACA,kBAAMC,SAAS,GAAG;AAAA;AAAA,gCAAUlB,IAAD,IAAU;AACpC,oBAAI,CAAC,KAAKtD,YAAV,EAAwB;AACvBsD,kBAAAA,IAAI;AACJ;AACA;;AACD,qBAAKtD,YAAL,CAAkBI,WAAlB,CAA8BmD,YAA9B,CAA2C5E,KAA3C,EAAkD8F,MAAlD,GAA2D1B,KAAK,CAACiB,GAAN,GAAY,EAAvE;AACA,qBAAKhE,YAAL,CAAkBI,WAAlB,CAA8BwD,MAA9B,GAAuC,IAAvC;AACA,oBAAMc,EAAE,GAAG,KAAK1E,YAAL,CAAkBI,WAAlB,CAA8BmD,YAA9B,CAA2CxE,SAA3C,CAAX;AACA,qBAAKiB,YAAL,CAAkBI,WAAlB,CAA8BuE,QAA9B,CAAuC,GAAvC,EAA4C,GAA5C;AACAD,gBAAAA,EAAE,CAACE,OAAH,GAAa,CAAb;AACA9F,gBAAAA,KAAK,GAAG+F,MAAR,CAAeH,EAAf,EAAmBI,EAAnB,CAAsB,GAAtB,EAA2B;AAAEF,kBAAAA,OAAO,EAAE;AAAX,iBAA3B,EAA6C7C,KAA7C;AACAjD,gBAAAA,KAAK,GAAG+F,MAAR,CAAe,KAAK7E,YAAL,CAAkBI,WAAjC,EAA8C0E,EAA9C,CAAiD,GAAjD,EAAsD;AAAEC,kBAAAA,KAAK,EAAE,IAAI/F,IAAJ,CAAS,CAAT,EAAY,CAAZ;AAAT,iBAAtD,EAAiF;AAAEgG,kBAAAA,MAAM,EAAE;AAAV,iBAAjF,EAAwGC,IAAxG,CAA6G,MAAM3B,IAAI,EAAvH,EAA2HvB,KAA3H;AACA,eAZiB,CAAlB,CAFuB,CAevB;;AACA,kBAAMmD,YAAY,GAAG;AAAA;AAAA,gCAAU5B,IAAD,IAAU;AACvC,oBAAI,CAAC,KAAKtD,YAAN,IAAsB,CAAC,KAAKoC,IAAhC,EAAsC;AACrCkB,kBAAAA,IAAI;AACJ;AACA,iBAJsC,CAKvC;;;AACAiB,gBAAAA,UAAU,GAAG;AAAA;AAAA,kDAAa;AAAA;AAAA,gDAAYY,gBAAzB,CAAb;;AACA,oBAAMC,GAAG,GAAIC,UAAD,IAAsB;AACjC,sBAAI,CAACA,UAAL,EAAiB;AAChB/B,oBAAAA,IAAI;AACJ,mBAFD,MAEO;AACN,wBAAMgC,aAAa,GAAG;AAAA;AAAA,4EAAwB,KAAKlD,IAA7B,CAAtB;AACA,wBAAMmD,cAAc,GAAG;AAAA;AAAA,4EAAwBF,UAAxB,CAAvB;AACA,yBAAKG,MAAL,CAAY,KAAKxF,YAAL,CAAkBG,gBAA9B,EAAgDmF,aAAhD,EAA+DC,cAA/D,EAA+E,MAAM;AACpF,uBAACL,YAAY,CAACO,SAAd,IAA2BnC,IAAI,EAA/B;AACA,qBAFD,EAEG,GAFH;AAGA;AACD,iBAVD;;AAWA8B,gBAAAA,GAAG,CAAC;AAAA;AAAA,wDAAgBM,IAAhB,CAAqBC,YAArB,EAAD,CAAH;AACAP,gBAAAA,GAAG,CAAE;AAAA;AAAA,8DAAmBQ,oBAAnB,CAAwC,SAAxC,EAAmDF,IAAnD,CAAwDG,aAAxD,EAAD,CAAkFC,QAAlF,CAA2F,KAAKxF,KAAL,CAAWE,MAAX,GAAoB,CAA/G,CAAD,CAAH;AACA,eApBoB,EAoBlBuF,aApBkB,CAoBJ,GApBI,EAoBC,MAAM;AAC3B;AACA;AACA;AACA;AACA;AACA,oBAAI,CAAC,KAAK/F,YAAV,EAAwB;AACxB,qBAAKgB,MAAL,CAAYG,kBAAZ,CAA+B+B,SAA/B,EAA0C,KAAK1B,eAAL,CAAqB,KAAKlB,KAAL,CAAWS,IAAhC,CAA1C;AACA,qBAAKC,MAAL,CAAYM,sBAAZ,CAAmCiD,UAAnC;AACA,eA7BoB,CAArB;AA8BA,mBAAKlE,aAAL,CAAmBgD,UAAnB,CAA8BmB,SAA9B,EAAyCnB,UAAzC,CAAoD6B,YAApD;AACA,aA/CD,EA+CG,IA/CH;AAgDA;;AACD,cAAIpC,GAAG,KAAK,SAAZ,EAAuB;AACtBY,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB;AACA,mBAAKtD,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,oBAAI,CAAC,KAAKtD,YAAN,IAAsB,CAAC,KAAKoC,IAAhC,EAAsC;AACrCkB,kBAAAA,IAAI;AACJ;AACA;;AACD,oBAAM8B,GAAG,GAAIC,UAAD,IAAsB;AACjC,sBAAI,CAACA,UAAL,EAAiB;AAChB/B,oBAAAA,IAAI;AACJ;AACA;;AACD,sBAAMgC,aAAa,GAAG;AAAA;AAAA,0EAAwB,KAAKlD,IAA7B,CAAtB;AACA,sBAAMmD,cAAc,GAAG;AAAA;AAAA,0EAAwBF,UAAxB,CAAvB;AACA,uBAAKG,MAAL,CAAY,KAAKxF,YAAL,CAAkBE,qBAA9B,EAAqDoF,aAArD,EAAoEC,cAApE,EAAoFjC,IAApF,EAA0F,GAA1F;AACA,iBARD;;AASA8B,gBAAAA,GAAG,CAAC;AAAA;AAAA,8DAAmBQ,oBAAnB,CAAwC,SAAxC,EAAmDF,IAAnD,CAAwDM,gBAAxD,EAAD,CAAH;AACA,eAf6B,EAe3BD,aAf2B,CAeb,GAfa,EAeR,MAAM;AAC3B,qBAAK/E,MAAL,CAAYG,kBAAZ,CAA+B+B,SAA/B,EAA0C,KAAK1B,eAAL,CAAqB,KAAKlB,KAAL,CAAWS,IAAhC,CAA1C;AACA;AACA;AACA,eAnB6B,CAA9B;AAoBA,aAtBD,EAsBG,IAtBH;AAuBA;;AACD,cAAI+B,GAAG,KAAK,OAAZ,EAAqB;AACpBY,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB;AACA;AACA,mBAAKtD,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,oBAAI,CAAC,KAAKtD,YAAN,IAAsB,CAAC,KAAKoC,IAAhC,EAAsC;AACrCkB,kBAAAA,IAAI;AACJ;AACA;;AACD,oBAAM8B,GAAG,GAAIC,UAAD,IAAsB;AACjC,sBAAI,CAACA,UAAL,EAAiB;AAChB/B,oBAAAA,IAAI;AACJ;AACA;;AACD,sBAAMgC,aAAa,GAAG;AAAA;AAAA,0EAAwB,KAAKlD,IAA7B,CAAtB;AACA,sBAAMmD,cAAc,GAAG;AAAA;AAAA,0EAAwBF,UAAxB,CAAvB;AACA,uBAAKG,MAAL,CAAY,KAAKxF,YAAL,CAAkBE,qBAA9B,EAAqDoF,aAArD,EAAoEC,cAApE,EAAoFjC,IAApF,EAA0F,GAA1F;AACA,iBARD;;AASA8B,gBAAAA,GAAG,CAAC;AAAA;AAAA,8DAAmBQ,oBAAnB,CAAwCF,IAAxC,CAA6CO,YAA7C,EAAD,CAAH;AACA,eAf6B,EAe3BF,aAf2B,CAeb,GAfa,EAeR,MAAM;AAC3B;AACA,qBAAK/E,MAAL,CAAYG,kBAAZ,CAA+B+B,SAA/B;AACA,eAlB6B,CAA9B;AAmBA,aAtBD,EAsBG,IAtBH;AAuBA;;AACD,cAAIJ,GAAG,KAAK,OAAZ,EAAqB;AACpBY,YAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACvB,mBAAKtD,aAAL,CAAmBgD,UAAnB,CAA8B;AAAA;AAAA,gCAAUC,IAAD,IAAU;AAChD,oBAAI,CAAC,KAAKtD,YAAN,IAAsB,CAAC;AAAA;AAAA,8DAAmB4F,oBAAnB,CAAwC,SAAxC,EAAmDF,IAAnD,CAAwDG,aAAxD,EAA3B,EAAoG;AACnGvC,kBAAAA,IAAI;AACJ;AACA;;AACD,oBAAMgC,aAAa,GAAG;AAAA;AAAA,wEAAwB;AAAA;AAAA,8DAAmBM,oBAAnB,CAAwC,SAAxC,EAAmDF,IAAnD,CAAwDG,aAAxD,EAAxB,CAAtB;AACA,oBAAMN,cAAc,GAAG;AAAA;AAAA,wEAAwB;AAAA;AAAA,wDAAgBG,IAAhB,CAAqBC,YAArB,EAAxB,CAAvB;AACA,qBAAKH,MAAL,CAAY,KAAKxF,YAAL,CAAkBG,gBAA9B,EAAgDmF,aAAhD,EAA+DC,cAA/D,EAA+EjC,IAA/E,EAAqF,GAArF;AACA,eAR6B,CAA9B;AASA,aAVD,EAUG,IAVH;AAWA;AACD;;AAEOkC,QAAAA,MAAM,CAACpD,IAAD,EAAakD,aAAb,EAAkCC,cAAlC,EAAwDjC,IAAxD,EAAwE4C,SAAxE,EAA+F;AAAA,cAAvBA,SAAuB;AAAvBA,YAAAA,SAAuB,GAAH,CAAG;AAAA;;AAC5G,cAAMb,UAAU,GAAG3G,WAAW,CAAC0D,IAAD,CAA9B;AACAiD,UAAAA,UAAU,CAACzB,MAAX,GAAoB,IAApB;AACA;AAAA;AAAA,wDAAmBuC,QAAnB,CAA4BC,QAA5B,CAAqCf,UAArC;AACAA,UAAAA,UAAU,CAACf,WAAX,CAAuBgB,aAAvB;AACA,cAAIe,cAAc,GAAG,IAAIrH,IAAJ,CAAS,CAACsG,aAAa,CAACpB,CAAd,GAAkBqB,cAAc,CAACrB,CAAlC,IAAuC,CAAhD,EAAmD,CAACoB,aAAa,CAACnB,CAAd,GAAkBoB,cAAc,CAACpB,CAAlC,IAAuC,CAAvC,GAA2C,GAA9F,EAAmG,CAAnG,CAArB;AACArF,UAAAA,KAAK,GAAG+F,MAAR,CAAeQ,UAAf,EAA2BP,EAA3B,CAA8B,GAA9B,EAAmC;AAAET,YAAAA,QAAQ,EAAEkB,cAAZ;AAA4BR,YAAAA,KAAK,EAAE,IAAI/F,IAAJ,CAAS,GAAT,EAAc,GAAd,EAAmB,CAAnB;AAAnC,WAAnC,EAA+F;AAC9FsH,YAAAA,QAAQ,EAAE,CAACzB,MAAD,EAAe0B,CAAf,KAA6B;AACtC,kBAAIlB,UAAJ,EAAgB;AACfA,gBAAAA,UAAU,CAAChB,QAAX,GAAsB,KAAKmC,MAAL,CAAYD,CAAZ,EAAejB,aAAf,EAA8Be,cAA9B,EAA8Cd,cAA9C,CAAtB;AACA;AACD;AAL6F,WAA/F,EAMGN,IANH,CAMQ,MAAM;AACb,gBAAIiB,SAAS,KAAK,CAAlB,EAAqB;AACpBb,cAAAA,UAAU,CAACoB,OAAX;AACAnD,cAAAA,IAAI;AACJ,aAHD,MAGO;AACN,kBAAI+B,UAAJ,EAAgB;AACf;AACAA,gBAAAA,UAAU,CAAC9B,YAAX,CAAwBxE,SAAxB,KAAsCsG,UAAU,CAACqB,YAAX,CAAwB3H,SAAxB,CAAtC;AACAD,gBAAAA,KAAK,CAACuG,UAAU,CAAC9B,YAAX,CAAwBxE,SAAxB,CAAD,CAAL,CAA0C+F,EAA1C,CAA6CoB,SAA7C,EAAwD;AAAEtB,kBAAAA,OAAO,EAAE;AAAX,iBAAxD,EAAwEK,IAAxE,CAA6E,MAAM;AAClFI,kBAAAA,UAAU,CAACoB,OAAX;AACA,iBAFD,EAEG1E,KAFH;AAGA;;AACDuB,cAAAA,IAAI;AACJ,aAbY,CAcb;;AACA,WArBD,EAqBGvB,KArBH;AAsBA;;AAWOyE,QAAAA,MAAM,CAACD,CAAD,EAAYI,QAAZ,EAA4BC,SAA5B,EAA6CC,MAA7C,EAA2D;AACxE,cAAI3C,CAAC,GAAG,CAAC,IAAIqC,CAAL,KAAW,IAAIA,CAAf,IAAoBI,QAAQ,CAACzC,CAA7B,GAAiC,IAAIqC,CAAJ,IAAS,IAAIA,CAAb,IAAkBK,SAAS,CAAC1C,CAA7D,GAAiEqC,CAAC,GAAGA,CAAJ,GAAQM,MAAM,CAAC3C,CAAxF;AACA,cAAIC,CAAC,GAAG,CAAC,IAAIoC,CAAL,KAAW,IAAIA,CAAf,IAAoBI,QAAQ,CAACxC,CAA7B,GAAiC,IAAIoC,CAAJ,IAAS,IAAIA,CAAb,IAAkBK,SAAS,CAACzC,CAA7D,GAAiEoC,CAAC,GAAGA,CAAJ,GAAQM,MAAM,CAAC1C,CAAxF;AACA,iBAAO,IAAInF,IAAJ,CAASkF,CAAT,EAAYC,CAAZ,EAAe,CAAf,CAAP;AACA;AAED;;;AACOvB,QAAAA,YAAY,GAAG;AACrB,eAAKI,QAAL,CAAc;AAAEf,YAAAA,UAAU,EAAEnC,UAAU,CAAC6C;AAAzB,WAAd;AACA,eAAK3B,MAAL,CAAYC,aAAZ,CAA0B,KAAKX,KAAL,CAAWC,KAArC;AACA;;AACSuG,QAAAA,MAAM,GAAS;AACxB,eAAKC,QAAL,CAAc,CAACjE,GAAD,EAAMC,KAAN,KAAgB,CAC7B;AAEA,WAHD,EAGG,CAAC,YAAD,CAHH;AAIA;;AAEMiE,QAAAA,aAAa,GAAG;AACtB,iBAAO,KAAKtE,KAAL,CAAWT,UAAlB;AACA;;AAESgF,QAAAA,eAAe,GAAG;AAC3B,eAAK5G,aAAL,CAAmB6G,YAAnB;AACA;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AA7QuE,O","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, sp, Sprite, tween, UIOpacity, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../../base/BaseComponent';\r\nimport TaskScheduler, { Task, TaskSchedulerDefault } from '../../../utils/TaskScheduler';\r\nimport { bundleStarlight, footerViewModel, starlight_Audio, gameBoardViewModel, sourceManageSeletor } from '../index';\r\nimport { getNodePositionInCanvas } from '../../../utils/tool';\r\nimport { updateSubGameTimes } from '../store/actions/game';\r\nimport dataTransfer, { DataKeyType } from '../dataTransfer';\r\nimport { GameType, JactpotType } from '../type';\r\nimport config from '../config';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum OpenStatus {\r\n\tCLOSE,\r\n\tOPENING,\r\n\tOPEN,\r\n\tDONE\r\n}\r\nexport interface IState {\r\n\topenStatus: OpenStatus\r\n}\r\n\r\nexport interface IProps {\r\n\tboxId: number,\r\n\tdataId: number,\r\n\ttimes: number,\r\n\tlevelUp: number,\r\n\tfruitFileName: string,\r\n\tscore: number,\r\n\tBONUS: number,\r\n\tdistance: number[],\r\n\tname: string\r\n}\r\nexport interface IEvent {\r\n\tonOpenHandler: (id: number) => void,\r\n\tupdateTimesHandler: (times: number, jactpotType?: JactpotType) => void,\r\n\tcheckFlyEndHandler: () => void,\r\n\tonFreeGameAmoundChange: (amount: number) => void\r\n}\r\n\r\n@ccclass('Thor_AwardBox')\r\nexport class Thor_AwardBox extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprotected propertyNode = {\r\n\t\tprops_btn_sg_box: new Node(),\r\n\t\tprops_spr_result_item: new Node(),\r\n\t\tprops_particle2D: new Node(),\r\n\t\tprops_score: new Node()\r\n\t}\r\n\tprivate taskScheduler: TaskScheduler = new TaskScheduler()\r\n\r\n\tpublic props: IProps = {\r\n\t\tboxId: 0,\r\n\t\tdataId: -1,\r\n\t\ttimes: 0,\r\n\t\tlevelUp: 0,\r\n\t\tfruitFileName: \"\",\r\n\t\tscore: 0,\r\n\t\tBONUS: 0,\r\n\t\tdistance: [0, 0],\r\n\t\tname: ''\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\t\tonOpenHandler: (id: number) => { },\r\n\t\tupdateTimesHandler: (times: number, jactpotType?: JactpotType) => { },\r\n\t\tcheckFlyEndHandler: () => { },\r\n\t\tonFreeGameAmoundChange: (amount: number) => { }\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {\r\n\t\t\topenStatus: OpenStatus.CLOSE\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\t\tthis.node.on(Node.EventType.TOUCH_END, () => {\r\n\t\t\t// console.log('GAME_TYPE', dataTransfer(DataKeyType.GAME_TYPE))\r\n\t\t\tif (dataTransfer(DataKeyType.GAME_TYPE) !== GameType.SUBGAME1) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (this.state.openStatus === OpenStatus.CLOSE || this.state.openStatus === OpenStatus.OPENING) {\r\n\t\t\t\tthis.openAwardBox()\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tthis.taskScheduler = new TaskScheduler(() => {\r\n\t\t\tthis.setState({ openStatus: OpenStatus.DONE })\r\n\t\t})\r\n\t\tlet thenTimes = 0\r\n\r\n\t\tif (key !== \"boxId\") {\r\n\t\t\tthenTimes = dataTransfer(DataKeyType.SUBGAME_TIMES)\r\n\t\t\tif (this.state.openStatus === OpenStatus.OPENING) {\r\n\t\t\t\t//执行贝壳动作\r\n\t\t\t\t// this.setState({ hasOpen: true })\r\n\t\t\t\tthis.setState({ openStatus: OpenStatus.OPEN })\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tthis.propertyNode.props_btn_sg_box.getComponent(sp.Skeleton).animation = 'diankaibaoxiang'\r\n\t\t\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t\t\t}))\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tthis.events.checkFlyEndHandler()\r\n\t\t\t\t\tdone()\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (key === \"fruitFileName\") {\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t//加定时器是确保distance肯定有数据\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.propertyNode.props_spr_result_item.active = true\r\n\t\t\t\t\tconst skeleton = this.propertyNode.props_spr_result_item.getComponent(sp.Skeleton)\r\n\t\t\t\t\tskeleton.skeletonData = sourceManageSeletor().getFile(value.cur).source\r\n\t\t\t\t\tskeleton.animation = \"animation\"\r\n\t\t\t\t\tconst { x, y, z } = this.propertyNode.props_spr_result_item.position\r\n\t\t\t\t\tthis.propertyNode.props_spr_result_item.setPosition(new Vec3(x + this.props.distance[0], y + this.props.distance[1], z))\r\n\t\t\t\t\twindow.setTimeout(() => done(), 1000)\r\n\t\t\t\t}))\r\n\t\t\t}, 100)\r\n\t\t}\r\n\t\tif (key === \"score\") {\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tlet thenAmound = 0\r\n\t\t\t\tconst scoreTask = new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.propertyNode.props_score.getComponent(Label).string = value.cur + ''\r\n\t\t\t\t\tthis.propertyNode.props_score.active = true\r\n\t\t\t\t\tconst ui = this.propertyNode.props_score.getComponent(UIOpacity)\r\n\t\t\t\t\tthis.propertyNode.props_score.setScale(1.3, 1.3)\r\n\t\t\t\t\tui.opacity = 0\r\n\t\t\t\t\ttween().target(ui).to(0.2, { opacity: 255 }).start()\r\n\t\t\t\t\ttween().target(this.propertyNode.props_score).to(0.7, { scale: new Vec3(1, 1) }, { easing: \"backOut\" }).call(() => done()).start()\r\n\t\t\t\t})\r\n\t\t\t\t//飞粒子\r\n\t\t\t\tconst particleTask = new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// starlight_Audio.playOneShot(SoundPathDefine.FRUIT_UP)\r\n\t\t\t\t\tthenAmound = dataTransfer(DataKeyType.FREE_GAME_AMOUNT)\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\t\tthis.flying(this.propertyNode.props_particle2D, beginPosition, targetPosition, () => {\r\n\t\t\t\t\t\t\t\t!particleTask.isExecute && done()\r\n\t\t\t\t\t\t\t}, 0.6)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(footerViewModel.comp.getProfitBar())\r\n\t\t\t\t\tfly((gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode() as Node).children[this.props.dataId - 1])\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\t// if (dataTransfer(DataKeyType.GAME_TYPE) === GameType.SUBGAME1) {\r\n\t\t\t\t\t// \t//如果已经要换游戏了，就不更新次数了，不然更新的是下一个游戏的剩余次数\r\n\t\t\t\t\t// \tthis.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tif (!this.propertyNode) return\r\n\t\t\t\t\tthis.events.updateTimesHandler(thenTimes, this.jackPotTypeName[this.props.name])\r\n\t\t\t\t\tthis.events.onFreeGameAmoundChange(thenAmound)\r\n\t\t\t\t})\r\n\t\t\t\tthis.taskScheduler.joinqQueue(scoreTask).joinqQueue(particleTask)\r\n\t\t\t}, 1000)\r\n\t\t}\r\n\t\tif (key === \"levelUp\") {\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t// starlight_Audio.playOneShot(SoundPathDefine.LEVEV_UP)\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\tthis.flying(this.propertyNode.props_spr_result_item, beginPosition, targetPosition, done, 0.1)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(gameBoardViewModel.currentGameViewModel['jackpot'].comp.getLevelBodyNode())\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\tthis.events.updateTimesHandler(thenTimes, this.jackPotTypeName[this.props.name])\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\t// this.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t}))\r\n\t\t\t}, 2000)\r\n\t\t}\r\n\t\tif (key === \"times\") {\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t// starlight_Audio.playOneShot(SoundPathDefine.GET_COIN)\r\n\t\t\t\t//确保资源被替换之后\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !this.node) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst fly = (targetNode: Node) => {\r\n\t\t\t\t\t\tif (!targetNode) {\r\n\t\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(this.node)\r\n\t\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(targetNode)\r\n\t\t\t\t\t\tthis.flying(this.propertyNode.props_spr_result_item, beginPosition, targetPosition, done, 0.1)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfly(gameBoardViewModel.currentGameViewModel.comp.getTimesNode())\r\n\t\t\t\t}).subscribeDone('1', () => {\r\n\t\t\t\t\t/**这里取的是开宝箱后当时的数据 */\r\n\t\t\t\t\tthis.events.updateTimesHandler(thenTimes)\r\n\t\t\t\t}))\r\n\t\t\t}, 2000)\r\n\t\t}\r\n\t\tif (key === \"BONUS\") {\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tthis.taskScheduler.joinqQueue(new Task((done) => {\r\n\t\t\t\t\tif (!this.propertyNode || !gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode()) {\r\n\t\t\t\t\t\tdone()\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst beginPosition = getNodePositionInCanvas(gameBoardViewModel.currentGameViewModel['jackpot'].comp.getHeaderNode())\r\n\t\t\t\t\tconst targetPosition = getNodePositionInCanvas(footerViewModel.comp.getProfitBar())\r\n\t\t\t\t\tthis.flying(this.propertyNode.props_particle2D, beginPosition, targetPosition, done, 0.2)\r\n\t\t\t\t}))\r\n\t\t\t}, 2000)\r\n\t\t}\r\n\t}\r\n\r\n\tprivate flying(node: Node, beginPosition: Vec3, targetPosition: Vec3, done: Function, delayTime: number = 0) {\r\n\t\tconst targetNode = instantiate(node)\r\n\t\ttargetNode.active = true\r\n\t\tgameBoardViewModel.viewNode.addChild(targetNode)\r\n\t\ttargetNode.setPosition(beginPosition)\r\n\t\tlet middlePosition = new Vec3((beginPosition.x + targetPosition.x) / 2, (beginPosition.y + targetPosition.y) / 2 + 300, 0)\r\n\t\ttween().target(targetNode).to(0.7, { position: targetPosition, scale: new Vec3(0.5, 0.5, 1) }, {\r\n\t\t\tonUpdate: (target: Vec3, t: number) => {\r\n\t\t\t\tif (targetNode) {\r\n\t\t\t\t\ttargetNode.position = this.bezier(t, beginPosition, middlePosition, targetPosition);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).call(() => {\r\n\t\t\tif (delayTime === 0) {\r\n\t\t\t\ttargetNode.destroy()\r\n\t\t\t\tdone()\r\n\t\t\t} else {\r\n\t\t\t\tif (targetNode) {\r\n\t\t\t\t\t// 透明度暂不支持粒子\r\n\t\t\t\t\ttargetNode.getComponent(UIOpacity) && targetNode.addComponent(UIOpacity)\r\n\t\t\t\t\ttween(targetNode.getComponent(UIOpacity)).to(delayTime, { opacity: 0 }).call(() => {\r\n\t\t\t\t\t\ttargetNode.destroy()\r\n\t\t\t\t\t}).start()\r\n\t\t\t\t}\r\n\t\t\t\tdone()\r\n\t\t\t}\r\n\t\t\t// tween(targetNode).to(0.2, { scale: new Vec3(0.5, 0.5, 1) }).start()\r\n\t\t}).start()\r\n\t}\r\n\r\n\tprivate jackPotTypeName = {\r\n\t\t\"BxApple\": JactpotType.APPLE,\r\n\t\t\"BxStrawberry\": JactpotType.STRAWBERRY,\r\n\t\t\"BxGrape\": JactpotType.GRAPE,\r\n\t\t\"BxWatermelon\": JactpotType.WATERMELON,\r\n\t\t\"BxBanana\": JactpotType.BANANA,\r\n\t\t\"up\": JactpotType.LEVEL,\r\n\t}\r\n\r\n\tprivate bezier(t: number, startPos: Vec3, middlePos: Vec3, endPos: Vec3) {\r\n\t\tlet x = (1 - t) * (1 - t) * startPos.x + 2 * t * (1 - t) * middlePos.x + t * t * endPos.x;\r\n\t\tlet y = (1 - t) * (1 - t) * startPos.y + 2 * t * (1 - t) * middlePos.y + t * t * endPos.y;\r\n\t\treturn new Vec3(x, y, 0);\r\n\t}\r\n\r\n\t/**为什么要提出来，因为便于自定执行器调用 */\r\n\tpublic openAwardBox() {\r\n\t\tthis.setState({ openStatus: OpenStatus.OPENING })\r\n\t\tthis.events.onOpenHandler(this.props.boxId)\r\n\t}\r\n\tprotected bindUI(): void {\r\n\t\tthis.useState((key, value) => {\r\n\t\t\t//执行开箱子的动作\r\n\r\n\t\t}, [\"openStatus\"])\r\n\t}\r\n\r\n\tpublic getOpenStatus() {\r\n\t\treturn this.state.openStatus\r\n\t}\r\n\r\n\tprotected destroyCallBack() {\r\n\t\tthis.taskScheduler.destoryQueue()\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}