{"version":3,"sources":["file:///Users/geliang/web/dibai/hall/assets/script/hall/components/Hall_WinningBox.ts"],"names":["_decorator","instantiate","Label","Node","Sprite","SpriteFrame","tween","UITransform","Vec3","BaseComponent","baseBoardView","bundleCommon","bundleHall","global","hallAudio","SoundPathDefine","addToastAction","ToastType","ccclass","property","Hall_WinningBox","winningList","isDone","propertyNode","props_zhongjiangbox_template","props","newWinningItem","events","start","initState","bindEvent","useProps","key","value","cur","push","showWinning","pushWinningData","winningType","length","shift","showItem","node","wrapNode","mainPanelViewModel","comp","subGameInfo","getPropertyNode","props_winnerBox","props_winningBox","addChild","active","getChildByName","getComponent","string","memberVo","nickName","amount","formatAmountWithLetter2","load","gameId","err","sp","spriteFrame","e","console","log","avatarIndex","x","y","position","width","playOneShot","WINNING","_tween","to","easing","delay","call","destroy","once","EventType","TOUCH_END","stop","scale","hallDispatch","content","type","ERROR","bindUI","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Sprite, SpriteFrame, tween, UITransform, Vec3 } from 'cc';\r\nimport { BaseComponent } from '../../base/BaseComponent';\r\nimport { baseBoardView, bundleCommon, bundleHall, global, hallAudio } from '../index';\r\nimport { SoundPathDefine } from '../sourceDefine/soundDefine';\r\nimport { addToastAction, ToastType } from '../store/actions/baseBoard';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport type WinningType = {\r\n\tamount: number,\r\n\tgameId: number,\r\n\tmemberVo: {\r\n\t\tavatarIndex: number,\r\n\t\tnickName: string\r\n\t}\r\n}\r\n\r\nexport interface IState {\r\n\r\n}\r\n\r\nexport interface IProps {\r\n\tnewWinningItem: WinningType\r\n}\r\nexport interface IEvent {\r\n\r\n}\r\n\r\n@ccclass('Hall_WinningBox')\r\nexport class Hall_WinningBox extends BaseComponent<IState, IProps, IEvent> {\r\n\tstart() { }\r\n\tprivate winningList: Array<WinningType> = []\r\n\tprivate isDone: boolean = true\r\n\r\n\r\n\tprotected propertyNode = {\r\n\t\tprops_zhongjiangbox_template: new Node()\r\n\t}\r\n\r\n\tpublic props: IProps = {\r\n\t\tnewWinningItem: null\r\n\t}\r\n\r\n\tpublic events: IEvent = {\r\n\r\n\t}\r\n\r\n\tprotected initState() {\r\n\t\treturn {}\r\n\t}\r\n\r\n\tprotected bindEvent(): void {\r\n\r\n\t}\r\n\r\n\tprotected useProps(key: keyof IProps, value: { pre: any, cur: any }) {\r\n\t\tif (key === \"newWinningItem\" && value.cur) {\r\n\t\t\tthis.winningList.push(value.cur)\r\n\t\t\tthis.isDone && this.showWinning()\r\n\t\t}\r\n\t}\r\n\r\n\tpublic pushWinningData(winningType: WinningType) {\r\n\t\tif (!winningType) return\r\n\t\tif (this.winningList.length >= 5) {\r\n\t\t\tthis.winningList.shift()\r\n\t\t}\r\n\t\tthis.winningList.push(winningType)\r\n\t\tthis.isDone && this.showWinning()\r\n\t}\r\n\r\n\tprivate showWinning() {\r\n\t\tif (!this.winningList.length) {\r\n\t\t\tthis.isDone = true\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tthis.isDone = false\r\n\t\t\t\tconst showItem = this.winningList.shift()\r\n\t\t\t\tconst node: Node = instantiate(this.propertyNode.props_zhongjiangbox_template)\r\n\t\t\t\t//如果处于字游戏中，就在最上层弹出，如果在大厅，就在中层弹出\r\n\t\t\t\tconst wrapNode = (baseBoardView.mainPanelViewModel.comp.props.subGameInfo ?\r\n\t\t\t\t\tbaseBoardView.comp.getPropertyNode().props_winnerBox : baseBoardView.mainPanelViewModel.comp.getPropertyNode().props_winningBox) as Node\r\n\t\t\t\twrapNode.addChild(node)\r\n\t\t\t\tnode.active = true\r\n\t\t\t\tnode.getChildByName(\"label_playerName\").getComponent(Label).string = showItem.memberVo.nickName\r\n\t\t\t\tnode.getChildByName(\"label_goldNum\").getComponent(Label).string = showItem.amount.formatAmountWithLetter2(false)\r\n\t\t\t\tbundleHall.load(`icon/smallIcon/game_${showItem.gameId}/spriteFrame`, SpriteFrame, (err, sp) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t!err && (node.getChildByName(\"game_spr_icon\").getComponent(Sprite).spriteFrame = sp)\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tbundleCommon.load(`resource/head/head_circle_${showItem.memberVo.avatarIndex}/spriteFrame`, SpriteFrame, (err, sp) => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t!err && (node.getChildByName(\"head_circle_2\").getComponent(Sprite).spriteFrame = sp)\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.log(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tconst { x, y } = node.position\r\n\t\t\t\tconst width = node.getComponent(UITransform).width\r\n\t\t\t\thallAudio.playOneShot(SoundPathDefine.WINNING)\r\n\t\t\t\tconst _tween = tween(node).to(0.3, { position: new Vec3(x - width, y) }, { easing: \"backOut\" }).delay(2).to(0.1, { position: new Vec3(x, y) }).call(() => {\r\n\t\t\t\t\tnode && node.destroy()\r\n\t\t\t\t\tthis && this.showWinning()\r\n\t\t\t\t}).start()\r\n\t\t\t\tnode.once(Node.EventType.TOUCH_END, () => {\r\n\t\t\t\t\t_tween && _tween.stop()\r\n\t\t\t\t\tnode && tween(node).to(0.05, { scale: new Vec3(0, 0, 0) }).call(() => {\r\n\t\t\t\t\t\tnode && node.destroy()\r\n\t\t\t\t\t\tif (this) {\r\n\t\t\t\t\t\t\tthis.winningList = []\r\n\t\t\t\t\t\t\tthis.showWinning()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).start()\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tglobal.hallDispatch(addToastAction({ content: e, type: ToastType.ERROR }))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected bindUI(): void {\r\n\t\t// this.propertyNode.props_zhongjiangbox_template.active = false\r\n\t}\r\n\r\n\tupdate(deltaTime: number) {\r\n\r\n\t}\r\n}\r\n\r\n"]}